<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>UAF CGPA Calculator - M Saqlain | Automatic & Accurate</title>
  
  <meta name="description" content="The best UAF CGPA Calculator. Automatically fetches results from UAF LMS to calculate your exact CGPA and percentage. Easy to use for all UAF students." />
  
  <meta name="keywords" content="uaf cgpa calculator, university of agriculture faisalabad, uaf lms, uaf results, gpa calculator uaf, cgpa calculator for uaf, uaf grading system, calculate uaf cgpa" />
  
  <meta name="author" content="Muhammad Saqlain" />

  <meta name="google-site-verification" content="google3e44586abf077c1e" />
  
  <link rel="canonical" href="https://uafcgpacalculator.vercel.app" />

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#7a6ad8">
  
  <meta property="og:title" content=" - Automatic & Accurate" />
  <meta property="og:description" content="Instantly fetch results from the UAF LMS and calculate your exact CGPA and percentage. The best tool for all UAF students." />
  <meta property="og:url" content="https://uafcgpacalculator.vercel.app/" />
  <meta property="og:site_name" content="" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://uafcgpacalculator.vercel.app/uafcgpacalculator.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content="en_US" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://uafcgpacalculator.vercel.app/" />
  <meta name="twitter:title" content=" - Automatic & Accurate" />
  <meta name="twitter:description" content="The #1 tool for UAF students. Automatically fetch results from the LMS to calculate your exact CGPA. Fast, free, and secure." />
  <meta name="twitter:image" content="https://uafcgpacalculator.vercel.app/uafcgpacalculator.png" />
  <meta name="twitter:creator" content="@M_Saqlain_Akbar" />

  <meta name="google-site-verification" content="zClcBWKWCeJyEGq-plDV2JvodudE4m_t8OK4sBMj8aw" />
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MJW7HPPS');</script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "",
    "url": "https://uafcgpacalculator.vercel.app/",
    "applicationCategory": "EducationalApplication",
    "description": "An automatic CGPA calculator for students of the University of Agriculture Faisalabad (UAF) that fetches results directly from the university's LMS.",
    "operatingSystem": "All",
    "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "PKR"
    },
    "creator": {
      "@type": "Person",
      "name": "Muhammad Saqlain"
    },
    "mainEntity": [
      {
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How does the  work?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The UAF CGPA Calculator securely connects to the public UAF LMS portal using your registration number. It fetches your official results, processes the grades and credit hours according to the official UAF grading formula, and instantly calculates your precise Semester GPA and Cumulative GPA (CGPA)."
            }
          },
          {
            "@type": "Question",
            "name": "Is it safe to use my registration number?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, it is completely safe. The calculator only requires your registration number, not your password. Your information is used only for fetching your result for the current session and is never stored or shared. The connection is secure and private."
            }
          },
          {
            "@type": "Question",
            "name": "Can I use this calculator for other universities?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "This calculator is specifically designed for the students of the University of Agriculture, Faisalabad (UAF). It uses UAF's unique grading system and connects directly to the UAF LMS, so it will not work for other universities."
            }
          }
        ]
      },
      {
        "@type": "HowTo",
        "name": "How to Use the ",
        "step": [
          {
            "@type": "HowToStep",
            "text": "Enter your full registration number (e.g., 2020-ag-1234) into the input field.",
            "name": "Enter Registration Number"
          },
          {
            "@type": "HowToStep",
            "text": "Click the 'Fetch Result' button to securely connect to the UAF LMS and retrieve your academic records.",
            "name": "Fetch Your Results"
          },
          {
            "@type": "HowToStep",
            "text": "View your automatically calculated CGPA, percentage, and detailed semester-wise results.",
            "name": "View Your CGPA"
          },
          {
            "@type": "HowToStep",
            "text": "Optionally, download a premium PDF of your transcript or use the forecast feature to plan for future semesters.",
            "name": "Download or Forecast"
          }
        ]
      }
    ]
  }
</script>


  <script src="https://analytics.ahrefs.com/analytics.js" data-key="CWWh1lx4Kz/fCxT0UN7M0w" async></script>
  
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
  --brand: #7a6ad8;
  --brand-600: #6b5fca;
  --brand-700: #5d52b8;
  --brand-gradient: linear-gradient(135deg, #7a6ad8 0%, #6b5fca 50%, #5d52b8 100%);
  --brand-gradient-hover: linear-gradient(135deg, #8a7ce8 0%, #7b6fda 50%, #6d62c8 100%);
  --accent: #ff6b6b;
  --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
  --text: #1b1f24;
  --text-light: #4b5563;
  --muted: #6b7280;
  --light-bg: #f8f9ff;
  --card-bg: #ffffff;
  --radius: 1.25rem;
  --shadow: 0 10px 30px rgba(17, 24, 39, 0.1);
  --shadow-hover: 0 15px 40px rgba(17, 24, 39, 0.15);
  
  /* New gradient variables */
  --brand-primary: #7a6ad8;
  --brand-secondary: #6b5fca;
}

html, body {
  font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  scroll-behavior: smooth;
}

body {
  display: flex; /* ADDED: Makes the body a flex container */
  flex-direction: column; /* ADDED: Stacks children vertically */
  background-color: var(--light-bg);
  min-height: 100vh;
  margin: 0;
  padding: 0;
  color: var(--text);
}

/* Improved navbar with glassmorphism effect */
.navbar {
  backdrop-filter: saturate(180%) blur(12px);
  background-color: rgba(255, 255, 255, 0.8);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.navbar .navbar-brand {
  font-weight: 800;
  letter-spacing: .3px;
  color: var(--brand);
  transition: all 0.3s ease;
}

.navbar .navbar-brand:hover {
  transform: translateY(-1px);
}

.navbar .nav-link {
  position: relative;
  font-weight: 500;
  transition: all 0.3s ease;
  color: var(--text);
}

.navbar .nav-link::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--brand-gradient);
  transition: width 0.3s ease;
}

.navbar .nav-link:hover::after {
  width: 100%;
}

/* Improved buttons */
.btn-brand {
  background: var(--brand-gradient);
  border: none;
  color: white;
  transition: all 0.3s ease;
  box-shadow: var(--shadow);
}

.btn-brand:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  color: white;
}

.btn-soft {
  background: rgba(122, 106, 216, 0.1);
  color: var(--brand);
  transition: all 0.3s ease;
}

.btn-soft:hover {
  background: rgba(122, 106, 216, 0.2);
  transform: translateY(-1px);
}

.badge-brand {
  background: var(--brand-gradient);
  color: white;
}

.btn-primary-action {
  background: var(--brand-gradient);
  color: #fff;
  border: 0;
  box-shadow: 0 6px 18px rgba(122, 106, 216, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-primary-action:hover {
  background: var(--brand-gradient-hover);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(122, 106, 216, 0.3);
}

.btn-secondary-action {
  background: #fff;
  color: var(--brand);
  border: 1px solid rgba(122, 106, 216, 0.15);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-secondary-action:hover {
  background: #f8f9ff;
  color: var(--brand);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.1);
}

.btn-danger-action {
  background: var(--accent-gradient);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-danger-action:hover {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  transform: translateY(-2px);
}

.btn-success-action {
  background: linear-gradient(135deg, #10ac84 0%, #0d916b 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-success-action:hover {
  background: linear-gradient(135deg, #12c29a 0%, #0fa57c 100%);
  color: white;
  transform: translateY(-2px);
}

/* Improved hero section */
.hero {
  padding: 5rem 0 4rem;
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: '';
  position: absolute;
  top: -100px;
  right: -100px;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  background: rgba(122, 106, 216, 0.1);
  z-index: -1;
}

.hero::after {
  content: '';
  position: absolute;
  bottom: -50px;
  left: -50px;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: rgba(255, 107, 107, 0.1);
  z-index: -1;
}

.hero h1 {
  font-weight: 800;
  line-height: 1.05;
  font-size: 3.5rem;
  margin-bottom: 1.5rem;
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero .lead {
  color: var(--text-light);
  font-size: 1.25rem;
  margin-bottom: 2rem;
}

.mt-3 {
  margin-top: 1rem !important;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

/* Improved cards with glassmorphism effect */
.card-modern {
  border: 0;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  overflow: hidden;
  color: var(--text);
}

.card-modern:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.card-modern .card-header {
  border: 0;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  padding: 1.5rem 2rem;
}

.card-modern .card-header h4 {
  font-weight: 700;
  color: var(--text);
  text-align: center; /* Center header text */
}

.form-select, .form-control {
  border-radius: .85rem;
  border: 1px solid rgba(122, 106, 216, 0.2);
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
  color: var(--text);
  background-color: rgba(255, 255, 255, 0.9);
}

.form-select:focus, .form-control:focus {
  border-color: var(--brand);
  box-shadow: 0 0 0 0.25rem rgba(122, 106, 216, 0.25);
}

label {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 0.5rem;
}

.subject-row {
  border: 1px dashed rgba(122, 106, 216, 0.3);
  border-radius: 1rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.5);
  transition: all 0.3s ease;
}

.subject-row:hover {
  border-color: var(--brand);
  background: rgba(255, 255, 255, 0.8);
}

.result-display {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--brand);
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Improved loading animations */
.loading-container {
  margin-top: 1.5rem;
  text-align: center;
  padding: 3rem 2rem;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.1), rgba(122, 106, 216, 0.05));
  display: none;
  backdrop-filter: blur(10px);
}

.loading-stage {
  display: none;
}

.loading-animation {
  width: 80px;
  height: 80px;
  margin: 0 auto 1.5rem;
  position: relative;
}

.loading-connecting {
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-connecting .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--brand);
  margin: 0 5px;
  animation: bounce 1.5s infinite ease-in-out;
}

.loading-connecting .dot:nth-child(2) {
  animation-delay: 0.2s;
}

.loading-connecting .dot:nth-child(3) {
  animation-delay: 0.4s;
}

.loading-complete .checkmark {
  width: 80px;
  height: 80px;
  margin: 0 auto;
  position: relative;
}

.loading-complete .checkmark:before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 40px;
  height: 20px;
  border: 6px solid var(--brand);
  border-top: none;
  border-right: none;
  transform: translate(-50%, -60%) rotate(-45deg);
  animation: checkmark 0.6s ease-in-out;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

@keyframes checkmark {
  0% { opacity: 0; transform: translate(-50%, -60%) rotate(-45deg) scale(0); }
  50% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1.2); }
  100% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1); }
}

.loading-text {
  font-weight: 600;
  color: var(--brand);
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.loading-subtext {
  color: var(--muted);
  font-size: 0.9rem;
  max-width: 400px;
  margin: 0 auto;
}

.status-log {
  max-height: 300px;
  overflow-y: auto;
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1rem;
  font-family: monospace;
  font-size: 0.875rem;
  margin-bottom: 1rem;
  backdrop-filter: blur(10px);
}

.status-line {
  margin-bottom: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(233, 236, 239, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
}

.status-line:hover {
  background: rgba(255, 255, 255, 0.5);
  border-radius: 0.25rem;
  padding-left: 0.5rem;
}

.status-line:last-child {
  margin-bottom: 0;
  border-bottom: none;
}

.status-success { color: #28a745; }
.status-error { color: #dc3545; }
status-warning { color: #fd7e14; }
.status-info { color: var(--brand); }

.footer {
  margin-top: auto; /* ADDED: Pushes the footer to the bottom */
  color: #9ca3af;
  background-color: var(--light-bg);
}

a {
  color: var(--brand);
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

a:hover {
  color: var(--brand-600);
}

/* Loading spinner styles */
.loading {
  display: none;
  text-align: center;
  padding: 20px;
}

.loading p {
  margin-top: 10px;
}

/* Result container styles */
.result-container {
  display: none;
}

/* Toast notifications */
#toast-container {
  position: fixed;
  top: 65px;
  right: 10px;
  z-index: 9999;
  display: flex;
  flex-direction: column-reverse;
  gap: 10px;
}

.toast {
  background: white;
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  min-width: 300px;
  max-width: 400px;
  transform: translateX(100%);
  opacity: 0;
  transition: transform 0.3s ease, opacity 0.3s ease;
  position: relative;
  overflow: hidden;
  border-left: 4px solid var(--brand);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast-success {
  border-left-color: #10ac84;
}

.toast-error {
  border-left-color: #e74c3c;
}

.toast-warning {
  border-left-color: #f39c12;
}

.toast-info {
  border-left-color: #3498db;
}

.toast-content {
  display: flex;
  align-items: center;
  width: 100%;
}

.toast-icon {
  margin-right: 12px;
  font-size: 20px;
}

.toast-success .toast-icon {
  color: #10ac84;
}

.toast-error .toast-icon {
  color: #e74c3c;
}

.toast-warning .toast-icon {
  color: #f39c12;
}

.toast-info .toast-icon {
  color: #3498db;
}

.toast-message {
  flex: 1;
  font-weight: 500;
  font-size: 14px;
  color: #2d3748;
}

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  width: 100%;
  background: rgba(0, 0, 0, 0.1);
  transform: scaleX(1);
  transform-origin: left;
  animation: toastProgress 3s linear forwards;
}

.toast-success .toast-progress {
  background: linear-gradient(to right, #10ac84, #0d916b);
}

.toast-error .toast-progress {
  background: linear-gradient(to right, #e74c3c, #c0392b);
}

.toast-warning .toast-progress {
  background: linear-gradient(to right, #f39c12, #e67e22);
}

.toast-info .toast-progress {
  background: linear-gradient(to right, #3498db, #2980b9);
}

@keyframes toastProgress {
  from { transform: scaleX(1); }
  to { transform: scaleX(0); }
}

    /* Positions the new icon relative to the card */
.gpa-result-card {
  position: relative;
}

/* Styles the new copy icon */
.copy-icon-btn {
  position: absolute;
  top: 1.25rem;
  right: 1.25rem;
  font-size: 1.2rem;
  color: #10ac84; /* Green color */
  cursor: pointer;
  transition: all 0.2s ease;
}
.copy-icon-btn:hover {
  transform: scale(1.15);
}
    
/* GPA Result Display */
.gpa-result-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  margin-top: 2rem;
  width: 70%;
  margin-left: auto;
  margin-right: auto;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.gpa-result-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.semester-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
  position: relative;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.semester-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-hover);
}

.delete-semester {
  position: absolute;
  top: 1rem;
  right: 1rem;
  cursor: pointer;
  color: #dc3545;
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.delete-semester:hover {
  transform: scale(1.2);
}

.add-course-btn {
  position: absolute;
  top: 1rem;
  right: 3rem;
  cursor: pointer;
  color: var(--brand);
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.add-course-btn:hover {
  transform: scale(1.2);
}

.course-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.course-table th, .course-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid rgba(229, 231, 235, 0.5);
}

.course-table th {
  font-weight: 600;
  color: var(--muted);
  background: rgba(122, 106, 216, 0.05);
}

.grade-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-weight: 600;
  font-size: 0.75rem;
}

.grade-A { background-color: rgba(220, 252, 231, 0.7); color: #166534; }
.grade-B { background-color: rgba(219, 234, 254, 0.7); color: #1e40af; }
.grade-C { background-color: rgba(254, 243, 199, 0.7); color: #92400e; }
.grade-D { background-color: rgba(254, 226, 226, 0.7); color: #991b1b; }
.grade-F { background-color: rgba(243, 244, 246, 0.7); color: #374151; }

.extra-enrolled {
  background-color: rgba(255, 193, 7, 0.2);
  color: #856404;
  padding: 1px 5px;
  border-radius: 4px;
  font-size: 0.65rem;
  font-weight: 600;
  vertical-align: super;
}

.course-details-modal .modal-content {
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.course-details-modal .modal-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}

.calculate-cgpa-btn {
  margin-top: 1rem;
  display: none;
}

/* Add Course Form */
.add-course-form {
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin-top: 1rem;
  display: none;
  backdrop-filter: blur(10px);
}

.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

.form-group {
  flex: 1;
  min-width: 200px;
}

    /* Styling for the collapsible chart header */
#gpaChartChevron {
  transition: transform 0.3s ease-in-out;
}
a[aria-expanded="true"] #gpaChartChevron {
  transform: rotate(180deg);
}
[data-theme="dark"] #gpaChartContainer .text-body {
    color: var(--text) !important;
}


    /* NEW: Modern Calculator Section Styles */
.calculator-section-modern {
  padding: 3rem 2rem;
  backdrop-filter: blur(10px);
  margin-bottom: 2rem;
}


.search-and-profiles-container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.modern-search-wrapper {
  position: relative;
  width: 100%;
}

.modern-search-input {
  border-radius: 50px !important;
  padding: 1rem 1.5rem !important;
  font-size: 1.1rem;
  box-shadow: var(--shadow);
  border: 2px solid transparent;
}

.modern-search-input:focus {
  border-color: var(--brand);
  box-shadow: var(--shadow-hover);
}

.modern-search-button {
  position: absolute;
  top: 50%;
  right: 8px;
  transform: translateY(-50%);
  border-radius: 50%;
  width: 48px;
  height: 48px;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  transition: all 0.3s ease; /* Added for smooth transition */
}

/* --- CHANGE 1: More subtle hover effect for the button --- */
.modern-search-button:hover {
  transform: translateY(-50%) scale(1.05); /* Softer transform */
  box-shadow: var(--shadow-hover);
}

.modern-profiles-wrapper {
  width: 100%;
}

/* --- CHANGE 2: Fix for the profile switcher text collision --- */
.modern-profiles-select {
  border-top-left-radius: 0 !important;
  border-bottom-left-radius: 0 !important;
  text-overflow: ellipsis; /* Add ellipsis for very long text */
  padding-right: 2.5rem;   /* Add padding to avoid overlap with arrow */
}

.modern-profiles-icon {
  border-top-left-radius: .85rem !important;
  border-bottom-left-radius: .85rem !important;
  background-color: rgba(122, 106, 216, 0.1);
  color: var(--brand);
}

.modern-delete-button {
    border-top-right-radius: .85rem !important;
    border-bottom-right-radius: .85rem !important;
}

/* ADD THIS CSS FOR THE ANNOUNCEMENT BAR */
.announcement-bar {
  background: var(--brand-gradient);
  color: white;
  padding: 0.75rem 0;
  overflow: hidden;
  white-space: nowrap;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.announcement-track {
  display: inline-block;
  animation: scroll-left 30s linear infinite;
}

.announcement-text {
  display: inline-block;
  font-weight: 500;
  margin: 0 2.5rem; /* Spacing between tips */
  opacity: 0.9;
}

@keyframes scroll-left {
  0% {
    transform: translateX(0%);
  }
  100% {
    transform: translateX(-50%); /* This value should be -50% because the content is duplicated */
  }
}

/* Aligned Action Buttons */
.action-buttons-aligned {
  display: flex;
  justify-content: space-between; /* This is the key change */
  align-items: center;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}
.action-buttons-aligned .btn {
  border-radius: 12px; /* A little radius, not fully rounded */
}
@media (max-width: 576px) {
  .action-buttons-aligned {
    justify-content: center; /* Stack them in the center on mobile */
  }
}

/* Collapsible Status Log Icon */
.status-log-chevron {
  transition: transform 0.3s ease-in-out;
}
a[aria-expanded="true"] .status-log-chevron {
  transform: rotate(180deg);
}


    /* ADD THIS CSS FOR THE RENAME BUTTON */
.modern-rename-button {
    border-left: 0 !important;
}

    /* ADD THIS CSS FOR THE PREMIUM CGPA DISPLAY */
.gpa-result-card-premium {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  margin-top: 2rem;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
[data-theme="dark"] .gpa-result-card-premium {
  background: rgba(26, 32, 48, 0.8);
}
.gpa-result-card-premium:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.student-info-header {
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.2);
  padding-bottom: 1.5rem;
}
.student-info-header h2 {
  font-size: 1.5rem;
}

.cgpa-dashboard {
  display: flex;
  justify-content: center;
  margin-bottom: 2rem;
}

.cgpa-progress-circle {
  width: 180px;
  height: 180px;
  position: relative;
}
.cgpa-progress-circle svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}
.cgpa-progress-circle .circle-bg {
  fill: none;
  stroke: rgba(122, 106, 216, 0.15);
  stroke-width: 3.8;
}
[data-theme="dark"] .cgpa-progress-circle .circle-bg {
    stroke: rgba(122, 106, 216, 0.2);
}
.cgpa-progress-circle .circle {
  fill: none;
  stroke: var(--brand);
  stroke-width: 3.8;
  stroke-linecap: round;
  transition: stroke-dasharray 1s ease-in-out;
}

.cgpa-progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.cgpa-progress-text .cgpa-value {
  font-size: 2rem;
  font-weight: 700;
  line-height: 1;
  color: var(--brand);
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.cgpa-progress-text .cgpa-label {
  display: block;
  font-size: 1rem;
  font-weight: 500;
  color: var(--muted);
  margin-top: 0.25rem;
}

.secondary-stats {
  display: flex;
  justify-content: center;
  gap: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(122, 106, 216, 0.2);
}
.stat-item {
  text-align: center;
}
.stat-label {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--muted);
  display: block;
  margin-bottom: 0.5rem;
}
.stat-value {
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--text);
}
[data-theme="dark"] .stat-value {
    color: #e5e7eb;
}
.stat-sub-value {
    font-size: 1rem;
    color: var(--muted);
}
.stat-divider {
  width: 1px;
  background: rgba(122, 106, 216, 0.2);
}

@media (max-width: 576px) {
  .gpa-result-card-premium {
    padding: 1.5rem;
  }
  .cgpa-progress-circle {
    width: 150px;
    height: 150px;
  }
  .cgpa-progress-text .cgpa-value {
    font-size: 1.70rem;
  }
  .secondary-stats {
    gap: 1rem;
  }
  .stat-value {
    font-size: 1.25rem;
  }
}
    
    
/* ----------- DARK MODE IMPROVED ----------- */
[data-theme="dark"] {
  --text: #e5e7eb;
  --text-light: #d1d5db;
  --muted: #9ca3af;
}

[data-theme="dark"] body {
  background: linear-gradient(180deg, #0b0e13 0%, #0f1320 70%);
  color: #f1f5f9;
}

[data-theme="dark"] .navbar {
  background-color: rgba(17, 24, 39, 0.8);
}

[data-theme="dark"] .navbar .nav-link {
  color: #d1d5db;
}

[data-theme="dark"] .navbar .nav-link:hover {
  color: #fff;
}

[data-theme="dark"] .card-modern {
  background: rgba(15, 20, 34, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] .card-modern .card-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
}

[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4, [data-theme="dark"] h5 {
  color: #ffffff;
}

[data-theme="dark"] .lead {
  color: #9ca3af;
}

[data-theme="dark"] .subject-row {
  background: rgba(26, 31, 46, 0.8);
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] label {
  color: #e5e7eb;
}

[data-theme="dark"] .form-control, [data-theme="dark"] .form-select {
  background: rgba(11, 16, 32, 0.8);
  color: #f1f5f9;
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] .form-control::placeholder {
  color: #9ca3af;
}

[data-theme="dark"] .form-text {
  color: var(--muted);
}

[data-theme="dark"] .input-group-text {
  background: rgba(31, 41, 55, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] .footer {
  color: #9ca3af;
  background: rgba(17, 24, 39, 0.8);
}

[data-theme="dark"] a {
  color: rgb(158, 141, 240);
}

[data-theme="dark"] a:hover {
  color: #9f8df0;
}

[data-theme="dark"] .status-log {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .status-line {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .gpa-result-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .semester-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .course-table th, 
[data-theme="dark"] .course-table td {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .course-table th {
  background: rgba(122, 106, 216, 0.1);
}

[data-theme="dark"] .add-course-form {
  background: rgba(26, 31, 46, 0.8);
}

[data-theme="dark"] .loading-container {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.15), rgba(122, 106, 216, 0.08));
}

[data-theme="dark"] .grade-A { background-color: rgba(21, 128, 61, 0.3); color: #86efac; }
[data-theme="dark"] .grade-B { background-color: rgba(30, 64, 175, 0.3); color: #93c5fd; }
[data-theme="dark"] .grade-C { background-color: rgba(146, 64, 14, 0.3); color: #fed7aa; }
[data-theme="dark"] .grade-D { background-color: rgba(153, 27, 27, 0.3); color: #fecaca; }
[data-theme="dark"] .grade-F { background-color: rgba(55, 65, 81, 0.3); color: #d1d5db; }

/* Dark mode for modals */
[data-theme="dark"] .course-details-modal .modal-content,
[data-theme="dark"] #addCourseModal .modal-content {
  background: rgba(26, 32, 48, 0.95);
  color: #e5e7eb;
}

[data-theme="dark"] .course-details-modal .modal-header,
[data-theme="dark"] #addCourseModal .modal-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .course-details-modal .modal-header .btn-close,
[data-theme="dark"] #addCourseModal .modal-header .btn-close {
  filter: invert(1);
}

[data-theme="dark"] .course-details-modal .alert-info {
  background-color: rgba(23, 162, 184, 0.2);
  border-color: rgba(23, 162, 184, 0.3);
  color: #71d4f0;
}

[data-theme="dark"] .course-details-modal .alert-warning {
  background-color: rgba(255, 193, 7, 0.2);
  border-color: rgba(255, 193, 7, 0.3);
  color: #ffd351;
}

/* Dark mode contrast improvements */
[data-theme="dark"] .text-body-secondary {
  color: #d1d5db !important;
}

[data-theme="dark"] .btn-primary-action {
  color: #ffffff !important;
}

.cursor-dot {
  position: fixed;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--brand);
  pointer-events: none;
  transform: translate(-50%, -50%);
  opacity: .7;
  mix-blend-mode: multiply;
  z-index: 9999;
  transition: all 0.1s ease;
}

[data-theme="dark"] .cursor-dot {
  mix-blend-mode: screen;
}

/* Course action buttons */
.course-actions i {
  cursor: pointer;
  font-size: 14px;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.delete-course {
  color: #dc3545;
}

.delete-course:hover {
  background-color: rgba(220, 53, 69, 0.1);
  transform: scale(1.2);
}

.restore-course {
  color: #10ac84;
}

.restore-course:hover {
  background-color: rgba(16, 172, 132, 0.1);
  transform: scale(1.2);
}

/* Clickable info icon */
.clickable-info {
  cursor: pointer;
  color: var(--brand);
  transition: all 0.3s ease;
}

.clickable-info:hover {
  opacity: 0.8;
  transform: scale(1.1);
}

    
/* Restore the original horizontal margin for the icon */
.course-code-container .fa-info-circle {
    margin-left: 0.3rem !important;
}

/* --- UPDATED: Mobile responsive adjustments --- */
@media (max-width: 575.98px) {
  .hero {
    padding: 2rem 0;
  }
  .hero h1 {
    font-size: 2.2rem !important;
  }
  .d-flex.gap-2 .btn {
    width: 100%;
    max-width: 300px;
    margin-bottom: 0.5rem;
  }
  .toast {
    min-width: 250px;
    max-width: 300px;
    padding: 12px 16px;
  }
  .toast-message {
    font-size: 0.75rem;
  }
  .card-modern .card-header {
    padding: 1rem 1.25rem;
  }
  #themeToggle {
    font-size: 0.8rem; /* Adjust the font size to make the icon smaller */
    padding: 0.3rem 0.6rem; /* Adjust padding to make the button smaller */
  }
}
    
/* Ensure subject columns are 2-up on very small screens: change from col-12 col-md-6 -> col-6 col-md-6 */
@media (max-width: 420px) {
  .subject-row .col-6 {
    padding-right: .4rem;
    padding-left: .4rem;
  }
}

/* UPDATED: Narrow calculator container on desktop */
@media (min-width: 992px) {
  #Auto-Calculator .col-md-10 {
    width: 100%;
  }
}

@media (min-width: 992px) {
  .navbar-expand-lg .navbar-nav .nav-link {
    padding-right: var(--bs-navbar-nav-link-padding-x);
    margin-right: 20px;
  }
}

@media (min-width: 768px) {
  .col-md-10 {
    flex: 0 0 auto;
    width: 100%;
  }
}

@media (min-width: 768px) {
  .col-md-4 {
    flex: 0 0 auto;
    width: 48.3%;
  }
}

/* --- UPDATED: Mobile responsive table --- */
@media screen and (max-width: 768px) {
  body {
    font-size: 0.9rem;
  }
  .gpa-result-card {
    width: 95%;
    padding: 1.25rem;
  }
  .course-code-container .fa-info-circle {
    display: none;
  }
  .semester-card {
    padding: 1.25rem;
    max-width: 420px;
  }
  .semester-card h5 {
    font-size: 0.9rem;
  }
  .semester-card .text-end .small {
    font-size: 0.65rem;
  }
  .custom-course-btn {
    padding: 4px 8px;
    font-size: 0.7rem;
    margin-top: 5px;
  }
  .course-table {
    font-size: 0.65rem;
  }
  /* NEW: Reduce padding to decrease gaps between columns */
  .course-table th, .course-table td {
    padding: 0.75rem 0.4rem; /* Reduced horizontal padding */
  }
  .course-table td:first-child {
    font-size: 0.7rem;
    font-weight: 500;
  }
  /* NEW: Make grade text smaller */
  .grade-badge {
    font-size: 0.6rem;
    padding: 0.2rem 0.35rem;
  }
  .btn {
    padding: 0.6rem 0.9rem;
    font-size: 0.9rem;
  }
  .loading-animation {
    width: 50px;
    height: 50px;
  }
  .loading-text {
    font-size: 0.9rem;
  }
  .loading-subtext {
    font-size: 0.75rem;
  }
  .cgpa-main-info h2 {
    font-size: 1.3rem;
  }
  .cgpa-metric-value {
    font-size: 1.35rem;
  }
  .action-buttons .btn {
    font-size: 0.75rem;
    padding: 0.6rem 0.4rem;
  }
  /* NEW: Table alignment rules */
  .course-table th:nth-child(n+3),
  .course-table td:nth-child(n+3) {
      text-align: center;
  }
  .course-table th:nth-child(1), .course-table td:nth-child(1),
  .course-table th:nth-child(2), .course-table td:nth-child(2) {
      text-align: left;
  }
}

/* Center buttons only in specific sections */
.scraping-section .center-buttons,
.log-section .center-buttons {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

@media (max-width: 576px) {
  .scraping-section .center-buttons,
  .log-section .center-buttons {
    flex-direction: column;
    align-items: center;
  }
  
  .scraping-section .center-buttons .btn,
  .log-section .center-buttons .btn {
    width: auto;  
    min-width: 180px;  
  }
}

/* New layout improvements */
.results-section {
  margin-top: 2rem;
}

.student-info-section {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.student-details {
  flex: 1;
  min-width: 300px;
}

.cgpa-display {
  flex: 0 0 auto;
  text-align: right;
  min-width: 200px;
}

.action-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  justify-content: center;
}

@media (max-width: 768px) {
  .student-info-section {
    flex-direction: column;
    gap: 1rem;
  }
  
  .cgpa-display {
    text-align: left;
    margin-top: 1rem;
  }
  
  .action-buttons {
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
  }
  
  .action-buttons .btn {
    flex-grow: 1;
    margin: 0 0.25rem;
    min-width: auto;
  }
}

/* Section separators */
.section-container {
  margin-bottom: 2rem;
}

.section-title {
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(122, 106, 216, 0.3);
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 60px;
  height: 2px;
  background: var(--brand-gradient);
}

/* Student info logo style */
.student-info-logo {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  transition: all 0.3s ease;
}

.student-info-logo:hover {
  transform: rotate(15deg);
}

.student-info-logo i {
  font-size: 1.5rem;
  color: var(--brand);
}

/* Desktop-specific smaller text for semester sections */
@media (min-width: 992px) {
  .semester-card {
    font-size: 0.95rem;
  }
  
  .semester-card h5 {
    font-size: 1.15rem;
  }
  
  .course-table {
    font-size: 0.9rem;
  }
}

/* Semester section layout improvements */
.semester-results-container {
  width: 100%;
}

.semester-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  width: 100%;
}

@media (min-width: 992px) {
  .semester-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* NEW STYLES FOR UPDATES */
.repeated-badge {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ffc107;
  color: #856404;
  font-size: 8px;
  padding: 2px 4px;
  border-radius: 3px;
  font-weight: bold;
}

.custom-course-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 0.9rem;
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.custom-course-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
}

.undo-notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(51, 51, 51, 0.9);
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  width: calc(100% - 40px);
  max-width: 400px;
  justify-content: space-between;
}

.undo-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.undo-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-1px);
}
@media (max-width: 576px) {
  .undo-notification {
    bottom: 70px; /* Raise it above mobile browser UI */
    padding: 10px 15px;
    font-size: 0.9rem;
    flex-direction: column;
    gap: 8px;
    text-align: center;
  }
  .undo-btn {
    width: 100%;
    padding: 6px 10px;
  }
}


/* Updated CGPA Display Layout */
.cgpa-display-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}

.cgpa-main-info {
  text-align: center;
  width: 100%;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.3);
}

.cgpa-metrics-row {
  display: flex;
  justify-content: space-between;
  width: 100%;
  gap: 1rem;
}

.cgpa-metric {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.cgpa-metric-left {
  align-items: flex-start;
}

.cgpa-metric-center {
  align-items: center;
}

.cgpa-metric-right {
  align-items: flex-end;
}

.cgpa-metric-label {
  font-size: 1rem;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.cgpa-metric-value {
  font-size: 1.75rem;
  font-weight: 650;
  color: var(--brand);
  line-height: 1.2;
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.cgpa-metric-subvalue {
  font-size: 0.9rem;
  color: var(--muted);
}

/* --- UPDATED: Mobile responsive adjustments for CGPA --- */
@media (max-width: 768px) {
  .cgpa-metrics-row {
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .cgpa-metric {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(122, 106, 216, 0.1);
  }
  
  .cgpa-metric:last-child {
    border-bottom: none;
  }
  
  .cgpa-metric-left,
  .cgpa-metric-center,
  .cgpa-metric-right {
    align-items: center;
  }
  
  .cgpa-metric-label {
    margin-bottom: 0;
    min-width: 100px;
    text-align: left;
  }
  
  .cgpa-metric-value-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }
  
  .semester-grid {
    display: block;
  }
}

/* Contact form improvements */
#contact-form {
  background: rgba(255, 255, 255, 0.5);
  padding: 2rem;
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
}

[data-theme="dark"] #contact-form {
  background: rgba(26, 32, 48, 0.5);
}

/* Animation for form elements */
.form-control, .form-select {
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  transform: translateY(-2px);
}

/* Pulse animation for important elements */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 2s infinite;
}

/* Floating animation */
@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

.float {
  animation: float 3s ease-in-out infinite;
}

/* Improved scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.1);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--brand);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.2);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--brand);
}

/* NEW STYLES FOR ADDED FEATURES */

/* Back to Top Button */
#backToTop {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--brand-gradient);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.3);
  z-index: 1000;
}

#backToTop.visible {
  opacity: 1;
  visibility: visible;
}

#backToTop:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(122, 106, 216, 0.4);
}

/* Gradient Text Animation */
.gradient-text {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}

@keyframes gradient-text {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Why Choose Section */
.why-choose-section {
  padding: 5rem 0;
}

.why-choose-section .text-center {
  margin-bottom: 4rem;
}

.why-choose-section h2 {
  font-weight: 800;
  margin-bottom: 1rem;
}

.why-choose-section .lead {
  color: var(--text-light);
  font-size: 1.25rem;
}

.feature-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  height: 100%;
  text-align: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
}

.feature-card:hover {
  transform: translateY(-10px);
  box-shadow: var(--shadow-hover);
}

.feature-icon {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1.5rem;
  background: var(--brand-gradient);
  color: white;
  font-size: 1.5rem;
  transition: all 0.3s ease;
}

.feature-card:hover .feature-icon {
  transform: scale(1.1) rotate(5deg);
}

.feature-card h5 {
  font-weight: 700;
  margin-bottom: 1rem;
  color: var(--text);
}

.feature-card p {
  color: var(--text-light);
}

/* Dark mode for Why Choose section */
[data-theme="dark"] .why-choose-section {
  background: transparent; /* Inherit from body gradient */
}

[data-theme="dark"] .feature-card {
  background: rgba(15, 20, 34, 0.8);
}

[data-theme="dark"] .feature-card h5 {
  color: #ffffff;
}

[data-theme="dark"] .feature-card p.text-muted {
    color: var(--muted) !important;
}
[data-theme="dark"] .why-choose-section .lead.text-muted {
    color: var(--text-light) !important;
}


/* Hide Why Choose section on mobile */
@media (max-width: 991.98px) {
  .why-choose-section {
    display: none;
  }
}

/* Animation for hero text */
.hero-text-gradient {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}


/* Animation for robot icon */
.robot-icon-gradient {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}

/* PDF Download Button */
.btn-pdf-download {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  border: 0;
  box-shadow: 0 6px 18px rgba(231, 76, 60, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-pdf-download:hover {
  background: linear-gradient(135deg, #ff6b6b 0%, #e74c3c 100%);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
}

/* Action buttons container */
.action-buttons {
  display: flex;
  justify-content: center; /* Center the single button */
  align-items: center;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

/* Center Registration Number Input */
.scraping-section .mb-3 {
    text-align: center;
}
.scraping-section #registrationNumber {
    max-width: 350px;
    margin: 0 auto;
    text-align: center;
}

/* Drag and Drop Styles (Desktop Only) */
@media (min-width: 992px) {
  .course-table tbody tr {
    cursor: grab;
  }
  .course-table tbody tr.dragging {
    opacity: 0.5;
    background: #e9e6f8;
  }
  .semester-card.drag-over {
    border: 2px dashed var(--brand);
    transform: scale(1.02);
    background-color: rgba(122, 106, 216, 0.1);
  }
  [data-theme="dark"] .semester-card.drag-over {
    background-color: rgba(122, 106, 216, 0.2);
  }
}

/* NEW: Scroll Animation Styles */
.fade-in-on-scroll {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}
.fade-in-on-scroll.is-visible {
  opacity: 1;
  transform: translateY(0);
}

/* NEW: Forecast/Info Button Style */
.btn-info-action {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}
.btn-info-action:hover {
  background: linear-gradient(135deg, #5dade2 0%, #3498db 100%);
  color: white;
  transform: translateY(-2px);
}
  </style>
</head>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CMENQJ4ELS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CMENQJ4ELS');
</script>

<body>

  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MJW7HPPS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="cursor-dot" id="cursorDot"></div>

  <div id="backToTop">
    <i class="fas fa-arrow-up"></i>
  </div>

  <div class="modal fade course-details-modal" id="courseDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="courseDetailsModalTitle">Course Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="courseDetailsModalBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="addCourseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-plus-circle me-2"></i>Add Custom Course</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addCourseForm">
            <input type="hidden" id="addCourseSemester" value="">
            <div class="mb-3">
              <label for="courseCode" class="form-label">Course Code</label>
              <input type="text" class="form-control" id="courseCode" placeholder="e.g., CHEM-101" required>
            </div>
            <div class="mb-3">
              <label for="courseTitle" class="form-label">Course Title</label>
              <input type="text" class="form-control" id="courseTitle" placeholder="e.g., Inorganic Chemistry" required>
            </div>
            <div class="row">
              <div class="col-6 mb-3">
                <label for="creditHours" class="form-label">Credit Hours</label>
                <select class="form-select" id="creditHours" required>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3" selected>3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </div>
              <div class="col-6 mb-3">
                <label for="courseMarks" class="form-label">Marks Obtained</label>
                <input type="number" class="form-control" id="courseMarks" min="0" max="100" placeholder="e.g., 75" required>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveCourseBtn">Add Course</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="renameProfileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-pen-to-square me-2"></i>Rename Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="renameProfileForm">
            <div class="mb-3">
              <label for="newProfileName" class="form-label">Profile Name</label>
              <input type="text" class="form-control" id="newProfileName" required>
              <div class="form-text">Give this profile a unique name (e.g., "My Final Year Forecast").</div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveProfileNameBtn">Save Name</button>
        </div>
      </div>
    </div>
</div>

  <nav class="navbar navbar-expand-lg sticky-top border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/">
        <span class="badge rounded-pill badge-brand">UAF</span>
        <span class="gradient-text">CGPA Calculator</span>
      </a>
      <div class="d-flex align-items-center gap-2 order-lg-2">
        <button id="themeToggle" class="btn btn-sm btn-soft rounded-pill" type="button" aria-label="Toggle dark mode" style="margin-bottom: 0.01rem;">
          <i class="fa-solid fa-moon"></i>
        </button>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="mainNav">
  <ul class="navbar-nav ms-auto align-items-lg-center">
    <li class="nav-item">
      <a class="nav-link" href="#Home"
        ><i class="fa-solid fa-house me-2"></i>Home</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#Auto-Calculator"
        ><i class="fa-solid fa-calculator me-2"></i>CGPA Calculator</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#features"
        ><i class="fa-solid fa-star me-2"></i>Features</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#faq"
        ><i class="fa-solid fa-circle-question me-2"></i>FAQ</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#contact-us"
        ><i class="fa-solid fa-envelope me-2"></i>Contact</a
      >
    </li>
  </ul>
</div>
    </div>
  </nav>

  <section class="hero" id="Home">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-7">
          <span class="badge rounded-pill badge-brand mb-3">University of Agriculture Faisalabad</span>
          <h1 class="display-5 mb-3">Calculate Your <span class="hero-text-gradient">CGPA & Percentage </span>Automatically from <span class="hero-text-gradient">UAF CGPA Calculator</span></h1>
          <p class="lead mb-4">Enter your <strong>registration number</strong> to fetch your results directly from UAF LMS. The calculator will automatically compute your CGPA and Percentage based on UAF grading system.</p>
          <div class="d-flex gap-2">
            <a href="#Auto-Calculator" class="btn btn-primary-action btn-lg rounded-pill" style="font-size: 1.05rem; padding: 0.9rem;">
              <i class="fa-solid fa-bolt me-2"></i>Try It Now
            </a>
            <a href="#features" class="btn btn-secondary-action rounded-pill" style="display:block; padding:14px">
              <i class="fa-solid fa-star me-2"></i>Features
            </a>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card card-modern fade-in-on-scroll">
            <div class="card-body p-4">
              <div class="d-flex align-items-center gap-3">
                <div class="display-6 robot-icon-gradient"><i class="fa-solid fa-robot"></i></div>
                <div>
                  <h3 class="mb-1 fw-bold" style="font-size:22px">Key Features</h3>
                  <p class="mb-0 text-body-secondary">Automatically fetch & analyze your official UAF results.</p>
                </div>
              </div>
              <hr class="my-4" />
              <ul class="list-unstyled m-0">
                <li class="d-flex align-items-center gap-2 mb-2"><i class="fa-solid fa-check text-success"></i> Instantly fetch your complete results from the UAF portal.</li>
                <li class="d-flex align-items-center gap-2 mb-2"><i class="fa-solid fa-check text-success"></i> Forecast your future CGPA with powerful editing tools.</li>
                <li class="d-flex align-items-center gap-2"><i class="fa-solid fa-check text-success"></i> Download a professional, premium-style PDF transcript.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="announcement-bar">
    <div class="announcement-track">
        <span class="announcement-text">
            <i class="fa-solid fa-circle-info me-2"></i>
            <strong>Hint: </strong> Only the highest marks in a repeated course are counted towards your CGPA.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-wand-magic-sparkles me-2"></i>
            <strong>Tip:</strong> Use the 'Forecast Semester' button to plan your future grades.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-arrows-up-down-left-right me-2"></i>
            <strong>Clue:</strong> On desktop, you can drag & drop courses between semesters.
        </span>
    </div>
</div>

  <section class="py-5" id="Auto-Calculator" style="padding-bottom: 0rem !important;">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="calculator-section-modern fade-in-on-scroll">
    <div class="text-center mb-4">
      <h2 class="fw-bold">
        <i class="fa-solid fa-calculator me-2 gradient-text"></i>
        <span class="gradient-text">UAF CGPA Calculator</span>
      </h2>
      <p class="text-muted">Enter a registration number or select a saved profile.</p>
    </div>
    <form id="resultForm" class="text-center">
      <div class="search-and-profiles-container">
        <div class="modern-search-wrapper">
          <input
            type="text"
            class="form-control modern-search-input"
            id="registrationNumber"
            placeholder="e.g., 2020-ag-1234"
            required
          />
          <button type="submit" class="btn btn-primary-action modern-search-button">
            <i class="fa-solid fa-cloud-arrow-down"></i>
          </button>
        </div>
        <div id="profileManagement" class="modern-profiles-wrapper" style="display: none;">
          <div class="input-group">
            <span class="input-group-text modern-profiles-icon">
              <i class="fa-solid fa-user-check"></i>
            </span>
            <select class="form-select modern-profiles-select" id="profileSwitcher"></select>
            <button class="btn btn-outline-secondary modern-rename-button" type="button" id="renameProfileBtn" title="Rename Selected Profile">
                <i class="fa-solid fa-pen-to-square"></i>
            </button>
            <button class="btn btn-outline-danger modern-delete-button" type="button" id="deleteProfileBtn" title="Delete Selected Profile">
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </div>
        </div>
      </div>
    </form>
    <div class="loading-container" id="loadingContainer">
      <div class="loading-stage" id="connectingStage"><div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><p class="loading-text">Connecting to UAF LMS</p><p class="loading-subtext">Establishing secure connection to university servers</p></div>
      <div class="loading-stage" id="fetchingStage"><div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><p class="loading-text">Fetching Your Results</p<p class="loading-subtext">Retrieving your academic records from the database</p></div>
      <div class="loading-stage" id="processingStage"><div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><p class="loading-text">Processing Data</p><p class="loading-subtext">Analyzing your grades and calculating CGPA</p></div>
      <div class="loading-stage" id="completeStage"><div class="loading-animation loading-complete"><div class="checkmark"></div></div><p class="loading-text">Results Ready!</p><p class="loading-subtext">Your CGPA has been calculated successfully</p></div>
    </div>
</div>
          
          <div id="resultContainer" class="result-container">
    <div class="gpa-result-card-premium fade-in-on-scroll">
    <div class="student-info-header">
      <h2 class="mb-0 fw-bold" id="studentName"><i class="fa-solid fa-user-graduate me-2"></i>Student Name</h2>
      <p class="mb-0 text-body-secondary" id="studentReg">Registration Number</p>
    </div>
    
    <div class="cgpa-dashboard">
      <div class="cgpa-progress-circle">
        <svg viewBox="0 0 36 36">
          <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
          <path id="cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
        </svg>
        <div class="cgpa-progress-text">
          <span id="totalCgpa" class="cgpa-value">0.00</span>
          <span class="cgpa-label">CGPA</span>
        </div>
      </div>
    </div>

    <div class="secondary-stats">
        <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="totalPercentage">0.00%</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
                <span id="totalMarksObtained">0</span><span id="totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
        </div>
    </div>
</div>
    
    <div class="card card-modern mt-4 fade-in-on-scroll" id="gpaChartContainer" style="display: none;">
    <div class="card-header p-0">
      <a href="#gpaChartCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="gpaChartCollapse">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-body"><i class="fa-solid fa-chart-line me-2"></i>GPA Trend</h4>
          <i class="fa-solid fa-chevron-down text-body" id="gpaChartChevron"></i>
        </div>
      </a>
    </div>
    <div class="collapse" id="gpaChartCollapse">
      <div class="card-body">
        <canvas id="gpaTrendChart"></canvas>
      </div>
    </div>
  </div>

    <div class="action-buttons-aligned fade-in-on-scroll">
      <button id="downloadPdfBtn" class="btn btn-pdf-download"><i class="fa-solid fa-file-pdf me-2"></i>Download PDF</button>
      <button id="addForecastSemesterBtn" class="btn btn-info-action"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>Forecast Semester</button>
    </div>

    <div class="semester-results-container">
      <div id="semesterResults" class="semester-grid"></div>
    </div>
</div>
          
<div class="card card-modern mt-4 fade-in-on-scroll">
    <div class="card-header p-0">
        <a href="#statusLogCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="statusLogCollapse">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0 text-body"><i class="fa-solid fa-terminal me-2"></i>Status Log</h4>
                <i class="fa-solid fa-chevron-down text-body status-log-chevron"></i>
            </div>
        </a>
    </div>
    <div class="collapse" id="statusLogCollapse">
        <div class="card-body p-4">
            <div class="status-log" id="statusLog">
                <div class="status-line status-info">Ready to fetch your results. Enter your registration number and click "Fetch Result".</div>
            </div>
            <div class="log-section center-buttons mt-3">
                <button id="downloadLogBtn" class="btn btn-secondary-action rounded-pill"><i class="fa-solid fa-file-lines me-2"></i>Download Log</button>
                <button id="clearLogBtn" class="btn btn-danger-action rounded-pill"><i class="fa-solid fa-trash me-2"></i>Clear Log</button>
            </div>
        </div>
    </div>
</div>

  <section class="why-choose-section" id="features">
    <div class="container">
      <div class="text-center mb-5 fade-in-on-scroll">
        <h2 class="fw-bold">Why Choose Our <span class="gradient-text">CGPA Calculator</span></h2>
        <p class="lead text-muted">The most advanced and feature-rich cgpa calculation tool for UAF students</p>
      </div>
      <div class="row g-4">
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-robot"></i></div>
            <h5>Instant & Automatic</h5>
            <p class="text-muted">Enter your registration number to get your complete, calculated academic record from the UAF portal in seconds. No manual entry needed.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-edit"></i></div>
            <h5>Forecast & Edit</h5>
            <p class="text-muted">Accurately forecast your CGPA by adding custom courses, deleting semesters, or simply dragging-and-dropping subjects between semesters.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-file-pdf"></i></div>
            <h5>Premium PDF Export</h5>
            <p class="text-muted">Generate a beautifully designed, professional transcript of your results with a single click. Perfect for your personal academic records.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
            <h5>Secure & Personal</h5>
            <p class="text-muted">Requires no password and never stores your data on our servers. Save multiple profiles securely in your own browser and enjoy a modern interface with dark mode.</p>
          </div>
        </div>
      </div>
    </div>
  </section>


  <main>
    <section class="py-5" id="faq">
      <div class="container">
        <div class="text-center mb-5 fade-in-on-scroll">
          <h2 class="fw-bold">Frequently Asked Questions</h2>
          <p class="lead text-muted">Answers to common questions about the UAF CGPA Calculator.</p>
        </div>
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="accordion" id="faqAccordion">
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    How does the UAF CGPA Calculator work?
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    <strong>Our CGPA Calculator</strong> securely connects to the public UAF LMS portal using your registration number. It fetches your official results, processes the grades and credit hours according to the official UAF grading formula, and instantly calculates your precise Semester GPA and Cumulative GPA (CGPA).
                  </div>
                </div>
              </div>
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Is it safe to use my registration number?
                  </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    <strong>Yes, This CGPA Calculator by M Saqlain is completely safe.</strong> The calculator only requires your registration number, not your password. Your information is used only for fetching your result for the current session and is never stored or shared. The connection is secure and private.
                  </div>
                </div>
              </div>
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Can I use this calculator for other universities?
                  </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    This calculator is specifically designed for the students of the <strong>University of Agriculture Faisalabad (UAF)</strong>. It uses UAF's unique grading system and connects directly to the UAF LMS, so it will not work for other universities.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  
  <section class="py-5" id="contact-us">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-6 fade-in-on-scroll">
          <h3 class="fw-bold mb-2">Contact</h3>
          <p class="text-body-secondary">Questions or suggestions? Send a message.</p>
          <form id="contact-form" action="https://formspree.io/f/xblrolwp" method="post" class="needs-validation" novalidate>
            <div class="row g-3">
              <div class="col-md-6"><label class="form-label" for="name">Your Name</label><input class="form-control" id="name" name="name" placeholder="e.g., Ali Raza" required /><div class="invalid-feedback">Please enter your name.</div></div>
              <div class="col-md-6"><label class="form-label" for="email">Email</label><input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required /><div class="invalid-feedback">Enter a valid email.</div></div>
              <div class="col-12"><label class="form-label" for="message">Message</label><textarea class="form-control" id="message" name="message" rows="4" placeholder="Write your message..." required></textarea><div class="invalid-feedback">Please write a message.</div></div>
              <div class="col-12"><button class="btn btn-primary-action rounded-pill" type="submit"><i class="fa-solid fa-paper-plane me-2"></i>Send</button></div>
              <div id="contact-form-status" class="mt-2 small"></div>
            </div>
          </form>
        </div>
        <div class="col-lg-6 fade-in-on-scroll">
          <div class="h-100 p-4 p-lg-5 rounded-4" style="background:linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));">
            <h5 class="fw-bold">Developer</h5>
            <div class="d-flex align-items-center gap-3 mt-2">
              <img src="assets/images/UAF CGPA Calculator Developer - M Saqlain.webp" alt="Muhammad Saqlain - Developer of UAF CGPA Calculator" class="rounded-circle" width="86" height="86" />
              <div>
                <div class="fw-semibold">Muhammad Saqlain</div><div class="text-body-secondary small">BS Chemistry (2020â€“2024)</div>
                <div class="d-flex gap-3 mt-2">
                  <a class="text-decoration-none" href="https://www.facebook.com/UAFChemist.Rustam" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                  <a class="text-decoration-none" href="https://x.com/M_Saqlain_Akbar" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                  <a class="text-decoration-none" href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                </div>
              </div>
            </div>
            <hr class="my-4" /><p class="mb-0 small text-body-secondary">Share this tool with your friends to support the project. â™¥</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="border-top py-4" style="margin-top: 30px;">
    <div class="container text-center footer">
      <p class="mb-1">UAF CGPA Calculator - A project by <a href="#contact-us">M Saqlain</a>.</p>
      <p class="mb-0">Â© 2025 UAFTools. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const resultForm = document.getElementById('resultForm');
      const registrationNumber = document.getElementById('registrationNumber');
      const resultContainer = document.getElementById('resultContainer');
      const statusLog = document.getElementById('statusLog');
      const themeToggle = document.getElementById('themeToggle');
      const cursorDot = document.getElementById('cursorDot');
      const contactForm = document.getElementById('contact-form');
      const downloadLogBtn = document.getElementById('downloadLogBtn');
      const clearLogBtn = document.getElementById('clearLogBtn');
      const semesterResults = document.getElementById('semesterResults');
      const studentName = document.getElementById('studentName');
      const studentReg = document.getElementById('studentReg');
      const totalCgpa = document.getElementById('totalCgpa');
      const totalPercentage = document.getElementById('totalPercentage');
      const totalMarksObtained = document.getElementById('totalMarksObtained');
      const totalMaxMarks = document.getElementById('totalMaxMarks');
      const downloadPdfBtn = document.getElementById('downloadPdfBtn');
      const courseDetailsModal = new bootstrap.Modal(document.getElementById('courseDetailsModal'));
      const addCourseModal = new bootstrap.Modal(document.getElementById('addCourseModal'));
      const saveCourseBtn = document.getElementById('saveCourseBtn');
      const addCourseForm = document.getElementById('addCourseForm');
      const loadingContainer = document.getElementById('loadingContainer');
      const backToTopButton = document.getElementById('backToTop');
      const addForecastSemesterBtn = document.getElementById('addForecastSemesterBtn');
      const gpaChartContainer = document.getElementById('gpaChartContainer');
      const gpaTrendChartCanvas = document.getElementById('gpaTrendChart').getContext('2d');  
      const profileManagementDiv = document.getElementById('profileManagement');
      const profileSwitcher = document.getElementById('profileSwitcher');
      const deleteProfileBtn = document.getElementById('deleteProfileBtn');

      // NEW: Rename Profile Elements
      const renameProfileBtn = document.getElementById('renameProfileBtn');
      const renameProfileModal = new bootstrap.Modal(document.getElementById('renameProfileModal'));
      const saveProfileNameBtn = document.getElementById('saveProfileNameBtn');
      
      // State
      let allLogs = [];
      let processedData = null;
      let deletedSemesters = {};
      let gpaChart = null;  
      let isInitialLoad = true;
      
      const API_ENDPOINT = `/api/result-scraper?action=scrape_single`;
      
      function init() {
        initCustomCursor();
        initTheme();
        initContactForm();
        createToastContainer();
        initBackToTop();
        initScrollAnimations();  
        loadProfiles();
      }

      function initScrollAnimations() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-in-on-scroll').forEach(el => observer.observe(el));
      }

      // --- UPDATED PROFILE MANAGEMENT ---
      function getProfiles() {
        return JSON.parse(localStorage.getItem('uafCalculatorProfiles') || '{}');
      }

      function saveProfiles(profiles) {
        localStorage.setItem('uafCalculatorProfiles', JSON.stringify(profiles));
      }

      function getActiveProfileId() {
        return localStorage.getItem('uafCalculatorActiveProfile');
      }

      function setActiveProfileId(id) {
        localStorage.setItem('uafCalculatorActiveProfile', id);
      }

      function loadProfiles() {
        const profiles = getProfiles();
        const activeProfileId = getActiveProfileId();
        updateProfileSwitcher(profiles, activeProfileId);

        if (activeProfileId && profiles[activeProfileId]) {
          loadProfile(activeProfileId);
          addStatusMessage('Loaded active profile from session.', 'info');
        }
      }

      function updateProfileSwitcher(profiles, activeProfileId) {
        const profileKeys = Object.keys(profiles);
        if (profileKeys.length > 0) {
          profileSwitcher.innerHTML = '<option value="">Select a saved profile...</option>';
          profileKeys.forEach(profileId => {
            const profile = profiles[profileId];
            if (profile && profile.studentInfo) { // Ensure profile data is valid
                const option = document.createElement('option');
                option.value = profileId;
                // Use the custom displayName, fallback to the default generated name
                option.textContent = profile.displayName || `${profile.studentInfo.name} (${profile.studentInfo.registration})`;
                if (profileId === activeProfileId) {
                option.selected = true;
                }
                profileSwitcher.appendChild(option);
            }
          });
          profileManagementDiv.style.display = 'block';
        } else {
          profileManagementDiv.style.display = 'none';
        }
      }

      function loadProfile(profileId) {
        const profiles = getProfiles();
        if (profiles[profileId]) {
          processedData = profiles[profileId];
          isInitialLoad = true;
          const cgpaData = calculateCGPA(processedData);
          displayCGPAResults(processedData, cgpaData);
          registrationNumber.value = processedData.studentInfo.registration;
          setActiveProfileId(profileId);
          updateProfileSwitcher(profiles, profileId);
        }
      }

      function switchProfile(event) {
        const profileId = event.target.value;
        if (profileId) {
          loadProfile(profileId);
          showToast(`Switched to profile: ${getProfiles()[profileId].displayName}`, 'info');
        }
      }

      function deleteCurrentProfile() {
        const activeProfileId = getActiveProfileId();
        if (!activeProfileId) {
          showToast('No active profile selected to delete.', 'warning');
          return;
        }

        const profiles = getProfiles();
        const profileNameToDelete = profiles[activeProfileId].displayName;

        if (confirm(`Are you sure you want to delete the profile "${profileNameToDelete}"? This cannot be undone.`)) {
          delete profiles[activeProfileId];
          saveProfiles(profiles);
          localStorage.removeItem('uafCalculatorActiveProfile');
          
          showToast(`Profile "${profileNameToDelete}" deleted.`, 'success');
          addStatusMessage(`Deleted profile: ${profileNameToDelete}`, 'info');
          
          setTimeout(() => location.reload(), 500);
        }
      }

      function saveActiveProfile() {
        const activeProfileId = getActiveProfileId();
        if (activeProfileId) {
            const profiles = getProfiles();
            if (profiles[activeProfileId]) {
                profiles[activeProfileId] = processedData;
                saveProfiles(profiles);
            }
        }
      }

      function openRenameModal() {
        const activeProfileId = getActiveProfileId();
        if (!activeProfileId) {
            showToast('Please select a profile to rename.', 'warning');
            return;
        }
        const profiles = getProfiles();
        const currentName = profiles[activeProfileId].displayName;
        document.getElementById('newProfileName').value = currentName;
        renameProfileModal.show();
      }

      function renameProfile() {
          const activeProfileId = getActiveProfileId();
          const newName = document.getElementById('newProfileName').value.trim();

          if (!newName) {
              showToast('Profile name cannot be empty.', 'error');
              return;
          }

          const profiles = getProfiles();
          // Check if another profile already has this name
          const nameExists = Object.values(profiles).some(p => p.displayName === newName);
          if (nameExists && profiles[activeProfileId].displayName !== newName) {
              showToast('A profile with this name already exists.', 'error');
              return;
          }

          profiles[activeProfileId].displayName = newName;
          saveProfiles(profiles);
          renameProfileModal.hide();
          showToast('Profile renamed successfully!', 'success');
          updateProfileSwitcher(profiles, activeProfileId);
      }
      
      // --- END OF UPDATED PROFILE MANAGEMENT ---
      
      function updateTotalsDisplay() {
        const cgpaData = calculateCGPA(processedData);
        if (!cgpaData) return;

        studentName.innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${processedData.studentInfo.name}`;
        studentReg.textContent = processedData.studentInfo.registration;
        totalCgpa.textContent = formatNumber(cgpaData.cgpa).toFixed(4);
        totalPercentage.textContent = `${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`;
        totalMarksObtained.textContent = cgpaData.totalMarksObtained.toFixed(0);
        totalMaxMarks.textContent = `/ ${cgpaData.totalMaxMarks.toFixed(0)}`;
        
        renderGpaChart();
        saveActiveProfile();
      }
      
      function initBackToTop() {
        window.addEventListener('scroll', () => backToTopButton.classList.toggle('visible', window.pageYOffset > 300));
        backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
      }
      
      function createToastContainer() {
        if (!document.getElementById('toast-container')) {
          const toastContainer = document.createElement('div');
          toastContainer.id = 'toast-container';
          document.body.appendChild(toastContainer);
        }
      }
      
      function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        const icons = { success: 'fa-circle-check', error: 'fa-circle-exclamation', warning: 'fa-triangle-exclamation', info: 'fa-circle-info' };
        toast.innerHTML = `<div class="toast-content"><i class="toast-icon fa-solid ${icons[type]}"></i><span class="toast-message">${message}</span></div><div class="toast-progress"></div>`;
        toastContainer.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
      
      function initCustomCursor() {
        document.addEventListener('mousemove', (e) => {
          cursorDot.style.display = window.innerWidth > 768 ? 'block' : 'none';
          cursorDot.style.left = `${e.clientX}px`;
          cursorDot.style.top = `${e.clientY}px`;
        });
      }
      
      function initTheme() {
        const THEME_KEY = 'uaf-theme';
        const applyTheme = (theme) => {
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem(THEME_KEY, theme);
          themeToggle.innerHTML = theme === 'dark' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
        };
        const currentTheme = localStorage.getItem(THEME_KEY) || 'light';
        applyTheme(currentTheme);
        themeToggle.addEventListener('click', () => applyTheme(document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light'));
      }
      
      function initContactForm() {
        contactForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (!contactForm.checkValidity()) {
            e.stopPropagation();
            contactForm.classList.add('was-validated');
            return;
          }
          const data = new FormData(contactForm);
          const statusEl = document.getElementById('contact-form-status');
          try {
            const res = await fetch(contactForm.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
            if (res.ok) {
              statusEl.textContent = "Thanks! We'll get back to you soon.";
              statusEl.className = "text-success small";
              contactForm.reset();
              contactForm.classList.remove('was-validated');
              showToast('Message sent successfully!', 'success');
            } else {
              throw new Error('Form submission failed');
            }
          } catch {
            statusEl.textContent = "Oops! There was a problem. Please try again.";
            statusEl.className = "text-danger small";
            showToast('Failed to send message.', 'error');
          }
        });
      }
      
      function addStatusMessage(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        allLogs.push({ timestamp, message, type });
        const messageEl = document.createElement('div');
        messageEl.className = `status-line status-${type}`;
        messageEl.textContent = `[${timestamp}] ${message}`;
        statusLog.prepend(messageEl);
        statusLog.scrollTop = 0;
      }
      
      function showLoadingStage(stage) {
        ['connecting', 'fetching', 'processing', 'complete'].forEach(s => {
          const el = document.getElementById(`${s}Stage`);
          if (el) el.style.display = 'none';
        });
        if (stage) {
            const el = document.getElementById(`${stage}Stage`);
            if (el) el.style.display = 'block';
        }
        loadingContainer.style.display = stage ? 'block' : 'none';
      }
      
      function downloadLog() {
        addStatusMessage('Preparing log file for download...', 'info');
        let logContent = "UAF CGPA Calculator - M SAQLAIN - Activity Log\n============================================\n\n";
        allLogs.forEach(log => logContent += `[${log.timestamp}] ${log.message}\n`);
        const blob = new Blob([logContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `cgpa_calculator_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        addStatusMessage('Log file downloaded successfully', 'success');
        showToast('Log file downloaded!', 'success');
      }
      
      function clearLog() {
        statusLog.innerHTML = '';
        allLogs = [];
        addStatusMessage('Log cleared', 'info');
        showToast('Log cleared', 'info');
      }
      
      function processSemesterName(semester) {
          if (!semester) return 'Unknown Semester';
          if (semester.includes('Winter')) {
              const yearMatch = semester.match(/(\d{4})/);
              if (yearMatch) return `Winter ${yearMatch[1]}`;
          } else if (semester.includes('Spring')) {
              const yearMatch = semester.match(/(\d{4})-(\d{2,4})/);
              if (yearMatch && yearMatch[2].length === 4) return `Spring ${yearMatch[2]}`;
              if (yearMatch && yearMatch[2].length === 2) return `Spring 20${yearMatch[2]}`;
          } else if (semester.includes('Summer')) {
              const yearMatch = semester.match(/(\d{4})/);
              if (yearMatch) return `Summer ${yearMatch[1]}`;
          } else if (semester.includes('Fall')) {
              const yearMatch = semester.match(/(\d{4})/);
              if (yearMatch) return `Fall ${yearMatch[1]}`;
          }
          return semester;
      }
      
      function getSemesterOrderKey(semesterName) {
        if (!semesterName) return '9999-9';
        if (semesterName.toLowerCase().startsWith('forecast')) {
            const num = parseInt(semesterName.split(' ')[1] || '1');
            return `3000-${num}`;
        }
        let year = '9999';
        let seasonOrder = 9;
        const yearMatch = semesterName.match(/\b(20\d{2})\b/);
        if (yearMatch) year = yearMatch[1];
        if (semesterName.toLowerCase().includes('winter')) seasonOrder = 1;
        else if (semesterName.toLowerCase().includes('spring')) seasonOrder = 2;
        else if (semesterName.toLowerCase().includes('summer')) seasonOrder = 3;
        else if (semesterName.toLowerCase().includes('fall')) seasonOrder = 4;
        return `${year}-${seasonOrder}`;
      }
      
      function processScrapedData(data) {
        if (!data || !data.resultData) return null;
        const studentInfo = { name: data.resultData[0]?.StudentName || '', registration: data.resultData[0]?.RegistrationNo || '' };
        const semesters = {};
        const courseHistory = {};
        
        data.resultData.forEach(course => {
          const originalSemester = course.Semester || 'Unknown Semester';
          const semesterName = processSemesterName(originalSemester);
          const courseCode = course.CourseCode || '';
          const historyKey = courseCode.toUpperCase();

          if (!semesters[semesterName]) {
            semesters[semesterName] = { originalName: originalSemester, sortKey: getSemesterOrderKey(originalSemester), courses: [] };
          }
          
          const creditHoursStr = course.CreditHours || '0';
          const creditHours = parseInt(creditHoursStr.match(/\d+/)?.[0] || '0');
          const marks = parseFloat(course.Total || '0');
          
          let qualityPoints = calculateQualityPoints(marks, creditHours);
          
          if (course.Grade === 'F') {
            qualityPoints = 0;
          }

          const courseData = {
            code: courseCode,
            title: course.CourseTitle || '',
            creditHours: creditHours,
            creditHoursDisplay: creditHoursStr,
            marks: marks,
            qualityPoints: qualityPoints,
            grade: course.Grade || '',
            teacher: course.TeacherName || '',
            mid: course.Mid || '0',
            assignment: course.Assignment || '0',
            final: course.Final || '0',
            practical: course.Practical || '0',
            total: course.Total || '0',
            isExtraEnrolled: false,
            isRepeated: false,
            isDeleted: false,
            isCustom: false
          };
          
          if (!courseHistory[historyKey]) {
            courseHistory[historyKey] = [];
          }
          courseHistory[historyKey].push({ semester: semesterName, semesterSortKey: getSemesterOrderKey(originalSemester), marks: marks, data: courseData });
          semesters[semesterName].courses.push(courseData);
        });
        
        Object.values(courseHistory).forEach(history => {
          if (history.length > 1) {
            history.sort((a, b) => a.semesterSortKey.localeCompare(b.semesterSortKey));
            const highest = history.reduce((prev, current) => (prev.marks > current.marks) ? prev : current);
            history.forEach(item => {
              item.data.isRepeated = true;
              if (item !== highest) item.data.isExtraEnrolled = true;
            });
          }
        });
        
        return { studentInfo, semesters, courseHistory };
      }
      
      function calculateQualityPoints(marks, creditHours) {
        marks = parseFloat(marks);
        creditHours = parseInt(creditHours);
        let qualityPoints = 0;
        if (creditHours === 10) {
            if (marks >= 160) qualityPoints = 40;
            else if (marks >= 100) qualityPoints = 40 - ((160 - marks) * 0.33333);
            else if (marks < 100) qualityPoints = 20 - ((100 - marks) * 0.5);
            if (marks < 80) qualityPoints = 0;
        } else if (creditHours === 9) {
            if (marks >= 144) qualityPoints = 36;
            else if (marks >= 90) qualityPoints = 36 - ((144 - marks) * 0.33333);
            else if (marks < 90) qualityPoints = 18 - ((90 - marks) * 0.5);
            if (marks < 72) qualityPoints = 0;
        } else if (creditHours === 8) {
            if (marks >= 128) qualityPoints = 32;
            else if (marks >= 80) qualityPoints = 32 - ((128 - marks) * 0.33333);
            else if (marks < 80) qualityPoints = 16 - ((80 - marks) * 0.5);
            if (marks < 64) qualityPoints = 0;
        } else if (creditHours === 7) {
            if (marks >= 112) qualityPoints = 28;
            else if (marks >= 70) qualityPoints = 28 - ((112 - marks) * 0.33333);
            else if (marks < 70) qualityPoints = 14 - ((70 - marks) * 0.5);
            if (marks < 56) qualityPoints = 0;
        } else if (creditHours === 6) {
            if (marks >= 96) qualityPoints = 24;
            else if (marks >= 60) qualityPoints = 24 - ((96 - marks) * 0.33333);
            else if (marks < 60) qualityPoints = 12 - ((60 - marks) * 0.5);
            if (marks < 48) qualityPoints = 0;
        } else if (creditHours === 5) {
            if (marks >= 80) qualityPoints = 20;
            else if (marks >= 50) qualityPoints = 20 - ((80 - marks) * 0.33333);
            else if (marks < 50) qualityPoints = 10 - ((50 - marks) * 0.5);
            if (marks < 40) qualityPoints = 0;
        } else if (creditHours === 4) {
            if (marks >= 64) qualityPoints = 16;
            else if (marks >= 40) qualityPoints = 16 - ((64 - marks) * 0.33333);
            else if (marks < 40) qualityPoints = 8 - ((40 - marks) * 0.5);
            if (marks < 32) qualityPoints = 0;
        } else if (creditHours === 3) {
            if (marks >= 48) qualityPoints = 12;
            else if (marks >= 30) qualityPoints = 12 - ((48 - marks) * 0.33333);
            else if (marks < 30) qualityPoints = 6 - ((30 - marks) * 0.5);
            if (marks < 24) qualityPoints = 0;
        } else if (creditHours === 2) {
            if (marks >= 32) qualityPoints = 8;
            else if (marks >= 20) qualityPoints = 8 - ((32 - marks) * 0.33333);
            else if (marks < 20) qualityPoints = 4 - ((20 - marks) * 0.5);
            if (marks < 16) qualityPoints = 0;
        } else if (creditHours === 1) {
            if (marks >= 16) qualityPoints = 4;
            else if (marks >= 10) qualityPoints = 4 - ((16 - marks) * 0.33333);
            else if (marks < 10) qualityPoints = 2 - ((10 - marks) * 0.5);
            if (marks < 8) qualityPoints = 0;
        }
        return parseFloat(Math.max(0, qualityPoints).toFixed(2));
      }
      
      function calculateCustomGrade(marks, creditHours) {
        const grading = { 10: { A: 160, B: 100, D: 80 }, 9: { A: 144, B: 90, D: 72 }, 8: { A: 128, B: 80, D: 64 }, 7: { A: 112, B: 70, D: 56 }, 6: { A: 96, B: 60, D: 48 }, 5: { A: 80, B: 50, D: 40 }, 4: { A: 64, B: 52, C: 40, D: 32 }, 3: { A: 48, B: 39, C: 30, D: 24 }, 2: { A: 32, B: 26, C: 20, D: 16 }, 1: { A: 16, B: 13, C: 10, D: 8 } };
        const scale = grading[creditHours];
        if (!scale) return 'F';
        if (marks >= scale.A) return 'A'; if (marks >= scale.B) return 'B';
        if (scale.C && marks >= scale.C) return 'C'; if (marks >= scale.D) return 'D';
        return 'F';
      }
      
      function calculateCGPA(data) {
        if (!data) return null;
        let totalQualityPoints = 0, totalCreditHours = 0, totalMarksObtained = 0, totalMaxMarks = 0;
        
        Object.values(data.semesters).forEach(semester => {
            semester.totalQualityPoints = 0;
            semester.totalCreditHours = 0;
            semester.totalMarksObtained = 0;
            semester.totalMaxMarks = 0;
            semester.courses.forEach(course => {
                if (!course.isExtraEnrolled && !course.isDeleted) {
                    semester.totalQualityPoints += course.qualityPoints;
                    semester.totalCreditHours += course.creditHours;
                    semester.totalMarksObtained += course.marks;
                    
                    let maxMarks = { 10: 200, 9: 180, 8: 160, 7: 140, 6: 120, 5: 100, 4: 80, 3: 60, 2: 40, 1: 20 }[course.creditHours] || 0;
                    semester.totalMaxMarks += maxMarks;
                    
                    totalQualityPoints += course.qualityPoints;
                    totalCreditHours += course.creditHours;
                    totalMarksObtained += course.marks;
                    totalMaxMarks += maxMarks;
                }
            });
            semester.gpa = semester.totalCreditHours > 0 ? (semester.totalQualityPoints / semester.totalCreditHours) : 0;
            semester.percentage = semester.totalMaxMarks > 0 ? (semester.totalMarksObtained / semester.totalMaxMarks * 100) : 0;
        });
        
        const cgpa = totalCreditHours > 0 ? (totalQualityPoints / totalCreditHours) : 0;
        const percentage = totalMaxMarks > 0 ? (totalMarksObtained / totalMaxMarks * 100) : 0;
        return { cgpa, percentage, totalQualityPoints, totalCreditHours, totalMarksObtained, totalMaxMarks };
      }
      
      function formatNumber(value, places = 4) { return parseFloat(value.toFixed(places)); }
      
      function displayCGPAResults(data, cgpaData) {
        processedData = data;
        resultContainer.style.display = 'block';
        
        studentName.innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${data.studentInfo.name}`;
        studentReg.textContent = data.studentInfo.registration;
        totalCgpa.textContent = formatNumber(cgpaData.cgpa).toFixed(4);
        totalPercentage.textContent = `${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`;
        totalMarksObtained.textContent = cgpaData.totalMarksObtained.toFixed(0);
        totalMaxMarks.textContent = `/ ${cgpaData.totalMaxMarks.toFixed(0)}`;

        // --- ADD THIS NEW CODE FOR THE CIRCLE ---
    const cgpaCircle = document.getElementById('cgpaCircle');
    if(cgpaCircle) {
        const cgpa = parseFloat(totalCgpa.textContent);
        const percentage = (cgpa / 4.0) * 100;
        const offset = 100 - percentage;
        // A short delay to allow the element to render before animating
        setTimeout(() => {
            cgpaCircle.style.strokeDasharray = `${percentage}, 100`;
        }, 100);
    }
        
        semesterResults.innerHTML = '';
        Object.keys(data.semesters).sort((a,b) => data.semesters[a].sortKey.localeCompare(data.semesters[b].sortKey)).forEach(semesterName => {
          const semester = data.semesters[semesterName];
          const semesterCard = document.createElement('div');
          
          const animationClass = isInitialLoad ? 'fade-in-on-scroll' : 'is-visible';
          semesterCard.className = `semester-card ${animationClass}`;
          
          semesterCard.dataset.semester = semesterName;
          semesterCard.innerHTML = `
            <i class="fa-solid fa-trash delete-semester" title="Delete this semester" data-semester="${semesterName}"></i>
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="mb-0"><i class="fa-solid fa-book-open me-2" style="color: var(--brand);"></i>${semesterName}</h5>
              <div class="text-end" style="margin-right: 40px;">
                <p class="mb-0 text-body-secondary small">GPA:</p>
                <p class="mb-0 h4 fw-bold" style="color: var(--brand);">${formatNumber(semester.gpa).toFixed(4)}</p>
                <p class="mb-0 text-body-secondary small">${formatNumber(semester.percentage, 2).toFixed(2)}%</p>
              </div>
            </div>
            <button class="custom-course-btn" data-semester="${semesterName}"><i class="fa-solid fa-plus"></i> Custom Course</button>
            <div class="table-responsive"><table class="course-table"><thead><tr><th>Course</th><th>Hrs</th><th>Marks</th><th>Grade</th><th>Action</th></tr></thead>
              <tbody>${semester.courses.map((course, index) => {
                  const courseIdentifier = `${semesterName}-${course.code}-${course.total}-${index}`;
                  return `
                  <tr data-course-identifier="${courseIdentifier}" draggable="true" class="${course.isExtraEnrolled ? 'table-warning' : ''} ${course.isDeleted ? 'table-danger text-decoration-line-through' : ''} ${course.isCustom ? 'table-info' : ''}">
                    <td>
                      <div class="course-code-container">
                        <span class="fw-medium course-code clickable-info" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}'>
                          ${course.code}
                          <i class="fa-solid fa-info-circle ms-1 clickable-info small" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' title="${course.title}"></i>
                        </span>
                        ${course.isExtraEnrolled ? '<sup class="extra-enrolled">Rep.</sup>' : ''}
                        ${course.isCustom ? '<span class="extra-enrolled">Custom</span>' : ''}
                      </div>
                    </td>
                    <td>${course.creditHoursDisplay || course.creditHours}</td><td>${course.marks}</td>
                    <td><span class="grade-badge grade-${course.grade}">${course.grade}</span></td>
                    <td class="course-actions">${course.isDeleted ? `<i class="fa-solid fa-rotate-left restore-course" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' data-semester="${semesterName}" title="Restore"></i>` : `<i class="fa-solid fa-trash delete-course" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' data-semester="${semesterName}" title="Delete"></i>`}</td>
                  </tr>`;
              }).join('')}</tbody>
            </table></div>`;
          semesterResults.appendChild(semesterCard);
        });

        isInitialLoad = false;
        attachResultEventListeners();
        renderGpaChart();  
      }

      function renderGpaChart() {
          if (!processedData || Object.keys(processedData.semesters).length === 0) {
              gpaChartContainer.style.display = 'none';
              return;
          }

          if (gpaChart) {
              gpaChart.destroy();
          }

          const sortedSemesters = Object.entries(processedData.semesters)
              .sort(([, a], [, b]) => a.sortKey.localeCompare(b.sortKey));

          const labels = sortedSemesters.map(([name]) => name);
          const gpaData = sortedSemesters.map(([, semester]) => formatNumber(semester.gpa, 4));

          const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
          const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
          const fontColor = isDarkMode ? '#e5e7eb' : '#4b5563';

          gpaChart = new Chart(gpaTrendChartCanvas, {
              type: 'line',
              data: {
                  labels: labels,
                  datasets: [{
                      label: 'Semester GPA',
                      data: gpaData,
                      fill: true,
                      backgroundColor: 'rgba(122, 106, 216, 0.2)',
                      borderColor: 'rgba(122, 106, 216, 1)',
                      tension: 0.3,
                      pointBackgroundColor: 'rgba(122, 106, 216, 1)',
                      pointBorderColor: '#fff',
                      pointHoverRadius: 7,
                      pointHoverBackgroundColor: '#fff',
                      pointHoverBorderColor: 'rgba(122, 106, 216, 1)'
                  }]
              },
              options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  scales: {
                      y: {
                          beginAtZero: true,
                          suggestedMax: 4.0,
                          ticks: { color: fontColor },
                          grid: { color: gridColor }
                      },
                      x: {
                          ticks: { color: fontColor },
                          grid: { color: gridColor }
                      }
                  },
                  plugins: {
                      legend: { display: false },
                      tooltip: {
                          backgroundColor: isDarkMode ? '#1b1f24' : '#fff',
                          titleColor: isDarkMode ? '#fff' : '#1b1f24',
                          bodyColor: isDarkMode ? '#d1d5db' : '#4b5563',
                          borderColor: 'rgba(122, 106, 216, 0.5)',
                          borderWidth: 1,
                          padding: 10,
                          callbacks: {
                              label: context => `GPA: ${context.parsed.y.toFixed(4)}`
                          }
                      }
                  },
                  animation: {
                      duration: 1000,
                      easing: 'easeInOutQuart'
                  }
              }
          });
          gpaChartContainer.style.display = 'block';
      }

      function attachResultEventListeners() {
        document.querySelectorAll('.clickable-info').forEach(el => el.addEventListener('click', e => showCourseDetails(JSON.parse(e.currentTarget.dataset.course.replace(/&#39;/g, "'")))));
        document.querySelectorAll('.delete-semester').forEach(btn => btn.addEventListener('click', e => deleteSemester(e, e.currentTarget.dataset.semester)));
        document.querySelectorAll('.custom-course-btn').forEach(btn => btn.addEventListener('click', e => openAddCourseModal(e.currentTarget.dataset.semester)));
        if(document.getElementById('copyDetailsIconBtn')) {
            document.getElementById('copyDetailsIconBtn').addEventListener('click', copyDetailsToClipboard);
        }
        document.querySelectorAll('.delete-course').forEach(btn => {
          const course = JSON.parse(btn.dataset.course.replace(/&#39;/g, "'"));
          btn.addEventListener('click', e => modifyCourseState(e, course, btn.dataset.semester, true));
        });
        document.querySelectorAll('.restore-course').forEach(btn => {
          const course = JSON.parse(btn.dataset.course.replace(/&#39;/g, "'"));
          btn.addEventListener('click', e => modifyCourseState(e, course, btn.dataset.semester, false));
        });
        document.querySelectorAll('.semester-card.fade-in-on-scroll:not(.is-visible)').forEach(el => {
            const observer = new IntersectionObserver(entries => {
                if (entries[0].isIntersecting) {
                    entries[0].target.classList.add('is-visible');
                    observer.unobserve(entries[0].target);
                }
            }, { threshold: 0.1 });
            observer.observe(el);
        });
        if (window.innerWidth >= 992) {
          initDragAndDrop();
        }
      }

      function initDragAndDrop() {
          const draggables = document.querySelectorAll('.course-table tr[draggable="true"]');
          const droppables = document.querySelectorAll('.semester-card');

          draggables.forEach(draggable => {
              draggable.addEventListener('dragstart', e => {
                  e.target.classList.add('dragging');
                  const sourceSemester = e.target.closest('.semester-card').dataset.semester;
                  const courseIdentifier = e.target.dataset.courseIdentifier;
                  e.dataTransfer.setData('text/plain', JSON.stringify({ courseIdentifier, sourceSemester }));
              });
              draggable.addEventListener('dragend', e => {
                  e.target.classList.remove('dragging');
              });
          });

          droppables.forEach(droppable => {
              droppable.addEventListener('dragover', e => {
                  e.preventDefault();
                  e.currentTarget.classList.add('drag-over');
              });
              droppable.addEventListener('dragleave', e => {
                  e.currentTarget.classList.remove('drag-over');
              });
              droppable.addEventListener('drop', e => {
                  e.preventDefault();
                  e.currentTarget.classList.remove('drag-over');

                  const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                  const targetSemester = e.currentTarget.dataset.semester;

                  if (data.sourceSemester === targetSemester) {
                      return;
                  }
                  
                  let courseToMove = null;
                  let courseIndex = -1;
                  
                  const identifierParts = data.courseIdentifier.split('-');
                  const originalIndex = parseInt(identifierParts[identifierParts.length - 1], 10);
                  
                  const sourceCourses = processedData.semesters[data.sourceSemester]?.courses;
                  if (sourceCourses && sourceCourses[originalIndex]) {
                      const potentialCourse = sourceCourses[originalIndex];
                      const expectedIdentifier = `${data.sourceSemester}-${potentialCourse.code}-${potentialCourse.total}-${originalIndex}`;
                      if (data.courseIdentifier === expectedIdentifier) {
                          courseToMove = potentialCourse;
                          courseIndex = originalIndex;
                      }
                  }

                  if (courseToMove && courseIndex > -1) {
                      sourceCourses.splice(courseIndex, 1);
                      processedData.semesters[targetSemester].courses.push(courseToMove);
                      recalculateAndDisplay();
                      showToast(`Moved ${courseToMove.code} to ${targetSemester}`, 'success');
                      addStatusMessage(`Moved course ${courseToMove.code} from ${data.sourceSemester} to ${targetSemester}`, 'info');
                  } else {
                      showToast('Could not move course.', 'error');
                      console.error('Course mismatch or not found. Identifier:', data.courseIdentifier);
                  }
              });
          });
      }
      
      function showCourseDetails(course) {
        document.getElementById('courseDetailsModalTitle').textContent = `${course.code} - ${course.title}`;
        document.getElementById('courseDetailsModalBody').innerHTML = `
          <div class="row">
            <div class="col-md-6"><p><strong>Teacher:</strong> ${course.teacher}</p><p><strong>Credit Hours:</strong> ${course.creditHoursDisplay || course.creditHours}</p><p><strong>Semester:</strong> ${processSemesterName(course.originalSemester)}</p></div>
            <div class="col-md-6"><p><strong>Mid Term:</strong> ${course.mid}</p><p><strong>Assignment:</strong> ${course.assignment}</p><p><strong>Final Term:</strong> ${course.final}</p>${course.practical ? `<p><strong>Practical:</strong> ${course.practical}</p>` : ''}</div>
          </div>
          <div class="alert alert-info mt-3"><p class="mb-1"><strong>Total Marks:</strong> ${course.total}</p><p class="mb-1"><strong>Grade:</strong> <span class="grade-badge grade-${course.grade}">${course.grade}</span></p><p class="mb-0"><strong>Quality Points:</strong> ${course.qualityPoints.toFixed(2)}</p></div>
          ${course.isExtraEnrolled ? `<div class="alert alert-warning"><i class="fa-solid fa-exclamation-triangle me-2"></i>This repeated course's marks are not counted towards the CGPA in this semester.</div>` : ''}
          ${course.isCustom ? `<div class="alert alert-info"><i class="fa-solid fa-info-circle me-2"></i>This is a custom course added manually.</div>` : ''}`;
        courseDetailsModal.show();
      }
      
      function openAddCourseModal(semesterName) {
        document.getElementById('addCourseSemester').value = semesterName;
        addCourseForm.reset();
        addCourseModal.show();
      }
      
      function addCustomCourse() {
        const semesterName = document.getElementById('addCourseSemester').value;
        const courseCode = document.getElementById('courseCode').value.trim();
        const courseTitle = document.getElementById('courseTitle').value.trim();
        const creditHours = parseInt(document.getElementById('creditHours').value);
        const marks = parseFloat(document.getElementById('courseMarks').value);
        if (!courseCode || !courseTitle || !creditHours || isNaN(marks)) {
          showToast('Please fill all fields correctly', 'error');
          return;
        }
        const newCourse = {
            code: courseCode, title: courseTitle, creditHours, creditHoursDisplay: `${creditHours}(${creditHours}-0)`, marks,
            qualityPoints: calculateQualityPoints(marks, creditHours), grade: calculateCustomGrade(marks, creditHours),
            semesterName, teacher: 'Custom', mid: 'N/A', assignment: 'N/A', final: marks, practical: 'N/A', total: marks,
            isExtraEnrolled: false, isRepeated: false, isDeleted: false, isCustom: true
        };
        processedData.semesters[semesterName].courses.push(newCourse);
        recalculateAndDisplay();
        addCourseModal.hide();
        showToast(`Course ${courseCode} added`, 'success');
      }
      
      function deleteSemester(event, semesterName) {
        event.preventDefault();
        if (!processedData || !processedData.semesters[semesterName]) return;
        
        deletedSemesters[semesterName] = JSON.parse(JSON.stringify(processedData.semesters[semesterName]));
        delete processedData.semesters[semesterName];
        
        recalculateAndDisplay();
        
        showUndoNotification(`Semester "${semesterName}" deleted`, () => undoDeleteSemester(semesterName));
        addStatusMessage(`Deleted semester: ${semesterName}`, 'info');
      }
      
      function showUndoNotification(message, undoCallback) {
        document.getElementById('undo-notification')?.remove();
        const notification = document.createElement('div');
        notification.id = 'undo-notification';
        notification.className = 'undo-notification';
        notification.innerHTML = `<span>${message}</span> <button class="undo-btn">Undo</button>`;
        document.body.appendChild(notification);
        notification.querySelector('.undo-btn').onclick = () => {
            undoCallback();
            notification.remove();
        };
        setTimeout(() => notification.remove(), 5000);
      }
      
      function undoDeleteSemester(semesterName) {
        if (!deletedSemesters[semesterName]) return;
        
        processedData.semesters[semesterName] = deletedSemesters[semesterName];
        delete deletedSemesters[semesterName];
        
        recalculateAndDisplay();
        addStatusMessage(`Restored semester: ${semesterName}`, 'info');
      }
      
      function modifyCourseState(event, course, semesterName, isDeleted) {
        event.preventDefault();
        const semester = processedData.semesters[semesterName];
        if (!semester) return;

        const courseIndex = semester.courses.findIndex(c => c.code === course.code && c.total === course.total && c.title === course.title);
        
        if (courseIndex !== -1) {
          semester.courses[courseIndex].isDeleted = isDeleted;
          recalculateAndDisplay();
          const action = isDeleted ? 'Deleted' : 'Restored';
          showToast(`Course ${course.code} ${action.toLowerCase()}`, 'info');
          addStatusMessage(`${action} course: ${course.code} from ${semesterName}`, 'info');
        }
      }

      function recalculateAndDisplay() {
        const cgpaData = calculateCGPA(processedData);
        displayCGPAResults(processedData, cgpaData);
        saveActiveProfile();
      }

      function addForecastSemester() {
        let forecastCount = 1;
        while (`Forecast ${forecastCount}` in processedData.semesters) {
            forecastCount++;
        }
        const newSemesterName = `Forecast ${forecastCount}`;
        processedData.semesters[newSemesterName] = {
            originalName: newSemesterName,
            sortKey: getSemesterOrderKey(newSemesterName),
            courses: []
        };
        recalculateAndDisplay();
        showToast(`Added "${newSemesterName}"`, 'success');
        addStatusMessage(`Added forecast semester: ${newSemesterName}`, 'info');
      }
      
      function copyDetailsToClipboard() {
          if (!processedData) return;
          const textToCopy = `Name: ${processedData.studentInfo.name}\nRegistration: ${processedData.studentInfo.registration}\nCGPA: ${totalCgpa.textContent}\nPercentage: ${totalPercentage.textContent}`;
          navigator.clipboard.writeText(textToCopy).then(() => {
              showToast('Details copied to clipboard!', 'success');
          }, (err) => {
              showToast('Failed to copy details.', 'error');
              console.error('Clipboard copy failed: ', err);
          });
      }
      
      function generatePDF() {
        if (!processedData) {
            showToast('No data to download', 'error');
            return;
        }
        addStatusMessage('Generating premium PDF report...', 'info');
        showLoadingStage('processing');

        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            const cgpaData = calculateCGPA(processedData);

            const pageMargin = 15;
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const availableWidth = pageWidth - (2 * pageMargin);
            const colors = {
                primary: '#7a6ad8',
                textDark: '#1b1f24',
                textLight: '#4b5563',
                line: '#e0e0e0',
                fillLight: '#f8f9ff',
            };
            let lastY = 0;

            const drawFirstPageHeader = () => {
                pdf.setFontSize(18);
                pdf.setTextColor(colors.primary);
                pdf.setFont('helvetica', 'bold');
                pdf.text("University of Agriculture, Faisalabad", pageWidth / 2, 20, { align: 'center' });
                
                pdf.setFontSize(12);
                pdf.setTextColor(colors.textLight);
                pdf.setFont('helvetica', 'normal');
                pdf.text("Unofficial Academic Transcript", pageWidth / 2, 28, { align: 'center' });
                
                pdf.setDrawColor(colors.primary);
                pdf.setLineWidth(0.5);
                pdf.line(pageMargin, 35, pageWidth - pageMargin, 35);
                lastY = 35;
            };
            
            drawFirstPageHeader();

            const topBoxY = lastY + 10;
            const boxHeight = 45; 
            const gap = 5;
            const leftBoxWidth = availableWidth * 0.4;
            const rightBoxWidth = availableWidth - leftBoxWidth - gap;
            const rightBoxX = pageMargin + leftBoxWidth + gap;

            pdf.setFillColor(colors.fillLight);
            pdf.roundedRect(pageMargin, topBoxY, leftBoxWidth, boxHeight, 3, 3, 'F');
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.textDark);
            pdf.text("Student Information", pageMargin + 5, topBoxY + 8);
            pdf.setDrawColor(colors.line);
            pdf.line(pageMargin + 5, topBoxY + 11, pageMargin + leftBoxWidth - 5, topBoxY + 11);

            pdf.setFontSize(12);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.primary);
            pdf.text(processedData.studentInfo.name, pageMargin + 5, topBoxY + 25, { maxWidth: leftBoxWidth - 10 });
            
            pdf.setFontSize(8);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(colors.textLight);
            pdf.text(processedData.studentInfo.registration, pageMargin + 5, topBoxY + 30);

            pdf.setFillColor(colors.fillLight);
            pdf.roundedRect(rightBoxX, topBoxY, rightBoxWidth, boxHeight, 3, 3, 'F');
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.textDark);
            pdf.text("Overall Academic Summary", rightBoxX + 5, topBoxY + 8);
            pdf.line(rightBoxX + 5, topBoxY + 11, rightBoxX + rightBoxWidth - 5, topBoxY + 11);
            
            pdf.setFontSize(22);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(colors.primary);
            pdf.text(formatNumber(cgpaData.cgpa, 4).toFixed(4), rightBoxX + 5, topBoxY + 25);
            pdf.setFontSize(8);
            pdf.setTextColor(colors.textLight);
            pdf.text("OVERALL CGPA", rightBoxX + 5, topBoxY + 29);

            const statsStartX = rightBoxX + 40;
            pdf.setFont('helvetica', 'bold');
            pdf.text("Percentage:", statsStartX, topBoxY + 20);
            pdf.text("Total Credits:", statsStartX, topBoxY + 28);
            pdf.text("Total Marks:", statsStartX, topBoxY + 36);
            
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(colors.textDark);
            pdf.text(`${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`, statsStartX + 25, topBoxY + 20);
            pdf.text(cgpaData.totalCreditHours.toString(), statsStartX + 25, topBoxY + 28);
            pdf.text(`${cgpaData.totalMarksObtained.toFixed(0)} / ${cgpaData.totalMaxMarks}`, statsStartX + 25, topBoxY + 36);
            
            lastY = topBoxY + boxHeight;

            let semesterIndex = 0;
            Object.keys(processedData.semesters)
                .sort((a, b) => processedData.semesters[a].sortKey.localeCompare(processedData.semesters[b].sortKey))
                .forEach(semesterName => {
                    semesterIndex++;
                    const semester = processedData.semesters[semesterName];
                    const activeCourses = semester.courses.filter(c => !c.isDeleted);
                    if (activeCourses.length === 0) return;

                    const semesterSummary = `GPA: ${formatNumber(semester.gpa, 4).toFixed(4)}  |  Credit Hours: ${semester.totalCreditHours}  |  Marks: ${semester.totalMarksObtained.toFixed(0)}/${semester.totalMaxMarks}`;
                    
                    if (lastY + 30 > pageHeight) {
                        pdf.addPage();
                        lastY = 20;
                    }
                    const semesterHeaderY = lastY + 12;

                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(colors.primary);
                    pdf.text(`${semesterIndex}. ${semesterName}`, pageMargin, semesterHeaderY);

                    pdf.setFontSize(9);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(colors.textDark);
                    pdf.text(semesterSummary, pageWidth - pageMargin, semesterHeaderY, { align: 'right' });
                    
                    lastY = semesterHeaderY + 2;
                    
                    const head = [['Course Code', 'Course Title', 'CH', 'Marks', 'Grade']];
                    const body = activeCourses.map(c => [c.code, c.title, c.creditHoursDisplay, c.marks.toFixed(0), c.grade]);
                    
                    pdf.autoTable({
                        head: head,
                        body: body,
                        startY: lastY,
                        margin: { left: pageMargin, right: pageMargin, bottom: 25 },
                        headStyles: { fillColor: colors.primary, textColor: '#ffffff', fontStyle: 'bold', halign: 'center', valign: 'middle' },
                        columnStyles: { 
                            0: { halign: 'left', cellWidth: availableWidth * 0.18 },
                            1: { halign: 'left', cellWidth: availableWidth * 0.46, cellPadding: { left: 2 } },
                            2: { halign: 'center', cellWidth: availableWidth * 0.12 },
                            3: { halign: 'center', cellWidth: availableWidth * 0.12 },
                            4: { halign: 'center', cellWidth: availableWidth * 0.12 }
                        },
                        styles: { valign: 'middle', cellPadding: 2.2, fontSize: 9, overflow: 'linebreak' },
                        alternateRowStyles: { fillColor: '#f8f9ff' }
                    });
                    lastY = pdf.lastAutoTable.finalY;

                    if (lastY < pageHeight - 30) {
                         pdf.setDrawColor(colors.line);
                         pdf.setLineWidth(0.3);
                         pdf.line(pageMargin, lastY + 6, pageWidth - pageMargin, lastY + 6);
                         lastY += 6;
                    }
                });
            
            const totalPages = pdf.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(9);
                pdf.setTextColor(colors.textLight);
                pdf.setFont('helvetica', 'italic');
                const footerY = pageHeight - 15;
                
                pdf.text("Generated by UAF CGPA Calculator - M Saqlain (www.uafcgpacalculator.vercel.app)", pageWidth / 2, footerY, { align: 'center' });
                pdf.text("This is an unofficial transcript and should be used for reference purposes only.", pageWidth / 2, footerY + 5, { align: 'center' });
                
                pdf.setFontSize(8).setTextColor('#b0b0b0');
                pdf.text(`Page ${i} of ${totalPages}`, pageWidth - pageMargin, pageHeight - 10, { align: 'right' });
            }
            
            pdf.save(`UAF_Transcript_${processedData.studentInfo.registration}.pdf`);
            addStatusMessage('Premium PDF report generated successfully', 'success');
            showToast('PDF downloaded!', 'success');
        } catch (e) {
            addStatusMessage(`Error generating PDF: ${e.message}`, 'error');
            showToast('Error generating PDF', 'error');
            console.error("PDF generation error: ", e);
        } finally {
            showLoadingStage(null);
        }
      }

      async function fetchResult() {
        const regNum = registrationNumber.value.trim();
        if (!regNum) { showToast('Please enter a registration number', 'error'); return; }
        
        resultContainer.style.display = 'none';
        showLoadingStage('connecting');
        addStatusMessage(`Fetching result for: ${regNum}`, 'info');
        semesterResults.innerHTML = '';
        gpaChartContainer.style.display = 'none';

        try {
          const response = await fetch(`${API_ENDPOINT}&registrationNumber=${encodeURIComponent(regNum)}`);
          if (!response.ok) throw new Error(`Server responded with status ${response.status}`);
          showLoadingStage('fetching');
          const data = await response.json();
          showLoadingStage('processing');
          
          if (data.success && data.resultData && data.resultData.length > 0) {
            addStatusMessage('Result fetched successfully from UAF LMS', 'success');
            isInitialLoad = true;
            const processed = processScrapedData(data);
            const cgpaData = calculateCGPA(processed);
            
            // --- UPDATED SAVE LOGIC ---
            const profiles = getProfiles();
            const studentInfo = processed.studentInfo;
            let baseName = `${studentInfo.name} (${studentInfo.registration})`;
            let finalName = baseName;
            let copyNum = 1;

            // Find an available name if the base name is already taken for a different registration number
            const allDisplayNames = Object.values(profiles).map(p => p.displayName);

            while(allDisplayNames.includes(finalName)) {
                finalName = `${baseName} - ${copyNum++}`;
            }

            processed.displayName = finalName;
            const newProfileId = `profile_${Date.now()}`;
            profiles[newProfileId] = processed;
            saveProfiles(profiles);
            setActiveProfileId(newProfileId);
            // --- END OF UPDATED SAVE LOGIC ---

            showLoadingStage('complete');
            setTimeout(() => {
              displayCGPAResults(processed, cgpaData);
              showLoadingStage(null);
              showToast('New profile created successfully!', 'success');
              updateProfileSwitcher(profiles, newProfileId);
            }, 1000);

          } else {
            throw new Error(data.message || "No result found for this registration number.");
          }
        } catch (error) {
            console.error("Fetch Error:", error);
            let userMessage, logMessage;
            
            if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                userMessage = 'Network error. Please check your internet connection.';
                logMessage = 'Failed to fetch due to a network error. Ensure you are connected to the internet.';
            } else {
                userMessage = 'Could not retrieve results. The UAF LMS may be offline or the registration number is incorrect.';
                logMessage = `API/LMS Error: ${error.message}`;
            }
            
            addStatusMessage(logMessage, 'error');
            showToast(userMessage, 'error');
            showLoadingStage(null);
        }
      }
      
      // Event Listeners
      resultForm.addEventListener('submit', (e) => { e.preventDefault(); fetchResult(); });
      downloadLogBtn.addEventListener('click', downloadLog);
      clearLogBtn.addEventListener('click', clearLog);
      downloadPdfBtn.addEventListener('click', generatePDF);
      saveCourseBtn.addEventListener('click', addCustomCourse);
      addForecastSemesterBtn.addEventListener('click', addForecastSemester);
      profileSwitcher.addEventListener('change', switchProfile);
      deleteProfileBtn.addEventListener('click', deleteCurrentProfile);
      // NEW: Event listeners for rename functionality
      renameProfileBtn.addEventListener('click', openRenameModal);
      saveProfileNameBtn.addEventListener('click', renameProfile);
      
      init();
    });
</script>
</body>
</html>






















