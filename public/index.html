<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UAF CGPA Calculator</title>
  <meta name="description" content="UAF CGPA Calculator that fetches your results directly from UAF LMS. Built for University of Agriculture Faisalabad students." />
  <link rel="canonical" href="https://uaftools.vercel.app/auto.html" />
  <meta property="og:title" content="UAF CGPA Calculator" />
  <meta property="og:description" content="Fetch your results directly from UAF LMS and calculate CGPA automatically." />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="UAF Tools" />
  <meta property="og:url" content="https://uaftools.vercel.app/auto.html" />
  <meta property="og:image" content="https://uaftools.vercel.app/uaftools.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="UAF CGPA Calculator" />
  <meta name="twitter:description" content="Fetch your results directly from UAF LMS and calculate CGPA automatically." />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>">

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Theme Styles -->
  <style>
    :root {
  --brand: #7a6ad8;
  --brand-600: #6b5fca;
  --brand-700: #5d52b8;
  --brand-gradient: linear-gradient(135deg, #7a6ad8 0%, #6b5fca 50%, #5d52b8 100%);
  --brand-gradient-hover: linear-gradient(135deg, #8a7ce8 0%, #7b6fda 50%, #6d62c8 100%);
  --accent: #ff6b6b;
  --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
  --text: #1b1f24;
  --text-light: #4b5563;
  --muted: #6b7280;
  --light-bg: #f8f9ff;
  --card-bg: #ffffff;
  --radius: 1.25rem;
  --shadow: 0 10px 30px rgba(17, 24, 39, 0.1);
  --shadow-hover: 0 15px 40px rgba(17, 24, 39, 0.15);
}

html, body {
  font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  scroll-behavior: smooth;
}

body {
  background: linear-gradient(180deg, #f8f9ff 0%, #ffffff 70%);
  min-height: 100vh;
  margin: 0;
  padding: 0;
}

/* Improved navbar with glassmorphism effect */
.navbar {
  backdrop-filter: saturate(180%) blur(12px);
  background-color: rgba(255, 255, 255, 0.8);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.navbar .navbar-brand {
  font-weight: 800;
  letter-spacing: .3px;
  color: var(--brand);
  transition: all 0.3s ease;
}

.navbar .navbar-brand:hover {
  transform: translateY(-1px);
}

.navbar .nav-link {
  position: relative;
  font-weight: 500;
  transition: all 0.3s ease;
}

.navbar .nav-link::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--brand-gradient);
  transition: width 0.3s ease;
}

.navbar .nav-link:hover::after {
  width: 100%;
}

/* Improved buttons */
.btn-brand {
  background: var(--brand-gradient);
  border: none;
  color: white;
  transition: all 0.3s ease;
  box-shadow: var(--shadow);
}

.btn-brand:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  color: white;
}

.btn-soft {
  background: rgba(122, 106, 216, 0.1);
  color: var(--brand);
  transition: all 0.3s ease;
}

.btn-soft:hover {
  background: rgba(122, 106, 216, 0.2);
  transform: translateY(-1px);
}

.badge-brand {
  background: var(--brand-gradient);
  color: white;
}

.btn-primary-action {
  background: var(--brand-gradient);
  color: #fff;
  border: 0;
  box-shadow: 0 6px 18px rgba(122, 106, 216, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-primary-action:hover {
  background: var(--brand-gradient-hover);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(122, 106, 216, 0.3);
}

.btn-secondary-action {
  background: #fff;
  color: var(--brand);
  border: 1px solid rgba(122, 106, 216, 0.15);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-secondary-action:hover {
  background: #f8f9ff;
  color: var(--brand);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.1);
}

.btn-danger-action {
  background: var(--accent-gradient);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-danger-action:hover {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  transform: translateY(-2px);
}

.btn-success-action {
  background: linear-gradient(135deg, #10ac84 0%, #0d916b 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-success-action:hover {
  background: linear-gradient(135deg, #12c29a 0%, #0fa57c 100%);
  color: white;
  transform: translateY(-2px);
}

/* Improved hero section */
.hero {
  padding: 7rem 0 4rem;
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: '';
  position: absolute;
  top: -100px;
  right: -100px;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  background: rgba(122, 106, 216, 0.1);
  z-index: -1;
}

.hero::after {
  content: '';
  position: absolute;
  bottom: -50px;
  left: -50px;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: rgba(255, 107, 107, 0.1);
  z-index: -1;
}

.hero h1 {
  font-weight: 800;
  line-height: 1.05;
  font-size: 3.5rem;
  margin-bottom: 1.5rem;
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero .lead {
  color: var(--text-light);
  font-size: 1.25rem;
  margin-bottom: 2rem;
}

/* Improved cards with glassmorphism effect */
.card-modern {
  border: 0;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  overflow: hidden;
}

.card-modern:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.card-modern .card-header {
  border: 0;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  padding: 1.5rem 2rem;
}

.card-modern .card-header h4 {
  font-weight: 700;
  color: var(--text);
}

.form-select, .form-control {
  border-radius: .85rem;
  border: 1px solid rgba(122, 106, 216, 0.2);
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
}

.form-select:focus, .form-control:focus {
  border-color: var(--brand);
  box-shadow: 0 0 0 0.25rem rgba(122, 106, 216, 0.25);
}

label {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 0.5rem;
}

.subject-row {
  border: 1px dashed rgba(122, 106, 216, 0.3);
  border-radius: 1rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.5);
  transition: all 0.3s ease;
}

.subject-row:hover {
  border-color: var(--brand);
  background: rgba(255, 255, 255, 0.8);
}

.result-display {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--brand);
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Improved loading animations */
.loading-container {
  margin-top: 1.5rem;
  text-align: center;
  padding: 3rem 2rem;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.1), rgba(122, 106, 216, 0.05));
  display: none;
  backdrop-filter: blur(10px);
}

.loading-stage {
  display: none;
}

.loading-animation {
  width: 80px;
  height: 80px;
  margin: 0 auto 1.5rem;
  position: relative;
}

.loading-connecting {
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-connecting .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--brand);
  margin: 0 5px;
  animation: bounce 1.5s infinite ease-in-out;
}

.loading-connecting .dot:nth-child(2) {
  animation-delay: 0.2s;
}

.loading-connecting .dot:nth-child(3) {
  animation-delay: 0.4s;
}

.loading-fetching {
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-fetching .book {
  width: 40px;
  height: 30px;
  background: var(--brand);
  border-radius: 5px;
  position: relative;
  animation: bookFlip 2s infinite ease-in-out;
  transform-style: preserve-3d;
}

.loading-fetching .book:before {
  content: '';
  position: absolute;
  width: 100%;
  height: 100%;
  background: var(--brand-600);
  border-radius: 5px;
  transform: rotateY(180deg);
}

.loading-processing {
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-processing .calculator {
  width: 40px;
  height: 50px;
  background: var(--brand);
  border-radius: 5px;
  position: relative;
}

.loading-processing .calculator:before {
  content: '';
  position: absolute;
  top: 10px;
  left: 5px;
  width: 30px;
  height: 5px;
  background: rgba(255, 255, 255, 0.7);
  border-radius: 2px;
  box-shadow: 0 10px 0 rgba(255, 255, 255, 0.7), 0 20px 0 rgba(255, 255, 255, 0.7);
}

.loading-processing .calculator:after {
  content: '';
  position: absolute;
  bottom: 5px;
  right: 5px;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid rgba(255, 255, 255, 0.7);
  border-top-color: transparent;
  animation: spin 1s infinite linear;
}

.loading-complete .checkmark {
  width: 80px;
  height: 80px;
  margin: 0 auto;
  position: relative;
}

.loading-complete .checkmark:before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 40px;
  height: 20px;
  border: 6px solid var(--brand);
  border-top: none;
  border-right: none;
  transform: translate(-50%, -60%) rotate(-45deg);
  animation: checkmark 0.6s ease-in-out;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

@keyframes bookFlip {
  0%, 100% { transform: rotateY(0deg); }
  50% { transform: rotateY(180deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes checkmark {
  0% { opacity: 0; transform: translate(-50%, -60%) rotate(-45deg) scale(0); }
  50% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1.2); }
  100% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1); }
}

.loading-text {
  font-weight: 600;
  color: var(--brand);
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.loading-subtext {
  color: var(--muted);
  font-size: 0.9rem;
  max-width: 400px;
  margin: 0 auto;
}

.status-log {
  max-height: 300px;
  overflow-y: auto;
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1rem;
  font-family: monospace;
  font-size: 0.875rem;
  margin-bottom: 1rem;
  backdrop-filter: blur(10px);
}

.status-line {
  margin-bottom: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(233, 236, 239, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
}

.status-line:hover {
  background: rgba(255, 255, 255, 0.5);
  border-radius: 0.25rem;
  padding-left: 0.5rem;
}

.status-line:last-child {
  margin-bottom: 0;
  border-bottom: none;
}

.status-success { color: #28a745; }
.status-error { color: #dc3545; }
.status-warning { color: #fd7e14; }
.status-info { color: var(--brand); }

.footer {
  color: #9ca3af;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
}

a {
  color: var(--brand);
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

a:hover {
  color: var(--brand-600);
  text-decoration: underline;
}

/* Loading spinner styles */
.loading {
  display: none;
  text-align: center;
  padding: 20px;
}

.loading p {
  margin-top: 10px;
}

/* Result container styles */
.result-container {
  display: none;
}

/* Toast notifications */
#toast-container {
  position: fixed;
  top: 25px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column-reverse;
  gap: 10px;
}

.toast {
  background: white;
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  min-width: 300px;
  max-width: 400px;
  transform: translateX(100%);
  opacity: 0;
  transition: transform 0.3s ease, opacity 0.3s ease;
  position: relative;
  overflow: hidden;
  border-left: 4px solid var(--brand);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast-success {
  border-left-color: #10ac84;
}

.toast-error {
  border-left-color: #e74c3c;
}

.toast-warning {
  border-left-color: #f39c12;
}

.toast-info {
  border-left-color: #3498db;
}

.toast-content {
  display: flex;
  align-items: center;
  width: 100%;
}

.toast-icon {
  margin-right: 12px;
  font-size: 20px;
}

.toast-success .toast-icon {
  color: #10ac84;
}

.toast-error .toast-icon {
  color: #e74c3c;
}

.toast-warning .toast-icon {
  color: #f39c12;
}

.toast-info .toast-icon {
  color: #3498db;
}

.toast-message {
  flex: 1;
  font-weight: 500;
  font-size: 14px;
  color: #2d3748;
}

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  width: 100%;
  background: rgba(0, 0, 0, 0.1);
  transform: scaleX(1);
  transform-origin: left;
  animation: toastProgress 3s linear forwards;
}

.toast-success .toast-progress {
  background: linear-gradient(to right, #10ac84, #0d916b);
}

.toast-error .toast-progress {
  background: linear-gradient(to right, #e74c3c, #c0392b);
}

.toast-warning .toast-progress {
  background: linear-gradient(to right, #f39c12, #e67e22);
}

.toast-info .toast-progress {
  background: linear-gradient(to right, #3498db, #2980b9);
}

@keyframes toastProgress {
  from { transform: scaleX(1); }
  to { transform: scaleX(0); }
}

/* GPA Result Display - UPDATED WIDTH */
.gpa-result-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.gpa-result-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.semester-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
  position: relative;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.semester-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-hover);
}

.delete-semester {
  position: absolute;
  top: 1rem;
  right: 1rem;
  cursor: pointer;
  color: #dc3545;
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.delete-semester:hover {
  transform: scale(1.2);
}

.add-course-btn {
  position: absolute;
  top: 1rem;
  right: 3rem;
  cursor: pointer;
  color: var(--brand);
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.add-course-btn:hover {
  transform: scale(1.2);
}

.course-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.course-table th, .course-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid rgba(229, 231, 235, 0.5);
}

.course-table th {
  font-weight: 600;
  color: var(--muted);
  background: rgba(122, 106, 216, 0.05);
}

.grade-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-weight: 600;
  font-size: 0.75rem;
}

.grade-A { background-color: rgba(220, 252, 231, 0.7); color: #166534; }
.grade-B { background-color: rgba(219, 234, 254, 0.7); color: #1e40af; }
.grade-C { background-color: rgba(254, 243, 199, 0.7); color: #92400e; }
.grade-D { background-color: rgba(254, 226, 226, 0.7); color: #991b1b; }
.grade-F { background-color: rgba(243, 244, 246, 0.7); color: #374151; }

.extra-enrolled {
  background-color: rgba(255, 193, 7, 0.2);
  color: #856404;
  padding: 0.15rem 0.35rem;
  border-radius: 0.25rem;
  font-size: 0.7rem;
  margin-left: 0.5rem;
}

.course-details-modal .modal-content {
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.course-details-modal .modal-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}

.calculate-cgpa-btn {
  margin-top: 1rem;
  display: none;
}

/* Saved Results Section */
.saved-results-container {
  display: none;
  margin-top: 2rem;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
}

.saved-result-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 1.5rem;
  box-shadow: 0 5px 15px rgba(17, 24, 39, 0.1);
  margin-bottom: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.saved-result-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(17, 24, 39, 0.15);
  background: rgba(255, 255, 255, 0.95);
}

.saved-result-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.saved-result-date {
  font-size: 0.8rem;
  color: var(--muted);
}

.saved-result-actions {
  display: flex;
  gap: 0.5rem;
}

.saved-result-action-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--muted);
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.saved-result-action-btn:hover {
  color: var(--brand);
  transform: scale(1.1);
}

/* Add Course Form */
.add-course-form {
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin-top: 1rem;
  display: none;
  backdrop-filter: blur(10px);
}

.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

.form-group {
  flex: 1;
  min-width: 200px;
}

/* Save to Web Button */
.save-to-web-btn {
  margin-top: 1rem;
  display: none;
  text-align: center;
}

/* ----------- DARK MODE IMPROVED ----------- */
[data-theme="dark"] body {
  background: linear-gradient(180deg, #0b0e13 0%, #0f1320 70%);
  color: #f1f5f9;
}

[data-theme="dark"] .navbar {
  background-color: rgba(17, 24, 39, 0.8);
}

[data-theme="dark"] .navbar .nav-link {
  color: #d1d5db;
}

[data-theme="dark"] .navbar .nav-link:hover {
  color: #fff;
}

[data-theme="dark"] .card-modern {
  background: rgba(15, 20, 34, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] .card-modern .card-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
}

[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4, [data-theme="dark"] h5 {
  color: #ffffff;
}

[data-theme="dark"] .lead {
  color: #9ca3af;
}

[data-theme="dark"] .subject-row {
  background: rgba(26, 31, 46, 0.8);
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] label {
  color: #e5e7eb;
}

[data-theme="dark"] .form-control, [data-theme="dark"] .form-select {
  background: rgba(11, 16, 32, 0.8);
  color: #f1f5f9;
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] .form-control::placeholder {
  color: #9ca3af;
}

[data-theme="dark"] .input-group-text {
  background: rgba(31, 41, 55, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] .footer {
  color: #9ca3af;
  background: rgba(17, 24, 39, 0.8);
}

[data-theme="dark"] a {
  color: rgb(158, 141, 240);
}

[data-theme="dark"] a:hover {
  color: #9f8df0;
}

[data-theme="dark"] .status-log {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .status-line {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .gpa-result-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .semester-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .course-table th, 
[data-theme="dark"] .course-table td {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .course-table th {
  background: rgba(122, 106, 216, 0.1);
}

[data-theme="dark"] .saved-result-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .add-course-form {
  background: rgba(26, 31, 46, 0.8);
}

[data-theme="dark"] .loading-container {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.15), rgba(122, 106, 216, 0.08));
}

[data-theme="dark"] .grade-A { background-color: rgba(21, 128, 61, 0.3); color: #86efac; }
[data-theme="dark"] .grade-B { background-color: rgba(30, 64, 175, 0.3); color: #93c5fd; }
[data-theme="dark"] .grade-C { background-color: rgba(146, 64, 14, 0.3); color: #fed7aa; }
[data-theme="dark"] .grade-D { background-color: rgba(153, 27, 27, 0.3); color: #fecaca; }
[data-theme="dark"] .grade-F { background-color: rgba(55, 65, 81, 0.3); color: #d1d5db; }

/* Dark mode for course details modal */
[data-theme="dark"] .course-details-modal .modal-content {
  background: rgba(26, 32, 48, 0.95);
  color: #e5e7eb;
}

[data-theme="dark"] .course-details-modal .modal-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .course-details-modal .modal-header .btn-close {
  filter: invert(1);
}

[data-theme="dark"] .course-details-modal .alert-info {
  background-color: rgba(23, 162, 184, 0.2);
  border-color: rgba(23, 162, 184, 0.3);
  color: #71d4f0;
}

[data-theme="dark"] .course-details-modal .alert-warning {
  background-color: rgba(255, 193, 7, 0.2);
  border-color: rgba(255, 193, 7, 0.3);
  color: #ffd351;
}

/* Dark mode contrast improvements */
[data-theme="dark"] .text-body-secondary {
  color: #d1d5db !important;
}

[data-theme="dark"] .btn-primary-action {
  color: #ffffff !important;
}

.cursor-dot {
  position: fixed;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--brand);
  pointer-events: none;
  transform: translate(-50%, -50%);
  opacity: .7;
  mix-blend-mode: multiply;
  z-index: 9999;
  transition: all 0.1s ease;
}

[data-theme="dark"] .cursor-dot {
  mix-blend-mode: screen;
}

/* Course action buttons */
.course-actions i {
  cursor: pointer;
  font-size: 14px;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.delete-course {
  color: #dc3545;
}

.delete-course:hover {
  background-color: rgba(220, 53, 69, 0.1);
  transform: scale(1.2);
}

.restore-course {
  color: #10ac84;
}

.restore-course:hover {
  background-color: rgba(16, 172, 132, 0.1);
  transform: scale(1.2);
}

/* Clickable info icon */
.clickable-info {
  cursor: pointer;
  color: var(--brand);
  transition: all 0.3s ease;
}

.clickable-info:hover {
  opacity: 0.8;
  transform: scale(1.1);
}

/* Mobile responsive adjustments */
@media (max-width: 575.98px) {
  .hero {
    padding: 5rem 0 2rem;
  }
  
  .hero h1 {
    font-size: 2.5rem;
  }
  
  .d-flex.gap-2 {
    flex-direction: column;
    align-items: center;
  }
  
  .d-flex.gap-2 .btn {
    width: 100%;
    max-width: 300px;
    margin-bottom: 0.5rem;
  }
  
  /* Mobile notification text size */
  .toast {
    min-width: 250px;
    max-width: 300px;
    padding: 12px 16px;
  }
  
  .toast-message {
    font-size: 12px;
  }
  
  .card-modern .card-header {
    padding: 1rem;
  }
  
  .gpa-result-card, .semester-card {
    padding: 1.5rem;
  }
}

/* Ensure subject columns are 2-up on very small screens: change from col-12 col-md-6 -> col-6 col-md-6 */
@media (max-width: 420px) {
  .subject-row .col-6 {
    padding-right: .4rem;
    padding-left: .4rem;
  }
}

@media (min-width: 992px) {
  .navbar-expand-lg .navbar-nav .nav-link {
    padding-right: var(--bs-navbar-nav-link-padding-x);
    margin-right: 20px;
  }
}

@media (min-width: 768px) {
  .col-md-10 {
    flex: 0 0 auto;
    width: 100%;
  }
}

@media (min-width: 768px) {
  .col-md-4 {
    flex: 0 0 auto;
    width: 48.3%;
  }
}

/* Mobile responsive table */
@media (max-width: 768px) {
  .course-table {
    white-space: nowrap;
    font-size: 12px;
  }
  
  /* Make repeated course indicator appear below course code on mobile */
  .course-code-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  
  .extra-enrolled {
    margin-left: 0;
    margin-top: 0.25rem;
  }
  
  /* Adjust spacing for mobile */
  .semester-card {
    padding: 1.5rem;
  }
  
  .gpa-result-card {
    padding: 1.5rem;
  }
  
  /* Make buttons more touch-friendly */
  .btn {
    padding: 0.75rem 1rem;
  }
  
  /* Adjust loading animations for mobile */
  .loading-animation {
    width: 60px;
    height: 60px;
  }
  
  .loading-text {
    font-size: 1rem;
  }
  
  .loading-subtext {
    font-size: 0.8rem;
  }
}

/* Center buttons only in specific sections */
.scraping-section .center-buttons,
.log-section .center-buttons {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

@media (max-width: 576px) {
  .scraping-section .center-buttons,
  .log-section .center-buttons {
    flex-direction: column;
    align-items: center;
  }
  
  .scraping-section .center-buttons .btn,
  .log-section .center-buttons .btn {
    width: 100%;
    max-width: 300px;
  }
}

/* New layout improvements */
.results-section {
  margin-top: 2rem;
}

.student-info-section {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.student-details {
  flex: 1;
  min-width: 300px;
}

.cgpa-display {
  flex: 0 0 auto;
  text-align: right;
  min-width: 200px;
}

.action-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  justify-content: center;
}

@media (max-width: 768px) {
  .student-info-section {
    flex-direction: column;
  }
  
  .cgpa-display {
    text-align: left;
    margin-top: 1rem;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .action-buttons .btn {
    width: 100%;
  }
}

/* Section separators */
.section-container {
  margin-bottom: 2rem;
}

.section-title {
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(122, 106, 216, 0.3);
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 60px;
  height: 2px;
  background: var(--brand-gradient);
}

/* Student info logo style */
.student-info-logo {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  transition: all 0.3s ease;
}

.student-info-logo:hover {
  transform: rotate(15deg);
}

.student-info-logo i {
  font-size: 1.5rem;
  color: var(--brand);
}

/* Test connection button style */
.test-connection-btn {
  background: rgba(248, 249, 250, 0.8);
  color: var(--muted);
  border: 1px solid rgba(233, 236, 239, 0.5);
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.test-connection-btn:hover {
  background: rgba(233, 236, 239, 0.8);
  color: var(--text);
  transform: translateY(-1px);
}

/* Desktop-specific smaller text for semester sections */
@media (min-width: 992px) {
  .semester-card {
    font-size: 0.95rem;
  }
  
  .semester-card h5 {
    font-size: 1.15rem;
  }
  
  .course-table {
    font-size: 0.9rem;
  }
}

/* Semester section layout improvements */
.semester-results-container {
  width: 100%;
}

.semester-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  gap: 1.5rem;
  width: 100%;
}

@media (max-width: 992px) {
  .semester-grid {
    grid-template-columns: 1fr;
  }
}

/* NEW STYLES FOR UPDATES */
.repeated-badge {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ffc107;
  color: #856404;
  font-size: 8px;
  padding: 2px 4px;
  border-radius: 3px;
  font-weight: bold;
}

.custom-course-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 0.9rem;
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.custom-course-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
}

.undo-notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(51, 51, 51, 0.9);
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 1000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
}

.undo-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.undo-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-1px);
}

/* Updated CGPA Display Layout */
.cgpa-display-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}

.cgpa-main-info {
  text-align: center;
  width: 100%;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.3);
}

.cgpa-metrics-row {
  display: flex;
  justify-content: space-between;
  width: 100%;
  gap: 1rem;
}

.cgpa-metric {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.cgpa-metric-left {
  align-items: flex-start;
}

.cgpa-metric-center {
  align-items: center;
}

.cgpa-metric-right {
  align-items: flex-end;
}

.cgpa-metric-label {
  font-size: 1rem;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.cgpa-metric-value {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--brand);
  line-height: 1.2;
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.cgpa-metric-subvalue {
  font-size: 0.9rem;
  color: var(--muted);
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
  .cgpa-metrics-row {
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .cgpa-metric {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(122, 106, 216, 0.1);
  }
  
  .cgpa-metric:last-child {
    border-bottom: none;
  }
  
  .cgpa-metric-left,
  .cgpa-metric-center,
  .cgpa-metric-right {
    align-items: center;
  }
  
  .cgpa-metric-label {
    margin-bottom: 0;
    min-width: 100px;
    text-align: left;
  }
  
  .cgpa-metric-value-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }
  
  .cgpa-metric-value {
    font-size: 1.5rem;
  }
  
  .cgpa-main-info h2 {
    font-size: 1.5rem;
  }
}

/* Contact form improvements */
#contact-form {
  background: rgba(255, 255, 255, 0.5);
  padding: 2rem;
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
}

[data-theme="dark"] #contact-form {
  background: rgba(26, 32, 48, 0.5);
}

/* Animation for form elements */
.form-control, .form-select {
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  transform: translateY(-2px);
}

/* Pulse animation for important elements */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 2s infinite;
}

/* Floating animation */
@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

.float {
  animation: float 3s ease-in-out infinite;
}

/* Improved scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.1);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--brand);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.2);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--brand);
}


  </style>
</head>
<body>
  <!-- Custom cursor -->
  <div class="cursor-dot" id="cursorDot"></div>

  <!-- Course Details Modal -->
  <div class="modal fade course-details-modal" id="courseDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="courseDetailsModalTitle">Course Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="courseDetailsModalBody">
          <!-- Course details will be populated here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Course Modal -->
  <div class="modal fade" id="addCourseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Custom Course</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addCourseForm">
            <input type="hidden" id="addCourseSemester" value="">
            <div class="mb-3">
              <label for="courseCode" class="form-label">Course Code</label>
              <input type="text" class="form-control" id="courseCode" required>
            </div>
            <div class="mb-3">
              <label for="courseTitle" class="form-label">Course Title</label>
              <input type="text" class="form-control" id="courseTitle" required>
            </div>
            <div class="mb-3">
              <label for="creditHours" class="form-label">Credit Hours</label>
              <select class="form-select" id="creditHours" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="courseMarks" class="form-label">Marks Obtained</label>
              <input type="number" class="form-control" id="courseMarks" min="0" max="100" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveCourseBtn">Add Course</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/">
        <span class="badge rounded-pill badge-brand">UAF</span>
        <span>CGPA <span class="text-body-secondary">Calculator</span></span>
      </a>

      <div class="d-flex align-items-center gap-2 order-lg-2">
        <button id="themeToggle" class="btn btn-sm btn-soft rounded-pill" type="button" style="margin-bottom: 0rem;" aria-label="Toggle dark mode">
          <i class="fa-solid fa-moon"></i>
        </button>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="index.html#Home">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html#CGPA-Calculator">Manual Calculator</a></li>
          <li class="nav-item"><a class="nav-link" href="uaf-results.html">UAF Results</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact-us">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero" id="Home">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-7">
          <span class="badge rounded-pill badge-brand mb-3">University of Agriculture Faisalabad</span>
          <h1 class="display-5 mb-3">Calculate Your <span style="color:var(--brand)">CGPA Automatically</span><br/>from UAF LMS</h1>
          <p class="lead mb-4">Enter your <strong>registration number</strong> to fetch your results directly from UAF LMS. The calculator will automatically compute your CGPA and Percentage based on UAF grading system.</p>
          <div class="d-flex gap-2">
            <a href="#Auto-Calculator" 
               class="btn btn-primary-action btn-lg rounded-pill" 
               style="font-size: 1.05rem; padding: 0.9rem;">
              <i class="fa-solid fa-bolt me-2"></i>Try It Now
            </a>
            <a href="index.html#CGPA-Calculator" class="btn btn-secondary-action rounded-pill" style="display:block; padding:14px">
              <i class="fa-solid fa-calculator me-2"></i>Manual Calculator
            </a>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card card-modern">
            <div class="card-body p-4">
              <div class="d-flex align-items-center gap-3">
                <div class="display-6" style="color:var(--brand);"><i class="fa-solid fa-robot"></i></div>
                <div>
                  <h5 class="mb-1 fw-bold">Automatic CGPA Calculation</h5>
                  <p class="mb-0 text-body-secondary">No manual inputs needed. Just enter your registration number.</p>
                </div>
              </div>
              <hr class="my-4" />
              <ul class="list-unstyled m-0">
                <li class="d-flex align-items-center gap-2 mb-2"><i class="fa-solid fa-check text-success"></i> Fetches results directly from UAF LMS</li>
                <li class="d-flex align-items-center gap-2 mb-2"><i class="fa-solid fa-check text-success"></i> Automatic CGPA calculation</li>
                <li class="d-flex align-items-center gap-2"><i class="fa-solid fa-check text-success"></i> Same accurate UAF grading system</li>
              </ul>
            </div>
          </div>
        </div>
      </div><!-- /row -->
    </div>
  </section>

  <!-- Automatic Calculator Section -->
  <section class="py-5" id="Auto-Calculator">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-10">
          
          <!-- Input Section -->
          <div class="card card-modern mb-4">
            <div class="card-header p-4">
              <h4 class="mb-0"><i class="fa-solid fa-bolt me-2"></i>UAF CGPA Calculator</h4>
            </div>
            <div class="card-body p-4 scraping-section">
              <form id="resultForm">
                <div class="mb-3">
                  <label for="registrationNumber" class="form-label">Registration Number</label>
                  <input type="text" class="form-control" id="registrationNumber" 
                         placeholder="e.g., 2020-ag-1234" required>
                  <div class="form-text">Enter your UAF registration number</div>
                </div>
                
                <div class="center-buttons">
                  <button type="submit" class="btn btn-primary-action rounded-pill">
                    <i class="fa-solid fa-cloud-arrow-down me-2"></i>Fetch Result
                  </button>
                  <button id="testConnectionBtn" type="button" class="btn test-connection-btn rounded-pill">
                    <i class="fa-solid fa-vial me-2"></i>Test Connection
                  </button>
                </div>
              </form>
              
              <!-- Improved Loading Animation Section -->
              <div class="loading-container" id="loadingContainer">
                <div class="loading-stage" id="connectingStage">
                  <div class="loading-animation loading-connecting">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                  </div>
                  <p class="loading-text">Connecting to UAF LMS</p>
                  <p class="loading-subtext">Establishing secure connection to university servers</p>
                </div>
                
                <div class="loading-stage" id="fetchingStage">
                  <div class="loading-animation loading-fetching">
                    <div class="book"></div>
                  </div>
                  <p class="loading-text">Fetching Your Results</p>
                  <p class="loading-subtext">Retrieving your academic records from the database</p>
                </div>
                
                <div class="loading-stage" id="processingStage">
                  <div class="loading-animation loading-processing">
                    <div class="calculator"></div>
                  </div>
                  <p class="loading-text">Processing Data</p>
                  <p class="loading-subtext">Analyzing your grades and calculating CGPA</p>
                </div>
                
                <div class="loading-stage" id="completeStage">
                  <div class="loading-animation loading-complete">
                    <div class="checkmark"></div>
                  </div>
                  <p class="loading-text">Results Ready!</p>
                  <p class="loading-subtext">Your CGPA has been calculated successfully</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Results Section -->
          <div id="resultContainer" class="result-container">
            <!-- Replace the CGPA display section with this code -->
<div class="gpa-result-card">
  <div class="card-body p-4">
    <div class="cgpa-display-container">
      <!-- Name and Registration (centered on top) -->
      <div class="cgpa-main-info">
        <h2 class="mb-1 fw-bold" id="studentName"><i class="fa-solid fa-user-graduate me-2"></i>Student Name</h2>
        <p class="mb-0 text-body-secondary" id="studentReg">Registration Number</p>
      </div>
      
      <!-- Metrics Row -->
      <div class="cgpa-metrics-row">
        <!-- CGPA (left) -->
        <div class="cgpa-metric cgpa-metric-left">
          <p class="mb-0 cgpa-metric-label">CGPA</p>
          <p class="mb-0 cgpa-metric-value" id="totalCgpa">0.0000</p>
        </div>
        
        <!-- Percentage (center) -->
        <div class="cgpa-metric cgpa-metric-center">
          <p class="mb-0 cgpa-metric-label">Percentage</p>
          <p class="mb-0 cgpa-metric-value" id="totalPercentage">0.0000%</p>
        </div>
        
        <!-- Marks (right) -->
        <div class="cgpa-metric cgpa-metric-right">
          <p class="mb-0 cgpa-metric-label">Marks</p>
          <div class="cgpa-metric-value-container">
            <p class="mb-0 cgpa-metric-value" id="totalMarksObtained">0</p>
            <p class="mb-0 cgpa-metric-subvalue" id="totalMaxMarks">/ 0</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="action-buttons">
      <button id="saveToWebBtn" class="btn btn-primary-action rounded-pill save-to-web-btn">
        <i class="fa-solid fa-cloud-arrow-up me-2"></i>Save to Web
      </button>
    </div>
  </div>
</div>
            
            <!-- Semester Results Container - Removed outer card -->
            <div class="semester-results-container">
              <div id="semesterResults" class="semester-grid">
                <!-- Semester cards will be dynamically inserted here -->
              </div>
            </div>
          </div>
          
          <!-- Saved Results Section -->
          <div id="savedResultsContainer" class="saved-results-container card card-modern mb-4">
            <div class="card-header p-4">
              <h4 class="mb-0"><i class="fa-solid fa-floppy-disk me-2"></i>Saved Results</h4>
            </div>
            <div class="card-body p-4">
              <div id="savedResultsList">
                <!-- Saved results will be populated here -->
              </div>
            </div>
          </div>
          
  <!-- Status Log Section -->
  <div class="card card-modern">
    <div class="card-header p-4">
      <h4 class="mb-0"><i class="fa-solid fa-terminal me-2"></i>Status Log</h4>
    </div>
    <div class="card-body p-4">
      <!-- Status Log -->
      <div class="status-log" id="statusLog">
        <div class="status-line status-info">Ready to fetch your results. Enter your registration number and click "Fetch Result".</div>
      </div>
      
      <!-- Log Action Buttons -->
      <div class="log-section center-buttons mt-3">
        <button id="downloadLogBtn" class="btn btn-secondary-action rounded-pill">
          <i class="fa-solid fa-file-lines me-2"></i>Download Log
        </button>
        <button id="clearLogBtn" class="btn btn-danger-action rounded-pill">
          <i class="fa-solid fa-trash me-2"></i>Clear Log
        </button>
      </div>
    </div>
  </div>
  
</div>
</div>
</div>
</section>

  <!-- Contact Section -->
  <section class="py-5" id="contact-us">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-6">
          <h3 class="fw-bold mb-2">Contact</h3>
          <p class="text-body-secondary">Questions or suggestions? Send a message.</p>
          <form id="contact-form" action="https://formspree.io/f/xblrolwp" method="post" class="needs-validation" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="name">Your Name</label>
                <input class="form-control" id="name" name="name" placeholder="e.g., Ali Raza" required />
                <div class="invalid-feedback">Please enter your name.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required />
                <div class="invalid-feedback">Enter a valid email.</div>
              </div>
              <div class="col-12">
                <label class="form-label" for="message">Message</label>
                <textarea class="form-control" id="message" name="message" rows="4" placeholder="Write your message..." required></textarea>
                <div class="invalid-feedback">Please write a message.</div>
              </div>
              <div class="col-12">
                <button class="btn btn-primary-action rounded-pill" type="submit"><i class="fa-solid fa-paper-plane me-2"></i>Send</button>
              </div>
              <div id="contact-form-status" class="mt-2 small"></div>
            </div>
          </form>
        </div>
        <div class="col-lg-6">
          <div class="h-100 p-4 p-lg-5 rounded-4" style="background:linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));">
            <h5 class="fw-bold">Developer</h5>
            <div class="d-flex align-items-center gap-3 mt-2">
              <img src="assets/images/member-01.png" alt="Muhammad Saqlain" class="rounded-circle" width="56" height="56" />
              <div>
                <div class="fw-semibold">Muhammad Saqlain</div>
                <div class="text-body-secondary small">BS Chemistry (2020â€“2024)</div>
                <div class="d-flex gap-3 mt-2">
                  <a class="text-decoration-none" href="https://www.facebook.com/UAFChemist.Rustam" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                  <a class="text-decoration-none" href="https://x.com/M_Saqlain_Akbar" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                  <a class="text-decoration-none" href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                </div>
              </div>
            </div>
            <hr class="my-4" />
            <p class="mb-0 small text-body-secondary">Share this tool with your friends to support the project. â™¥</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-top py-4">
    <div class="container text-center footer">
      <div>Â© 2025 Saqlain. All rights reserved.</div>
    </div>
  </footer>

  <!-- Vendor JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Add this new script reference -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  
  <!-- App JS -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const resultForm = document.getElementById('resultForm');
      const registrationNumber = document.getElementById('registrationNumber');
      const resultContainer = document.getElementById('resultContainer');
      const testConnectionBtn = document.getElementById('testConnectionBtn');
      const statusLog = document.getElementById('statusLog');
      const themeToggle = document.getElementById('themeToggle');
      const cursorDot = document.getElementById('cursorDot');
      const contactForm = document.getElementById('contact-form');
      const contactFormStatus = document.getElementById('contact-formStatus');
      const downloadLogBtn = document.getElementById('downloadLogBtn');
      const clearLogBtn = document.getElementById('clearLogBtn');
      const semesterResults = document.getElementById('semesterResults');
      const studentName = document.getElementById('studentName');
      const studentReg = document.getElementById('studentReg');
      const totalCgpa = document.getElementById('totalCgpa');
      const totalPercentage = document.getElementById('totalPercentage');
      const totalMarksObtained = document.getElementById('totalMarksObtained');
      const totalMaxMarks = document.getElementById('totalMaxMarks');
      const saveToWebBtn = document.getElementById('saveToWebBtn');
      const savedResultsContainer = document.getElementById('savedResultsContainer');
      const savedResultsList = document.getElementById('savedResultsList');
      const courseDetailsModal = new bootstrap.Modal(document.getElementById('courseDetailsModal'));
      const addCourseModal = new bootstrap.Modal(document.getElementById('addCourseModal'));
      const saveCourseBtn = document.getElementById('saveCourseBtn');
      const addCourseForm = document.getElementById('addCourseForm');
      const loadingContainer = document.getElementById('loadingContainer');
      const connectingStage = document.getElementById('connectingStage');
      const fetchingStage = document.getElementById('fetchingStage');
      const processingStage = document.getElementById('processingStage');
      const completeStage = document.getElementById('completeStage');
      
      // State variables
      let allLogs = [];
      let testInProgress = false;
      let scrapedData = null;
      let processedData = null;
      let currentSessionId = null;
      let deletedSemesters = {}; // Track deleted semesters for undo functionality
      
      // API endpoints - FIXED to match your Python backend
      const API_ENDPOINTS = {
        scrape: `/api/result-scraper`,
        test: `/api/result-scraper`,
        save: `/api/result-scraper?action=save`,
        load: `/api/result-scraper?action=load_result`
      };
      
      // Initialize the application
      function init() {
        initCustomCursor();
        initTheme();
        initContactForm();
        createToastContainer();
        currentSessionId = generateSessionId();
        checkSavedResults();
      }
      
      // Generate a unique session ID
      function generateSessionId() {
        return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }
      
      // Create a custom toast container
      function createToastContainer() {
        const toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        document.body.appendChild(toastContainer);
      }
      
      // Show toast notification
      function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
          <div class="toast-content">
            <i class="toast-icon ${getToastIcon(type)}"></i>
            <span class="toast-message">${message}</span>
          </div>
          <div class="toast-progress"></div>
        `;
        
        toastContainer.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
          toast.classList.add('show');
        }, 10);
        
        // Remove after delay
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }, 3000);
      }
      
      // Get icon for toast type
      function getToastIcon(type) {
        switch(type) {
          case 'success': return 'fa-solid fa-circle-check';
          case 'error': return 'fa-solid fa-circle-exclamation';
          case 'warning': return 'fa-solid fa-triangle-exclamation';
          case 'info': return 'fa-solid fa-circle-info';
          default: return 'fa-solid fa-circle-info';
        }
      }
      
      // Initialize custom cursor
      function initCustomCursor() {
        document.addEventListener('mousemove', (e) => {
          cursorDot.style.display = window.innerWidth > 768 ? 'block' : 'none';
          cursorDot.style.left = e.clientX + 'px';
          cursorDot.style.top = e.clientY + 'px';
        });
      }
      
      // Theme toggle functionality
      function initTheme() {
        const THEME_KEY = 'uaf-theme';
        function applyTheme(theme){
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem(THEME_KEY, theme);
          themeToggle.innerHTML = theme === 'dark' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
        }
        applyTheme(localStorage.getItem(THEME_KEY) || 'light');
        themeToggle.addEventListener('click', () => {
          const next = (localStorage.getItem(THEME_KEY) || 'light') === 'light' ? 'dark' : 'light';
          applyTheme(next);
        });
      }
      
      // Contact form
      function initContactForm() {
        contactForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          if(!contactForm.checkValidity()){
            e.stopPropagation();
            contactForm.classList.add('was-validated');
            return;
          }
          const data = new FormData(contactForm);
          try{
            const res = await fetch(contactForm.action, { method: 'POST', body: data, headers: {'Accept':'application/json'}});
            if(res.ok){
              contactFormStatus.textContent = "Thanks! We'll get back to you soon.";
              contactFormStatus.className = "text-success";
              contactForm.reset(); contactForm.classList.remove('was-validated');
              showToast('Message sent successfully!', 'success');
            }else{
              contactFormStatus.textContent = "Oops! There was a problem submitting your form.";
              contactFormStatus.className = "text-danger";
              showToast('Failed to send message. Please try again.', 'error');
            }
          }catch{
            contactFormStatus.textContent = "Network error. Try again.";
            contactFormStatus.className = "text-danger";
            showToast('Network error. Please try again.', 'error');
          }
        });
      }
      
      // Add a status message to the log
      function addStatusMessage(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const fullMessage = `[${timestamp}] ${message}`;
        
        // Add to all logs array
        allLogs.push({timestamp, message, type});
        
        const messageEl = document.createElement('div');
        messageEl.className = `status-line status-${type}`;
        messageEl.textContent = fullMessage;
        statusLog.prepend(messageEl);
        
        // Auto-scroll to top
        statusLog.scrollTop = 0;
      }
      
      // Show loading animation stage
      function showLoadingStage(stage) {
        // Hide all stages first
        connectingStage.style.display = 'none';
        fetchingStage.style.display = 'none';
        processingStage.style.display = 'none';
        completeStage.style.display = 'none';
        
        // Show the requested stage
        switch(stage) {
          case 'connecting':
            connectingStage.style.display = 'block';
            break;
          case 'fetching':
            fetchingStage.style.display = 'block';
            break;
          case 'processing':
            processingStage.style.display = 'block';
            break;
          case 'complete':
            completeStage.style.display = 'block';
            break;
        }
        
        // Show the container if hidden
        loadingContainer.style.display = 'block';
      }
      
      // Hide loading animation
      function hideLoading() {
        loadingContainer.style.display = 'none';
      }
      
      // Download log
      function downloadLog() {
        addStatusMessage('Preparing log file for download...', 'info');
        
        // Create log content
        let logContent = "UAF CGPA Calculator - Activity Log\n";
        logContent += "============================================\n\n";
        
        allLogs.forEach(log => {
          logContent += `[${log.timestamp}] ${log.message}\n`;
        });
        
        // Create download link
        const blob = new Blob([logContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `cgpa_calculator_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
        document.body.appendChild(a);
        a.click();
        
        // Clean up
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        addStatusMessage('Log file downloaded successfully', 'success');
        showToast('Log file downloaded!', 'success');
      }
      
      // Clear log
      function clearLog() {
        statusLog.innerHTML = '';
        allLogs = [];
        addStatusMessage('Log cleared', 'info');
        showToast('Log cleared', 'info');
      }
      
      // Test connection
      async function testConnection() {
        // Prevent multiple simultaneous test requests
        if (testInProgress) {
          addStatusMessage('Test connection already in progress', 'info');
          return;
        }
        
        testInProgress = true;
        testConnectionBtn.disabled = true;
        
        addStatusMessage('Testing connection to UAF LMS server...', 'info');
        showLoadingStage('connecting');
        
        try {
          const response = await fetch(`${API_ENDPOINTS.test}?action=test`, {
            method: 'GET'
          });
          
          // Handle both JSON and HTML responses
          let responseData;
          const contentType = response.headers.get('content-type');
          
          if (contentType && contentType.includes('application/json')) {
            responseData = await response.json();
          } else {
            // If it's HTML, check if the response status is 200
            if (response.status === 200) {
              responseData = {success: true, message: 'Connection to UAF LMS successful'};
            } else {
              responseData = {success: false, message: `UAF LMS returned status code: ${response.status}`};
            }
          }
          
          if (responseData.success) {
            addStatusMessage('Connection test successful - UAF LMS is accessible', 'success');
            showToast('Connection test successful!', 'success');
            showLoadingStage('complete');
            
            // Hide loading after delay
            setTimeout(() => {
              hideLoading();
            }, 2000);
          } else {
            addStatusMessage(`Connection test failed: ${responseData.message}`, 'error');
            showToast('Connection test failed!', 'error');
            hideLoading();
          }
        } catch (error) {
          addStatusMessage(`Connection test failed: ${error.message}`, 'error');
          showToast('Connection test failed!', 'error');
          hideLoading();
        } finally {
          testInProgress = false;
          testConnectionBtn.disabled = false;
        }
      }
      
      // Process semester name for display (convert Winter 2024-2025 to Winter 2024, Spring 2024-2025 to Spring 2025)
      function processSemesterName(semester) {
        if (!semester) return 'Unknown Semester';
        
        // Handle different semester formats
        if (semester.includes('Winter')) {
          const yearMatch = semester.match(/(\d{4})-(\d{2,4})/);
          if (yearMatch) {
            return `Winter ${yearMatch[1]}`;
          }
        } else if (semester.includes('Spring')) {
          const yearMatch = semester.match(/(\d{4})-(\d{2,4})/);
          if (yearMatch && yearMatch[2].length === 4) {
            return `Spring ${yearMatch[2]}`;
          } else if (yearMatch && yearMatch[2].length === 2) {
            return `Spring 20${yearMatch[2]}`;
          }
        } else if (semester.includes('Summer')) {
          // Handle "Summer Semester 2025" -> "Summer 2025"
          const yearMatch = semester.match(/(\d{4})-(\d{2,4})/);
          if (yearMatch) {
            return `Summer ${yearMatch[1]}`;
          }
          // Also handle "Summer Semester 2025" format
          const summerMatch = semester.match(/Summer Semester (\d{4})/);
          if (summerMatch) {
            return `Summer ${summerMatch[1]}`;
          }
        } else if (semester.includes('Fall')) {
          const yearMatch = semester.match(/(\d{4})-(\d{2,4})/);
          if (yearMatch) {
            return `Fall ${yearMatch[1]}`;
          }
        }
        
        // Return original if no pattern matched
        return semester;
      }
      
      // Extract semester order key for internal chronological sorting
      function getSemesterOrderKey(semesterName) {
        if (!semesterName) return '9999-9';
        
        // Extract year and season for chronological ordering
        let year = '';
        let seasonOrder = 9; // Default to last position
        
        // Try to extract year from different patterns
        const yearMatch = semesterName.match(/\b(20\d{2})\b/);
        if (yearMatch) {
          year = yearMatch[1];
        } else {
          // Try 2-digit year format
          const shortYearMatch = semesterName.match(/\b(\d{2})\b/);
          if (shortYearMatch) {
            year = '20' + shortYearMatch[1];
          }
        }
        
        // Determine season order (Winter=1, Spring=2, Summer=3, Fall=4)
        if (semesterName.toLowerCase().includes('winter')) {
          seasonOrder = 1;
        } else if (semesterName.toLowerCase().includes('spring')) {
          seasonOrder = 2;
        } else if (semesterName.toLowerCase().includes('summer')) {
          seasonOrder = 3;
        } else if (semesterName.toLowerCase().includes('fall')) {
          seasonOrder = 4;
        }
        
        // If we couldn't extract year, use a high number to push to end
        if (!year) year = '9999';
        
        return `${year}-${seasonOrder}`;
      }
      
      // Process scraped data to handle re-enrolled courses
      function processScrapedData(data) {
        if (!data || !data.resultData) return null;
        
        const resultData = data.resultData;
        const studentInfo = {
          name: resultData[0]?.StudentName || '',
          registration: resultData[0]?.RegistrationNo || ''
        };
        
        // Group by semester (processed name)
        const semesters = {};
        const courseHistory = {}; // Track course history for re-enrollment detection
        
        // First pass: organize by semester and track course history
        resultData.forEach(course => {
          const originalSemester = course.Semester || 'Unknown Semester';
          const semesterName = processSemesterName(originalSemester);
          const courseCode = course.CourseCode || '';
          const creditHoursStr = course.CreditHours || '0';
          
          if (!semesters[semesterName]) {
            semesters[semesterName] = {
              originalName: originalSemester,
              sortKey: getSemesterOrderKey(originalSemester),
              courses: [],
              totalQualityPoints: 0,
              totalCreditHours: 0
            };
          }
          
          // Parse credit hours - preserve the original format like "3(2-1)"
          let creditHours = 0;
          const numbers = creditHoursStr.match(/\d+/g);
          if (numbers && numbers.length > 0) {
            creditHours = parseInt(numbers[0]);
          }
          
          // Parse marks
          let marks = 0;
          try {
            marks = parseFloat(course.Total || '0');
          } catch (e) {
            marks = 0;
          }
          
          // Get grade from scraped data
          const grade = course.Grade || '';
          
          // Calculate quality points based on UAF system
          const qualityPoints = calculateQualityPoints(marks, creditHours);
          
          const courseData = {
            code: courseCode,
            title: course.CourseTitle || '',
            creditHours: creditHours,
            creditHoursDisplay: creditHoursStr, // Preserve original format
            marks: marks,
            qualityPoints: qualityPoints,
            grade: grade,
            originalSemester: originalSemester,
            semesterName: semesterName,
            semesterSortKey: getSemesterOrderKey(originalSemester),
            teacher: course.TeacherName || '',
            mid: course.Mid || '0',
            assignment: course.Assignment || '0',
            final: course.Final || '0',
            practical: course.Practical || '0',
            total: course.Total || '0',
            isExtraEnrolled: false,
            isRepeated: false,
            isDeleted: false,
            originalSemesterForRepeated: null,
            isCustom: false
          };
          
          // Track course history
          if (!courseHistory[courseCode]) {
            courseHistory[courseCode] = [];
          }
          courseHistory[courseCode].push({
            semester: semesterName,
            semesterSortKey: getSemesterOrderKey(originalSemester),
            marks: marks,
            qualityPoints: qualityPoints,
            data: courseData
          });
          
          semesters[semesterName].courses.push(courseData);
        });
        
        // Second pass: identify re-enrolled courses and mark them
        Object.keys(courseHistory).forEach(courseCode => {
          const history = courseHistory[courseCode];
          if (history.length > 1) {
            // Sort by semester order (chronological)
            history.sort((a, b) => a.semesterSortKey.localeCompare(b.semesterSortKey));
            
            // Find the highest marks/quality points
            let highest = history[0];
            for (let i = 1; i < history.length; i++) {
              if (history[i].marks > highest.marks) {
                highest = history[i];
              }
            }
            
            // Mark all other instances as extra enrolled and repeated
            // Also set the original semester for repeated courses
            history.forEach(item => {
              if (item !== highest) {
                item.data.isExtraEnrolled = true;
                item.data.isRepeated = true;
                item.data.originalSemesterForRepeated = highest.semester;
              }
            });
          }
        });
        
        return {
          studentInfo: studentInfo,
          semesters: semesters,
          courseHistory: courseHistory
        };
      }
      
      // Calculate quality points based on UAF grading system
      function calculateQualityPoints(marks, creditHours) {
        marks = parseFloat(marks);
        creditHours = parseInt(creditHours);

        let qualityPoints = 0;

        if (creditHours === 5) {
          if (marks >= 80) {
            qualityPoints = 20;
          } else if (marks >= 50) {
            qualityPoints = 20 - ((80 - marks) * 0.33333);
          } else if (marks < 50) {
            qualityPoints = 10 - ((50 - marks) * 0.5);
          }
          if (marks < 40) {
            qualityPoints = 0;
          }
        } else if (creditHours === 4) {
          if (marks >= 64) {
            qualityPoints = 16;
          } else if (marks >= 40) {
            qualityPoints = 16 - ((64 - marks) * 0.33333);
          } else if (marks < 40) {
            qualityPoints = 8 - ((40 - marks) * 0.5);
          }
          if (marks < 32) {
            qualityPoints = 0;
          }
        } else if (creditHours === 3) {
          if (marks >= 48) {
            qualityPoints = 12;
          } else if (marks >= 30) {
            qualityPoints = 12 - ((48 - marks) * 0.33333);
          } else if (marks < 30) {
            qualityPoints = 6 - ((30 - marks) * 0.5);
          }
          if (marks < 24) {
            qualityPoints = 0;
          }
        } else if (creditHours === 2) {
          if (marks >= 32) {
            qualityPoints = 8;
          } else if (marks >= 20) {
            qualityPoints = 8 - ((32 - marks) * 0.33333);
          } else if (marks < 20) {
            qualityPoints = 4 - ((20 - marks) * 0.5);
          }
          if (marks < 16) {
            qualityPoints = 0;
          }
        } else if (creditHours === 1) {
          if (marks >= 16) {
            qualityPoints = 4;
          } else if (marks >= 10) {
            qualityPoints = 4 - ((16 - marks) * 0.33333);
          } else if (marks < 10) {
            qualityPoints = 2 - ((10 - marks) * 0.5);
          }
          if (marks < 8) {
            qualityPoints = 0;
          }
        }

        return parseFloat(qualityPoints.toFixed(2));
      }
      
      // Calculate grade for custom courses based on marks and credit hours
      function calculateCustomGrade(marks, creditHours) {
        marks = parseFloat(marks);
        creditHours = parseInt(creditHours);
        
        if (creditHours === 5) {
          if (marks >= 80) return 'A';
          else if (marks >= 50) return 'B';
          else if (marks >= 40) return 'D';
          else return 'F';
        } else if (creditHours === 4) {
          if (marks >= 64) return 'A';
          else if (marks >= 52) return 'B';
          else if (marks >= 40) return 'C';
          else if (marks >= 32) return 'D';
          else return 'F';
        } else if (creditHours === 3) {
          if (marks >= 48) return 'A';
          else if (marks >= 39) return 'B';
          else if (marks >= 30) return 'C';
          else if (marks >= 24) return 'D';
          else return 'F';
        } else if (creditHours === 2) {
          if (marks >= 32) return 'A';
          else if (marks >= 26) return 'B';
          else if (marks >= 20) return 'C';
          else if (marks >= 16) return 'D';
          else return 'F';
        } else if (creditHours === 1) {
          if (marks >= 16) return 'A';
          else if (marks >= 13) return 'B';
          else if (marks >= 10) return 'C';
          else if (marks >= 8) return 'D';
          else return 'F';
        }
        
        return 'F';
      }
      
      // Calculate CGPA from processed data
      function calculateCGPA(processedData) {
        if (!processedData) return null;
        
        let totalQualityPoints = 0;
        let totalCreditHours = 0;
        let totalMarksObtained = 0;
        let totalMaxMarks = 0;
        
        // Calculate for each semester (in display order, not chronological)
        Object.keys(processedData.semesters).forEach(semesterName => {
          const semester = processedData.semesters[semesterName];
          semester.totalQualityPoints = 0;
          semester.totalCreditHours = 0;
          semester.totalMarksObtained = 0;
          semester.totalMaxMarks = 0;
          
          semester.courses.forEach(course => {
            // Only count non-extra enrolled and non-deleted courses for CGPA
            if (!course.isExtraEnrolled && !course.isDeleted) {
              semester.totalQualityPoints += course.qualityPoints;
              semester.totalCreditHours += course.creditHours;
              semester.totalMarksObtained += course.marks;
              
              // Calculate max marks based on credit hours
              let maxMarks = 0;
              if (course.creditHours === 5) maxMarks = 100;
              else if (course.creditHours === 4) maxMarks = 80;
              else if (course.creditHours === 3) maxMarks = 60;
              else if (course.creditHours === 2) maxMarks = 40;
              else if (course.creditHours === 1) maxMarks = 20;
              
              semester.totalMaxMarks += maxMarks;
              totalMaxMarks += maxMarks;
              
              totalQualityPoints += course.qualityPoints;
              totalCreditHours += course.creditHours;
              totalMarksObtained += course.marks;
            }
          });
          
          // Calculate semester GPA
          if (semester.totalCreditHours > 0) {
            semester.gpa = parseFloat((semester.totalQualityPoints / semester.totalCreditHours).toFixed(4));
            semester.percentage = parseFloat((semester.totalMarksObtained / semester.totalMaxMarks * 100).toFixed(4));
          } else {
            semester.gpa = 0;
            semester.percentage = 0;
          }
        });
        
        // Calculate overall CGPA
        const cgpa = totalCreditHours > 0 ? parseFloat((totalQualityPoints / totalCreditHours).toFixed(4)) : 0;
        const percentage = totalMaxMarks > 0 ? parseFloat((totalMarksObtained / totalMaxMarks * 100).toFixed(4)) : 0;
        
        return {
          cgpa: cgpa,
          percentage: percentage,
          totalQualityPoints: totalQualityPoints,
          totalCreditHours: totalCreditHours,
          totalMarksObtained: totalMarksObtained,
          totalMaxMarks: totalMaxMarks
        };
      }
      
      // Format CGPA with appropriate decimal places
      function formatCGPA(value) {
        if (value % 1 === 0) {
          return value.toFixed(2);
        } else {
          // Check if it has non-recurring decimals beyond 2 places
          const decimalPart = (value - Math.floor(value)).toFixed(4).substring(2);
          if (decimalPart.length > 2 && decimalPart !== '00') {
            return value.toFixed(4);
          } else {
            return value.toFixed(2);
          }
        }
      }
      
      // Format percentage with appropriate decimal places
      function formatPercentage(value) {
        if (value % 1 === 0) {
          return value.toFixed(0);
        } else {
          return value.toFixed(2);
        }
      }
      
      // Display CGPA results
      function displayCGPAResults(processedData, cgpaData) {
        // Show the result container
        resultContainer.style.display = 'block';
        saveToWebBtn.style.display = 'block';
        
        // Update student info
        studentName.textContent = processedData.studentInfo.name;
        studentName.innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${processedData.studentInfo.name}`;
        studentReg.textContent = processedData.studentInfo.registration;
        
        // Update overall CGPA and marks with formatted values
        totalCgpa.textContent = formatCGPA(cgpaData.cgpa);
        totalPercentage.textContent = `${formatPercentage(cgpaData.percentage)}%`;
        totalMarksObtained.textContent = cgpaData.totalMarksObtained.toFixed(0);
        totalMaxMarks.textContent = `/ ${cgpaData.totalMaxMarks.toFixed(0)}`;
        
        // Clear previous semester results
        semesterResults.innerHTML = '';
        
        // Create semester cards in their original order (not chronological)
        Object.keys(processedData.semesters).forEach(semesterName => {
          const semester = processedData.semesters[semesterName];
          
          const semesterCard = document.createElement('div');
          semesterCard.className = 'semester-card';
          semesterCard.dataset.semester = semesterName;
          semesterCard.innerHTML = `
            <i class="fa-solid fa-trash delete-semester" title="Delete this semester" data-semester="${semesterName}"></i>
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="mb-0">
                <i class="fa-solid fa-book-open me-2" style="color: var(--brand);"></i>
                ${semesterName}
              </h5>
              <div class="text-right" style="margin-right: 40px;">
                <p class="mb-0 text-body-secondary small">GPA:</p>
                <p class="mb-0 h4 fw-bold" style="color: var(--brand);">${semester.gpa ? formatCGPA(semester.gpa) : 0}</p>
                <p class="mb-0 text-body-secondary small">${semester.percentage ? formatPercentage(semester.percentage) : 0}%</p>
              </div>
            </div>
            <button class="custom-course-btn" data-semester="${semesterName}">
              <i class="fa-solid fa-plus"></i> Custom Course
            </button>
            <div class="table-responsive">
              <table class="course-table">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Hrs</th>
                    <th>Marks</th>
                    <th>Grade</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  ${semester.courses.map(course => `
                    <tr class="${course.isExtraEnrolled ? 'table-warning' : ''} ${course.isDeleted ? 'table-danger text-decoration-line-through' : ''} ${course.isCustom ? 'table-info' : ''}">
                      <td>
  <div class="course-code-container">
    <div class="d-flex align-items-center">
      <span class="fw-medium course-code clickable-info" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}'>
        ${course.code}${course.isExtraEnrolled ? '<span style="font-size: 8px; color: #856404;"> (Rep.)</span>' : ''}
      </span>
      <i class="fa-solid fa-info-circle ms-2 clickable-info small" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' title="${course.title}"></i>
    </div>
    ${course.isCustom ? '<span class="extra-enrolled">Custom</span>' : ''}
  </div>
</td>
                      <td>${course.creditHoursDisplay || course.creditHours}</td>
                      <td>${course.marks}</td>
                      <td>
                        <span class="grade-badge grade-${course.grade}">${course.grade}</span>
                      </td>
                      <td class="course-actions">
                        ${course.isDeleted ? 
                          `<i class="fa-solid fa-rotate-left restore-course" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' data-semester="${semesterName}" title="Restore this course"></i>` : 
                          `<i class="fa-solid fa-trash delete-course" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}' data-semester="${semesterName}" title="Delete this course"></i>`
                        }
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
          
          semesterResults.appendChild(semesterCard);
        });
        
        // Add event listeners for course details and delete buttons
        document.querySelectorAll('.clickable-info').forEach(el => {
          el.addEventListener('click', function() {
            const courseData = JSON.parse(this.dataset.course.replace(/&#39;/g, "'"));
            showCourseDetails(courseData);
          });
        });
        
        document.querySelectorAll('.delete-semester').forEach(btn => {
          btn.addEventListener('click', function() {
            const semesterName = this.dataset.semester;
            deleteSemester(semesterName);
          });
        });
        
        document.querySelectorAll('.custom-course-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const semesterName = this.dataset.semester;
            openAddCourseModal(semesterName);
          });
        });
        
        document.querySelectorAll('.delete-course').forEach(btn => {
          btn.addEventListener('click', function() {
            const courseData = JSON.parse(this.dataset.course.replace(/&#39;/g, "'"));
            const semesterName = this.dataset.semester;
            deleteCourse(courseData, semesterName);
          });
        });
        
        document.querySelectorAll('.restore-course').forEach(btn => {
          btn.addEventListener('click', function() {
            const courseData = JSON.parse(this.dataset.course.replace(/&#39;/g, "'"));
            const semesterName = this.dataset.semester;
            restoreCourse(courseData, semesterName);
          });
        });
      }
      
      // Show course details in modal
      function showCourseDetails(course) {
        document.getElementById('courseDetailsModalTitle').textContent = `${course.code} - ${course.title}`;
        
        const modalBody = document.getElementById('courseDetailsModalBody');
        
        let repeatedInfoHtml = '';
        if (course.isExtraEnrolled && course.originalSemesterForRepeated) {
          repeatedInfoHtml = `
            <div class="row mt-3">
              <div class="col-12">
                <div class="alert alert-warning">
                  <i class="fa-solid fa-exclamation-triangle me-2"></i>
                  <p class="mb-1">The Marks and Quality points of this Repeated subject will be considered in its <strong class="clickable-semester" data-semester="${course.originalSemesterForRepeated}" style="cursor: pointer; text-decoration: underline;">Original Semester (${course.originalSemesterForRepeated})</strong></p>
                  <p class="mb-0 small">Click on the semester name to view it</p>
                </div>
              </div>
            </div>
          `;
        }
        
        let customInfoHtml = '';
        if (course.isCustom) {
          customInfoHtml = `
            <div class="row mt-3">
              <div class="col-12">
                <div class="alert alert-info">
                  <i class="fa-solid fa-info-circle me-2"></i>
                  <p class="mb-0">This is a custom course added manually.</p>
                </div>
              </div>
            </div>
          `;
        }
        
        modalBody.innerHTML = `
          <div class="row">
            <div class="col-md-6">
              <p><strong>Teacher:</strong> ${course.teacher}</p>
              <p><strong>Credit Hours:</strong> ${course.creditHoursDisplay || course.creditHours}</p>
              <p><strong>Semester:</strong> ${course.semesterName}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Mid Term:</strong> ${course.mid}</p>
              <p><strong>Assignment:</strong> ${course.assignment}</p>
              <p><strong>Final Term:</strong> ${course.final}</p>
              ${course.practical ? `<p><strong>Practical:</strong> ${course.practical}</p>` : ''}
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-12">
              <div class="alert alert-info">
                <p class="mb-1"><strong>Total Marks:</strong> ${course.total}</p>
                <p class="mb-1"><strong>Grade:</strong> <span class="grade-badge grade-${course.grade}">${course.grade}</span></p>
                <p class="mb-0"><strong>Quality Points:</strong> ${course.qualityPoints.toFixed(2)}</p>
              </div>
            </div>
          </div>
          ${repeatedInfoHtml}
          ${customInfoHtml}
        `;
        
        // Add event listener for semester link if it exists
        const semesterLink = modalBody.querySelector('.clickable-semester');
        if (semesterLink) {
          semesterLink.addEventListener('click', function() {
            const semesterName = this.dataset.semester;
            courseDetailsModal.hide();
            
            // Scroll to the semester
            const semesterElement = document.querySelector(`.semester-card[data-semester="${semesterName}"]`);
            if (semesterElement) {
              semesterElement.scrollIntoView({ behavior: 'smooth' });
              // Add highlight effect
              semesterElement.style.transition = 'all 0.5s ease';
              semesterElement.style.boxShadow = '0 0 20px rgba(122, 106, 216, 0.5)';
              setTimeout(() => {
                semesterElement.style.boxShadow = '';
              }, 2000);
            }
          });
        }
        
        courseDetailsModal.show();
      }
      
      // Open add course modal
      function openAddCourseModal(semesterName) {
        document.getElementById('addCourseSemester').value = semesterName;
        addCourseForm.reset();
        addCourseModal.show();
      }
      
      // Add custom course
      function addCustomCourse() {
        const semesterName = document.getElementById('addCourseSemester').value;
        const courseCode = document.getElementById('courseCode').value;
        const courseTitle = document.getElementById('courseTitle').value;
        const creditHours = parseInt(document.getElementById('creditHours').value);
        const marks = parseInt(document.getElementById('courseMarks').value);
        
        if (!courseCode || !courseTitle || !creditHours || isNaN(marks)) {
          showToast('Please fill all fields correctly', 'error');
          return;
        }
        
        if (!processedData || !processedData.semesters[semesterName]) return;
        
        const semester = processedData.semesters[semesterName];
        
        // Calculate quality points
        const qualityPoints = calculateQualityPoints(marks, creditHours);
        
        // Determine grade based on custom grading system
        const grade = calculateCustomGrade(marks, creditHours);
        
        const courseData = {
          code: courseCode,
          title: courseTitle,
          creditHours: creditHours,
          creditHoursDisplay: creditHours.toString(), // Simple display for custom courses
          marks: marks,
          qualityPoints: qualityPoints,
          grade: grade,
          originalSemester: semesterName,
          semesterName: semesterName,
          semesterSortKey: getSemesterOrderKey(semesterName),
          teacher: 'Custom Course',
          mid: '0',
          assignment: '0',
          final: marks.toString(),
          practical: '0',
          total: marks.toString(),
          isExtraEnrolled: false,
          isRepeated: false,
          isDeleted: false,
          originalSemesterForRepeated: null,
          isCustom: true
        };
        
        // Add course to semester
        semester.courses.push(courseData);
        
        // Recalculate CGPA
        const cgpaData = calculateCGPA(processedData);
        
        // Update display
        displayCGPAResults(processedData, cgpaData);
        
        addCourseModal.hide();
        showToast(`Course ${courseCode} added to ${semesterName}`, 'success');
        addStatusMessage(`Added custom course: ${courseCode} to ${semesterName}`, 'info');
      }
      
      // Delete a semester
      function deleteSemester(semesterName) {
        if (!processedData || !processedData.semesters[semesterName]) return;
        
        // Store the semester data for potential undo
        deletedSemesters[semesterName] = JSON.parse(JSON.stringify(processedData.semesters[semesterName]));
        
        // Remove semester from processed data
        delete processedData.semesters[semesterName];
        
        // Recalculate CGPA
        const cgpaData = calculateCGPA(processedData);
        
        // Update display
        displayCGPAResults(processedData, cgpaData);
        
        // Show undo notification
        showUndoNotification(semesterName);
        
        addStatusMessage(`Deleted semester: ${semesterName}`, 'info');
        showToast(`Semester ${semesterName} deleted`, 'info');
      }
      
      // Show undo notification for deleted semester
      function showUndoNotification(semesterName) {
        // Remove any existing undo notification
        const existingNotification = document.getElementById('undo-notification');
        if (existingNotification) {
          existingNotification.remove();
        }
        
        const notification = document.createElement('div');
        notification.id = 'undo-notification';
        notification.className = 'undo-notification';
        notification.innerHTML = `
          Semester "${semesterName}" deleted
          <button class="undo-btn" data-semester="${semesterName}">Undo</button>
        `;
        
        document.body.appendChild(notification);
        
        // Add event listener for undo button
        notification.querySelector('.undo-btn').addEventListener('click', function() {
          const semesterToRestore = this.dataset.semester;
          undoDeleteSemester(semesterToRestore);
          notification.remove();
        });
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
            // Permanently remove the semester from undo history
            delete deletedSemesters[semesterName];
          }
        }, 5000);
      }
      
      // Undo semester deletion
      function undoDeleteSemester(semesterName) {
        if (!deletedSemesters[semesterName]) return;
        
        // Restore the semester
        processedData.semesters[semesterName] = deletedSemesters[semesterName];
        
        // Remove from undo history
        delete deletedSemesters[semesterName];
        
        // Recalculate CGPA
        const cgpaData = calculateCGPA(processedData);
        
        // Update display
        displayCGPAResults(processedData, cgpaData);
        
        addStatusMessage(`Restored semester: ${semesterName}`, 'info');
        showToast(`Semester ${semesterName} restored`, 'success');
      }
      
      // Delete a course
      function deleteCourse(course, semesterName) {
        if (!processedData || !processedData.semesters[semesterName]) return;
        
        // Find the course index
        const semester = processedData.semesters[semesterName];
        const courseIndex = semester.courses.findIndex(c => c.code === course.code && c.marks === course.marks);
        
        if (courseIndex === -1) return;
        
        // Mark course as deleted
        semester.courses[courseIndex].isDeleted = true;
        
        // If this was the best instance of a repeated course, find the next best one
        if (!course.isExtraEnrolled && course.isRepeated) {
          // Find all instances of this course
          const courseCode = course.code;
          const allInstances = [];
          
          // Collect all instances of this course
          Object.keys(processedData.semesters).forEach(sem => {
            processedData.semesters[sem].courses.forEach(c => {
              if (c.code === courseCode && !c.isDeleted) {
                allInstances.push({
                  semester: sem,
                  marks: c.marks,
                  qualityPoints: c.qualityPoints,
                  data: c
                });
              }
            });
          });
          
          // If there are other instances, find the best one and update its status
          if (allInstances.length > 0) {
            // Sort by marks (highest first)
            allInstances.sort((a, b) => b.marks - a.marks);
            const bestInstance = allInstances[0];
            
            // Update all other instances to point to this best instance
            allInstances.forEach((instance, index) => {
              if (index > 0) {
                instance.data.originalSemesterForRepeated = bestInstance.semester;
              }
            });
          }
        }
        
        // Recalculate CGPA
        const cgpaData = calculateCGPA(processedData);
        
        // Update display
        displayCGPAResults(processedData, cgpaData);
        
        addStatusMessage(`Deleted course: ${course.code} from ${semesterName}`, 'info');
        showToast(`Course ${course.code} deleted`, 'info');
      }
      
      // Restore a course
      function restoreCourse(course, semesterName) {
        if (!processedData || !processedData.semesters[semesterName]) return;
        
        // Find the course index
        const semester = processedData.semesters[semesterName];
        const courseIndex = semester.courses.findIndex(c => c.code === course.code && c.marks === course.marks);
        
        if (courseIndex === -1) return;
        
        // Mark course as not deleted
        semester.courses[courseIndex].isDeleted = false;
        
        // If this is a repeated course, we need to determine which instance should be used for CGPA
        if (course.isRepeated) {
          // Find all instances of this course
          const courseCode = course.code;
          const allInstances = [];
          
          // Collect all instances of this course
          Object.keys(processedData.semesters).forEach(sem => {
            processedData.semesters[sem].courses.forEach(c => {
              if (c.code === courseCode && !c.isDeleted) {
                allInstances.push({
                  semester: sem,
                  marks: c.marks,
                  qualityPoints: c.qualityPoints,
                  data: c
                });
              }
            });
          });
          
          // If there are multiple instances, find the best one
          if (allInstances.length > 1) {
            // Sort by marks (highest first)
            allInstances.sort((a, b) => b.marks - a.marks);
            const bestInstance = allInstances[0];
            
            // Update all other instances to point to this best instance
            allInstances.forEach((instance, index) => {
              if (index > 0) {
                instance.data.isExtraEnrolled = true;
                instance.data.originalSemesterForRepeated = bestInstance.semester;
              } else {
                instance.data.isExtraEnrolled = false;
                instance.data.originalSemesterForRepeated = null;
              }
            });
          }
        }
        
        // Recalculate CGPA
        const cgpaData = calculateCGPA(processedData);
        
        // Update display
        displayCGPAResults(processedData, cgpaData);
        
        addStatusMessage(`Restored course: ${course.code} in ${semesterName}`, 'info');
        showToast(`Course ${course.code} restored`, 'success');
      }
      
      // Save result to web storage
      async function saveToWeb() {
        if (!processedData) {
          showToast('No data to save', 'error');
          return;
        }
        
        const regNum = registrationNumber.value.trim();
        if (!regNum) {
          showToast('Please enter a registration number', 'error');
          return;
        }
        
        addStatusMessage('Saving result to web storage...', 'info');
        showLoadingStage('processing');
        
        try {
          const response = await fetch(API_ENDPOINTS.save, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              registrationNumber: regNum,
              studentData: processedData,
              timestamp: new Date().toISOString()
            })
          });
          
          const result = await response.json();
          
          if (result.success) {
            addStatusMessage('Result saved successfully to web storage', 'success');
            showLoadingStage('complete');
            showToast('Result saved successfully!', 'success');
            
            // Refresh saved results list
            checkSavedResults();
            
            // Hide loading after delay
            setTimeout(() => {
              hideLoading();
            }, 2000);
          } else {
            addStatusMessage(`Error saving result: ${result.message}`, 'error');
            hideLoading();
            showToast('Error saving result', 'error');
          }
        } catch (error) {
          addStatusMessage(`Error saving result: ${error.message}`, 'error');
          hideLoading();
          showToast('Error saving result', 'error');
        }
      }
      
      // Check for saved results
      async function checkSavedResults() {
        const regNum = registrationNumber.value.trim();
        if (!regNum) return;
        
        try {
          const response = await fetch(`${API_ENDPOINTS.load}&registrationNumber=${encodeURIComponent(regNum)}`);
          const result = await response.json();
          
          if (result.success && result.savedResults && result.savedResults.length > 0) {
            displaySavedResults(result.savedResults);
          } else {
            savedResultsContainer.style.display = 'none';
          }
        } catch (error) {
          console.error('Error checking saved results:', error);
          savedResultsContainer.style.display = 'none';
        }
      }
      
      // Display saved results
      function displaySavedResults(savedResults) {
        savedResultsList.innerHTML = '';
        savedResultsContainer.style.display = 'block';
        
        savedResults.forEach((result, index) => {
          const date = new Date(result.timestamp).toLocaleDateString();
          const time = new Date(result.timestamp).toLocaleTimeString();
          
          const resultCard = document.createElement('div');
          resultCard.className = 'saved-result-card';
          resultCard.innerHTML = `
            <div class="saved-result-header">
              <div>
                <strong>Saved Result ${index + 1}</strong>
                <div class="saved-result-date">${date} at ${time}</div>
              </div>
              <div class="saved-result-actions">
                <button class="saved-result-action-btn view-saved-result" data-index="${index}">
                  <i class="fa-solid fa-eye"></i>
                </button>
                <button class="saved-result-action-btn delete-saved-result" data-index="${index}">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>
          `;
          
          savedResultsList.appendChild(resultCard);
        });
        
        // Add event listeners
        document.querySelectorAll('.view-saved-result').forEach(btn => {
          btn.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            loadSavedResult(savedResults[index]);
          });
        });
        
        document.querySelectorAll('.delete-saved-result').forEach(btn => {
          btn.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            deleteSavedResult(savedResults[index].id);
          });
        });
      }
      
      // Load saved result
      function loadSavedResult(savedResult) {
        processedData = savedResult.studentData;
        
        // Calculate CGPA
        const cgpaData = calculateCGPA(processedData);
        
        // Display the result
        displayCGPAResults(processedData, cgpaData);
        
        showToast('Saved result loaded successfully!', 'success');
        addStatusMessage('Loaded saved result from web storage', 'info');
      }
      
      // Delete saved result
      async function deleteSavedResult(resultId) {
        try {
          const response = await fetch(API_ENDPOINTS.save, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              id: resultId
            })
          });
          
          const result = await response.json();
          
          if (result.success) {
            showToast('Saved result deleted successfully!', 'success');
            addStatusMessage('Deleted saved result from web storage', 'info');
            
            // Refresh saved results list
            checkSavedResults();
          } else {
            showToast('Error deleting saved result', 'error');
            addStatusMessage(`Error deleting saved result: ${result.message}`, 'error');
          }
        } catch (error) {
          showToast('Error deleting saved result', 'error');
          addStatusMessage(`Error deleting saved result: ${error.message}`, 'error');
        }
      }
      
      // Fetch result from UAF LMS
      async function fetchResult() {
        const regNum = registrationNumber.value.trim();
        
        if (!regNum) {
          showToast('Please enter a registration number', 'error');
          return;
        }
        
        // Check if we have saved results first
        try {
          const response = await fetch(`${API_ENDPOINTS.load}&registrationNumber=${encodeURIComponent(regNum)}`);
          const result = await response.json();
          
          if (result.success && result.savedResults && result.savedResults.length > 0) {
            // Ask user if they want to load saved result
            if (confirm('Saved results found for this registration number. Would you like to load the latest saved result instead of fetching from UAF LMS?')) {
              loadSavedResult(result.savedResults[0]);
              return;
            }
          }
        } catch (error) {
          console.error('Error checking saved results:', error);
        }
        
        // Show loading animation
        resultContainer.style.display = 'none';
        saveToWebBtn.style.display = 'none';
        showLoadingStage('connecting');
        addStatusMessage(`Fetching result for registration number: ${regNum}`, 'info');
        
        try {
          // Stage 1: Connecting
          setTimeout(() => {
            showLoadingStage('fetching');
            addStatusMessage('Connected to UAF LMS, fetching results...', 'info');
          }, 2000);
          
          const response = await fetch(`${API_ENDPOINTS.scrape}?action=scrape_single&registrationNumber=${encodeURIComponent(regNum)}`, {
            method: 'GET'
          });
          
          // Stage 2: Processing
          showLoadingStage('processing');
          addStatusMessage('Results received, processing data...', 'info');
          
          const data = await response.json();
          
          if (data.success) {
            scrapedData = data;
            addStatusMessage('Result fetched successfully', 'success');
            
            // Process the scraped data
            processedData = processScrapedData(data);
            
            if (processedData) {
              // Calculate CGPA
              const cgpaData = calculateCGPA(processedData);
              
              // Stage 3: Complete
              showLoadingStage('complete');
              addStatusMessage('CGPA calculated successfully', 'success');
              
              // Display the result after a brief delay to show the completion animation
              setTimeout(() => {
                displayCGPAResults(processedData, cgpaData);
                hideLoading();
                showToast('Result fetched successfully!', 'success');
                
                // Check for saved results
                checkSavedResults();
              }, 1500);
            } else {
              addStatusMessage('Error processing result data', 'error');
              showToast('Error processing result data', 'error');
              hideLoading();
            }
          } else {
            addStatusMessage(`Error: ${data.message}`, 'error');
            showToast(data.message, 'error');
            hideLoading();
          }
        } catch (error) {
          addStatusMessage(`Error fetching result: ${error.message}`, 'error');
          showToast('Error fetching result', 'error');
          hideLoading();
        }
      }
      
      // Event listeners
      resultForm.addEventListener('submit', function(e) {
        e.preventDefault();
        fetchResult();
      });
      
      testConnectionBtn.addEventListener('click', testConnection);
      
      downloadLogBtn.addEventListener('click', downloadLog);
      
      clearLogBtn.addEventListener('click', clearLog);
      
      saveToWebBtn.addEventListener('click', saveToWeb);
      
      saveCourseBtn.addEventListener('click', addCustomCourse);
      
      registrationNumber.addEventListener('input', function() {
        const regNum = this.value.trim();
        if (regNum) {
          checkSavedResults();
        } else {
          savedResultsContainer.style.display = 'none';
        }
      });
      
      // Initialize the application
      init();
    });
  </script>
</body>
</html>





