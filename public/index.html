<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>UAF CGPA Calculator - Automatic GPA & Percentage</title>

  <meta name="description" content="Calculate UAF CGPA, GPA, and Percentage instantly with the automatic calculator by M Saqlain. Fetches results from UAF LMS & Attendance System by registration number. Accurate, free, with PDF download. Works for all departments (2025)." />

  <meta name="keywords" content="uaf cgpa calculator, cgpa calculator uaf, uaf gpa calculator, university of agriculture faisalabad cgpa calculator, uaf lms cgpa calculator, uaf cgpa calculator saqlain, uaf result calculator, uaf cgpa calculator by registration number, calculate uaf cgpa, uaf grading system calculator, uaf quality points calculator, uaf semester gpa calculator, cgpa calculator uaf online, uaf cgpa calculator 2025, uaf cgpa calculator free, uaf cgpa to percentage, uaf automatic cgpa calculator, uaf bs cgpa calculator, uaf ms cgpa calculator, uaf attendance system calculator, cgpa calculator for uaf students, uaf result fetcher, lms uaf result calculator, uaf transcript calculator, uaf grade calculator, agriculture university faisalabad cgpa, uaf credit hours calculator, uaf marks to cgpa, university of agriculture faisalabad gpa calculator, uaf cgpa calculator saqlain, uaf calculator by ag number, uaf official grading system, uaf 4.0 scale calculator" />

  <meta name="author" content="Muhammad Saqlain" />
  <link rel="canonical" href="https://uafcgpacalculator.vercel.app/" />

  <meta name="google-site-verification" content="google3e44586abf077c1e" />
  <meta name="google-site-verification" content="zClcBWKWCeJyEGq-plDV2JvodudE4m_t8OK4sBMj8aw" />

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#7a6ad8">

  <meta property="og:title" content="UAF CGPA Calculator | Automatic Result Fetcher by M Saqlain" />
  <meta property="og:description" content="The Best UAF CGPA Calculator - Enter your registration number to automatically fetch and calculate your University of Agriculture Faisalabad CGPA, GPA, and percentage. Download PDF transcript instantly." />
  <meta property="og:url" content="https://uafcgpacalculator.vercel.app/" />
  <meta property="og:site_name" content="UAF CGPA Calculator" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://uafcgpacalculator.vercel.app/uafcgpacalculator.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:locale" content="en_PK" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://uafcgpacalculator.vercel.app/" />
  <meta name="twitter:title" content="UAF CGPA Calculator - Automatic GPA & Percentage" />
  <meta name="twitter:description" content="Calculate your UAF CGPA automatically by registration number. Free tool by M Saqlain for University of Agriculture Faisalabad students. Instant results with PDF download." />
  <meta name="twitter:image" content="https://uafcgpacalculator.vercel.app/uafcgpacalculator.png" />
  <meta name="twitter:creator" content="@M_Saqlain_Akbar" />

  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https.www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MJW7HPPS');</script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "UAF CGPA Calculator",
    "url": "https://uafcgpacalculator.vercel.app/",
    "applicationCategory": "EducationalApplication",
    "description": "An automatic CGPA calculator for students of the University of Agriculture Faisalabad (UAF) that fetches results directly from the university's LMS.",
    "operatingSystem": "All",
    "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "PKR"
    },
    "creator": {
      "@type": "Person",
      "name": "Muhammad Saqlain"
    },
    "mainEntity": [
      {
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How does the  work?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The UAF CGPA Calculator by Saqlain securely connects to the public UAF LMS portal using your registration number. It fetches your official results, processes the grades and credit hours according to the official UAF grading formula, and instantly calculates your precise Semester GPA and Cumulative GPA (CGPA)."
            }
          },
          {
            "@type": "Question",
            "name": "Is it safe to use my registration number?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, it is completely safe. The calculator only requires your registration number, not your password. Your information is used only for fetching your result for the current session and is never stored or shared. The connection is secure and private."
            }
          },
          {
            "@type": "Question",
            "name": "Can I use this calculator for other universities?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "This calculator is specifically designed for the students of the University of Agriculture, Faisalabad (UAF). It uses UAF's unique grading system and connects directly to the UAF LMS, so it will not work for other universities."
            }
          }
        ]
      },
      {
        "@type": "HowTo",
        "name": "How to Use the ",
        "step": [
          {
            "@type": "HowToStep",
            "text": "Enter your full registration number (e.g., 2020-ag-1234) into the input field.",
            "name": "Enter Registration Number"
          },
          {
            "@type": "HowToStep",
            "text": "Click the 'Fetch Result' button to securely connect to the UAF LMS and retrieve your academic records.",
            "name": "Fetch Your Results"
          },
          {
            "@type": "HowToStep",
            "text": "View your automatically calculated CGPA, percentage, and detailed semester-wise results.",
            "name": "View Your CGPA"
          },
          {
            "@type": "HowToStep",
            "text": "Optionally, download a premium PDF of your transcript or use the forecast feature to plan for future semesters.",
            "name": "Download or Forecast"
          }
        ]
      }
    ]
  }
</script>

  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "UAF CGPA Calculator",
  "applicationCategory": "EducationalApplication",
  "operatingSystem": "Web Browser",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "PKR"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "ratingCount": "1250",
    "bestRating": "5",
    "worstRating": "1"
  },
  "author": {
    "@type": "Person",
    "name": "Muhammad Saqlain",
    "url": "https://uafcgpacalculator.vercel.app"
  },
  "description": "The best UAF CGPA Calculator for University of Agriculture Faisalabad students. Automatically fetch results by registration number and calculate CGPA, GPA, and percentage.",
  "featureList": [
    "Automatic result fetching by registration number",
    "CGPA and GPA calculation",
    "Semester-wise grade analysis",
    "PDF transcript download",
    "Attendance system integration",
    "Multiple profile management",
    "Dark mode support"
  ],
  "screenshot": "https://uafcgpacalculator.vercel.app/uafcgpacalculator.png"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "UAF CGPA Calculator",
  "url": "https://uafcgpacalculator.vercel.app",
  "logo": "https://uafcgpacalculator.vercel.app/uafcgpacalculator.png",
  "sameAs": [
    "https://www.facebook.com/UAFChemist.Rustam",
    "https://x.com/M_Saqlain_Akbar",
    "https://www.linkedin.com/in/muhammad-saqlain-akbar/"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "Developer Support",
    "url": "https://uafcgpacalculator.vercel.app#contact-us"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://uafcgpacalculator.vercel.app"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "UAF CGPA Calculator",
      "item": "https://uafcgpacalculator.vercel.app#Auto-Calculator"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Features",
      "item": "https://uafcgpacalculator.vercel.app#features"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "FAQ",
      "item": "https://uafcgpacalculator.vercel.app#faq"
    }
  ]
}
</script>
  


  <script src="https://analytics.ahrefs.com/analytics.js" data-key="CWWh1lx4Kz/fCxT0UN7M0w" async></script>

  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎓</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://fonts.googleapis.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
  --brand: #7a6ad8;
  --brand-600: #6b5fca;
  --brand-700: #5d52b8;
  --brand-gradient: linear-gradient(135deg, #7a6ad8 0%, #6b5fca 50%, #5d52b8 100%);
  --brand-gradient-hover: linear-gradient(135deg, #8a7ce8 0%, #7b6fda 50%, #6d62c8 100%);
  --accent: #ff6b6b;
  --accent-gradient: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
  --text: #1b1f24;
  --text-light: #4b5563;
  --muted: #6b7280;
  --light-bg: #f8f9ff;
  --card-bg: #ffffff;
  --radius: 1.25rem; /* Standard radius */
  --radius-sm: 0.75rem; /* Slightly smaller radius */
  --radius-btn: 12px; /* Specific radius for certain buttons */
  --shadow: 0 10px 30px rgba(17, 24, 39, 0.1);
  --shadow-hover: 0 15px 40px rgba(17, 24, 39, 0.15);

  /* New gradient variables */
  --brand-primary: #7a6ad8;
  --brand-secondary: #6b5fca;
}

html, body {
  font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  scroll-behavior: smooth;
}

body {
  display: flex; /* ADDED: Makes the body a flex container */
  flex-direction: column; /* ADDED: Stacks children vertically */
  background-color: var(--light-bg);
  min-height: 100vh;
  margin: 0;
  padding: 0;
  color: var(--text);
}

/* Improved navbar with glassmorphism effect */
.navbar {
  backdrop-filter: saturate(180%) blur(12px);
  background-color: rgba(255, 255, 255, 0.8);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.navbar .navbar-brand {
  font-weight: 800;
  letter-spacing: .3px;
  color: var(--brand);
  transition: all 0.3s ease;
}

.navbar .navbar-brand:hover {
  transform: translateY(-1px);
}

.navbar .nav-link {
  position: relative;
  font-weight: 500;
  transition: all 0.3s ease;
  color: #6358c0;
}

.navbar .nav-link::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--brand-gradient);
  transition: width 0.3s ease;
}

.navbar .nav-link:hover::after {
  width: 100%;
}

/* Improved buttons */
.btn-brand {
  background: var(--brand-gradient);
  border: none;
  color: white;
  transition: all 0.3s ease;
  box-shadow: var(--shadow);
}

.btn-brand:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  color: white;
}

.btn-soft {
  background: rgba(122, 106, 216, 0.1);
  color: var(--brand);
  transition: all 0.3s ease;
}

.btn-soft:hover {
  background: rgba(122, 106, 216, 0.2);
  transform: translateY(-1px);
}

.badge-brand {
  background: var(--brand-gradient);
  color: white;
}

.btn-primary-action {
  background: var(--brand-gradient);
  color: #fff;
  border: 0;
  box-shadow: 0 6px 18px rgba(122, 106, 216, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-primary-action:hover {
  background: var(--brand-gradient-hover);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(122, 106, 216, 0.3);
}

.btn-secondary-action {
  background: #fff;
  color: var(--brand);
  border: 1px solid rgba(122, 106, 216, 0.15);
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-secondary-action:hover {
  background: #f8f9ff;
  color: var(--brand);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.1);
}

.btn-danger-action {
  background: var(--accent-gradient);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-danger-action:hover {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  transform: translateY(-2px);
}

.btn-success-action {
  background: linear-gradient(135deg, #10ac84 0%, #0d916b 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-success-action:hover {
  background: linear-gradient(135deg, #12c29a 0%, #0fa57c 100%);
  color: white;
  transform: translateY(-2px);
}

/* Improved hero section */
.hero {
  padding: 5rem 0 4rem;
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: '';
  position: absolute;
  top: -100px;
  right: -100px;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  background: rgba(122, 106, 216, 0.1);
  z-index: -1;
}

.hero::after {
  content: '';
  position: absolute;
  bottom: -50px;
  left: -50px;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: rgba(255, 107, 107, 0.1);
  z-index: -1;
}

.hero h1 {
  font-weight: 800;
  line-height: 1.05;
  font-size: 3.5rem;
  margin-bottom: 1.5rem;
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero .lead {
  color: var(--text-light);
  font-size: 1.25rem;
  margin-bottom: 2rem;
}

.mt-3 {
  margin-top: 1rem !important;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

/* Improved cards with glassmorphism effect */
.card-modern {
  border: 0;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.8);
  transition: all 0.3s ease;
  overflow: hidden;
  color: var(--text);
}

.card-modern:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.card-modern .card-header {
  border: 0;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  padding: 1.5rem 2rem;
}

.card-modern .card-header h4 {
  font-weight: 700;
  color: var(--text);
  text-align: center; /* Center header text */
}

.form-select, .form-control {
  border-radius: .85rem;
  border: 1px solid rgba(122, 106, 216, 0.2);
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
  color: var(--text);
  background-color: rgba(255, 255, 255, 0.9);
}

.form-select:focus, .form-control:focus {
  border-color: var(--brand);
  box-shadow: 0 0 0 0.25rem rgba(122, 106, 216, 0.25);
}

label {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 0.5rem;
}

.subject-row {
  border: 1px dashed rgba(122, 106, 216, 0.3);
  border-radius: 1rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.5);
  transition: all 0.3s ease;
}

.subject-row:hover {
  border-color: var(--brand);
  background: rgba(255, 255, 255, 0.8);
}

.result-display {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--brand);
  background: linear-gradient(135deg, var(--brand) 0%, var(--text) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Improved loading animations */
.loading-container {
  margin-top: 1.5rem;
  text-align: center;
  padding: 3rem 2rem;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.1), rgba(122, 106, 216, 0.05));
  display: none;
  backdrop-filter: blur(10px);
}

.loading-stage {
  display: none;
}

.loading-animation {
  width: 80px;
  height: 80px;
  margin: 0 auto 1.5rem;
  position: relative;
}

.loading-connecting {
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-connecting .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--brand);
  margin: 0 5px;
  animation: bounce 1.5s infinite ease-in-out;
}

.loading-connecting .dot:nth-child(2) {
  animation-delay: 0.2s;
}

.loading-connecting .dot:nth-child(3) {
  animation-delay: 0.4s;
}

.loading-complete .checkmark {
  width: 80px;
  height: 80px;
  margin: 0 auto;
  position: relative;
}

.loading-complete .checkmark:before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 40px;
  height: 20px;
  border: 6px solid var(--brand);
  border-top: none;
  border-right: none;
  transform: translate(-50%, -60%) rotate(-45deg);
  animation: checkmark 0.6s ease-in-out;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-15px); }
}

@keyframes checkmark {
  0% { opacity: 0; transform: translate(-50%, -60%) rotate(-45deg) scale(0); }
  50% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1.2); }
  100% { opacity: 1; transform: translate(-50%, -60%) rotate(-45deg) scale(1); }
}

.loading-text {
  font-weight: 600;
  color: var(--brand);
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
}

.loading-subtext {
  color: var(--muted);
  font-size: 0.9rem;
  max-width: 400px;
  margin: 0 auto;
}

.status-log {
  max-height: 300px;
  overflow-y: auto;
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1rem;
  font-family: monospace;
  font-size: 0.875rem;
  margin-bottom: 1rem;
  backdrop-filter: blur(10px);
}

.status-line {
  margin-bottom: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(233, 236, 239, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
}

.status-line:hover {
  background: rgba(255, 255, 255, 0.5);
  border-radius: 0.25rem;
  padding-left: 0.5rem;
}

.status-line:last-child {
  margin-bottom: 0;
  border-bottom: none;
}

.status-success { color: #28a745; }
.status-error { color: #dc3545; }
status-warning { color: #fd7e14; }
.status-info { color: var(--brand); }

/* --- NEW: Premium Footer Styles --- */
.premium-footer {
  /* Use light-bg to blend seamlessly with the page */
  background-color: var(--light-bg);
  border-top: 1px solid rgba(122, 106, 216, 0.2);
  padding-top: 4rem;
  color: var(--muted);
  margin-top: 3rem; /* Replaces inline style from old footer */
}

[data-theme="dark"] .premium-footer {
  /* Dark mode: use a transparent bg to blend with the body gradient */
  background-color: transparent;
}

.footer-logo {
  font-weight: 800;
  letter-spacing: .3px;
  font-size: 1.25rem;
  margin-bottom: 1rem;
  display: inline-block;
  text-decoration: none;
}

.footer-logo .badge {
  /* Re-style the badge from the navbar */
  background: var(--brand-gradient);
  color: white;
  font-size: 0.8rem;
  padding: 0.4em 0.6em;
  vertical-align: middle;
  margin-right: 0.5rem;
}

.footer-logo .gradient-text {
  vertical-align: middle;
}

.footer-description {
  font-size: 0.95rem;
  color: var(--muted);
  max-width: 350px; /* Constrains the text block */
}

.social-links {
  display: flex;
  gap: 1.25rem;
  margin-top: 1.5rem;
}

.social-links a {
  font-size: 1.25rem;
  color: var(--muted);
  transition: all 0.3s ease;
}

.social-links a:hover {
  color: var(--brand);
  transform: translateY(-2px);
}

.footer-heading {
  font-weight: 600;
  font-size: 1rem;
  /* Use --text for higher contrast in both light/dark modes */
  color: var(--text);
  margin-bottom: 1.5rem;
}

.footer-links {
  list-style: none;
  padding: 0;
  margin: 0;
}

.footer-links li {
  margin-bottom: 1rem;
}

.footer-links a {
  color: var(--muted);
  text-decoration: none;
  transition: all 0.3s ease;
  position: relative;
}

.footer-links a:hover {
  color: var(--brand);
  /* Shopify-style hover indent */
  padding-left: 8px;
}

/* Underline effect for footer links on hover */
.footer-links a::after {
  content: '';
  position: absolute;
  width: 0;
  height: 1px;
  bottom: -3px;
  left: 0;
  background-color: var(--brand);
  transition: width 0.3s ease-out;
}

.footer-links a:hover::after {
  width: 100%;
}

.footer-bottom-bar {
  padding-top: 1.5rem;
  padding-bottom: 1.5rem;
  margin-top: 3rem;
  /* Separator line */
  border-top: 1px solid rgba(122, 106, 216, 0.2);
}

.footer-copyright {
  font-size: 0.9rem;
  color: var(--muted);
  text-align: center;
}

.footer-copyright p {
  margin-bottom: 0.5rem;
}

.footer-copyright a {
    font-weight: 500;
    color: var(--muted);
    text-decoration: underline;
    text-decoration-color: rgba(122, 106, 216, 0.5);
}
.footer-copyright a:hover {
    color: var(--brand);
    text-decoration-color: var(--brand);
}

.footer-disclaimer {
  font-size: 0.85rem;
  color: var(--muted);
  font-style: italic;
  padding-top: 10px;
}

/* Responsive handling for the columns */
@media (max-width: 991.98px) {
  .premium-footer .col-lg-3,
  .premium-footer .col-lg-2 {
      margin-bottom: 2.5rem; /* Add space between stacked columns */
  }
}
@media (max-width: 767.98px) {
    .premium-footer .col-lg-4,
    .premium-footer .col-md-7,
    .premium-footer .col-md-5,
    .premium-footer .col-md-4,
    .premium-footer .col-md-3 {
        margin-bottom: 2.5rem; /* Add space between stacked columns */
    }
    .footer-copyright {
        text-align: center;
    }
}

/* Make copyright text smaller on mobile */
@media (max-width: 575.98px) {
    .footer-copyright {
        font-size: 0.8rem;
    }
    .footer-heading {
        margin-bottom: 1rem;
    }
    .footer-links li {
        margin-bottom: 0.75rem;
    }
}
    

a {
  color: var(--brand);
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

a:hover {
  color: var(--brand-600);
}

/* Loading spinner styles */
.loading {
  display: none;
  text-align: center;
  padding: 20px;
}

.loading p {
  margin-top: 10px;
}

/* Result container styles */
.result-container {
  display: none;
}

/* Toast notifications */
#toast-container {
  position: fixed;
  top: 65px;
  right: 10px;
  z-index: 9999;
  display: flex;
  flex-direction: column-reverse;
  gap: 10px;
}

.toast {
  background: white;
  border-radius: 12px;
  padding: 16px 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  min-width: 300px;
  max-width: 400px;
  transform: translateX(100%);
  opacity: 0;
  transition: transform 0.3s ease, opacity 0.3s ease;
  position: relative;
  overflow: hidden;
  border-left: 4px solid var(--brand);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast-success {
  border-left-color: #10ac84;
}

.toast-error {
  border-left-color: #e74c3c;
}

.toast-warning {
  border-left-color: #f39c12;
}

.toast-info {
  border-left-color: #3498db;
}

.toast-content {
  display: flex;
  align-items: center;
  width: 100%;
}

.toast-icon {
  margin-right: 12px;
  font-size: 20px;
}

.toast-success .toast-icon {
  color: #10ac84;
}

.toast-error .toast-icon {
  color: #e74c3c;
}

.toast-warning .toast-icon {
  color: #f39c12;
}

.toast-info .toast-icon {
  color: #3498db;
}

.toast-message {
  flex: 1;
  font-weight: 500;
  font-size: 14px;
  color: #2d3748;
}

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  width: 100%;
  background: rgba(0, 0, 0, 0.1);
  transform: scaleX(1);
  transform-origin: left;
  animation: toastProgress 3s linear forwards;
}

.toast-success .toast-progress {
  background: linear-gradient(to right, #10ac84, #0d916b);
}

.toast-error .toast-progress {
  background: linear-gradient(to right, #e74c3c, #c0392b);
}

.toast-warning .toast-progress {
  background: linear-gradient(to right, #f39c12, #e67e22);
}

.toast-info .toast-progress {
  background: linear-gradient(to right, #3498db, #2980b9);
}

@keyframes toastProgress {
  from { transform: scaleX(1); }
  to { transform: scaleX(0); }
}

    /* Positions the new icon relative to the card */
.gpa-result-card {
  position: relative;
}

/* Styles the new copy icon */
.copy-icon-btn {
  position: absolute;
  top: 1.25rem;
  right: 1.25rem;
  font-size: 1.2rem;
  color: #10ac84; /* Green color */
  cursor: pointer;
  transition: all 0.2s ease;
}
.copy-icon-btn:hover {
  transform: scale(1.15);
}

/* GPA Result Display */
.gpa-result-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  margin-top: 2rem;
  width: 70%;
  margin-left: auto;
  margin-right: auto;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.gpa-result-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.semester-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 1.5rem;
  position: relative;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.semester-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-hover);
}

.delete-semester {
  position: absolute;
  top: 1rem;
  right: 1rem;
  cursor: pointer;
  color: #dc3545;
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.delete-semester:hover {
  transform: scale(1.2);
}

.add-course-btn {
  position: absolute;
  top: 1rem;
  right: 3rem;
  cursor: pointer;
  color: var(--brand);
  font-size: 1.2rem;
  z-index: 10;
  transition: all 0.3s ease;
}

.add-course-btn:hover {
  transform: scale(1.2);
}

.course-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.course-table th, .course-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid rgba(229, 231, 235, 0.5);
}

.course-table th {
  font-weight: 600;
  color: var(--muted);
  background: rgba(122, 106, 216, 0.05);
}

.grade-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-weight: 600;
  font-size: 0.75rem;
}

.grade-A { background-color: rgba(220, 252, 231, 0.7); color: #166534; }
.grade-B { background-color: rgba(219, 234, 254, 0.7); color: #1e40af; }
.grade-C { background-color: rgba(254, 243, 199, 0.7); color: #92400e; }
.grade-D { background-color: rgba(254, 226, 226, 0.7); color: #991b1b; }
.grade-F { background-color: rgba(243, 244, 246, 0.7); color: #374151; }

.extra-enrolled {
  background-color: rgba(255, 193, 7, 0.2);
  color: #856404;
  padding: 1px 5px;
  border-radius: 4px;
  font-size: 0.65rem;
  font-weight: 600;
  vertical-align: super;
}

.course-details-modal .modal-content {
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.course-details-modal .modal-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
}

.calculate-cgpa-btn {
  margin-top: 1rem;
  display: none;
}

/* Add Course Form */
.add-course-form {
  background: rgba(248, 249, 250, 0.7);
  border-radius: 0.5rem;
  padding: 1.5rem;
  margin-top: 1rem;
  display: none;
  backdrop-filter: blur(10px);
}

.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

.form-group {
  flex: 1;
  min-width: 200px;
}

    /* Styling for the collapsible chart header */
#gpaChartChevron {
  transition: transform 0.3s ease-in-out;
}
a[aria-expanded="true"] #gpaChartChevron {
  transform: rotate(180deg);
}
[data-theme="dark"] #gpaChartContainer .text-body {
    color: var(--text) !important;
}


    /* NEW: Modern Calculator Section Styles */
.calculator-section-modern {
  padding: 3rem 2rem;
  backdrop-filter: blur(10px);
  margin-bottom: 2rem;
}


.search-and-profiles-container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.modern-search-wrapper {
  position: relative;
  width: 100%;
}

/* --- UPDATE: Professional Search Input --- */
.modern-search-input {
  border-radius: 50px !important;
  padding: 1rem 1.5rem !important;
  font-size: 1.1rem;
  box-shadow: var(--shadow);
  border: 2px solid transparent;
  /* Add padding to the right to make space for the button */
  padding-right: 170px !important;
}

.modern-search-input:focus {
  border-color: var(--brand);
  box-shadow: var(--shadow-hover);
}

/* --- UPDATE: Professional Search Button --- */
.modern-search-button {
  position: absolute;
  top: 50%;
  right: 6px; /* Space from edge */
  transform: translateY(-50%);
  border-radius: 50px; /* Match input pill shape */
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.25rem; /* Professional padding */
  transition: all 0.3s ease;
  height: calc(100% - 12px); /* Make button slightly smaller than input */
  line-height: 1; /* Ensure text/icon aligns well */
}

.modern-search-button:hover {
  transform: translateY(-50%) scale(1.02); /* Softer transform */
  box-shadow: var(--shadow-hover);
}

/* --- UPDATE: Mobile styles for Search Button/Input --- */
@media (max-width: 767.98px) {
  .modern-search-input {
    padding-right: 70px !important; /* Space for just the icon button */
  }
  .modern-search-button {
    width: 48px; /* Back to circle on mobile */
    height: 48px;
    padding: 0;
    right: 8px;
    border-radius: 50%; /* Back to circle */
  }
}


.modern-profiles-wrapper {
  width: 100%;
}

.modern-profiles-select {
  border-top-left-radius: 0 !important;
  border-bottom-left-radius: 0 !important;
  text-overflow: ellipsis; /* Add ellipsis for very long text */
  padding-right: 2.5rem;   /* Add padding to avoid overlap with arrow */
}

.modern-profiles-icon {
  border-top-left-radius: .85rem !important;
  border-bottom-left-radius: .85rem !important;
  background-color: rgba(122, 106, 216, 0.1);
  color: var(--brand);
}

.modern-delete-button {
    border-top-right-radius: .85rem !important;
    border-bottom-right-radius: .85rem !important;
}

/* ADD THIS CSS FOR THE ANNOUNCEMENT BAR */
.announcement-bar {
  background: var(--brand-gradient);
  color: white;
  padding: 0.75rem 0;
  overflow: hidden;
  white-space: nowrap;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.announcement-track {
  display: inline-block;
  animation: scroll-left 30s linear infinite;
}

.announcement-text {
  display: inline-block;
  font-weight: 500;
  margin: 0 2.5rem; /* Spacing between tips */
  opacity: 0.9;
}

@keyframes scroll-left {
  0% {
    transform: translateX(0%);
  }
  100% {
    transform: translateX(-50%); /* This value should be -50% because the content is duplicated */
  }
}
    @media (max-width: 576px) {
  .announcement-bar {
    padding: 0.25rem 0;
    font-size: 14px;
  }
}

/* Aligned Action Buttons */
.action-buttons-aligned {
  display: flex;
  justify-content: center; /* This is the key change */
  align-items: center;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}
/* --- UPDATE: Use var(--radius-btn) --- */
.action-buttons-aligned .btn {
  border-radius: var(--radius-btn);
}
@media (max-width: 576px) {
  .action-buttons-aligned {
    justify-content: center; /* Stack them in the center on mobile */
  }
  .action-buttons-aligned .btn {
    flex-grow: 1; /* Make buttons take equal space on mobile */
    min-width: 140px; /* Ensure they don't get too small */
  }
}

/* Collapsible Status Log Icon */
.status-log-chevron {
  transition: transform 0.3s ease-in-out;
}
a[aria-expanded="true"] .status-log-chevron {
  transform: rotate(180deg);
}


#openProfileManagerBtn {
    border-top-right-radius: .85rem !important;
    border-bottom-right-radius: .85rem !important;
    border-left: 0;
}

    /* ADD THIS CSS FOR THE PREMIUM CGPA DISPLAY */
.gpa-result-card-premium {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: var(--shadow);
  margin-bottom: 2rem;
  margin-top: 2rem;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
[data-theme="dark"] .gpa-result-card-premium {
  background: rgba(26, 32, 48, 0.8);
}
.gpa-result-card-premium:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.student-info-header {
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.2);
  padding-bottom: 1.5rem;
}
.student-info-header h2 {
  font-size: 1.5rem;
}

.cgpa-dashboard {
  display: flex;
  justify-content: center;
  margin-bottom: 2rem;
}

.cgpa-progress-circle {
  width: 180px;
  height: 180px;
  position: relative;
}
.cgpa-progress-circle svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}
.cgpa-progress-circle .circle-bg {
  fill: none;
  stroke: rgba(122, 106, 216, 0.15);
  stroke-width: 3.8;
}
[data-theme="dark"] .cgpa-progress-circle .circle-bg {
    stroke: rgba(122, 106, 216, 0.2);
}
.cgpa-progress-circle .circle {
  fill: none;
  stroke: var(--brand);
  stroke-width: 3.8;
  stroke-linecap: round;
  transition: stroke-dasharray 1s ease-in-out;
}

.cgpa-progress-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.cgpa-progress-text .cgpa-value {
  font-size: 2rem;
  font-weight: 700;
  line-height: 1;
  color: var(--brand);
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.cgpa-progress-text .cgpa-label {
  display: block;
  font-size: 1rem;
  font-weight: 500;
  color: var(--muted);
  margin-top: 0.25rem;
}

.secondary-stats {
  display: flex;
  justify-content: center;
  gap: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(122, 106, 216, 0.2);
}
.stat-item {
  text-align: center;
}
.stat-label {
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--muted);
  display: block;
  margin-bottom: 0.5rem;
}
.stat-value {
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--text);
}
[data-theme="dark"] .stat-value {
    color: #e5e7eb;
}
.stat-sub-value {
    font-size: 1rem;
    color: var(--muted);
}
.stat-divider {
  width: 1px;
  background: rgba(122, 106, 216, 0.2);
}

@media (max-width: 576px) {
  .gpa-result-card-premium {
    padding: 1.5rem;
  }
  .cgpa-progress-circle {
    width: 150px;
    height: 150px;
  }
  .cgpa-progress-text .cgpa-value {
    font-size: 1.70rem;
  }
  .secondary-stats {
    gap: 1rem;
  }
  .stat-value {
    font-size: 1.25rem;
  }
}


/* ----------- DARK MODE IMPROVED ----------- */
[data-theme="dark"] {
  --text: #e5e7eb;
  --text-light: #d1d5db;
  --muted: #9ca3af;
}

[data-theme="dark"] body {
  background: linear-gradient(180deg, #0b0e13 0%, #0f1320 70%);
  color: #f1f5f9;
}

[data-theme="dark"] .navbar {
  background-color: rgba(17, 24, 39, 0.8);
}

[data-theme="dark"] .navbar .nav-link {
  color: #d1d5db;
}

[data-theme="dark"] .navbar .nav-link:hover {
  color: #fff;
}

[data-theme="dark"] .card-modern {
  background: rgba(15, 20, 34, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] .card-modern .card-header {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
}

[data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4, [data-theme="dark"] h5 {
  color: #ffffff;
}

[data-theme="dark"] .lead {
  color: #9ca3af;
}

/* --- UPDATE: Make subtitle visible in dark mode --- */
[data-theme="dark"] .calculator-section-modern .text-muted {
    color: var(--text-light) !important;
}

[data-theme="dark"] .subject-row {
  background: rgba(26, 31, 46, 0.8);
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] label {
  color: #e5e7eb;
}

[data-theme="dark"] .form-control, [data-theme="dark"] .form-select {
  background: rgba(11, 16, 32, 0.8);
  color: #f1f5f9;
  border-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] .form-control::placeholder {
  color: #9ca3af;
}

[data-theme="dark"] .form-text {
  color: var(--muted);
}

[data-theme="dark"] .input-group-text {
  background: rgba(31, 41, 55, 0.8);
  color: #e5e7eb;
}

[data-theme="dark"] a {
  color: rgb(158, 141, 240);
}

[data-theme="dark"] a:hover {
  color: #9f8df0;
}

[data-theme="dark"] .status-log {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .status-line {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .gpa-result-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .semester-card {
  background: rgba(26, 32, 48, 0.8);
}

[data-theme="dark"] .course-table th,
[data-theme="dark"] .course-table td {
  border-bottom-color: rgba(45, 55, 72, 0.5);
}

[data-theme="dark"] .course-table th {
  background: rgba(122, 106, 216, 0.1);
}

[data-theme="dark"] .add-course-form {
  background: rgba(26, 31, 46, 0.8);
}

[data-theme="dark"] .loading-container {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.15), rgba(122, 106, 216, 0.08));
}

[data-theme="dark"] .grade-A { background-color: rgba(21, 128, 61, 0.3); color: #86efac; }
[data-theme="dark"] .grade-B { background-color: rgba(30, 64, 175, 0.3); color: #93c5fd; }
[data-theme="dark"] .grade-C { background-color: rgba(146, 64, 14, 0.3); color: #fed7aa; }
[data-theme="dark"] .grade-D { background-color: rgba(153, 27, 27, 0.3); color: #fecaca; }
[data-theme="dark"] .grade-F { background-color: rgba(55, 65, 81, 0.3); color: #d1d5db; }

/* Dark mode for modals */
[data-theme="dark"] .modal-content {
    background: rgba(26, 32, 48, 0.95);
    color: #e5e7eb;
}
[data-theme="dark"] .modal-header {
    background: linear-gradient(135deg, rgba(122, 106, 216, 0.3), rgba(122, 106, 216, 0.15));
    border-bottom-color: rgba(45, 55, 72, 0.5);
}
[data-theme="dark"] .modal-header .btn-close {
    filter: invert(1);
}
[data-theme="dark"] .alert-info {
  background-color: rgba(23, 162, 184, 0.2);
  border-color: rgba(23, 162, 184, 0.3);
  color: #71d4f0;
}
[data-theme="dark"] .alert-warning {
  background-color: rgba(255, 193, 7, 0.2);
  border-color: rgba(255, 193, 7, 0.3);
  color: #ffd351;
}

/* Dark mode contrast improvements */
[data-theme="dark"] .text-body-secondary {
  color: #d1d5db !important;
}

[data-theme="dark"] .btn-primary-action {
  color: #ffffff !important;
}

.cursor-dot {
  position: fixed;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--brand);
  pointer-events: none;
  transform: translate(-50%, -50%);
  opacity: .7;
  mix-blend-mode: multiply;
  z-index: 9999;
  transition: all 0.1s ease;
}

[data-theme="dark"] .cursor-dot {
  mix-blend-mode: screen;
}

/* Course action buttons */
.course-actions i {
  cursor: pointer;
  font-size: 14px;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.delete-course {
  color: #dc3545;
}

.delete-course:hover {
  background-color: rgba(220, 53, 69, 0.1);
  transform: scale(1.2);
}

.restore-course {
  color: #10ac84;
}

.restore-course:hover {
  background-color: rgba(16, 172, 132, 0.1);
  transform: scale(1.2);
}

/* Clickable info icon */
.clickable-info {
  cursor: pointer;
  color: var(--brand);
  transition: all 0.3s ease;
}

.clickable-info:hover {
  opacity: 0.8;
  transform: scale(1.1);
}


/* Restore the original horizontal margin for the icon */
.course-code-container .fa-info-circle {
    margin-left: 0.3rem !important;
}

/* --- Mobile responsive adjustments --- */
@media (max-width: 575.98px) {
  .hero {
    padding: 2rem 0;
  }
  .hero h1 {
    font-size: 2.2rem !important;
  }
  /* --- UPDATE: Removed width: 100% --- */
  .d-flex.gap-2 .btn {
    max-width: 300px;
    margin-bottom: 0.5rem;
  }
  .toast {
    min-width: 250px;
    max-width: 300px;
    padding: 12px 16px;
  }
  .toast-message {
    font-size: 0.75rem;
  }
  .card-modern .card-header {
    padding: 1rem 1.25rem;
  }
  #themeToggle {
    font-size: 0.8rem; /* Adjust the font size to make the icon smaller */
    padding: 0.3rem 0.6rem; /* Adjust padding to make the button smaller */
  }
}

/* Ensure subject columns are 2-up on very small screens: change from col-12 col-md-6 -> col-6 col-md-6 */
@media (max-width: 420px) {
  .subject-row .col-6 {
    padding-right: .4rem;
    padding-left: .4rem;
  }
}

/* UPDATED: Narrow calculator container on desktop */
@media (min-width: 992px) {
  #Auto-Calculator .col-md-10 {
    width: 100%;
  }
}

@media (min-width: 992px) {
  .navbar-expand-lg .navbar-nav .nav-link {
    padding-right: var(--bs-navbar-nav-link-padding-x);
    margin-right: 20px;
  }
}

@media (min-width: 992px) {
  .offset-lg-1 {
    margin-left: 5%;
  }
}

@media (min-width: 768px) {
  .col-md-10 {
    flex: 0 0 auto;
    width: 100%;
  }
}

@media (min-width: 768px) {
  .col-md-4 {
    flex: 0 0 auto;
    width: 50%;
  }
}
    
    
@media (min-width: 768px) {
  .col-md-7 {
    flex: 0 0 auto;
    width: 20%;
  }
}

/* --- Mobile responsive table --- */
@media screen and (max-width: 768px) {
  body {
    font-size: 0.9rem;
  }
  .gpa-result-card {
    width: 95%;
    padding: 1.25rem;
  }
  .course-code-container .fa-info-circle {
    display: none;
  }
  .semester-card {
    padding: 1.25rem;
    max-width: 420px;
  }
  .semester-card h5 {
    font-size: 0.9rem;
  }
  .semester-card .text-end .small {
    font-size: 0.65rem;
  }
  .custom-course-btn {
    padding: 4px 8px;
    font-size: 0.7rem;
    margin-top: 5px;
  }
  .course-table {
    font-size: 0.65rem;
  }
  /* Reduce padding to decrease gaps between columns */
  .course-table th, .course-table td {
    padding: 0.75rem 0.4rem; /* Reduced horizontal padding */
  }
  .course-table td:first-child {
    font-size: 0.7rem;
    font-weight: 500;
  }
  /* Make grade text smaller */
  .grade-badge {
    font-size: 0.6rem;
    padding: 0.2rem 0.35rem;
  }
  .btn {
    padding: 0.6rem 0.9rem;
    font-size: 0.9rem;
  }
  .loading-animation {
    width: 50px;
    height: 50px;
  }
  .loading-text {
    font-size: 0.9rem;
  }
  .loading-subtext {
    font-size: 0.75rem;
  }
  .cgpa-main-info h2 {
    font-size: 1.3rem;
  }
  .cgpa-metric-value {
    font-size: 1.35rem;
  }
  .action-buttons .btn {
    font-size: 0.75rem;
    padding: 0.6rem 0.4rem;
  }
  /* Table alignment rules */
  .course-table th:nth-child(n+3),
  .course-table td:nth-child(n+3) {
      text-align: center;
  }
  .course-table th:nth-child(1), .course-table td:nth-child(1),
  .course-table th:nth-child(2), .course-table td:nth-child(2) {
      text-align: left;
  }
}

/* Center buttons only in specific sections */
.scraping-section .center-buttons,
.log-section .center-buttons {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

@media (max-width: 576px) {
  .scraping-section .center-buttons,
  .log-section .center-buttons {
    flex-direction: column;
    align-items: center;
  }

  .scraping-section .center-buttons .btn,
  .log-section .center-buttons .btn {
    width: auto;
    min-width: 180px;
  }
}

/* New layout improvements */
.results-section {
  margin-top: 2rem;
}

.student-info-section {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.student-details {
  flex: 1;
  min-width: 300px;
}

.cgpa-display {
  flex: 0 0 auto;
  text-align: right;
  min-width: 200px;
}

.action-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  justify-content: center;
}

@media (max-width: 768px) {
  .student-info-section {
    flex-direction: column;
    gap: 1rem;
  }

  .cgpa-display {
    text-align: left;
    margin-top: 1rem;
  }

  .action-buttons {
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
    align-items: center;
  }

  .action-buttons .btn {
    flex-grow: 1;
    margin: 0 0.25rem;
    min-width: auto;
  }
}

/* Section separators */
.section-container {
  margin-bottom: 2rem;
}

.section-title {
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(122, 106, 216, 0.3);
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 60px;
  height: 2px;
  background: var(--brand-gradient);
}

/* Student info logo style */
.student-info-logo {
  background: linear-gradient(135deg, rgba(122, 106, 216, 0.2), rgba(122, 106, 216, 0.1));
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 1rem;
  transition: all 0.3s ease;
}

.student-info-logo:hover {
  transform: rotate(15deg);
}

.student-info-logo i {
  font-size: 1.5rem;
  color: var(--brand);
}

/* Desktop-specific smaller text for semester sections */
@media (min-width: 992px) {
  .semester-card {
    font-size: 0.95rem;
  }

  .semester-card h5 {
    font-size: 1.15rem;
  }

  .course-table {
    font-size: 0.9rem;
  }
}

/* Semester section layout improvements */
.semester-results-container {
  width: 100%;
}

.semester-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
  width: 100%;
}

@media (min-width: 992px) {
  .semester-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* NEW STYLES FOR UPDATES */
.repeated-badge {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ffc107;
  color: #856404;
  font-size: 8px;
  padding: 2px 4px;
  border-radius: 3px;
  font-weight: bold;
}

/* --- UPDATE: Use var(--radius-btn) --- */
.custom-course-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  border-radius: var(--radius-btn);
  padding: 8px 12px;
  font-size: 0.9rem;
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.custom-course-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-2px);
}

.undo-notification {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(51, 51, 51, 0.9);
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  width: calc(100% - 40px);
  max-width: 400px;
  justify-content: space-between;
}

.undo-btn {
  background: var(--brand-gradient);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.undo-btn:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-1px);
}
@media (max-width: 576px) {
  .undo-notification {
    bottom: 70px; /* Raise it above mobile browser UI */
    padding: 10px 15px;
    font-size: 0.9rem;
    flex-direction: column;
    gap: 8px;
    text-align: center;
  }
  .undo-btn {
    width: 100%;
    padding: 6px 10px;
  }
}


/* Updated CGPA Display Layout */
.cgpa-display-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}

.cgpa-main-info {
  text-align: center;
  width: 100%;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.3);
}

.cgpa-metrics-row {
  display: flex;
  justify-content: space-between;
  width: 100%;
  gap: 1rem;
}

.cgpa-metric {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
}

.cgpa-metric-left {
  align-items: flex-start;
}

.cgpa-metric-center {
  align-items: center;
}

.cgpa-metric-right {
  align-items: flex-end;
}

.cgpa-metric-label {
  font-size: 1rem;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.cgpa-metric-value {
  font-size: 1.75rem;
  font-weight: 650;
  color: var(--brand);
  line-height: 1.2;
  background: var(--brand-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.cgpa-metric-subvalue {
  font-size: 0.9rem;
  color: var(--muted);
}

/* --- Mobile responsive adjustments for CGPA --- */
@media (max-width: 768px) {
  .cgpa-metrics-row {
    flex-direction: column;
    gap: 1.5rem;
  }

  .cgpa-metric {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(122, 106, 216, 0.1);
  }

  .cgpa-metric:last-child {
    border-bottom: none;
  }

  .cgpa-metric-left,
  .cgpa-metric-center,
  .cgpa-metric-right {
    align-items: center;
  }

  .cgpa-metric-label {
    margin-bottom: 0;
    min-width: 100px;
    text-align: left;
  }

  .cgpa-metric-value-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .semester-grid {
    display: block;
  }
}

/* Contact form improvements */
#contact-form {
  background: rgba(255, 255, 255, 0.5);
  padding: 2rem;
  border-radius: var(--radius);
  backdrop-filter: blur(10px);
}

[data-theme="dark"] #contact-form {
  background: rgba(26, 32, 48, 0.5);
}

/* Animation for form elements */
.form-control, .form-select {
  transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
  transform: translateY(-2px);
}

/* Pulse animation for important elements */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 2s infinite;
}

/* Floating animation */
@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}

.float {
  animation: float 3s ease-in-out infinite;
}

/* Improved scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.1);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--brand);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-track {
  background: rgba(122, 106, 216, 0.2);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: var(--brand-600);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--brand);
}

/* NEW STYLES FOR ADDED FEATURES */

/* Back to Top Button */
#backToTop {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--brand-gradient);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(122, 106, 216, 0.3);
  z-index: 1000;
}

#backToTop.visible {
  opacity: 1;
  visibility: visible;
}

#backToTop:hover {
  background: var(--brand-gradient-hover);
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(122, 106, 216, 0.4);
}

/* Gradient Text Animation */
.gradient-text {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}

@keyframes gradient-text {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Why Choose Section */
.why-choose-section {
  padding: 5rem 0;
}

.why-choose-section .text-center {
  margin-bottom: 4rem;
}

.why-choose-section h2 {
  font-weight: 800;
  margin-bottom: 1rem;
}

.why-choose-section .lead {
  color: var(--text-light);
  font-size: 1.25rem;
}

.feature-card {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius);
  padding: 2rem;
  height: 100%;
  text-align: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
}

.feature-card:hover {
  transform: translateY(-10px);
  box-shadow: var(--shadow-hover);
}

.feature-icon {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1.5rem;
  background: var(--brand-gradient);
  color: white;
  font-size: 1.5rem;
  transition: all 0.3s ease;
}

.feature-card:hover .feature-icon {
  transform: scale(1.1) rotate(5deg);
}

.feature-card h5 {
  font-weight: 700;
  margin-bottom: 1rem;
  color: var(--text);
}

.feature-card p {
  color: var(--text-light);
}

/* Dark mode for Why Choose section */
[data-theme="dark"] .why-choose-section {
  background: transparent; /* Inherit from body gradient */
}

[data-theme="dark"] .feature-card {
  background: rgba(15, 20, 34, 0.8);
}

[data-theme="dark"] .feature-card h5 {
  color: #ffffff;
}

[data-theme="dark"] .feature-card p.text-muted {
    color: var(--muted) !important;
}
[data-theme="dark"] .why-choose-section .lead.text-muted {
    color: var(--text-light) !important;
}


/* Hide Why Choose section on mobile */
@media (max-width: 991.98px) {
  .why-choose-section {
    display: none;
  }
}


    /* --- NEW: B.Ed. Tab Styles --- */
#bedTab {
  border-bottom: 3px solid rgba(122, 106, 216, 0.2);
  margin-bottom: 1.5rem;
}

#bedTab .nav-link {
  font-weight: 600;
  font-size: 1.1rem;
  color: var(--muted);
  border: none;
  border-bottom: 3px solid transparent;
  padding-bottom: 1rem;
  transition: all 0.3s ease;
}

#bedTab .nav-link.active {
  color: var(--brand);
  border-bottom-color: var(--brand);
  background-color: transparent;
}

#bedTab .nav-link:hover:not(.active) {
  color: var(--text);
  border-bottom-color: rgba(122, 106, 216, 0.5);
}

[data-theme="dark"] #bedTab {
  border-bottom-color: rgba(122, 106, 216, 0.3);
}

[data-theme="dark"] #bedTab .nav-link.active {
  color: #fff;
}
/* --- End of B.Ed. Tab Styles --- */
    
    

/* Animation for hero text */
.hero-text-gradient {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}


/* Animation for robot icon */
.robot-icon-gradient {
  background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--accent), var(--brand-primary));
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-text 3s ease infinite;
}

/* PDF Download Button */
.btn-pdf-download {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  border: 0;
  box-shadow: 0 6px 18px rgba(231, 76, 60, 0.2);
  cursor: pointer;
  transition: all 0.3s ease;
  border-radius: var(--radius-btn); /* Consistent radius */
}

.btn-pdf-download:hover {
  background: linear-gradient(135deg, #ff6b6b 0%, #e74c3c 100%);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
}

/* Action buttons container */
.action-buttons {
  display: flex;
  justify-content: center; /* Center the single button */
  align-items: center;
  margin-top: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

/* Center Registration Number Input */
.scraping-section .mb-3 {
    text-align: center;
}
.scraping-section #registrationNumber {
    max-width: 350px;
    margin: 0 auto;
    text-align: center;
}

/* Drag and Drop Styles (Desktop Only) */
@media (min-width: 992px) {
  .course-table tbody tr {
    cursor: grab;
  }
  .course-table tbody tr.dragging {
    opacity: 0.5;
    background: #e9e6f8;
  }
  .semester-card.drag-over {
    border: 2px dashed var(--brand);
    transform: scale(1.02);
    background-color: rgba(122, 106, 216, 0.1);
  }
  [data-theme="dark"] .semester-card.drag-over {
    background-color: rgba(122, 106, 216, 0.2);
  }
}

/* NEW: Scroll Animation Styles */
.fade-in-on-scroll {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}
.fade-in-on-scroll.is-visible {
  opacity: 1;
  transform: translateY(0);
}

/* NEW: Forecast/Info Button Style */
.btn-info-action {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  border: 0;
  cursor: pointer;
  transition: all 0.3s ease;
  border-radius: var(--radius-btn); /* Consistent radius */
}
.btn-info-action:hover {
  background: linear-gradient(135deg, #5dade2 0%, #3498db 100%);
  color: white;
  transform: translateY(-2px);
}

/* NEW: Profile Manager Styles */
.profile-manager-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(122, 106, 216, 0.2);
    margin-bottom: 1rem;
}
.profile-manager-stats {
    font-size: 0.85rem;
    color: var(--muted);
}
.profile-manager-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
    margin-bottom: 1rem;
}
.profile-list {
    list-style: none;
    padding: 0;
    max-height: 50vh;
    overflow-y: auto;
}
.profile-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    border-radius: 0.75rem;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid rgba(122, 106, 216, 0.1);
    position: relative;
    background-color: rgba(98, 71, 255, 0.02);
    margin-bottom: 10px;
}
.profile-item:last-child {
    border-bottom: none;
}
.profile-item:hover {
    background-color: rgba(122, 106, 216, 0.05);
}
[data-theme="dark"] .profile-item:hover {
    background-color: rgba(122, 106, 216, 0.1);
}
.profile-item .form-check-input {
    margin-top: 0;
    transform: scale(1.2);
}
.profile-item-details {
    flex-grow: 1;
    margin-left: 1rem;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0 1rem;
}
.profile-item-name {
    grid-column: 1 / -1;
    font-weight: 600;
    color: var(--text);
}
.profile-item-meta {
    font-size: 0.8rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.profile-item-actions {
    display: flex;
    gap: 0.5rem;
}
.profile-item-actions .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.8rem;
}

/* Custom Confirmation Modal */
.confirmation-modal .modal-content {
    border-radius: var(--radius);
}
.confirmation-modal .modal-header {
    border-bottom: none;
}
.confirmation-modal .modal-body {
    text-align: center;
}
.confirmation-modal .modal-body .fa-triangle-exclamation {
    font-size: 2.5rem;
    color: #f39c12;
}
.confirmation-modal .modal-footer {
    border-top: none;
    justify-content: center;
}

/* Mobile adjustments for Profile Manager */
@media (max-width: 767.98px) {
    .profile-manager-toolbar {
        flex-direction: row; /* Keep in a row */
        justify-content: space-between; /* Space out items */
        align-items: center; /* Align vertically */
    }
    .profile-manager-toolbar .ms-auto {
        margin-left: 0 !important; /* Remove margin */
        width: auto; /* Allow natural width */
        margin-top: 0; /* Remove top margin */
        display: flex;
        gap: 0.5rem; /* Reduce gap */
    }
    /* --- UPDATE: Removed padding override --- */
    .profile-manager-toolbar .btn {
        font-size: 0.8rem;
        /* Removed padding rule */
    }

    .profile-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
    }
    .profile-item .form-check-input {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
    }
    .profile-item-details {
        margin-left: 0;
        grid-template-columns: 1fr; /* Stack details vertically */
        gap: 0.25rem;
    }
    .profile-item-actions {
        width: 100%;
        justify-content: space-around;
        border-top: 1px solid rgba(122, 106, 216, 0.1);
        padding-top: 0.75rem;
    }
}

/* --- NEW & UNIFIED: Image Lightbox Styles (All Devices) --- */

.zoomable-image-container {
  position: relative;
  overflow: hidden; /* Contain elements */
  border-radius: 0.75rem; /* Match card style */
  display: block; /* Ensure it behaves like a block */
  line-height: 0; /* Prevent extra space below image */
  cursor: pointer; /* Indicate clickability */
}

.zoomable-image-container img#qpTableImage {
  display: block; /* Ensure image behaves predictably */
  width: 100%;   /* Make image fill container width */
  height: auto;  /* Maintain aspect ratio */
  max-width: 100%; /* Ensure it doesn't overflow container */
  border-radius: 0.75rem; /* Match container */
}

/* Hide desktop-specific elements if they exist (cleanup) */
.zoom-loupe, .zoom-box { display: none !important; }

/* "Click to zoom" icon (Applies to all devices now) */
.zoomable-image-container::after {
  content: '\f00e'; /* FontAwesome zoom-in icon */
  font-family: 'Font Awesome 6 Free';
  font-weight: 900;
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0,0,0,0.5);
  color: white;
  padding: 8px 10px;
  border-radius: 5px;
  font-size: 1.1rem;
  z-index: 5;
  pointer-events: none; /* Don't block the click */
  opacity: 0.8;
  transition: opacity 0.2s ease;
}
.zoomable-image-container:hover::after {
    opacity: 1;
}

/* --- Lightbox Styles --- */

/* Background */
.image-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(5px);
  z-index: 1070;
  display: none; /* Changed from flex to none */
  opacity: 0;
  transition: opacity 0.3s ease;
  overflow: hidden; /* Prevent body scroll */
}
.image-lightbox.show {
  display: flex; /* Use flex to center when shown */
  align-items: center;
  justify-content: center;
  opacity: 1;
}

/* Content area (holds the image) */
.lightbox-content {
  width: 100%;
  height: 100%;
  position: relative; /* Crucial for image positioning */
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden; /* Container doesn't scroll/pan */
}

/* Image inside lightbox */
.lightbox-content img#lightboxImage {
  display: block;
  /* Start unzoomed */
  max-width: 95%;
  max-height: 95%;
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 5px;
  cursor: grab; /* Default cursor inside */
  /* Transitions and touch actions */
  transition: transform 0.15s ease-out; /* Smooth transforms */
  touch-action: none; /* Essential for custom touch handling */
  user-select: none;
  -webkit-user-drag: none;
  transform-origin: center center; /* Default origin */
}

/* Style for when desktop hover-zoom is active */
.lightbox-content.desktop-zoom-active img#lightboxImage {
    cursor: crosshair; /* Indicate zoom region */
    /* Set transform origin dynamically via JS */
}

/* Close Button */
.lightbox-close-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border: none;
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  z-index: 1071;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}
.lightbox-close-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: rotate(90deg);
}
    
    

    

/* --- Z-index and Blur for modals --- */
#renameProfileModal, #confirmationModal, #attendanceImportModal {
  z-index: 1060; /* Higher z-index to appear on top */
}
/* When rename or confirm modal is open, apply blur to profile manager */
#profileManagerModal.blur-backdrop {
  filter: blur(4px);
  transition: filter 0.15s linear;
}

/* --- Profile data buttons --- */
.profile-data-buttons {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 1rem;
}
/* --- UPDATE: Use var(--radius-btn) --- */
.profile-data-buttons .btn {
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-btn);
}
/* --- Mobile styles for Import/Export buttons --- */
@media (max-width: 575.98px) {
    .profile-data-buttons {
        flex-direction: row; /* Keep in row */
        gap: 0.5rem; /* Reduce gap */
        justify-content: center; /* Center horizontally */
    }
    .profile-data-buttons .btn {
        width: auto; /* Allow natural width */
        max-width: none;
        font-size: 0.8rem; /* Slightly smaller */
        padding: 0.5rem 0.8rem; /* Adjust padding */
        flex-grow: 1; /* Allow buttons to grow equally */
        max-width: 50%; /* Limit width to half */
    }
}
/* NEW: Styles for Attendance Import Modal */
.attendance-course-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem;
  border-bottom: 1px solid rgba(122, 106, 216, 0.1);
}
.attendance-course-item:last-child {
  border-bottom: none;
}
.attendance-course-item .form-check {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.attendance-course-item .form-check-label {
  line-height: 1.3;
}
.attendance-course-item .form-check-label small {
  font-size: 0.8rem;
}
.attendance-course-item .import-ch-select {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.attendance-course-item .import-ch-select .form-select {
  width: 80px;
  padding-top: 0.25rem;
  padding-bottom: 0.25rem;
  font-size: 0.9rem;
}

@media (max-width: 576px) {
  .attendance-course-item {
    /* flex-direction: column; <-- REMOVED */
    align-items: center; /* Vertically align items in the row */
    gap: 0.5rem; /* Reduced gap */
    justify-content: space-between; /* Space out checkbox/info and CH selector */
  }
  .attendance-course-item .form-check {
     flex-grow: 1; /* Allow checkbox and text to take available space */
     margin-right: 0.5rem; /* Add some space before CH selector */
  }
  .attendance-course-item .import-ch-select {
    width: auto; /* Let it shrink to content */
    flex-shrink: 0; /* Prevent it from shrinking too much */
    /* justify-content: flex-end; <-- REMOVED (space-between on parent handles it) */
  }
   .attendance-course-item .import-ch-select .form-select {
       width: 65px; /* Slightly smaller width for mobile select */
   }
}
    /* Fix for Dark Mode Text Visibility (Request 6) */
[data-theme="dark"] #faq .lead.text-muted {
    color: var(--text-light) !important;
}

[data-theme="dark"] #attendanceImportModal .text-muted {
    color: var(--text-light) !important;
}
    
  </style>
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CMENQJ4ELS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CMENQJ4ELS');
</script>

<body>

  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MJW7HPPS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="cursor-dot" id="cursorDot"></div>

  <div id="backToTop">
    <i class="fas fa-arrow-up"></i>
  </div>

  <div class="modal fade course-details-modal" id="courseDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="courseDetailsModalTitle">Course Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="courseDetailsModalBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="addCourseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-plus-circle me-2"></i>Add Custom Course</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addCourseForm">
            <input type="hidden" id="addCourseSemester" value="">
            <div class="mb-3">
              <label for="courseCode" class="form-label">Course Code</label>
              <input type="text" class="form-control" id="courseCode" placeholder="e.g., CHEM-101" required>
            </div>
            <div class="mb-3">
              <label for="courseTitle" class="form-label">Course Title</label>
              <input type="text" class="form-control" id="courseTitle" placeholder="e.g., Inorganic Chemistry" required>
            </div>
            <div class="row">
              <div class="col-6 mb-3">
                <label for="creditHours" class="form-label">Credit Hours</label>
                <select class="form-select" id="creditHours" required>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3" selected>3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
              </div>
              <div class="col-6 mb-3">
                <label for="courseMarks" class="form-label">Marks Obtained</label>
                <input type="number" class="form-control" id="courseMarks" min="0" max="100" placeholder="e.g., 75" required>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveCourseBtn">Add Course</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="renameProfileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg"> <div class="modal-header">
          <h5 class="modal-title"><i class="fa-solid fa-pen-to-square me-2"></i>Rename Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="renameProfileForm">
            <div class="mb-3">
              <label for="newProfileName" class="form-label">Profile Name</label>
              <input type="text" class="form-control" id="newProfileName" required>
              <div class="form-text">Give this profile a unique name (e.g., "My Final Year Forecast").</div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="saveProfileNameBtn">Save Name</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="attendanceImportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header d-flex justify-content-between align-items-center w-100">
          <h5 class="modal-title mb-0" id="attendanceModalTitle"><i class="fa-solid fa-clipboard-user me-2"></i>Import Courses</h5>
          <div class="d-flex align-items-center gap-3">
            <span id="attendanceCourseCount" class="small text-muted"></span>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="toggleAllCourses" role="switch">
              <label class="form-check-label small" for="toggleAllCourses">Show All</label>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
        </div>
        <div class="modal-body">
          <p class="text-muted small" id="attendanceModalDescription">The following courses were found in the Attendance System but not in your main LMS results. Select courses to import and set their credit hours.</p>
          
          <div class="d-flex justify-content-between align-items-center py-2 px-3 rounded mb-2" style="background-color: rgba(122, 106, 216, 0.05);">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="toggleSelectAllCourses">
              <label class="form-check-label fw-medium" for="toggleSelectAllCourses">Select All Visible</label>
            </div>
            <span id="attendanceSelectedCount" class="small fw-medium" style="color: var(--brand);">0 Selected</span>
          </div>

          <div id="attendanceCourseList">
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary-action rounded-pill" id="importAttendanceCoursesBtn">Import Selected Courses</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="profileManagerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fa-solid fa-users-gear me-2"></i>Profile Manager</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="profile-manager-header">
                    <h6 class="mb-0">Manage Your Saved Profiles</h6>
                    <div class="profile-manager-stats">
                        <span id="profileCountStat">0 Profiles</span> |
                        <span id="lastBackupStat">Last Backup: Never</span>
                    </div>
                </div>
                <div class="profile-manager-toolbar">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAllProfiles">
                        <label class="form-check-label" for="selectAllProfiles">Select All</label>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-secondary-action btn-sm dropdown-toggle rounded-3" type="button" id="bulkActionsBtn" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                            Bulk Actions
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="bulkActionsBtn">
                            <li><a class="dropdown-item text-danger" href="#" id="deleteSelectedBtn"><i class="fa-solid fa-trash-can me-2"></i>Delete Selected</a></li>
                        </ul>
                    </div>
                    <div class="ms-auto d-flex gap-2">
                         <button class="btn btn-success-action btn-sm rounded-3" id="importProfilesBtnModal"><i class="fa-solid fa-upload me-2"></i>Import</button>
                         <button class="btn btn-info-action btn-sm rounded-3" id="exportProfilesBtnModal"><i class="fa-solid fa-download me-2"></i>Export</button>
                    </div>
                </div>
                <ul class="profile-list" id="profileManagerList">
                    </ul>
            </div>
        </div>
    </div>
  </div>


  <div class="modal fade confirmation-modal" id="bedConfirmationModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <i class="fa-solid fa-graduation-cap mb-3" style="font-size: 2.5rem; color: var(--brand);"></i>
        <h5 class="modal-title mb-2">B.Ed. Courses Detected</h5>
        <p class="text-muted small">We found courses related to the B.Ed. (Bachelor of Education) program in your results.</p>
        <p class="mb-0"><strong>Have you enrolled in the B.Ed. program?</strong></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary-action rounded-pill" id="bedConfirmNo">No, Show All</button>
        <button type="button" class="btn btn-primary-action rounded-pill" id="bedConfirmYes">Yes, Separate B.Ed.</button>
      </div>
    </div>
  </div>
</div>
  

  <div class="modal fade confirmation-modal" id="confirmationModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content">
        <div class="modal-body">
          <i class="fa-solid fa-triangle-exclamation mb-3"></i>
          <h5 class="modal-title mb-2" id="confirmationModalTitle">Are you sure?</h5>
          <p id="confirmationModalBody" class="text-muted small">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary-action rounded-pill" data-bs-dismiss="modal" id="confirmationCancelBtn">Cancel</button>
          <button type="button" class="btn btn-danger-action rounded-pill" id="confirmationConfirmBtn">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg sticky-top border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/">
        <span class="badge rounded-pill badge-brand">UAF</span>
        <span class="gradient-text">CGPA Calculator</span>
      </a>
      <div class="d-flex align-items-center gap-2 order-lg-2">
        <button id="themeToggle" class="btn btn-sm btn-soft rounded-pill" type="button" aria-label="Toggle dark mode" style="margin-bottom: 0.01rem;">
          <i class="fa-solid fa-moon"></i>
        </button>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="mainNav">
  <ul class="navbar-nav ms-auto align-items-lg-center">
    <li class="nav-item">
      <a class="nav-link" href="#Home"
        ><i class="fa-solid fa-house me-2"></i>Home</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#Auto-Calculator"
        ><i class="fa-solid fa-calculator me-2"></i>CGPA Calculator</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#features"
        ><i class="fa-solid fa-star me-2"></i>Features</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#faq"
        ><i class="fa-solid fa-circle-question me-2"></i>FAQ</a
      >
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#contact-us"
        ><i class="fa-solid fa-envelope me-2"></i>Contact</a
      >
    </li>
  </ul>
</div>
    </div>
  </nav>

  <section class="hero" id="Home">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-7">
          <span class="badge rounded-pill badge-brand mb-3">University of Agriculture Faisalabad</span>
          <!-- <h1 class="display-5 mb-3"><span class="hero-text-gradient"><strong>UAF CGPA Calculator 2025</strong></span> by <span class="hero-text-gradient">M Saqlain </span>- Automatic & Accurate</h1> -->
          <!-- <h1 class="display-5 mb-3">Calculate Your <span class="hero-text-gradient">CGPA &amp; Percentage </span>Automatically from <span class="hero-text-gradient"><strong>UAF CGPA Calculator</strong></span></h1> -->
          <h1 class="display-5 mb-3"><span class="hero-text-gradient"><strong>UAF CGPA Calculator 2025</strong></span> by <span class="hero-text-gradient">M Saqlain </span>- Automatic & Accurate</h1>
          <p class="lead mb-4">Enter your <strong>registration number</strong> to fetch your results directly from UAF LMS. The calculator will automatically compute your CGPA and Percentage based on UAF grading system.</p>
          <div class="d-flex gap-2">
            <a href="#Auto-Calculator" class="btn btn-primary-action btn-lg rounded-pill" style="font-size: 1.05rem; padding: 0.9rem;">
              <i class="fa-solid fa-bolt me-2"></i>Try It Now
            </a>
            <a href="#features" class="btn btn-secondary-action rounded-pill" style="display:block; padding:14px">
              <i class="fa-solid fa-star me-2"></i>Features
            </a>
          </div>
        </div>
        <div class="col-lg-5">
            <div class="card card-modern fade-in-on-scroll">
              <div class="card-body p-4">
                <div class="d-flex align-items-center gap-3">
                  <div class="display-6 robot-icon-gradient"><i class="fa-solid fa-award"></i></div>
                  <div>
                    <h3 class="mb-1 fw-bold" style="font-size:22px">50,000+ Students Choose This</h3>
                    <p class="mb-0 text-body-secondary">The #1 CGPA Calculator by M Saqlain.</p>
                  </div>
                </div>
                <hr class="my-4" />
                <ul class="list-unstyled m-0">
                  <li class="d-flex align-items-start gap-2 mb-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>Instant & Automatic:</strong> Fetches official results from LMS & Attendance System by registration number.
                    </div>
                  </li>
                  <li class="d-flex align-items-start gap-2 mb-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>Forecast & Edit:</strong> The *only* calculator to forecast future CGPA, add custom courses, and edit results.
                    </div>
                  </li>
                  <li class="d-flex align-items-start gap-2 mb-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>100% Accurate:</strong> Correctly handles repeated courses (counting only the best attempt) for an official CGPA.
                    </div>
                  </li>
                  <li class="d-flex align-items-start gap-2">
                    <i class="fa-solid fa-check text-success mt-1"></i>
                    <div>
                      <strong>Premium PDF:</strong> Download a professional-style transcript of your results with a single click.
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
      </div>
    </div>
  </section>

  <div class="announcement-bar">
    <div class="announcement-track">
        <span class="announcement-text">
            <i class="fa-solid fa-circle-info me-2"></i>
             Only the highest marks in a repeated course are counted towards your CGPA.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-wand-magic-sparkles me-2"></i>
             Use the 'Forecast Semester' button to plan your future grades.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-arrows-up-down-left-right me-2"></i>
             On desktop, you can drag & drop courses between semesters.
        </span>
      <span class="announcement-text">
            <i class="fa-solid fa-circle-info me-2"></i>
             Only the highest marks in a repeated course are counted towards your CGPA.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-wand-magic-sparkles me-2"></i>
             Use the 'Forecast Semester' button to plan your future grades.
        </span>
        <span class="announcement-text">
            <i class="fa-solid fa-arrows-up-down-left-right me-2"></i>
             On desktop, you can drag & drop courses between semesters.
        </span>
    </div>
</div>
  
  
  <section class="py-5" id="Auto-Calculator" style="padding-bottom: 0rem !important;">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="calculator-section-modern fade-in-on-scroll">
    <div class="text-center mb-4">
      <h2 class="fw-bold">
        <i class="fa-solid fa-calculator me-2 gradient-text"></i>
        <span class="gradient-text">UAF CGPA Calculator</span>
      </h2>
      <p class="text-muted">Enter a registration number or select a saved profile.</p>
    </div>
    <form id="resultForm" class="text-center">
      <div class="search-and-profiles-container">
        <div class="modern-search-wrapper">
          <input
            type="text"
            class="form-control modern-search-input"
            id="registrationNumber"
            placeholder="e.g., 2020-ag-1234"
            required
          />
          <button type="submit" class="btn btn-primary-action modern-search-button">
            <i class="fa-solid fa-cloud-arrow-down"></i>
            <span class="d-none d-md-inline ms-2">Fetch Result</span>
          </button>
        </div>

        <div class="profile-data-buttons">
            <button class="btn btn-success-action btn-sm" type="button" id="importProfilesBtn"><i class="fa-solid fa-upload me-2"></i>Import Profiles</button>
            <button class="btn btn-info-action btn-sm" type="button" id="exportProfilesBtn"><i class="fa-solid fa-download me-2"></i>Export Profiles</button>
        </div>

        <div id="profileManagement" class="modern-profiles-wrapper" style="display: none;">
          <div class="input-group">
            <span class="input-group-text modern-profiles-icon">
              <i class="fa-solid fa-user-check"></i>
            </span>
            <select class="form-select modern-profiles-select" id="profileSwitcher"></select>
            <button class="btn btn-primary-action" type="button" id="openProfileManagerBtn" title="Manage All Profiles">
              <i class="fa-solid fa-users-gear"></i><span class="d-none d-sm-inline ms-1">Manage</span>
            </button>
          </div>
        </div>
      </div>
    </form>
    <div class="loading-container" id="loadingContainer">
      <div class="loading-stage" id="connectingStage"><div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><p class="loading-text">Connecting to UAF LMS</p><p class="loading-subtext">Establishing secure connection to university servers</p></div>
      <div class="loading-stage" id="fetchingStage"><div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><p class="loading-text">Fetching Your Results</p<p class="loading-subtext">Retrieving your academic records from the database</p></div>
      <div class="loading-stage" id="processingStage"><div class="loading-animation loading-connecting"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><p class="loading-text">Processing Data</p<p class="loading-subtext">Analyzing your grades and calculating CGPA</p></div>
      <div class="loading-stage" id="completeStage"><div class="loading-animation loading-complete"><div class="checkmark"></div></div><p class="loading-text">Results Ready!</p><p class="loading-subtext">Your CGPA has been calculated successfully</p></div>
    </div>
</div>

          <div id="resultContainer" class="result-container">
    <div class="gpa-result-card-premium fade-in-on-scroll">
    <div class="student-info-header">
      <h2 class="mb-0 fw-bold" id="studentName"><i class="fa-solid fa-user-graduate me-2"></i>Student Name</h2>
      <p class="mb-0 text-body-secondary" id="studentReg">Registration Number</p>
    </div>

    <div class="cgpa-dashboard">
      <div class="cgpa-progress-circle">
        <svg viewBox="0 0 36 36">
          <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
          <path id="cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
        </svg>
        <div class="cgpa-progress-text">
          <span id="totalCgpa" class="cgpa-value">0.00</span>
          <span class="cgpa-label">CGPA</span>
        </div>
      </div>
    </div>

    <div class="secondary-stats">
        <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="totalPercentage">0.00%</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
                <span id="totalMarksObtained">0</span><span id="totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
        </div>
    </div>
</div>

            <div class="text-center fade-in-on-scroll" style="margin-top: 1.5rem;">
      <p class="text-muted small mb-2">If some courses are not in LMS, you can find them in the Attendance System.</p>
      <button id="fetchAttendanceBtn" class="btn btn-success-action" style="min-width: 220px; border-radius: var(--radius-btn);">
        <i class="fa-solid fa-clipboard-user me-2"></i>Attendance System
      </button>
    </div>            

    <div class="card card-modern mt-4 fade-in-on-scroll" id="gpaChartContainer" style="display: none;">
    <div class="card-header p-0">
      <a href="#gpaChartCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="gpaChartCollapse">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-body"><i class="fa-solid fa-chart-line me-2"></i>GPA Trend</h4>
          <i class="fa-solid fa-chevron-down text-body" id="gpaChartChevron"></i>
        </div>
      </a>
    </div>
    <div class="collapse" id="gpaChartCollapse">
      <div class="card-body">
        <canvas id="gpaTrendChart"></canvas>
      </div>
    </div>
  </div>

    <div class="action-buttons-aligned justify-content-lg-between w-100 fade-in-on-scroll">
      <button id="downloadPdfBtn" class="btn btn-pdf-download"><i class="fa-solid fa-file-pdf me-2"></i>Download PDF</button>
      <button id="addForecastSemesterBtn" class="btn btn-info-action"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>Forecast Semester</button>
    </div>

    <div class="semester-results-container">
      <div id="semesterResults" class="semester-grid"></div>
    </div>
</div>

          <div id="bedResultContainer" style="display: none;">
  <nav class="nav nav-tabs nav-fill" id="bedTab" role="tablist">
    <a class="nav-link active" id="bed-tab" data-bs-toggle="tab" href="#bed-tab-content" role="tab" aria-controls="bed-tab-content" aria-selected="true">
      <i class="fa-solid fa-graduation-cap me-2"></i>B.Ed. Program
    </a>
    <a class="nav-link" id="other-tab" data-bs-toggle="tab" href="#other-tab-content" role="tab" aria-controls="other-tab-content" aria-selected="false">
      <i class="fa-solid fa-book me-2"></i>Other Programs
    </a>
  </nav>

  <div class="tab-content" id="bedTabContent">
    <div class="tab-pane fade show active" id="bed-tab-content" role="tabpanel" aria-labelledby="bed-tab">
      <div class="gpa-result-card-premium fade-in-on-scroll is-visible">
        <div class="student-info-header">
          <h2 class="mb-0 fw-bold"><i class="fa-solid fa-graduation-cap me-2"></i>B.Ed. Program Summary</h2>
        </div>
        <div class="cgpa-dashboard">
          <div class="cgpa-progress-circle">
            <svg viewBox="0 0 36 36">
              <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="bed-cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="cgpa-progress-text">
              <span id="bed-totalCgpa" class="cgpa-value">0.00</span>
              <span class="cgpa-label">B.Ed. CGPA</span>
            </div>
          </div>
        </div>
        <div class="secondary-stats">
          <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="bed-totalPercentage">0.00%</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
              <span id="bed-totalMarksObtained">0</span><span id="bed-totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
          </div>
        </div>
      </div>
      <div class="semester-results-container">
        <div id="bed-semesterResults" class="semester-grid"></div>
      </div>
    </div>

    <div class="tab-pane fade" id="other-tab-content" role="tabpanel" aria-labelledby="other-tab">
      <div class="gpa-result-card-premium fade-in-on-scroll is-visible">
        <div class="student-info-header">
          <h2 class="mb-0 fw-bold"><i class="fa-solid fa-book me-2"></i>Other Programs Summary</h2>
        </div>
        <div class="cgpa-dashboard">
          <div class="cgpa-progress-circle">
            <svg viewBox="0 0 36 36">
              <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="other-cgpaCircle" class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div class="cgpa-progress-text">
              <span id="other-totalCgpa" class="cgpa-value">0.00</span>
              <span class="cgpa-label">Other CGPA</span>
            </div>
          </div>
        </div>
        <div class="secondary-stats">
          <div class="stat-item">
            <span class="stat-label">Percentage</span>
            <span class="stat-value" id="other-totalPercentage">0.00%</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-label">Total Marks</span>
            <span class="stat-value">
              <span id="other-totalMarksObtained">0</span><span id="other-totalMaxMarks" class="stat-sub-value">/ 0</span>
            </span>
          </div>
        </div>
      </div>
      <div class="semester-results-container">
        <div id="other-semesterResults" class="semester-grid"></div>
      </div>
    </div>
  </div>
</div>
          

<div class="card card-modern mt-4 fade-in-on-scroll">
    <div class="card-header p-0">
        <a href="#statusLogCollapse" class="d-block text-decoration-none p-3" data-bs-toggle="collapse" role="button" aria-expanded="false" aria-controls="statusLogCollapse">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0 text-body"><i class="fa-solid fa-terminal me-2"></i>Status Log</h4>
                <i class="fa-solid fa-chevron-down text-body status-log-chevron"></i>
            </div>
        </a>
    </div>
    <div class="collapse" id="statusLogCollapse">
        <div class="card-body p-4">
            <div class="status-log" id="statusLog">
                <div class="status-line status-info">Ready to fetch your results. Enter your registration number and click "Fetch Result".</div>
            </div>
            <div class="log-section center-buttons mt-3">
                <button id="downloadLogBtn" class="btn btn-secondary-action rounded-pill"><i class="fa-solid fa-file-lines me-2"></i>Download Log</button>
                <button id="clearLogBtn" class="btn btn-danger-action rounded-pill"><i class="fa-solid fa-trash me-2"></i>Clear Log</button>
            </div>
        </div>
    </div>
</div>

  <section class="why-choose-section" id="features">
    <div class="container">
      <div class="text-center mb-5 fade-in-on-scroll">
        <h2 class="fw-bold">Why Choose Our <span class="gradient-text">CGPA Calculator</span></h2>
        <p class="lead text-muted">The most advanced and feature-rich cgpa calculation tool for UAF students</p>
      </div>
      <div class="row g-4">
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-robot"></i></div>
            <h5>Instant & Automatic</h5>
            <p class="text-muted">Enter your registration number to get your complete, calculated academic record from the UAF portal in seconds. No manual entry needed.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-edit"></i></div>
            <h5>Forecast & Edit</h5>
            <p class="text-muted">Accurately forecast your CGPA by adding custom courses, deleting semesters, or simply dragging-and-dropping subjects between semesters.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-file-pdf"></i></div>
            <h5>Premium PDF Export</h5>
            <p class="text-muted">Generate a beautifully designed, professional transcript of your results with a single click. Perfect for your personal academic records.</p>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="feature-card fade-in-on-scroll">
            <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
            <h5>Secure & Personal</h5>
            <p class="text-muted">Requires no password and never stores your data on our servers. Save multiple profiles securely in your own browser and enjoy a modern interface with dark mode.</p>
          </div>
        </div>
      </div>
    </div>
  </section>


          <section class="py-5 bg-light" id="how-it-works">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">How to Use <span class="gradient-text">UAF CGPA Calculator</span></h2>
      <p class="lead text-muted">Calculate your University of Agriculture Faisalabad CGPA in 4 simple steps</p>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-id-card"></i></div>
          </div>
          <h4 class="fw-bold">Step 1: Enter Registration Number</h4>
          <p class="text-muted">Enter your UAF registration number (e.g., 2020-ag-1234) in the input field. Our calculator supports all UAF departments including Agriculture, Sciences, and Engineering.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-cloud-download-alt"></i></div>
          </div>
          <h4 class="fw-bold">Step 2: Fetch Your Results</h4>
          <p class="text-muted">Click "Fetch Result" and our system will automatically connect to UAF LMS and Attendance System to retrieve your complete academic record securely.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-calculator"></i></div>
          </div>
          <h4 class="fw-bold">Step 3: View Your CGPA</h4>
          <p class="text-muted">Instantly view your calculated CGPA, GPA, percentage, and semester-wise breakdown. Download a professional PDF transcript with one click.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-modern h-100 text-center p-4 fade-in-on-scroll">
          <div class="mb-3">
            <div class="display-4" style="color: var(--brand);"><i class="fas fa-edit"></i></div>
          </div>
          <h4 class="fw-bold">Step 4: Edit & Forecast</h4>
          <p class="text-muted">Easily edit CGPA by importing from the Attendance System, adding custom courses, or forecasting future grades.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-5" id="uaf-grading-info">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">The <span class="gradient-text">UAF Grading System</span> Explained</h2>
      <p class="lead text-muted">A clear, precise breakdown of how your CGPA is calculated.</p>
    </div>

    <div class="row g-4 g-lg-5 justify-content-center">
      <div class="col-lg-6">
        <div class="card card-modern h-100 fade-in-on-scroll">
          <div class="card-body p-4 p-md-5">
            <div class="d-flex align-items-center mb-3">
              <div class="feature-icon" style="width: 50px; height: 50px; font-size: 1.2rem; margin: 0 1rem 0 0;">
                <i class="fa-solid fa-calculator"></i>
              </div>
              <h4 class="fw-bold mb-0">The Core CGPA Formula</h4>
            </div>
            <p class="text-muted">This calculator uses the <strong>official UAF 4.0 grading scale</strong>. Your CGPA is determined by a simple, powerful formula:</p>
            
            <div class="alert alert-info text-center" style="background-color: rgba(122, 106, 216, 0.05); border-color: rgba(122, 106, 216, 0.2); color: var(--text);">
              <strong class="d-block" style="font-size: 1.1rem; color: var(--brand);">CGPA = Total Quality Points ÷ Total Credit Hours</strong>
            </div>
            
            <hr class="my-4">

            <h5 class="fw-bold mb-3">How are <span class="gradient-text">Quality Points</span> Calculated?</h5>
            <p class="text-muted mb-0">For each course, the grade (A, B, C, D, F) you receive is converted into Grade Points (from 4.0 to 0.0). These are then multiplied by the course's credit hours to find the Quality Points (QP) for that single course.</p>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-modern h-100 fade-in-on-scroll">
          <div class="card-body p-4 p-md-5">
            <div class="d-flex align-items-center mb-3">
              <div class="feature-icon" style="width: 50px; height: 50px; font-size: 1.2rem; margin: 0 1rem 0 0;">
                <i class="fa-solid fa-star"></i>
              </div>
              <h4 class="fw-bold mb-0">Key Calculation Features</h4>
            </div>
            <p class="text-muted">Our tool automates the most complex parts of the UAF grading policy for you:</p>
            
            <ul class="list-unstyled m-0">
              <li class="d-flex align-items-start gap-3 mb-3">
                <i class="fa-solid fa-check-circle text-success fa-lg mt-1"></i>
                <div>
                  <strong class="d-block">Repeated Courses Handled</strong>
                  <span class="text-muted small">Only the <strong>highest grade attempt</strong> for any repeated course is included in the final CGPA calculation. All other attempts are automatically excluded.</span>
                </div>
              </li>
              <li class="d-flex align-items-start gap-3 mb-3">
                <i class="fa-solid fa-check-circle text-success fa-lg mt-1"></i>
                <div>
                  <strong class="d-block">Comprehensive System Sync</strong>
                  <span class="text-muted small">Pulls data from both the <strong>UAF LMS</strong> and the <strong>Attendance System</strong> to build the most complete picture of your academic record.</span>
                </div>
              </li>
              <li class="d-flex align-items-start gap-3">
                <i class="fa-solid fa-check-circle text-success fa-lg mt-1"></i>
                <div>
                  <strong class="d-block">Works for All Faculties</strong>
                  <span class="text-muted small">The calculation logic is standard across all UAF departments, from Agriculture and Sciences to Engineering and Veterinary Sciences.</span>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-10">
          <div class="card card-modern fade-in-on-scroll h-100">
            <div class="card-body p-4">
              <h4 class="fw-bold mb-3 d-flex align-items-center gap-2">
                <i class="fa-solid fa-table me-1" style="color: var(--brand);"></i>
                Official UAF Quality Point Table
              </h4>
              <p class="text-body-secondary mb-3">
                Refer to the official UAF Quality Point Table below to understand how marks are converted into quality points and grades. Click or tap the image to zoom in and drag for details.
              </p>
              <div class="zoomable-image-container" id="qpTableContainer">
                
                <img src="/assets/images/quality-point-table-uaf-saqlain.webp" 
                     id="qpTableImage"
                     alt="Official UAF Quality Point Table by M Saqlain showing mark ranges, grades (A, B+, B, C+, C, D, F), and corresponding quality points for various course credit hours (0.5 to 4.0). Designed by M Saqlain, a UAF alumni."
                     title="UAF Quality Point Table by M Saqlain">
                
                <div class="zoom-loupe" id="qpTableLoupe"></div>
                
                <div class="zoom-box" id="qpTableZoomBox"></div>

              </div>
              <p class="text-body-secondary small mt-3 mb-0">
                  *Table developed by M Saqlain based on official UAF academic regulations.
              </p>
            </div>
          </div>
        </div>
    </div>
  </div>
</section>


  <main>
    <section class="py-5" id="faq">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">Frequently Asked Questions</h2>
      <p class="lead text-muted">Everything you need to know about UAF CGPA Calculator</p>
    </div>
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="accordion" id="faqAccordion">
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    How does the UAF CGPA Calculator work?
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    <strong>Our CGPA Calculator</strong> securely connects to the public UAF LMS portal using your registration number. It fetches your official results, processes the grades and credit hours according to the official UAF grading formula, and instantly calculates your precise Semester GPA and Cumulative GPA (CGPA).
                  </div>
                </div>
              </div>
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Is it safe to use my registration number?
                  </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    <strong>Yes, This CGPA Calculator by M Saqlain is completely safe.</strong> The calculator only requires your registration number, not your password. Your information is used only for fetching your result for the current session and is never stored or shared. The connection is secure and private.
                  </div>
                </div>
              </div>
              <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
                <h2 class="accordion-header" id="headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Can I use this calculator for other universities?
                  </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                  <div class="accordion-body">
                    This calculator is specifically designed for the students of the <strong>University of Agriculture Faisalabad (UAF)</strong>. It uses UAF's unique grading system and connects directly to the UAF LMS, so it will not work for other universities.
                  </div>
                </div>
              </div>

          <!-- ADD THESE NEW FAQ ITEMS -->
          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                How do I calculate my UAF CGPA automatically?
              </button>
            </h2>
            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Simply enter your <strong>UAF registration number</strong> (e.g., 2020-ag-1234) in the calculator above and click "Fetch Result". Our system will automatically retrieve your results from UAF LMS and calculate your CGPA, GPA, and percentage using the official UAF grading formula.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
                What is the UAF CGPA formula used by this calculator?
              </button>
            </h2>
            <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Our calculator uses the <strong>official UAF CGPA formula</strong>: CGPA = (Total Quality Points from all semesters) ÷ (Total Credit Hours from all semesters). Quality points are calculated by multiplying your grade points with credit hours for each course, following UAF's 4.0 grading scale.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
                Does this work for all UAF departments and programs?
              </button>
            </h2>
            <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                <strong>Yes!</strong> This UAF CGPA calculator works for all departments including Agriculture, Sciences, Engineering, Veterinary, and all degree programs (BS, MS, PhD) at the University of Agriculture Faisalabad.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven">
                Can I calculate UAF CGPA without my registration number?
              </button>
            </h2>
            <div id="collapseSeven" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                While automatic fetching requires your registration number, you can manually add your semester GPAs and credit hours to calculate your CGPA. However, using your registration number provides the most accurate results as it fetches data directly from UAF's system.
              </div>
            </div>
          </div>

          <!-- 5. ADD ENHANCED FAQ QUESTIONS (Add these to your existing FAQ section) -->

<!-- Add these new FAQ items to your accordion -->
<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTen">
      How to use the UAF CGPA Calculator by M Saqlain?
    </button>
  </h2>
  <div id="collapseTen" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      Using <strong>M Saqlain's UAF CGPA Calculator</strong> is simple: (1) Enter your UAF registration number, (2) Click "Fetch Result", (3) View your automatic CGPA, GPA, and percentage calculation, (4) Optionally import missing courses from Attendance System, (5) Download your professional PDF transcript. The entire process takes less than 2 minutes!
    </div>
  </div>
</div>

<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEleven">
      Is Muhammad Saqlain's UAF calculator more accurate than others?
    </button>
  </h2>
  <div id="collapseEleven" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      Yes! <strong>M Saqlain's calculator</strong> is 100% accurate because: (1) It uses the official UAF quality point formula, (2) It correctly handles repeated courses by counting only the highest grade, (3) It fetches data from both LMS and Attendance System, (4) It's developed by a UAF alumni who deeply understands the grading system, (5) It's tested and trusted by 50,000+ students.
    </div>
  </div>
</div>

<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwelve">
      Can I forecast my future UAF CGPA with Saqlain's calculator?
    </button>
  </h2>
  <div id="collapseTwelve" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      Absolutely! The <strong>UAF CGPA Calculator by M Saqlain</strong> is the ONLY calculator that lets you forecast future semesters. Click "Forecast Semester", add custom courses with expected grades, and see how your CGPA will change. This feature helps you plan your academic goals and target specific CGPA milestones.
    </div>
  </div>
</div>

<div class="accordion-item card-modern mb-3 fade-in-on-scroll">
  <h2 class="accordion-header">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThirteen">
      What is the difference between UAF LMS calculator and Attendance System calculator?
    </button>
  </h2>
  <div id="collapseThirteen" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
    <div class="accordion-body">
      UAF has two systems: (1) <strong>LMS</strong> - contains most course results, (2) <strong>Attendance System</strong> - contains additional courses that teachers upload separately. <strong>M Saqlain's calculator</strong> is unique because it automatically fetches from BOTH systems, ensuring you never miss any courses in your CGPA calculation. Other calculators only check LMS.
    </div>
  </div>
</div>
          

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight">
                How accurate is this UAF CGPA calculator?
              </button>
            </h2>
            <div id="collapseEight" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                Our calculator is <strong>100% accurate</strong> as it follows the official UAF grading system and quality point calculation method. It fetches data directly from UAF LMS and uses the same formulas as the university's official calculation system.
              </div>
            </div>
          </div>

          <div class="accordion-item card-modern mb-3 fade-in-on-scroll">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNine">
                Who created this UAF CGPA Calculator?
              </button>
            </h2>
            <div id="collapseNine" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
              <div class="accordion-body">
                This calculator was developed by <strong>Muhammad Saqlain</strong>, a UAF BS Chemistry graduate (2020-2024). It's designed specifically for UAF students to make CGPA/GPA calculation easy and accurate. For any queries, you can contact through the form below.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
  </main>


          <!-- 4. ADD TESTIMONIALS SECTION AFTER FEATURES -->
<section class="py-5" style="background-color: var(--light-bg);" id="testimonials">
  <div class="container">
    <div class="text-center mb-5 fade-in-on-scroll">
      <h2 class="fw-bold">What UAF Students Say About <span class="gradient-text">M Saqlain's Calculator</span></h2>
      <p class="lead text-muted">Trusted by over 50,000 students across all UAF departments</p>
    </div>
    
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card card-modern h-100 p-4 fade-in-on-scroll">
          <div class="mb-3">
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
          </div>
          <p class="mb-3">"The <strong>best UAF CGPA calculator</strong> I've used! <strong>Saqlain's tool</strong> saved me hours of manual calculation. The attendance system integration is a game-changer!"</p>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
              <strong>AA</strong>
            </div>
            <div>
              <strong>Ahmed Ali</strong>
              <div class="small text-muted">BS Agriculture, Batch 2021</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card card-modern h-100 p-4 fade-in-on-scroll">
          <div class="mb-3">
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
          </div>
          <p class="mb-3">"Finally, a <strong>UAF calculator</strong> that handles repeated courses correctly! <strong>M Saqlain</strong> really understood our needs. The PDF download feature is amazing!"</p>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
              <strong>SF</strong>
            </div>
            <div>
              <strong>Sarah Fatima</strong>
              <div class="small text-muted">BS Chemistry, Batch 2020</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card card-modern h-100 p-4 fade-in-on-scroll">
          <div class="mb-3">
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
            <i class="fa-solid fa-star" style="color: #ffc107;"></i>
          </div>
          <p class="mb-3">"I've recommended <strong>UAF CGPA Calculator Saqlain</strong> to my entire batch! It's accurate, fast, and the forecasting feature helps me plan my grades perfectly."</p>
          <div class="d-flex align-items-center">
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
              <strong>MH</strong>
            </div>
            <div>
              <strong>Muhammad Hamza</strong>
              <div class="small text-muted">BS Engineering, Batch 2022</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
          

          <!-- 3. ADD THIS "ABOUT M SAQLAIN" SECTION BEFORE CONTACT -->
<section class="py-5" style="background-color: var(--light-bg);" id="about-developer">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card card-modern p-4 p-md-5 fade-in-on-scroll">
          <div class="text-center mb-4">
            <img src="assets/images/UAF CGPA Calculator Developer - M Saqlain.webp" 
                 alt="Muhammad Saqlain - Developer of UAF CGPA Calculator" 
                 class="rounded-circle mb-3" 
                 width="120" 
                 height="120" />
            <h2 class="fw-bold">About Muhammad Saqlain (M Saqlain)</h2>
            <p class="text-muted mb-0">Developer of UAF CGPA Calculator</p>
          </div>
          
          <div class="text-start">
            <p class="lead mb-4">
              <strong>Muhammad Saqlain</strong> is a BS Chemistry graduate from <strong>University of Agriculture Faisalabad</strong> (2020-2024) and the developer behind the most trusted <strong>UAF CGPA Calculator</strong>.
            </p>
            
            <h3 class="h5 fw-bold mb-3">Why M Saqlain Created This Calculator</h3>
            <p>
              As a UAF student, <strong>M Saqlain</strong> experienced firsthand the challenges of manually calculating CGPA, dealing with repeated courses, and tracking results from both the LMS and Attendance System. This inspired him to create the <strong>UAF CGPA Calculator by Saqlain</strong> - a comprehensive, automatic solution that has now helped over <strong>50,000 UAF students</strong>.
            </p>
            
            <h3 class="h5 fw-bold mb-3 mt-4">What Makes M Saqlain's Calculator Different</h3>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fa-solid fa-check-circle text-success me-2"></i>
                <strong>Built by a UAF Alumni:</strong> Deep understanding of UAF's grading system and student needs
              </li>
              <li class="mb-2">
                <i class="fa-solid fa-check-circle text-success me-2"></i>
                <strong>Most Accurate:</strong> Uses official UAF quality point formula with repeated course handling
              </li>
              <li class="mb-2">
                <i class="fa-solid fa-check-circle text-success me-2"></i>
                <strong>Most Features:</strong> Only calculator with LMS + Attendance System integration
              </li>
              <li class="mb-2">
                <i class="fa-solid fa-check-circle text-success me-2"></i>
                <strong>Regular Updates:</strong> Continuously improved based on student feedback
              </li>
              <li class="mb-2">
                <i class="fa-solid fa-check-circle text-success me-2"></i>
                <strong>Trusted by 50,000+:</strong> The #1 choice among UAF students since 2024
              </li>
            </ul>
            
            <div class="alert alert-info mt-4 d-flex align-items-center">
              <i class="fa-solid fa-lightbulb fa-2x me-3"></i>
              <div>
                <strong>Pro Tip from M Saqlain:</strong> Always check the Attendance System for any missing courses that might not appear in your LMS results. This calculator makes it easy to import them!
              </div>
            </div>
            
            <div class="text-center mt-4">
              <p class="mb-2"><strong>Connect with Muhammad Saqlain:</strong></p>
              <div class="d-flex justify-content-center gap-3">
                <a href="https://www.facebook.com/UAFChemist.Rustam" target="_blank" class="btn btn-soft rounded-pill">
                  <i class="fa-brands fa-facebook me-2"></i>Facebook
                </a>
                <a href="https://x.com/M_Saqlain_Akbar" target="_blank" class="btn btn-soft rounded-pill">
                  <i class="fa-brands fa-x-twitter me-2"></i>Twitter
                </a>
                <a href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank" class="btn btn-soft rounded-pill">
                  <i class="fa-brands fa-linkedin me-2"></i>LinkedIn
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


  <section class="py-5" id="contact-us">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-6 fade-in-on-scroll">
          <h3 class="fw-bold mb-2">Contact</h3>
          <p class="text-body-secondary">Questions or suggestions? Send a message.</p>
          <form id="contact-form" action="https://formspree.io/f/xblrolwp" method="post" class="needs-validation" novalidate>
            <div class="row g-3">
              <div class="col-md-6"><label class="form-label" for="name">Your Name</label><input class="form-control" id="name" name="name" placeholder="e.g., Ali Raza" required /><div class="invalid-feedback">Please enter your name.</div></div>
              <div class="col-md-6"><label class="form-label" for="email">Email</label><input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required /><div class="invalid-feedback">Enter a valid email.</div></div>
              <div class="col-12"><label class="form-label" for="message">Message</label><textarea class="form-control" id="message" name="message" rows="4" placeholder="Write your message..." required></textarea><div class="invalid-feedback">Please write a message.</div></div>
              <div class="col-12"><button class="btn btn-primary-action rounded-pill" type="submit"><i class="fa-solid fa-paper-plane me-2"></i>Send</button></div>
              <div id="contact-form-status" class="mt-2 small"></div>
            </div>
          </form>
        </div>
        <div class="col-lg-6 fade-in-on-scroll">
          <div class="h-100 p-4 p-lg-5 rounded-4" style="background:linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));">
            <h5 class="fw-bold">Developer</h5>
            <div class="d-flex align-items-center gap-3 mt-2">
              <img src="assets/images/UAF CGPA Calculator Developer - M Saqlain.webp" alt="Muhammad Saqlain - Developer of UAF CGPA Calculator" class="rounded-circle" width="86" height="86" />
              <div>
                <div class="fw-semibold">Muhammad Saqlain</div><div class="text-body-secondary small">BS Chemistry (2020–2024)</div>
                <div class="d-flex gap-3 mt-2">
                  <a class="text-decoration-none" href="https://www.facebook.com/UAFChemist.Rustam" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                  <a class="text-decoration-none" href="https://x.com/M_Saqlain_Akbar" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                  <a class="text-decoration-none" href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                </div>
              </div>
            </div>
            <hr class="my-4" /><p class="mb-0 small text-body-secondary">Share this tool with your friends to support the project. ♥</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 6. UPDATE YOUR FOOTER TO THIS -->
<footer class="premium-footer">
  <div class="container">
    <div class="row">

      <div class="col-lg-4 col-md-6">
        <a class="footer-logo" href="/">
          <span class="badge">UAF</span>
          <span class="gradient-text">CGPA Calculator</span>
        </a>
        <p class="footer-description">
          The #1 automatic calculator for University of Agriculture Faisalabad students. Developed by M Saqlain to be accurate, fast, and free.
        </p>
        <div class="social-links">
          <a href="https://www.facebook.com/UAFChemist.Rustam" target="_blank" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
          <a href="https://x.com/M_Saqlain_Akbar" target="_blank" title="Twitter/X"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank" title="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>

      <div class="col-lg-2 col-md-3 offset-lg-1">
        <h5 class="footer-heading">Quick Links</h5>
        <ul class="footer-links">
          <li><a href="#Home">Home</a></li>
          <li><a href="#Auto-Calculator">Calculator</a></li>
          <li><a href="#features">Features</a></li>
          <li><a href="#faq">FAQ</a></li>
        </ul>
      </div>

      <div class="col-lg-2 col-md-7">
        <h5 class="footer-heading">About</h5>
        <ul class="footer-links">
          <li><a href="#about-developer">About M Saqlain</a></li>
          <li><a href="#contact-us">Contact Developer</a></li>
          <li><a href="#uaf-grading-info">Grading System</a></li>
          <li><a href="#testimonials">Testimonials</a></li>
        </ul>
      </div>

      <div class="col-lg-3 col-md-12 mt-4 mt-lg-0"> <h5 class="footer-heading">Disclaimer</h5>
        <p class="footer-disclaimer">
          This is an unofficial, third-party tool developed by a UAF alumni. It is not affiliated with, endorsed, or supported by the University of Agriculture Faisalabad. Always verify your official results with the university.
        </p>
      </div>

    </div>

    <div class="footer-bottom-bar">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="footer-copyright">
              <p class="mb-1">© 2025 Muhammad Saqlain. All rights reserved.</p>
              <p class="mb-0">Trusted by 50,000+ UAF Students | Developed by <a href="#about-developer">M Saqlain</a> (BS Chemistry 2020-2024)</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script>
            document.addEventListener('DOMContentLoaded', function() {
      // --- 1. Elements ---
      const resultForm = document.getElementById('resultForm');
      const registrationNumber = document.getElementById('registrationNumber');
      const resultContainer = document.getElementById('resultContainer'); // Standard results container
      const statusLog = document.getElementById('statusLog');
      const themeToggle = document.getElementById('themeToggle');
      const cursorDot = document.getElementById('cursorDot');
      const contactForm = document.getElementById('contact-form');
      const downloadLogBtn = document.getElementById('downloadLogBtn');
      const clearLogBtn = document.getElementById('clearLogBtn');
      const semesterResults = document.getElementById('semesterResults'); // Standard semester results grid
      const studentName = document.getElementById('studentName'); // Standard student name element
      const studentReg = document.getElementById('studentReg'); // Standard student reg element
      const totalCgpa = document.getElementById('totalCgpa'); // Standard CGPA value element
      const totalPercentage = document.getElementById('totalPercentage'); // Standard Percentage value element
      const totalMarksObtained = document.getElementById('totalMarksObtained'); // Standard Marks Obtained value element
      const totalMaxMarks = document.getElementById('totalMaxMarks'); // Standard Max Marks value element
      const downloadPdfBtn = document.getElementById('downloadPdfBtn'); // Standard PDF button
      const courseDetailsModal = new bootstrap.Modal(document.getElementById('courseDetailsModal'));
      const addCourseModal = new bootstrap.Modal(document.getElementById('addCourseModal'));
      const saveCourseBtn = document.getElementById('saveCourseBtn');
      const addCourseForm = document.getElementById('addCourseForm');
      const loadingContainer = document.getElementById('loadingContainer');
      const backToTopButton = document.getElementById('backToTop');
      const addForecastSemesterBtn = document.getElementById('addForecastSemesterBtn'); // Standard Forecast button
      const gpaChartContainer = document.getElementById('gpaChartContainer'); // Chart container
      const gpaTrendChartCanvas = document.getElementById('gpaTrendChart').getContext('2d');
      const profileManagementDiv = document.getElementById('profileManagement');
      const profileSwitcher = document.getElementById('profileSwitcher');
      const renameProfileModal = new bootstrap.Modal(document.getElementById('renameProfileModal'));
      const saveProfileNameBtn = document.getElementById('saveProfileNameBtn');

      // Attendance System Elements
      let fetchAttendanceBtn = document.getElementById('fetchAttendanceBtn'); // Standard Attendance button
      const attendanceImportModal = new bootstrap.Modal(document.getElementById('attendanceImportModal'));
      const importAttendanceCoursesBtn = document.getElementById('importAttendanceCoursesBtn');

      // Profile Manager Elements
      const openProfileManagerBtn = document.getElementById('openProfileManagerBtn');
      const profileManagerModal = new bootstrap.Modal(document.getElementById('profileManagerModal'));
      const profileManagerModalEl = document.getElementById('profileManagerModal');
      const renameProfileModalEl = document.getElementById('renameProfileModal');
      const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
      const confirmationModalEl = document.getElementById('confirmationModal');
      const attendanceImportModalEl = document.getElementById('attendanceImportModal');

      // Import/Export buttons
      const importProfilesBtn = document.getElementById('importProfilesBtn');
      const exportProfilesBtn = document.getElementById('exportProfilesBtn');
      const importProfilesBtnModal = document.getElementById('importProfilesBtnModal');
      const exportProfilesBtnModal = document.getElementById('exportProfilesBtnModal');

      // B.Ed. Specific Elements (used when bedModeActive is true)
      const bedResultContainer = document.getElementById('bedResultContainer');
      const bedSemesterResults = document.getElementById('bed-semesterResults'); // B.Ed. semester grid
      const otherSemesterResults = document.getElementById('other-semesterResults'); // Other semester grid
      const bedTab = document.getElementById('bed-tab'); // B.Ed. tab selector
      const otherTab = document.getElementById('other-tab'); // Other tab selector

      // --- 2. State Variables ---
      let allLogs = [];
      let processedData = null; // Holds the full, unfiltered data for the current profile
      let deletedSemesters = {};
      let gpaChart = null;
      let isInitialLoad = true;
      let confirmationCallback = null;
      let importedAttendanceCourses = [];

      // B.Ed. State
      const BED_COURSES = new Set([
        'EDU-501', 'EDU-503', 'EDU-505', 'EDU-507', 'EDU-509', 'EDU-511', 'EDU-513',
        'EDU-502', 'EDU-504', 'EDU-506', 'EDU-508', 'EDU-510', 'EDU-512', 'EDU-516',
        'EDU-601', 'EDU-604', 'EDU-605', 'EDU-607', 'EDU-608', 'EDU-623'
      ]);
      let bedConfirmationModal;
      let bedModeActive = false; // Controls which UI (standard or tabbed) is displayed

      // API Endpoints
      const API_ENDPOINT = `/api/result-scraper?action=scrape_single`;
      const ATTENDANCE_API_ENDPOINT = `/api/result-scraper?action=scrape_attendance`;

      // --- 3. Initialization ---
      function init() {
        try {
          migrateOldProfiles();
          initCustomCursor();
          initTheme();
          initContactForm();
          createToastContainer();
          initBackToTop();
          initScrollAnimations();
          loadProfiles();
          initModalZIndexHandlers();

          // Init B.Ed. Modal
          const bedModalEl = document.getElementById('bedConfirmationModal');
          if (bedModalEl) {
              bedConfirmationModal = new bootstrap.Modal(bedModalEl);
              // Attach listeners that will be updated with data when fetched
              document.getElementById('bedConfirmYes').addEventListener('click', () => {
                  if (processedData) handleBedConfirm(true, processedData);
              });
              document.getElementById('bedConfirmNo').addEventListener('click', () => {
                  if (processedData) handleBedConfirm(false, processedData);
              });
          } else { console.warn("B.Ed. confirmation modal HTML not found."); }

          // Add Tab Listeners for Dynamic Chart Update
          if (bedTab && otherTab) {
              bedTab.addEventListener('shown.bs.tab', () => renderGpaChart());
              otherTab.addEventListener('shown.bs.tab', () => renderGpaChart());
          }

        } catch (error) {
            console.error("Initialization failed:", error);
            try { createToastContainer(); showToast("Error initializing application. Saved data might be corrupted.", "error"); }
            catch (toastError) { console.error("Could not show initialization error toast:", toastError); }
        }
      }

      // --- 4. Feature Button Management ---
      function setupFeatureButtons() {
         const resultsAreDisplayed = resultContainer.style.display !== 'none' || bedResultContainer.style.display !== 'none';

         // Attendance Button
         setupAttendanceButton(); // This handles its own logic including visibility

         // PDF and Forecast Buttons
         downloadPdfBtn.style.display = resultsAreDisplayed ? 'inline-block' : 'none';
         addForecastSemesterBtn.style.display = resultsAreDisplayed ? 'inline-block' : 'none';

         // Main Action Buttons Container
         const actionButtonsContainer = document.querySelector('.action-buttons-aligned');
         if(actionButtonsContainer) {
             actionButtonsContainer.style.display = resultsAreDisplayed ? 'flex' : 'none';
         }
         
         // GPA Chart Container visibility is handled by renderGpaChart
      }


      // --- 5. Attendance System Functions ---
      function setupAttendanceButton() {
        const buttonContainer = fetchAttendanceBtn.parentElement;
        if (!buttonContainer) return; // Guard if button container not found

        // Clone and replace to remove old listeners
        const newBtn = fetchAttendanceBtn.cloneNode(true);
        buttonContainer.replaceChild(newBtn, fetchAttendanceBtn);
        fetchAttendanceBtn = newBtn;

        const resultsAreDisplayed = resultContainer.style.display !== 'none' || bedResultContainer.style.display !== 'none';

        buttonContainer.style.display = resultsAreDisplayed ? 'block' : 'none';

        if (resultsAreDisplayed) {
            if (importedAttendanceCourses.length > 0) {
                fetchAttendanceBtn.innerHTML = '<i class="fa-solid fa-rotate-left me-2"></i>Revert Import';
                fetchAttendanceBtn.className = 'btn btn-danger-action';
                fetchAttendanceBtn.addEventListener('click', revertAttendanceImport);
                fetchAttendanceBtn.disabled = false;
            } else {
                fetchAttendanceBtn.innerHTML = '<i class="fa-solid fa-clipboard-user me-2"></i>Attendance System';
                fetchAttendanceBtn.className = 'btn btn-success-action';
                fetchAttendanceBtn.addEventListener('click', fetchAttendanceData);
                fetchAttendanceBtn.disabled = !processedData;
            }
        } else {
             fetchAttendanceBtn.innerHTML = '<i class="fa-solid fa-clipboard-user me-2"></i>Attendance System';
             fetchAttendanceBtn.className = 'btn btn-success-action';
             fetchAttendanceBtn.disabled = true;
        }
      }

      function revertAttendanceImport() {
        if (!processedData || importedAttendanceCourses.length === 0) return;

        let revertedCount = 0;
        importedAttendanceCourses.forEach(imported => {
            const semester = processedData.semesters[imported.semester];
            if (semester) {
                const initialLength = semester.courses.length;
                semester.courses = semester.courses.filter(c => 
                    !(c.isCustom && c.source === 'attendance' && c.code === imported.code)
                );
                if (semester.courses.length < initialLength) revertedCount++;
            }
        });
        
        showToast(`Reverted ${revertedCount} imported course(s)`, 'success');
        addStatusMessage(`Reverted import of ${revertedCount} courses`, 'info');
        
        importedAttendanceCourses = [];
        recalculateAndDisplay();
        // setupAttendanceButton() is called by recalculateAndDisplay -> renderResults -> setupFeatureButtons
      }

      function updateAttendanceCounts() {
        const listEl = document.getElementById('attendanceCourseList');
        const selectAllCheckbox = document.getElementById('toggleSelectAllCourses');
        const selectedCountEl = document.getElementById('attendanceSelectedCount');
        if (!listEl || !selectAllCheckbox || !selectedCountEl) return;

        const allVisibleCheckboxes = listEl.querySelectorAll('.attendance-course-item:not([style*="display: none"]) .form-check-input:not(:disabled)');
        const allVisibleChecked = listEl.querySelectorAll('.attendance-course-item:not([style*="display: none"]) .form-check-input:checked:not(:disabled)');

        const selected = allVisibleChecked.length;
        const totalVisible = allVisibleCheckboxes.length;
        
        selectedCountEl.textContent = `${selected} Selected`;

        if (totalVisible === 0) {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.disabled = true;
        } else {
            selectAllCheckbox.disabled = false;
            if (selected === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (selected === totalVisible) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }
      }

      function processAttendanceData(data) {
        if (!data || !data.resultData) {
            showToast('No attendance data to process.', 'info'); return;
        }
        addStatusMessage(`Processing ${data.resultData.length} records from Attendance System...`, 'info');

        const globalLmsCourseMap = new Map();
        Object.values(processedData.semesters).forEach(sem => {
            sem.courses.forEach(course => {
                if (!course.isDeleted && course.source !== 'attendance') {
                    const code = course.code.toUpperCase().trim();
                    const marks = parseFloat(course.marks);
                    const grade = (course.grade || 'N/A').toUpperCase().trim();
                    const key = `${marks}|${grade}`;
                    if (!globalLmsCourseMap.has(code)) globalLmsCourseMap.set(code, new Set());
                    globalLmsCourseMap.get(code).add(key);
                }
            });
        });

        const allAttendanceCourses = [];
        data.resultData.forEach(attCourse => {
            const courseCode = (attCourse.CourseCode || '').toUpperCase().trim();
            const semesterName = processSemesterName(attCourse.Semester);
            const marks = parseFloat(attCourse.Totalmark || '0');
            const grade = (attCourse.Grade || 'N/A').toUpperCase().trim();
            const globalKey = `${marks}|${grade}`;
            let isDuplicate = false;

            if (globalLmsCourseMap.has(courseCode) && globalLmsCourseMap.get(courseCode).has(globalKey)) {
                isDuplicate = true;
            }

            const semesterExists = processedData.semesters[semesterName];
            if (!isDuplicate && semesterExists && semesterExists.courses.some(c => 
                    c.code.toUpperCase().trim() === courseCode && c.isCustom && c.source === 'attendance'
                )) { isDuplicate = true; }

            allAttendanceCourses.push({
                code: (attCourse.CourseCode || '').trim(), title: attCourse.CourseName || 'N/A', semester: semesterName,
                marks, grade: (attCourse.Grade || 'N/A'), teacher: attCourse.TeacherName || 'N/A',
                mid: attCourse.Mid || '0', assignment: attCourse.Assigment || '0', final: attCourse.Final || '0',
                practical: attCourse.Practical || '0', isDuplicate
            });
        });

        if (allAttendanceCourses.length > 0) {
            const importableCount = allAttendanceCourses.filter(c => !c.isDuplicate).length;
            addStatusMessage(`${allAttendanceCourses.length} courses found, ${importableCount} are new/importable.`, 'info');
            renderAttendanceImportModal(allAttendanceCourses);
            attendanceImportModal.show();
        } else {
            showToast('No new courses found in Attendance System.', 'info');
            addStatusMessage('Attendance System search returned no new courses.', 'success');
        }
      }

      async function fetchAttendanceData() {
        if (!processedData || !processedData.studentInfo || !processedData.studentInfo.registration) {
            showToast('Please fetch results first.', 'warning'); return;
        }
        const regNum = processedData.studentInfo.registration;
        const cacheKey = `uafAttendanceCache_${regNum}`;
        const TEN_MINUTES_MS = 10 * 60 * 1000;

        try {
            const cachedDataJSON = localStorage.getItem(cacheKey);
            if (cachedDataJSON) {
                const cachedData = JSON.parse(cachedDataJSON);
                const cacheAge = Date.now() - cachedData.timestamp;
                if (cacheAge < TEN_MINUTES_MS) {
                    addStatusMessage(`Using cached attendance data (fetched ${Math.round(cacheAge / 60000)} mins ago).`, 'info');
                    showToast('Using cached attendance data.', 'info');
                    processAttendanceData(cachedData.data);
                    return;
                } else {
                    addStatusMessage('Cached attendance data is stale. Fetching new data.', 'info');
                    localStorage.removeItem(cacheKey);
                }
            }
        } catch (e) { console.error('Error reading cache:', e); localStorage.removeItem(cacheKey); }

        addStatusMessage(`Fetching results from Attendance System for: ${regNum}`, 'info');
        fetchAttendanceBtn.disabled = true;
        fetchAttendanceBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>Fetching...';

        try {
            const response = await fetch(`${ATTENDANCE_API_ENDPOINT}&registrationNumber=${encodeURIComponent(regNum)}`);
            const data = await response.json();
            if (!response.ok || !data.success) throw new Error(data.message || `Server status ${response.status}`);
            
            addStatusMessage(`Successfully fetched ${data.resultData.length} records from Attendance System`, 'success');
            try {
                localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data }));
                addStatusMessage('Saved attendance data to cache.', 'info');
            } catch (e) { console.error('Error saving to cache:', e); }

            processAttendanceData(data);

        } catch (error) {
            console.error("Attendance Fetch Error:", error);
            let userMessage = 'Could not retrieve Attendance System results. Server may be offline.';
            if (error.message.includes('timed out')) userMessage = 'Connection to Attendance System timed out.';
            else if (error.message.includes('No results found')) userMessage = error.message;
            addStatusMessage(`Error fetching from Attendance System: ${error.message}`, 'error');
            showToast(userMessage, 'error');
        } finally {
            // Reset button state (will be called again inside process/render logic if successful)
            setupAttendanceButton();
        }
      }

      function renderAttendanceImportModal(courses) {
        const listEl = document.getElementById('attendanceCourseList');
        const listElContainer = listEl.parentNode;
        let newListEl = listEl.cloneNode(false);
        const toggleSwitch = document.getElementById('toggleAllCourses');
        const selectAllCheckbox = document.getElementById('toggleSelectAllCourses');
        const courseCountEl = document.getElementById('attendanceCourseCount');
        const modalTitle = document.getElementById('attendanceModalTitle');
        const modalDescription = document.getElementById('attendanceModalDescription');
        
        if (courses.length === 0) {
            newListEl.innerHTML = '<p class="text-center text-muted p-3">No courses found.</p>';
            importAttendanceCoursesBtn.disabled = true;
            if (toggleSwitch) toggleSwitch.closest('.d-flex').style.display = 'none';
            courseCountEl.textContent = 'Total: 0';
            listElContainer.replaceChild(newListEl, listEl);
            updateAttendanceCounts();
            return;
        }

        let missingCoursesFound = false;
        courses.forEach((course, index) => {
            const courseId = `att-course-${index}`; const selectId = `att-ch-${index}`;
            const item = document.createElement('div');
            item.className = 'attendance-course-item';
            if (course.isDuplicate) {
                item.classList.add('duplicate-course'); item.style.display = 'none';
            } else { missingCoursesFound = true; }

            let labelText = (course.title && course.title.toLowerCase() !== 'n/a' && course.title.trim() !== '') ? `${course.title} - ` : '';
            labelText += `Marks: ${course.marks}, Grade: ${course.grade}`;

            item.innerHTML = `
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="${index}" id="${courseId}" ${course.isDuplicate ? 'disabled' : 'checked'} data-course-data='${JSON.stringify(course).replace(/'/g, "&#39;")}'>
                    <label class="form-check-label" for="${courseId}">
                        <strong>${course.code}</strong> (${course.semester})
                        ${course.isDuplicate ? '<span class="badge bg-success-subtle text-success-emphasis rounded-pill ms-1">In LMS</span>' : ''}
                        <small class="d-block text-muted">${labelText}</small>
                    </label>
                </div>
                <div class="import-ch-select">
                    <label for="${selectId}" class="form-label mb-0 small me-2">CH:</label>
                    <select class="form-select form-select-sm" id="${selectId}" ${course.isDuplicate ? 'disabled' : ''} style="width: 75px;">
                        ${[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map(ch => `<option value="${ch}" ${ch === 3 ? 'selected' : ''}>${ch}</option>`).join('')}
                    </select>
                </div>`;
            newListEl.appendChild(item);
        });

        listElContainer.replaceChild(newListEl, listEl);

        newListEl.addEventListener('change', (e) => {
            if (e.target.classList.contains('form-check-input')) updateAttendanceCounts();
        });

        if (toggleSwitch) {
            toggleSwitch.closest('.d-flex').style.display = 'flex';
            toggleSwitch.checked = false; 
            const newToggle = toggleSwitch.cloneNode(true);
            toggleSwitch.parentNode.replaceChild(newToggle, toggleSwitch);
            newToggle.addEventListener('change', (e) => {
                const showAll = e.target.checked;
                newListEl.querySelectorAll('.duplicate-course').forEach(item => { item.style.display = showAll ? 'flex' : 'none'; });
                updateAttendanceCounts();
            });
        }
        
        if (selectAllCheckbox) {
            selectAllCheckbox.checked = false;
            const newSelectAll = selectAllCheckbox.cloneNode(true);
            selectAllCheckbox.parentNode.replaceChild(newSelectAll, selectAllCheckbox);
            newSelectAll.addEventListener('change', (e) => {
                const isChecked = e.target.checked;
                newListEl.querySelectorAll('.attendance-course-item:not([style*="display: none"]) .form-check-input:not(:disabled)').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
                updateAttendanceCounts();
            });
        }

        courseCountEl.textContent = `Total: ${courses.length}`;
        if (missingCoursesFound) {
            modalTitle.innerHTML = '<i class="fa-solid fa-clipboard-user me-2"></i>Import Missing Courses';
            modalDescription.textContent = 'Select courses to import and set their credit hours.';
        } else {
            modalTitle.innerHTML = '<i class="fa-solid fa-clipboard-check me-2"></i>Courses Synced';
            modalDescription.textContent = 'All courses from the Attendance System are already in your results.';
        }
        importAttendanceCoursesBtn.disabled = false;
        updateAttendanceCounts();
      }

      function importSelectedAttendanceCourses() {
        importedAttendanceCourses = [];
        const selectedCheckboxes = document.querySelectorAll('#attendanceCourseList .form-check-input:checked');
        let importedCount = 0;

        selectedCheckboxes.forEach(checkbox => {
            if (checkbox.disabled) return;
            const courseData = JSON.parse(checkbox.dataset.courseData.replace(/&#39;/g, "'"));
            const index = checkbox.value;
            const creditHoursSelect = document.getElementById(`att-ch-${index}`);
            const creditHours = parseInt(creditHoursSelect.value);

            if (!isNaN(creditHours) && creditHours > 0 && creditHours <= 10) {
                const semesterName = courseData.semester;
                if (!processedData.semesters[semesterName]) {
                    processedData.semesters[semesterName] = {
                        originalName: semesterName, sortKey: getSemesterOrderKey(semesterName), courses: []
                    };
                     addStatusMessage(`Created new semester entry: ${semesterName}`, 'info');
                }

                const marks = courseData.marks;
                const grade = calculateCustomGrade(marks, creditHours);
                const qualityPoints = calculateQualityPoints(marks, creditHours, grade);
                const newCourse = {
                    code: courseData.code, title: courseData.title || 'Imported from Attendance', creditHours,
                    creditHoursDisplay: `${creditHours}(${creditHours}-0)`, marks, qualityPoints, grade,
                    teacher: courseData.teacher || 'Attendance System', mid: courseData.mid || 'N/A',
                    assignment: courseData.assignment || 'N/A', final: courseData.final || 'N/A',
                    practical: courseData.practical || 'N/A', total: marks, isExtraEnrolled: false,
                    isRepeated: false, isDeleted: false, isCustom: true, source: 'attendance',
                    originalSemester: semesterName
                };

                const semester = processedData.semesters[semesterName];
                 if (!semester.courses.some(c => !c.isDeleted && c.code.toUpperCase() === newCourse.code)) {
                     semester.courses.push(newCourse);
                     importedAttendanceCourses.push({ semester: semesterName, code: newCourse.code });
                     importedCount++;
                 } else {
                     addStatusMessage(`Skipped importing ${newCourse.code} for ${semesterName} as it already exists.`, 'warning');
                 }
            } else { showToast(`Invalid Credit Hours for ${courseData.code}`, 'warning'); }
        });

        if (importedCount > 0) {
            recalculateAndDisplay();
            showToast(`${importedCount} course(s) imported successfully!`, 'success');
            addStatusMessage(`Imported ${importedCount} courses.`, 'info');
        } else {
              showToast('No new courses were imported.', 'info');
              importedAttendanceCourses = [];
        }
        // setupAttendanceButton() is called by recalculateAndDisplay
        attendanceImportModal.hide();
      }

      // --- 6. Profile Management Functions ---
      function migrateOldProfiles() {
        const oldProfilesData = localStorage.getItem('uafCalculatorProfiles');
        if (oldProfilesData) {
            try {
                const oldProfiles = JSON.parse(oldProfilesData);
                const newProfiles = getProfiles();
                let migratedCount = 0;
                Object.keys(oldProfiles).forEach(oldId => {
                    const oldProfile = oldProfiles[oldId];
                    if (oldProfile?.studentInfo?.registration) {
                        const alreadyExists = Object.values(newProfiles).some(p => p?.studentInfo?.registration === oldProfile.studentInfo.registration);
                        if (!alreadyExists) {
                            const newProfile = {
                                ...oldProfile,
                                displayName: `${oldProfile.studentInfo.name} (${oldProfile.studentInfo.registration})`,
                                createdAt: new Date().toISOString(),
                                lastModified: new Date().toISOString()
                            };
                            const newId = `profile_${Date.now()}_${migratedCount}`;
                            newProfiles[newId] = newProfile;
                            migratedCount++;
                        }
                    }
                });
                if (migratedCount > 0) {
                    saveProfiles(newProfiles);
                    showToast(`${migratedCount} old profile(s) migrated!`, 'success');
                }
                localStorage.removeItem('uafCalculatorProfiles');
            } catch (e) { console.error("Failed to migrate old profiles:", e); localStorage.removeItem('uafCalculatorProfiles'); }
        }
      }

      function getProfiles() {
          try { return JSON.parse(localStorage.getItem('uafCalculatorProfiles_v2') || '{}'); }
          catch (e) { console.error("Error parsing profiles:", e); localStorage.removeItem('uafCalculatorProfiles_v2'); return {}; }
      }
      function saveProfiles(profiles) {
          try { localStorage.setItem('uafCalculatorProfiles_v2', JSON.stringify(profiles)); }
          catch (e) { console.error("Error saving profiles:", e); showToast("Could not save profile. Storage might be full.", "error"); }
      }
      function getActiveProfileId() { return localStorage.getItem('uafCalculatorActiveProfile_v2'); }
      function setActiveProfileId(id) {
          if (id) localStorage.setItem('uafCalculatorActiveProfile_v2', id);
          else localStorage.removeItem('uafCalculatorActiveProfile_v2');
      }
      function getBackupInfo() {
          try { return JSON.parse(localStorage.getItem('uafCalculatorBackupInfo') || '{}'); }
          catch (e) { localStorage.removeItem('uafCalculatorBackupInfo'); return {}; }
      }
      function saveBackupInfo(info) {
          try { localStorage.setItem('uafCalculatorBackupInfo', JSON.stringify(info)); }
          catch (e) { console.error("Error saving backup info:", e); }
      }

      function loadProfiles() {
        try {
          const profiles = getProfiles();
          const activeProfileId = getActiveProfileId();
          updateProfileSwitcher(profiles, activeProfileId);
          if (activeProfileId && profiles[activeProfileId]) {
            loadProfile(activeProfileId);
            addStatusMessage('Loaded active profile from session.', 'info');
          } else if (activeProfileId) {
            setActiveProfileId('');
            addStatusMessage('Cleared invalid active profile ID.', 'warning');
          }
        } catch (error) {
          console.error("Failed to load profiles:", error);
          showToast("Error loading saved profiles. Data might be corrupted.", "error");
          localStorage.removeItem('uafCalculatorProfiles_v2');
          localStorage.removeItem('uafCalculatorActiveProfile_v2');
          updateProfileSwitcher({}, '');
          profileManagementDiv.style.display = 'none';
        }
      }

      function updateProfileSwitcher(profiles, activeProfileId) {
        const profileKeys = Object.keys(profiles);
        if (profileKeys.length > 0) {
          profileSwitcher.innerHTML = '<option value="">Select a saved profile...</option>';
          profileKeys.sort((a, b) => new Date(profiles[b]?.lastModified || 0) - new Date(profiles[a]?.lastModified || 0))
          .forEach(profileId => {
            const profile = profiles[profileId];
            if (profile?.studentInfo?.registration) {
                const option = document.createElement('option');
                option.value = profileId;
                option.textContent = profile.displayName || `${profile.studentInfo.name} (${profile.studentInfo.registration})`;
                if (profileId === activeProfileId) option.selected = true;
                profileSwitcher.appendChild(option);
            }
          });
          profileManagementDiv.style.display = 'block';
        } else {
          profileManagementDiv.style.display = 'none';
        }
      }

      function loadProfile(profileId) {
        const profiles = getProfiles();
        if (profiles[profileId]) {
          processedData = profiles[profileId]; // This is the full data object
          isInitialLoad = true;
          bedModeActive = processedData.bedMode || false; // Set mode from profile
          renderResults(processedData); // Call main render function
          registrationNumber.value = processedData.studentInfo.registration;
          setActiveProfileId(profileId);
          updateProfileSwitcher(profiles, profileId); // Ensure switcher is in sync
        } else {
            console.error(`Profile with ID ${profileId} not found.`);
            showToast("Failed to load selected profile.", "error");
            setActiveProfileId('');
            updateProfileSwitcher(profiles, '');
        }
      }

      function switchProfile(event) {
        const profileId = event.target.value;
        if (profileId) {
          loadProfile(profileId);
          showToast(`Switched to profile: ${getProfiles()[profileId].displayName}`, 'info');
        } else {
            processedData = null;
            resultContainer.style.display = 'none';
            bedResultContainer.style.display = 'none';
            registrationNumber.value = '';
            setActiveProfileId('');
            setupFeatureButtons(); // Hide buttons
        }
      }

      function saveActiveProfile() {
        const activeProfileId = getActiveProfileId();
        if (activeProfileId && processedData) {
            const profiles = getProfiles();
            if (profiles[activeProfileId]) {
                processedData.lastModified = new Date().toISOString();
                profiles[activeProfileId] = processedData;
                saveProfiles(profiles);
            }
        }
      }

      function openRenameModal(profileId) {
        const profiles = getProfiles();
        if (!profileId || !profiles[profileId]) {
            showToast('Invalid profile selected for rename.', 'warning'); return;
        }
        document.getElementById('newProfileName').value = profiles[profileId].displayName;
        saveProfileNameBtn.dataset.profileId = profileId;
        renameProfileModal.show();
      }

      function renameProfile() {
          const profileId = saveProfileNameBtn.dataset.profileId;
          const newName = document.getElementById('newProfileName').value.trim();
          if (!newName) { showToast('Profile name cannot be empty.', 'error'); return; }

          const profiles = getProfiles();
          if (!profiles[profileId]) {
              showToast("Profile not found.", "error"); renameProfileModal.hide(); renderProfileManager(); return;
          }
          const nameExists = Object.entries(profiles).some(([id, p]) => p.displayName === newName && id !== profileId);
          if (nameExists) { showToast('A profile with this name already exists.', 'error'); return; }

          profiles[profileId].displayName = newName;
          profiles[profileId].lastModified = new Date().toISOString();
          saveProfiles(profiles);
          renameProfileModal.hide();
          showToast('Profile renamed successfully!', 'success');
          updateProfileSwitcher(profiles, getActiveProfileId());
          if (profileManagerModalEl.classList.contains('show')) renderProfileManager();
      }

      function showConfirmationModal(title, body, onConfirm) {
        document.getElementById('confirmationModalTitle').textContent = title;
        document.getElementById('confirmationModalBody').textContent = body;
        confirmationCallback = onConfirm;
        confirmationModal.show();
      }

      function handleConfirm() {
        if (typeof confirmationCallback === 'function') confirmationCallback();
        confirmationModal.hide();
        confirmationCallback = null;
      }

      function renderProfileManager() {
        const profiles = getProfiles();
        const profileListEl = document.getElementById('profileManagerList');
        const profileCountStat = document.getElementById('profileCountStat');
        const lastBackupStat = document.getElementById('lastBackupStat');

        const profileKeys = Object.keys(profiles);
        profileCountStat.textContent = `${profileKeys.length} Profile${profileKeys.length !== 1 ? 's' : ''}`;
        const backupInfo = getBackupInfo();
        lastBackupStat.textContent = backupInfo.lastBackup ? `Last Backup: ${new Date(backupInfo.lastBackup).toLocaleString()}` : 'Last Backup: Never';

        if (profileKeys.length === 0) {
            profileListEl.innerHTML = '<li class="text-center text-muted p-4">No profiles saved yet.</li>';
            document.getElementById('bulkActionsBtn').disabled = true;
            document.getElementById('selectAllProfiles').checked = false;
            document.getElementById('selectAllProfiles').disabled = true;
            exportProfilesBtnModal.disabled = true;
            return;
        }
        document.getElementById('selectAllProfiles').disabled = false;

        profileListEl.innerHTML = profileKeys.sort((a, b) => new Date(profiles[b]?.lastModified || 0) - new Date(profiles[a]?.lastModified || 0))
        .map(id => {
            const profile = profiles[id];
            if (!profile?.studentInfo?.registration || !profile.semesters) {
                 console.warn(`Skipping incomplete profile: ${id}`); return '';
            }
            const cgpaData = calculateCGPA(profile);
            const semesterCount = Object.keys(profile.semesters).length;
            const courseCount = Object.values(profile.semesters).reduce((sum, s) => sum + (s.courses?.length || 0), 0);
            const lastModified = profile.lastModified ? new Date(profile.lastModified).toLocaleString() : 'N/A';

            return `
              <li class="profile-item" data-profile-id="${id}">
                  <input class="form-check-input profile-checkbox" type="checkbox" value="${id}">
                  <div class="profile-item-details">
                      <div class="profile-item-name">${profile.displayName || 'Unnamed Profile'}</div>
                      <div class="profile-item-meta"><i class="fa-solid fa-id-card"></i> ${profile.studentInfo.registration}</div>
                      <div class="profile-item-meta"><i class="fa-solid fa-graduation-cap"></i> CGPA: ${cgpaData.cgpa.toFixed(4)}</div>
                      <div class="profile-item-meta"><i class="fa-solid fa-book"></i> ${semesterCount} Sem, ${courseCount} Courses</div>
                      <div class="profile-item-meta"><i class="fa-solid fa-clock"></i> ${lastModified}</div>
                  </div>
                  <div class="profile-item-actions">
                      <button class="btn btn-sm btn-soft rounded-pill action-load" title="Load Profile"><i class="fa-solid fa-arrow-up-right-from-square"></i></button>
                      <button class="btn btn-sm btn-soft rounded-pill action-rename" title="Rename"><i class="fa-solid fa-pen"></i></button>
                      <button class="btn btn-sm btn-soft rounded-pill text-danger action-delete" title="Delete"><i class="fa-solid fa-trash"></i></button>
                  </div>
              </li>`;
        }).join('');

        profileListEl.querySelectorAll('.action-load').forEach(btn => btn.addEventListener('click', e => {
            loadProfile(e.currentTarget.closest('.profile-item').dataset.profileId);
            profileManagerModal.hide();
        }));
        profileListEl.querySelectorAll('.action-rename').forEach(btn => btn.addEventListener('click', e => {
            openRenameModal(e.currentTarget.closest('.profile-item').dataset.profileId);
        }));
        profileListEl.querySelectorAll('.action-delete').forEach(btn => btn.addEventListener('click', e => {
            const profileId = e.currentTarget.closest('.profile-item').dataset.profileId;
            const profiles = getProfiles();
            if (profiles[profileId]) {
                showConfirmationModal('Delete Profile?', `Are you sure you want to delete "${profiles[profileId].displayName}"?`, () => deleteProfiles([profileId]));
            } else { showToast("Profile not found.", "error"); renderProfileManager(); }
        }));
        document.getElementById('bulkActionsBtn').disabled = true;
        document.getElementById('selectAllProfiles').checked = false;
        exportProfilesBtnModal.disabled = true;
      }

      function handleBulkAction() {
          const selectedIds = Array.from(document.querySelectorAll('#profileManagerList .profile-checkbox:checked')).map(cb => cb.value);
          if (selectedIds.length === 0) { showToast('No profiles selected.', 'warning'); return; }
          showConfirmationModal(`Delete ${selectedIds.length} Profiles?`, `This will permanently delete the selected profiles.`, () => deleteProfiles(selectedIds));
      }

      function deleteProfiles(idsToDelete) {
          const profiles = getProfiles();
          let deletedCount = 0;
          let activeProfileDeleted = false;
          idsToDelete.forEach(id => {
              if (profiles[id]) {
                  delete profiles[id];
                  deletedCount++;
                  if (getActiveProfileId() === id) {
                     activeProfileDeleted = true;
                     setActiveProfileId('');
                  }
              }
          });
          saveProfiles(profiles);
          showToast(`Successfully deleted ${deletedCount} profile(s).`, 'success');
          updateProfileSwitcher(profiles, getActiveProfileId());
          if (profileManagerModalEl.classList.contains('show')) renderProfileManager();

          if (activeProfileDeleted) {
              processedData = null;
              resultContainer.style.display = 'none';
              bedResultContainer.style.display = 'none';
              registrationNumber.value = '';
              setupFeatureButtons(); // Hide all feature buttons
          }
      }

      function exportSelectedProfiles() {
          const selectedIds = Array.from(document.querySelectorAll('#profileManagerList .profile-checkbox:checked')).map(cb => cb.value);
          const profiles = getProfiles();
          const profilesToExport = {};
          let exportCount = 0;
          let filename = `uaf-cgpa-backup-${new Date().toISOString().split('T')[0]}.json`;

          if (selectedIds.length === 0) { showToast('No profiles selected to export.', 'warning'); return; }

          selectedIds.forEach(id => {
              if (profiles[id]) { profilesToExport[id] = profiles[id]; exportCount++; }
          });

          if (exportCount === 1) {
              const singleProfileId = selectedIds[0];
              let profileName = 'profile';
              if (profiles[singleProfileId]?.displayName) profileName = profiles[singleProfileId].displayName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
              else if (profiles[singleProfileId]?.studentInfo?.registration) profileName = profiles[singleProfileId].studentInfo.registration.replace(/[^a-z0-9]/gi, '_').toLowerCase();
              filename = `${profileName}-backup.json`;
          }

          const backupData = { version: '2.0.0', exportDate: new Date().toISOString(), profiles: profilesToExport };
          const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = filename;
          document.body.appendChild(a); a.click(); a.remove();
          URL.revokeObjectURL(url);
          saveBackupInfo({ lastBackup: new Date().toISOString() });
          showToast(`${exportCount} profile(s) exported.`, 'success');
          if (profileManagerModalEl.classList.contains('show')) renderProfileManager();
      }

      function importProfiles() {
          const input = document.createElement('input');
          input.type = 'file'; input.accept = '.json';
          input.onchange = e => {
              const file = e.target.files[0]; if (!file) return;
              const reader = new FileReader();
              reader.onload = event => {
                  try {
                      const importedData = JSON.parse(event.target.result);
                      if (!importedData.profiles || importedData.version !== '2.0.0') throw new Error('Invalid or incompatible backup file.');
                      const existingProfiles = getProfiles();
                      let importedCount = 0, skippedCount = 0, firstImportedId = null;
                      Object.keys(importedData.profiles).forEach(id => {
                          if (existingProfiles[id]) { skippedCount++; }
                          else if (importedData.profiles[id]?.studentInfo?.registration && importedData.profiles[id]?.semesters) {
                              existingProfiles[id] = importedData.profiles[id];
                              importedCount++;
                              if (!firstImportedId) firstImportedId = id;
                          } else { skippedCount++; }
                      });
                      saveProfiles(existingProfiles);
                      showToast(`Import complete: ${importedCount} added, ${skippedCount} skipped.`, 'success');
                      const currentActiveId = getActiveProfileId();
                      updateProfileSwitcher(existingProfiles, currentActiveId || firstImportedId);
                      if (firstImportedId && !currentActiveId) loadProfile(firstImportedId);
                      else if (currentActiveId) loadProfile(currentActiveId); // Refresh current
                      else loadProfiles(); // Just refresh list
                      if (profileManagerModalEl.classList.contains('show')) renderProfileManager();
                  } catch (error) { showToast(`Import failed: ${error.message}`, 'error'); console.error('Import error:', error); }
              };
              reader.onerror = event => { showToast('Failed to read the file.', 'error'); console.error('FileReader error:', event.target.error); };
              reader.readAsText(file);
          };
          input.click();
      }

      // --- 7. UI & Helper Functions (Simple) ---
      function initModalZIndexHandlers() {
        renameProfileModalEl.addEventListener('show.bs.modal', () => profileManagerModalEl.classList.add('blur-backdrop'));
        renameProfileModalEl.addEventListener('hide.bs.modal', () => profileManagerModalEl.classList.remove('blur-backdrop'));
        confirmationModalEl.addEventListener('show.bs.modal', () => profileManagerModalEl.classList.add('blur-backdrop'));
        confirmationModalEl.addEventListener('hide.bs.modal', () => profileManagerModalEl.classList.remove('blur-backdrop'));
        attendanceImportModalEl.addEventListener('show.bs.modal', () => {
            document.querySelector('.hero').style.filter = 'blur(4px)';
            document.querySelector('#Auto-Calculator').style.filter = 'blur(4px)';
        });
        attendanceImportModalEl.addEventListener('hide.bs.modal', () => {
            document.querySelector('.hero').style.filter = 'none';
            document.querySelector('#Auto-Calculator').style.filter = 'none';
        });
      }

      function initScrollAnimations() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-in-on-scroll').forEach(el => observer.observe(el));
      }

      function initBackToTop() {
        window.addEventListener('scroll', () => backToTopButton.classList.toggle('visible', window.pageYOffset > 300));
        backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
      }

      function createToastContainer() {
        if (!document.getElementById('toast-container')) {
          const toastContainer = document.createElement('div');
          toastContainer.id = 'toast-container';
          document.body.appendChild(toastContainer);
        }
      }

      function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) return;
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        const icons = { success: 'fa-circle-check', error: 'fa-circle-exclamation', warning: 'fa-triangle-exclamation', info: 'fa-circle-info' };
        toast.innerHTML = `<div class="toast-content"><i class="toast-icon fa-solid ${icons[type]}"></i><span class="toast-message">${message}</span></div><div class="toast-progress"></div>`;
        toastContainer.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      function initCustomCursor() {
        document.addEventListener('mousemove', (e) => {
          if (window.innerWidth > 768) {
             cursorDot.style.display = 'block';
             cursorDot.style.left = `${e.clientX}px`;
             cursorDot.style.top = `${e.clientY}px`;
          } else {
             cursorDot.style.display = 'none';
          }
        });
      }

      function initTheme() {
        const THEME_KEY = 'uaf-theme';
        const applyTheme = (theme) => {
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem(THEME_KEY, theme);
          themeToggle.innerHTML = theme === 'dark' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
          renderGpaChart(); // Re-render chart for theme change
        };
        const currentTheme = localStorage.getItem(THEME_KEY) || 'light';
        applyTheme(currentTheme);
        themeToggle.addEventListener('click', () => applyTheme(document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light'));
      }

      function initContactForm() {
        contactForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (!contactForm.checkValidity()) {
            e.stopPropagation(); contactForm.classList.add('was-validated'); return;
          }
          const data = new FormData(contactForm);
          const statusEl = document.getElementById('contact-form-status');
          try {
            statusEl.textContent = 'Sending...'; statusEl.className = 'text-info small';
            const res = await fetch(contactForm.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } });
            if (res.ok) {
              statusEl.textContent = "Thanks! We'll get back to you soon.";
              statusEl.className = "text-success small";
              contactForm.reset(); contactForm.classList.remove('was-validated');
              showToast('Message sent successfully!', 'success');
            } else {
              const errorData = await res.json().catch(() => ({}));
              throw new Error(errorData.error || 'Form submission failed');
            }
          } catch(err) {
            console.error("Contact form error:", err);
            statusEl.textContent = `Oops! There was a problem. Please try again.`;
            statusEl.className = "text-danger small";
            showToast('Failed to send message.', 'error');
          }
        });
      }

      function addStatusMessage(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        allLogs.push({ timestamp, message, type });
        const messageEl = document.createElement('div');
        messageEl.className = `status-line status-${type}`;
        messageEl.textContent = `[${timestamp}] ${message}`;
        statusLog.prepend(messageEl);
        statusLog.scrollTop = 0;
      }

      function showLoadingStage(stage) {
        ['connecting', 'fetching', 'processing', 'complete'].forEach(s => {
          const el = document.getElementById(`${s}Stage`);
          if (el) el.style.display = 'none';
        });
        if (stage) {
            const el = document.getElementById(`${stage}Stage`);
            if (el) el.style.display = 'block';
        }
        loadingContainer.style.display = stage ? 'block' : 'none';
      }

      function downloadLog() {
        addStatusMessage('Preparing log file for download...', 'info');
        let logContent = "UAF CGPA Calculator - M SAQLAIN - Activity Log\n============================================\n\n";
        allLogs.slice().reverse().forEach(log => logContent += `[${log.timestamp}] ${log.message}\n`);
        const blob = new Blob([logContent], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `cgpa_calculator_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
        addStatusMessage('Log file downloaded successfully', 'success');
        showToast('Log file downloaded!', 'success');
      }

      function clearLog() {
        statusLog.innerHTML = ''; allLogs = [];
        addStatusMessage('Log cleared', 'info');
        showToast('Log cleared', 'info');
      }

      function processSemesterName(semester) {
          if (!semester) return 'Unknown Semester';
          const semesterLower = semester.toLowerCase();
          const yearRangeMatch = semesterLower.match(/(\d{4})-(\d{2,4})/);
          const singleYearMatch = semesterLower.match(/\b(\d{4})\b/);
          let season = 'Unknown', year = '';
          if (semesterLower.includes('spring')) {
              season = 'Spring';
              if (yearRangeMatch) year = yearRangeMatch[2];
              else if (singleYearMatch) year = (parseInt(singleYearMatch[1]) + 1).toString();
              if (year.length === 2) year = `20${year}`;
          } else if (semesterLower.includes('winter')) {
              season = 'Winter';
              if (yearRangeMatch) year = yearRangeMatch[1];
              else if (singleYearMatch) year = singleYearMatch[1];
          } else if (semesterLower.includes('summer')) {
              season = 'Summer';
              if (yearRangeMatch) year = yearRangeMatch[1];
              else if (singleYearMatch) year = singleYearMatch[1];
          } else if (semesterLower.includes('fall')) {
              season = 'Fall';
              if (yearRangeMatch) year = yearRangeMatch[1];
              else if (singleYearMatch) year = singleYearMatch[1];
          }
          if (season !== 'Unknown' && year) return `${season} ${year}`;
          const attendanceMatch = semesterLower.match(/^(winter|spring|summer|fall)(\d{2})$/);
          if (attendanceMatch) return `${attendanceMatch[1].charAt(0).toUpperCase() + attendanceMatch[1].slice(1)} 20${attendanceMatch[2]}`;
          return semester.length > 0 ? semester.charAt(0).toUpperCase() + semester.slice(1) : 'Unknown Semester';
      }

      function getSemesterOrderKey(processedSemesterName) {
        if (!processedSemesterName) return '9999-9';
        const semesterLower = processedSemesterName.toLowerCase();
        if (semesterLower.startsWith('forecast')) {
            const num = parseInt(semesterLower.split(' ')[1] || '1');
            return `3000-${num.toString().padStart(2, '0')}`;
        }
        const yearMatch = semesterLower.match(/\b(\d{4})\b/);
        if (!yearMatch) return '9999-9';
        const year = parseInt(yearMatch[1]);
        let academicYearStart = year, seasonOrder = 9;
        if (semesterLower.includes('fall')) { seasonOrder = 1; academicYearStart = year; }
        else if (semesterLower.includes('winter')) { seasonOrder = 2; academicYearStart = year; }
        else if (semesterLower.includes('spring')) { seasonOrder = 3; academicYearStart = year - 1; }
        else if (semesterLower.includes('summer')) { seasonOrder = 4; academicYearStart = year - 1; }
        return `${academicYearStart}-${seasonOrder}`;
      }

      function formatNumber(value, places = 4) {
          const num = parseFloat(value);
          return isNaN(num) ? 0 : parseFloat(num.toFixed(places));
      }

      function showUndoNotification(message, undoCallback) {
        document.getElementById('undo-notification')?.remove();
        const notification = document.createElement('div');
        notification.id = 'undo-notification';
        notification.className = 'undo-notification';
        notification.innerHTML = `<span>${message}</span> <button class="undo-btn">Undo</button>`;
        document.body.appendChild(notification);
        const undoButton = notification.querySelector('.undo-btn');
        const timeoutId = setTimeout(() => notification.remove(), 5000);
        undoButton.onclick = () => {
            clearTimeout(timeoutId);
            undoCallback();
            notification.remove();
        };
      }

      function copyDetailsToClipboard() {
          if (!processedData) return;
          let textToCopy;
          if (bedModeActive) {
                const activeTabId = document.querySelector('#bedTab .nav-link.active').id;
                if (activeTabId === 'bed-tab') {
                    const bedSemesters = filterSemesters(processedData.semesters, true);
                    const bedCgpa = calculateCGPA({ ...processedData, semesters: bedSemesters });
                    textToCopy = `Name: ${processedData.studentInfo.name}\nRegistration: ${processedData.studentInfo.registration}\nB.Ed. CGPA: ${bedCgpa.cgpa.toFixed(4)}\nB.Ed. Percentage: ${bedCgpa.percentage.toFixed(2)}%`;
                } else {
                    const otherSemesters = filterSemesters(processedData.semesters, false);
                    const otherCgpa = calculateCGPA({ ...processedData, semesters: otherSemesters });
                    textToCopy = `Name: ${processedData.studentInfo.name}\nRegistration: ${processedData.studentInfo.registration}\nOther CGPA: ${otherCgpa.cgpa.toFixed(4)}\nOther Percentage: ${otherCgpa.percentage.toFixed(2)}%`;
                }
          } else {
                const overallCgpa = calculateCGPA(processedData);
                textToCopy = `Name: ${processedData.studentInfo.name}\nRegistration: ${processedData.studentInfo.registration}\nOverall CGPA: ${overallCgpa.cgpa.toFixed(4)}\nOverall Percentage: ${overallCgpa.percentage.toFixed(2)}%`;
          }
          try {
              if (navigator.clipboard && navigator.clipboard.writeText) {
                  navigator.clipboard.writeText(textToCopy).then(() => {
                      showToast('Details copied to clipboard!', 'success');
                  }, () => fallbackCopyTextToClipboard(textToCopy));
              } else { fallbackCopyTextToClipboard(textToCopy); }
          } catch (e) { fallbackCopyTextToClipboard(textToCopy); }
      }

      function fallbackCopyTextToClipboard(text) {
          const textArea = document.createElement("textarea");
          textArea.value = text;
          textArea.style.top = "0"; textArea.style.left = "0"; textArea.style.position = "fixed";
          document.body.appendChild(textArea);
          textArea.focus(); textArea.select();
          try {
              if (document.execCommand('copy')) showToast('Details copied to clipboard!', 'success');
              else showToast('Failed to copy details (fallback).', 'error');
          } catch (err) { showToast('Failed to copy details (fallback).', 'error'); }
          document.body.removeChild(textArea);
      }

      // --- 8. Core Data Processing & Calculation ---
      function processScrapedData(data) {
        if (!data || !data.resultData) return null;
        const studentInfo = { name: data.resultData[0]?.StudentName || '', registration: data.resultData[0]?.RegistrationNo || '' };
        const semesters = {};
        const courseHistory = {};
        let hasBedCourses = false;

        data.resultData.forEach(course => {
          const originalSemester = course.Semester || 'Unknown Semester';
          const semesterName = processSemesterName(originalSemester);
          const courseCode = (course.CourseCode || '').trim().toUpperCase();
          if (!courseCode) return; // Skip rows without course codes

          if (BED_COURSES.has(courseCode)) hasBedCourses = true;

          if (!semesters[semesterName]) {
            semesters[semesterName] = { originalName: originalSemester, sortKey: getSemesterOrderKey(semesterName), courses: [] };
          }

          const creditHoursStr = course.CreditHours || '0';
          const creditHoursMatch = creditHoursStr.match(/^(\d+(\.\d+)?)/);
          const creditHours = creditHoursMatch ? parseFloat(creditHoursMatch[1]) : 0;
          const marks = parseFloat(course.Total || '0');
          const grade = (course.Grade || '').trim().toUpperCase();

          const qualityPoints = calculateQualityPoints(marks, creditHours, grade);

          const courseData = {
            code: courseCode, title: course.CourseTitle || '', creditHours, creditHoursDisplay: creditHoursStr,
            marks, qualityPoints, grade, teacher: course.TeacherName || '', mid: course.Mid || '0',
            assignment: course.Assignment || '0', final: course.Final || '0', practical: course.Practical || '0',
            isExtraEnrolled: false, isRepeated: false, isDeleted: false, isCustom: false, originalSemester
          };

          if (!courseHistory[courseCode]) courseHistory[courseCode] = [];
          courseHistory[courseCode].push({ semester: semesterName, semesterSortKey: semesters[semesterName].sortKey, marks, data: courseData });
          semesters[semesterName].courses.push(courseData);
        });

        Object.values(courseHistory).forEach(history => {
          if (history.length > 1) {
            history.sort((a, b) => a.semesterSortKey.localeCompare(b.semesterSortKey));
            const passedCourses = history.filter(item => item.data.grade !== 'F');
            let bestAttempt;
            if (passedCourses.length > 0) bestAttempt = passedCourses.reduce((prev, current) => (prev.marks >= current.marks) ? prev : current);
            else bestAttempt = history[history.length - 1]; // Use last F if all F
            history.forEach(item => {
              item.data.isRepeated = true;
              if (item !== bestAttempt) item.data.isExtraEnrolled = true;
              else item.data.isExtraEnrolled = false;
            });
          }
        });
        return { studentInfo, semesters, courseHistory, hasBedCourses };
      }

      function calculateQualityPoints(marks, creditHours, grade) {
          marks = parseFloat(marks);
          creditHours = parseFloat(creditHours);
          if (isNaN(creditHours) || creditHours <= 0) return 0;
          grade = (grade || '').trim().toUpperCase();

          // Grade-based calculation (Preferred)
          const gradePointMap = { 'A': 4.0, 'B+': 3.5, 'B': 3.0, 'C+': 2.5, 'C': 2.0, 'D': 1.0, 'F': 0.0, 'P': 4.0 };
          if (grade && gradePointMap.hasOwnProperty(grade)) {
              return parseFloat((gradePointMap[grade] * creditHours).toFixed(2));
          }
          if (isNaN(marks)) return 0; // If no grade and no marks, return 0

          // Fallback to marks-based logic (Original)
          let qualityPoints = 0;
          let intCreditHours = Math.round(creditHours); // Original logic used integer CH
          if (intCreditHours === 10) { if (marks >= 160) qualityPoints = 40; else if (marks >= 100) qualityPoints = 40 - ((160 - marks) * 0.33333); else if (marks < 100) qualityPoints = 20 - ((100 - marks) * 0.5); if (marks < 80) qualityPoints = 0; }
          else if (intCreditHours === 9) { if (marks >= 144) qualityPoints = 36; else if (marks >= 90) qualityPoints = 36 - ((144 - marks) * 0.33333); else if (marks < 90) qualityPoints = 18 - ((90 - marks) * 0.5); if (marks < 72) qualityPoints = 0; }
          else if (intCreditHours === 8) { if (marks >= 128) qualityPoints = 32; else if (marks >= 80) qualityPoints = 32 - ((128 - marks) * 0.33333); else if (marks < 80) qualityPoints = 16 - ((80 - marks) * 0.5); if (marks < 64) qualityPoints = 0; }
          else if (intCreditHours === 7) { if (marks >= 112) qualityPoints = 28; else if (marks >= 70) qualityPoints = 28 - ((112 - marks) * 0.33333); else if (marks < 70) qualityPoints = 14 - ((70 - marks) * 0.5); if (marks < 56) qualityPoints = 0; }
          else if (intCreditHours === 6) { if (marks >= 96) qualityPoints = 24; else if (marks >= 60) qualityPoints = 24 - ((96 - marks) * 0.33333); else if (marks < 60) qualityPoints = 12 - ((60 - marks) * 0.5); if (marks < 48) qualityPoints = 0; }
          else if (intCreditHours === 5) { if (marks >= 80) qualityPoints = 20; else if (marks >= 50) qualityPoints = 20 - ((80 - marks) * 0.33333); else if (marks < 50) qualityPoints = 10 - ((50 - marks) * 0.5); if (marks < 40) qualityPoints = 0; }
          else if (intCreditHours === 4) { if (marks >= 64) qualityPoints = 16; else if (marks >= 40) qualityPoints = 16 - ((64 - marks) * 0.33333); else if (marks < 40) qualityPoints = 8 - ((40 - marks) * 0.5); if (marks < 32) qualityPoints = 0; }
          else if (intCreditHours === 3) { if (marks >= 48) qualityPoints = 12; else if (marks >= 30) qualityPoints = 12 - ((48 - marks) * 0.33333); else if (marks < 30) qualityPoints = 6 - ((30 - marks) * 0.5); if (marks < 24) qualityPoints = 0; }
          else if (intCreditHours === 2) { if (marks >= 32) qualityPoints = 8; else if (marks >= 20) qualityPoints = 8 - ((32 - marks) * 0.33333); else if (marks < 20) qualityPoints = 4 - ((20 - marks) * 0.5); if (marks < 16) qualityPoints = 0; }
          else if (intCreditHours === 1) { if (marks >= 16) qualityPoints = 4; else if (marks >= 10) qualityPoints = 4 - ((16 - marks) * 0.33333); else if (marks < 10) qualityPoints = 2 - ((10 - marks) * 0.5); if (marks < 8) qualityPoints = 0; }
          // Handle non-integer CH by scaling from a 1-CH base (approximation)
          else { qualityPoints = calculateQualityPoints(marks / creditHours, 1, grade) * creditHours; }
          
          return parseFloat(Math.max(0, qualityPoints).toFixed(2));
      }

      function calculateCustomGrade(marks, creditHours) {
        // This function should be aligned with the official UAF grade boundaries
        // Using a percentage-based estimation for simplicity
        const intCreditHours = Math.round(creditHours);
        const maxMarks = { 10: 200, 9: 180, 8: 160, 7: 140, 6: 120, 5: 100, 4: 80, 3: 60, 2: 40, 1: 20 }[intCreditHours] || (intCreditHours * 20);
        if (maxMarks === 0) return 'F'; // Avoid division by zero
        const percentage = (marks / maxMarks) * 100;

        if (percentage >= 80) return 'A';
        // Note: This is simplified. UAF uses B+, B, C+, C.
        // A more accurate mapping is needed if available.
        else if (percentage >= 65) return 'B';
        else if (percentage >= 50) return 'C';
        else if (percentage >= 40) return 'D';
        else return 'F';
      }

      function calculateCGPA(data) {
        if (!data || !data.semesters) return { cgpa: 0, percentage: 0, totalQualityPoints: 0, totalCreditHours: 0, totalMarksObtained: 0, totalMaxMarks: 0 };

        let totalQualityPoints = 0, totalCreditHours = 0, totalMarksObtained = 0, totalMaxMarks = 0;
        
        const courseHistory = {};
        Object.entries(data.semesters).forEach(([semesterName, semester]) => {
            if (!Array.isArray(semester.courses)) return; // Skip if semester.courses is not an array
            semester.courses.forEach(course => {
                if (course.isDeleted) return;
                const historyKey = course.code.toUpperCase().trim();
                if (!historyKey) return; // Skip if no course code
                if (!courseHistory[historyKey]) courseHistory[historyKey] = [];
                courseHistory[historyKey].push({
                    semester: semesterName, semesterSortKey: semester.sortKey, marks: course.marks, data: course
                });
            });
        });

        Object.values(courseHistory).flat().forEach(item => { item.data.isExtraEnrolled = false; item.data.isRepeated = false; }); // Reset flags

        Object.values(courseHistory).forEach(history => {
            if (history.length > 1) {
                history.sort((a, b) => (a.semesterSortKey || '').localeCompare(b.semesterSortKey || ''));
                const passedCourses = history.filter(item => item.data.grade !== 'F');
                let bestAttempt;
                if (passedCourses.length > 0) bestAttempt = passedCourses.reduce((prev, current) => (prev.marks >= current.marks) ? prev : current);
                else bestAttempt = history[history.length - 1];
                history.forEach(item => {
                    item.data.isRepeated = true;
                    if (item !== bestAttempt) item.data.isExtraEnrolled = true;
                });
            }
        });

        Object.values(data.semesters).forEach(semester => {
            semester.totalQualityPoints = 0; semester.totalCreditHours = 0;
            semester.totalMarksObtained = 0; semester.totalMaxMarks = 0;
            if (!Array.isArray(semester.courses)) return; // Skip if bad data

            semester.courses.forEach(course => {
                if (!course.isExtraEnrolled && !course.isDeleted) {
                    const creditHours = parseFloat(course.creditHours) || 0;
                    const qualityPoints = parseFloat(course.qualityPoints) || 0;
                    const marks = parseFloat(course.marks) || 0;
                    
                    semester.totalQualityPoints += qualityPoints;
                    semester.totalCreditHours += creditHours;
                    semester.totalMarksObtained += marks;

                    let maxMarks = 0;
                    const intCreditHours = Math.round(creditHours);
                    if (course.grade === 'P') maxMarks = (intCreditHours === 1) ? 100 : marks;
                    else maxMarks = { 10: 200, 9: 180, 8: 160, 7: 140, 6: 120, 5: 100, 4: 80, 3: 60, 2: 40, 1: 20 }[intCreditHours] || (intCreditHours * 20);
                    semester.totalMaxMarks += maxMarks;

                    totalQualityPoints += qualityPoints;
                    totalCreditHours += creditHours;
                    totalMarksObtained += marks;
                    totalMaxMarks += maxMarks;
                }
            });
            semester.gpa = semester.totalCreditHours > 0 ? (semester.totalQualityPoints / semester.totalCreditHours) : 0;
            semester.percentage = semester.totalMaxMarks > 0 ? (semester.totalMarksObtained / semester.totalMaxMarks * 100) : 0;
        });

        const cgpa = totalCreditHours > 0 ? (totalQualityPoints / totalCreditHours) : 0;
        const percentage = totalMaxMarks > 0 ? (totalMarksObtained / totalMaxMarks * 100) : 0;
        return { cgpa, percentage, totalQualityPoints, totalCreditHours, totalMarksObtained, totalMaxMarks };
      }

      // --- 9. Course & Semester Modification ---
      function showCourseDetails(course) {
          if (!course) return;
          let formattedSemester = course.originalSemester || 'Unknown Semester';
          formattedSemester = formattedSemester.replace(' Semester', '');
          formattedSemester = formattedSemester.replace(/(\d{4})-(\d{4})/, (match, y1, y2) => `${y1}-${y2.substring(2)}`);

          document.getElementById('courseDetailsModalTitle').textContent = `${course.code} - ${course.title || 'N/A'}`;
          document.getElementById('courseDetailsModalBody').innerHTML = `
            <div class="mb-3 border-bottom pb-3"><h6 class="text-muted fw-bold small text-uppercase mb-2">Details</h6><div class="row g-2">
              <div class="col-12 col-sm-6"><p class="mb-1 small"><i class="fa-solid fa-chalkboard-user fa-fw me-2 text-primary"></i><strong>Teacher:</strong> ${course.teacher || 'N/A'}</p></div>
              <div class="col-12 col-sm-6"><p class="mb-1 small"><i class="fa-solid fa-calendar-alt fa-fw me-2 text-primary"></i><strong>Semester:</strong> ${formattedSemester}</p></div>
              <div class="col-12"><p class="mb-0 small"><i class="fa-solid fa-hourglass-half fa-fw me-2 text-primary"></i><strong>Credit Hours:</strong> ${course.creditHoursDisplay || course.creditHours}</p></div>
            </div></div>
            <div class="mb-3 border-bottom pb-3"><h6 class="text-muted fw-bold small text-uppercase mb-2">Marks Breakdown</h6><div class="row g-2">
              <div class="col-6 col-sm-3"><p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-file-pen fa-fw me-1 text-info"></i><strong>Mid:</strong> ${course.mid || 'N/A'}</p></div>
              <div class="col-6 col-sm-3"><p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-clipboard fa-fw me-1 text-info"></i><strong>Assign:</strong> ${course.assignment || 'N/A'}</p></div>
              <div class="col-6 col-sm-3"><p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-flag-checkered fa-fw me-1 text-info"></i><strong>Final:</strong> ${course.final || 'N/A'}</p></div>
              ${course.practical && course.practical !== '0' ? `<div class="col-6 col-sm-3"><p class="mb-1 small text-center text-sm-start"><i class="fa-solid fa-flask-vial fa-fw me-1 text-info"></i><strong>Prac:</strong> ${course.practical}</p></div>` : ''}
            </div></div>
            <div><h6 class="text-muted fw-bold small text-uppercase mb-2">Result</h6><div class="d-flex flex-wrap justify-content-around align-items-center bg-light rounded p-2" style="background-color: rgba(122, 106, 216, 0.05) !important;">
              <div class="text-center px-2"><span class="small text-muted">Total Marks</span><p class="fs-5 fw-bold mb-0 text-primary">${course.marks !== undefined ? course.marks : 'N/A'}</p></div>
              <div class="text-center px-2"><span class="small text-muted">Grade</span><p class="fs-5 mb-0"><span class="grade-badge grade-${course.grade}">${course.grade || 'N/A'}</span></p></div>
              <div class="text-center px-2"><span class="small text-muted">Quality Points</span><p class="fs-5 fw-bold mb-0 text-primary">${course.qualityPoints !== undefined ? course.qualityPoints.toFixed(2) : 'N/A'}</p></div>
            </div></div>
            ${course.isExtraEnrolled ? `<div class="alert alert-warning d-flex align-items-center mt-3 small p-2"><i class="fa-solid fa-info-circle me-2"></i> This is a repeated course attempt and not the highest grade. It is not counted in the CGPA.</div>` : ''}
            ${course.isRepeated && !course.isExtraEnrolled ? `<div class="alert alert-success d-flex align-items-center mt-3 small p-2"><i class="fa-solid fa-check-circle me-2"></i> This is the highest scoring attempt for this repeated course and is used in CGPA calculation.</div>` : ''}
            ${course.isCustom ? `<div class="alert alert-info d-flex align-items-center mt-3 small p-2"><i class="fa-solid fa-pencil me-2"></i> This is a custom course${course.source === 'attendance' ? ' (from Attendance System)' : ''}.</div>` : ''}`;
          courseDetailsModal.show();
      }

      function openAddCourseModal(semesterName) {
        document.getElementById('addCourseSemester').value = semesterName;
        addCourseForm.reset();
        document.getElementById('creditHours').value = '3'; // Default to 3
        addCourseModal.show();
      }

      function addCustomCourse() {
        const semesterName = document.getElementById('addCourseSemester').value;
        const courseCode = document.getElementById('courseCode').value.trim().toUpperCase();
        const courseTitle = document.getElementById('courseTitle').value.trim();
        const creditHours = parseFloat(document.getElementById('creditHours').value);
        const marks = parseFloat(document.getElementById('courseMarks').value);

        if (!semesterName || !processedData?.semesters[semesterName]) {
             showToast('Invalid semester.', 'error'); return;
        }
        if (!courseCode || !courseTitle || isNaN(creditHours) || creditHours <= 0 || isNaN(marks)) {
          showToast('Please fill all fields correctly.', 'error'); return;
        }
        if (marks < 0 || marks > 200) { // Max marks can be 200 (for 10CH)
             showToast('Marks must be realistic (e.g., 0-200).', 'error'); return;
        }
        
        if (bedModeActive) {
            const isBedCourse = BED_COURSES.has(courseCode);
            const targetTabIsBed = !!document.getElementById('bed-semesterResults').querySelector(`[data-semester="${semesterName}"]`);
            const targetTabIsOther = !!document.getElementById('other-semesterResults').querySelector(`[data-semester="${semesterName}"]`);
            if (isBedCourse && targetTabIsOther) { showToast(`Cannot add B.Ed. course (${courseCode}) to "Other" semester.`, 'warning'); return; }
            if (!isBedCourse && targetTabIsBed) { showToast(`Cannot add non-B.Ed. course (${courseCode}) to "B.Ed." semester.`, 'warning'); return; }
        }

        const grade = calculateCustomGrade(marks, creditHours);
        const qualityPoints = calculateQualityPoints(marks, creditHours, grade);
        const creditHoursDisplay = `${creditHours}(${creditHours}-0)`;

        const newCourse = {
            code: courseCode, title: courseTitle, creditHours, creditHoursDisplay, marks,
            qualityPoints, grade, semesterName, teacher: 'Custom', mid: 'N/A', assignment: 'N/A', final: marks, practical: 'N/A', total: marks,
            isExtraEnrolled: false, isRepeated: false, isDeleted: false, isCustom: true, source: 'manual', originalSemester: semesterName
        };

        const semester = processedData.semesters[semesterName];
        if (semester.courses.some(c => !c.isDeleted && c.code.toUpperCase() === newCourse.code)) {
            showToast(`Course ${newCourse.code} already exists in ${semesterName}.`, 'warning'); return;
        }

        semester.courses.push(newCourse);
        recalculateAndDisplay();
        addCourseModal.hide();
        showToast(`Course ${courseCode} added`, 'success');
        addStatusMessage(`Added custom course: ${courseCode} to ${semesterName}`, 'info');
      }

      function deleteSemester(event, semesterName) {
        event.preventDefault();
        if (!processedData || !processedData.semesters[semesterName]) return;
        deletedSemesters[semesterName] = JSON.parse(JSON.stringify(processedData.semesters[semesterName]));
        delete processedData.semesters[semesterName];
        recalculateAndDisplay();
        showUndoNotification(`Semester "${semesterName}" deleted`, () => undoDeleteSemester(semesterName));
        addStatusMessage(`Deleted semester: ${semesterName}`, 'info');
      }

      function undoDeleteSemester(semesterName) {
        if (!deletedSemesters[semesterName] || !processedData) return;
        processedData.semesters[semesterName] = deletedSemesters[semesterName];
        delete deletedSemesters[semesterName];
        recalculateAndDisplay();
        addStatusMessage(`Restored semester: ${semesterName}`, 'info');
        showToast(`Semester "${semesterName}" restored.`, 'success');
      }

      function modifyCourseState(event, course, semesterName, isDeleted) {
        event.preventDefault();
        if (!processedData || !processedData.semesters[semesterName] || !course) return;
        const semester = processedData.semesters[semesterName];
        const courseIndex = semester.courses.findIndex(c =>
            c.code === course.code && c.creditHours === course.creditHours &&
            c.marks === course.marks && c.isCustom === course.isCustom && c.source === course.source
        );
        if (courseIndex !== -1) {
          semester.courses[courseIndex].isDeleted = isDeleted;
          recalculateAndDisplay();
          const action = isDeleted ? 'Deleted' : 'Restored';
          showToast(`Course ${course.code} ${action.toLowerCase()}`, 'info');
          addStatusMessage(`${action} course: ${course.code} from ${semesterName}`, 'info');
        } else {
          console.error("Could not find exact course to modify state:", course, "in semester:", semesterName);
          showToast(`Error modifying course ${course.code}.`, 'error');
        }
      }

      function addForecastSemester() {
         if (!processedData) { showToast("Please load or fetch results first.", "warning"); return; }
        let forecastCount = 1;
        while (processedData.semesters[`Forecast ${forecastCount}`]) forecastCount++;
        const newSemesterName = `Forecast ${forecastCount}`;
        processedData.semesters[newSemesterName] = {
            originalName: newSemesterName, sortKey: getSemesterOrderKey(newSemesterName), courses: []
        };
        recalculateAndDisplay();
        showToast(`Added "${newSemesterName}"`, 'success');
        addStatusMessage(`Added forecast semester: ${newSemesterName}`, 'info');

        setTimeout(() => {
          const newCard = document.querySelector(`[data-semester="${newSemesterName}"]`);
          if (newCard) {
            newCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            newCard.style.transition = 'background-color 0.5s ease-out';
            newCard.style.backgroundColor = 'rgba(122, 106, 216, 0.1)';
            setTimeout(() => { newCard.style.backgroundColor = ''; }, 1000);
          }
        }, 100);
      }

      function openRenameSemesterModal(oldSemesterName) {
        if (!processedData || !processedData.semesters[oldSemesterName]) return;
        const isForecastOrCustomOnly = oldSemesterName.toLowerCase().startsWith('forecast') ||
                                       processedData.semesters[oldSemesterName].courses.every(c => c.isCustom);
        if (!isForecastOrCustomOnly) {
             showToast("Only Forecast or custom-only semesters can be renamed.", "warning"); return;
        }
        const newSemesterName = prompt("Enter a new name for this semester:", oldSemesterName);
        if (newSemesterName && newSemesterName.trim() !== "" && newSemesterName.trim() !== oldSemesterName) {
          const trimmedName = newSemesterName.trim();
          if (processedData.semesters[trimmedName]) {
            showToast(`Semester name "${trimmedName}" already exists.`, 'error'); return;
          }
          const semesterData = processedData.semesters[oldSemesterName];
          semesterData.originalName = trimmedName;
          semesterData.sortKey = getSemesterOrderKey(trimmedName);
          processedData.semesters[trimmedName] = semesterData;
          delete processedData.semesters[oldSemesterName];
          recalculateAndDisplay();
          showToast(`Semester renamed to "${trimmedName}"`, 'success');
          addStatusMessage(`Renamed semester "${oldSemesterName}" to "${trimmedName}"`, 'info');
        } else if (newSemesterName === "") { showToast("Semester name cannot be empty.", 'warning'); }
      }

      // --- 10. PDF Generation ---
      function generatePDF() {
        if (!processedData) { showToast('No data to download', 'error'); return; }

        let dataToPrint, titleSuffix;
        if (bedModeActive) {
            const activeTabId = document.querySelector('#bedTab .nav-link.active').id;
            if (activeTabId === 'bed-tab') {
                const bedSemesters = filterSemesters(processedData.semesters, true);
                dataToPrint = { ...processedData, semesters: bedSemesters };
                titleSuffix = 'B.Ed. Program';
            } else { // 'other-tab'
                const otherSemesters = filterSemesters(processedData.semesters, false);
                dataToPrint = { ...processedData, semesters: otherSemesters };
                titleSuffix = 'Other Programs';
            }
        } else {
            dataToPrint = processedData; titleSuffix = 'Overall';
        }
        addStatusMessage(`Generating premium PDF report (${titleSuffix})...`, 'info');
        showLoadingStage('processing');

        try {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
            const cgpaData = calculateCGPA(dataToPrint);
            const pageMargin = 15; const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight(); const availableWidth = pageWidth - (2 * pageMargin);
            const colors = { primary: '#7a6ad8', textDark: '#1b1f24', textLight: '#4b5563', line: '#e0e0e0', fillLight: '#f8f9ff' };
            let lastY = 0;

            const drawFirstPageHeader = () => {
                pdf.setFontSize(18); pdf.setTextColor(colors.primary); pdf.setFont('helvetica', 'bold');
                pdf.text("University of Agriculture, Faisalabad", pageWidth / 2, 20, { align: 'center' });
                pdf.setFontSize(12); pdf.setTextColor(colors.textLight); pdf.setFont('helvetica', 'normal');
                pdf.text(`Unofficial Academic Transcript (${titleSuffix})`, pageWidth / 2, 28, { align: 'center' });
                pdf.setDrawColor(colors.primary); pdf.setLineWidth(0.5);
                pdf.line(pageMargin, 35, pageWidth - pageMargin, 35); lastY = 35;
            };
            drawFirstPageHeader();

            const topBoxY = lastY + 10, boxHeight = 45, gap = 5;
            const leftBoxWidth = availableWidth * 0.4, rightBoxWidth = availableWidth - leftBoxWidth - gap;
            const rightBoxX = pageMargin + leftBoxWidth + gap;

            pdf.setFillColor(colors.fillLight); pdf.roundedRect(pageMargin, topBoxY, leftBoxWidth, boxHeight, 3, 3, 'F');
            pdf.setFontSize(11); pdf.setFont('helvetica', 'bold'); pdf.setTextColor(colors.textDark);
            pdf.text("Student Information", pageMargin + 5, topBoxY + 8);
            pdf.setDrawColor(colors.line); pdf.line(pageMargin + 5, topBoxY + 11, pageMargin + leftBoxWidth - 5, topBoxY + 11);
            pdf.setFontSize(12); pdf.setFont('helvetica', 'bold'); pdf.setTextColor(colors.primary);
            pdf.text(dataToPrint.studentInfo.name, pageMargin + 5, topBoxY + 25, { maxWidth: leftBoxWidth - 10 });
            pdf.setFontSize(8); pdf.setFont('helvetica', 'normal'); pdf.setTextColor(colors.textLight);
            pdf.text(dataToPrint.studentInfo.registration, pageMargin + 5, topBoxY + 30);
            pdf.setFillColor(colors.fillLight); pdf.roundedRect(rightBoxX, topBoxY, rightBoxWidth, boxHeight, 3, 3, 'F');
            pdf.setFontSize(11); pdf.setFont('helvetica', 'bold'); pdf.setTextColor(colors.textDark);
            pdf.text(`${titleSuffix} Academic Summary`, rightBoxX + 5, topBoxY + 8);
            pdf.line(rightBoxX + 5, topBoxY + 11, rightBoxX + rightBoxWidth - 5, topBoxY + 11);
            pdf.setFontSize(22); pdf.setFont('helvetica', 'bold'); pdf.setTextColor(colors.primary);
            pdf.text(formatNumber(cgpaData.cgpa, 4).toFixed(4), rightBoxX + 5, topBoxY + 25);
            pdf.setFontSize(8); pdf.setTextColor(colors.textLight);
            pdf.text(`${titleSuffix.toUpperCase()} CGPA`, rightBoxX + 5, topBoxY + 29);
            const statsStartX = rightBoxX + 40;
            pdf.setFont('helvetica', 'bold');
            pdf.text("Percentage:", statsStartX, topBoxY + 20);
            pdf.text("Total Credits:", statsStartX, topBoxY + 28);
            pdf.text("Total Marks:", statsStartX, topBoxY + 36);
            pdf.setFont('helvetica', 'normal'); pdf.setTextColor(colors.textDark);
            pdf.text(`${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`, statsStartX + 25, topBoxY + 20);
            pdf.text(cgpaData.totalCreditHours.toString(), statsStartX + 25, topBoxY + 28);
            pdf.text(`${cgpaData.totalMarksObtained.toFixed(0)} / ${cgpaData.totalMaxMarks.toFixed(0)}`, statsStartX + 25, topBoxY + 36);
            lastY = topBoxY + boxHeight;

            let semesterIndex = 0;
            Object.keys(dataToPrint.semesters).sort((a, b) => dataToPrint.semesters[a].sortKey.localeCompare(dataToPrint.semesters[b].sortKey))
                .forEach(semesterName => {
                    semesterIndex++;
                    const semester = dataToPrint.semesters[semesterName];
                    const activeCourses = semester.courses.filter(c => !c.isDeleted);
                    if (activeCourses.length === 0) return;

                    const semesterSummary = `GPA: ${formatNumber(semester.gpa, 4).toFixed(4)}  |  Credits: ${semester.totalCreditHours}  |  Marks: ${semester.totalMarksObtained.toFixed(0)}/${semester.totalMaxMarks.toFixed(0)}`;
                    if (lastY + 30 > pageHeight - 30) { pdf.addPage(); lastY = 20; }
                    const semesterHeaderY = lastY + 12;
                    pdf.setFontSize(14); pdf.setFont('helvetica', 'bold'); pdf.setTextColor(colors.primary);
                    pdf.text(`${semesterIndex}. ${semesterName}`, pageMargin, semesterHeaderY);
                    pdf.setFontSize(9); pdf.setFont('helvetica', 'bold'); pdf.setTextColor(colors.textDark);
                    pdf.text(semesterSummary, pageWidth - pageMargin, semesterHeaderY, { align: 'right' });
                    lastY = semesterHeaderY + 2;

                    const head = [['Course Code', 'Course Title', 'CH', 'Marks', 'Grade']];
                    const body = activeCourses.map(c => [
                        c.code + (c.isCustom ? '*' : ''), c.title || (c.isCustom ? 'Custom Course' : 'N/A'),
                        c.creditHoursDisplay || c.creditHours, c.marks.toFixed(0), c.grade
                    ]);
                    pdf.autoTable({
                        head, body, startY: lastY, margin: { left: pageMargin, right: pageMargin },
                        headStyles: { fillColor: colors.primary, textColor: '#ffffff', fontStyle: 'bold', halign: 'center', valign: 'middle' },
                        columnStyles: {
                            0: { halign: 'left', cellWidth: availableWidth * 0.18 }, 1: { halign: 'left', cellWidth: availableWidth * 0.46, cellPadding: { left: 2 } },
                            2: { halign: 'center', cellWidth: availableWidth * 0.12 }, 3: { halign: 'center', cellWidth: availableWidth * 0.12 }, 4: { halign: 'center', cellWidth: availableWidth * 0.12 }
                        },
                        styles: { valign: 'middle', cellPadding: 2.2, fontSize: 9, overflow: 'linebreak' },
                        alternateRowStyles: { fillColor: '#f8f9ff' },
                        didDrawPage: (data) => { lastY = data.cursor.y; }
                    });
                    lastY = pdf.lastAutoTable.finalY;
                    if (lastY < pageHeight - 30) {
                         pdf.setDrawColor(colors.line); pdf.setLineWidth(0.3);
                         pdf.line(pageMargin, lastY + 6, pageWidth - pageMargin, lastY + 6);
                         lastY += 6;
                    }
                });

            const totalPages = pdf.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(9); pdf.setTextColor(colors.textLight); pdf.setFont('helvetica', 'italic');
                const footerY = pageHeight - 15;
                pdf.text("Generated by UAF CGPA Calculator - M Saqlain (uafcgpacalculator.vercel.app)", pageWidth / 2, footerY, { align: 'center' });
                pdf.text("This is an unofficial transcript. * indicates a custom course added manually.", pageWidth / 2, footerY + 5, { align: 'center' });
                pdf.setFontSize(8).setTextColor('#b0b0b0');
                pdf.text(`Page ${i} of ${totalPages}`, pageWidth - pageMargin, pageHeight - 10, { align: 'right' });
            }

            const safeSuffix = titleSuffix.replace(/ /g, '_');
            pdf.save(`UAF_Transcript_${dataToPrint.studentInfo.registration}_${safeSuffix}.pdf`);
            addStatusMessage('Premium PDF report generated successfully', 'success');
            showToast('PDF downloaded!', 'success');
        } catch (e) {
            addStatusMessage(`Error generating PDF: ${e.message}`, 'error');
            showToast('Error generating PDF', 'error');
            console.error("PDF generation error: ", e);
        } finally {
            showLoadingStage(null);
        }
      }

      // --- 11. Main Rendering Logic (The Router) ---

      // Re-calculates and re-renders the entire UI based on current data and mode
      function recalculateAndDisplay() {
        if (!processedData) return;
        saveActiveProfile(); // Save changes to localStorage
        renderResults(processedData); // Call the main render router
      }
      
      // Main render router: Decides *which* UI to show (standard or B.Ed. tabs)
      function renderResults(data) {
        if (!data || !data.studentInfo || !data.semesters) {
            console.error("Incomplete data passed to renderResults", data);
            resultContainer.style.display = 'none';
            bedResultContainer.style.display = 'none';
            setupFeatureButtons(); // Hide all feature buttons
            return;
        }

        processedData = data; // Ensure global data is set
        bedModeActive = data.bedMode || false; // Set global mode flag

        // --- NEW LOGIC ---
        // Instead of hiding one container, we show the main container
        // and toggle the *content* inside it.
        resultContainer.style.display = 'block'; // This container holds *all* features
        
        // Find the specific components of the "standard" view
        const standardCgpaCard = resultContainer.querySelector('.gpa-result-card-premium');
        const standardSemesterGrid = document.getElementById('semesterResults');

        if (bedModeActive) {
            // --- B.Ed. Mode ---
            // Hide standard card and grid
            if (standardCgpaCard) standardCgpaCard.style.display = 'none';
            if (standardSemesterGrid) standardSemesterGrid.style.display = 'none';
            
            // Show B.Ed. tab container (which is *inside* the main section)
            bedResultContainer.style.display = 'block';
            
            // Populate the B.Ed. tabs
            displayBedResults(data); // This populates tabs

            // Ensure B.Ed tab is shown by default if just loaded
            const bedTabTrigger = new bootstrap.Tab(document.getElementById('bed-tab'));
            bedTabTrigger.show();

        } else {
            // --- Standard Mode ---
            // Show standard card and grid
            if (standardCgpaCard) standardCgpaCard.style.display = 'block';
            if (standardSemesterGrid) standardSemesterGrid.style.display = 'grid'; // Use grid as per your CSS

            // Hide B.Ed. tab container
            bedResultContainer.style.display = 'none';
            
            // Populate the standard view
            const cgpaData = calculateCGPA(data);
            displayCGPAResults(data, cgpaData); // This populates standard card + grid
        }

        // Common actions for both modes:
        // Update the *single* student info header (assuming it's in resultContainer, not bedResultContainer)
        if (studentName) studentName.innerHTML = `<i class="fa-solid fa-user-graduate me-2"></i>${data.studentInfo.name || 'N/A'}`;
        if (studentReg) studentReg.textContent = data.studentInfo.registration || 'N/A';
        
        // Render the *single* GPA chart (it will be tab-aware)
        renderGpaChart();
        
        // Show/Hide the *single* set of feature buttons
        setupFeatureButtons(); 
        
        // Attach event listeners to *all* newly rendered content
        attachResultEventListeners();
      }

      // Populates the standard (non-tabbed) view
      function displayCGPAResults(data, cgpaData) {
        // This function no longer manages container visibility
        
        // 1. Update the main CGPA card values
        totalCgpa.textContent = formatNumber(cgpaData.cgpa).toFixed(4);
        totalPercentage.textContent = `${formatNumber(cgpaData.percentage, 2).toFixed(2)}%`;
        totalMarksObtained.textContent = cgpaData.totalMarksObtained.toFixed(0);
        totalMaxMarks.textContent = `/ ${cgpaData.totalMaxMarks.toFixed(0)}`;
        const cgpaCircle = document.getElementById('cgpaCircle');
        if(cgpaCircle) {
            const cgpaVal = parseFloat(totalCgpa.textContent);
            const percentageVal = isNaN(cgpaVal) ? 0 : (cgpaVal / 4.0) * 100;
            setTimeout(() => { cgpaCircle.style.strokeDasharray = `${percentageVal}, 100`; }, 100);
        }

        // 2. Render the semester cards into the standard grid
        displaySemesterCards('semesterResults', data);
        
        // 3. (Listeners, Chart, Buttons are handled by renderResults)
      }

      // Populates the B.Ed. (tabbed) view
      function displayBedResults(data) {
        // 1. Filter data
        const bedSemesters = filterSemesters(data.semesters, true);
        const bedData = { ...data, semesters: bedSemesters, courseHistory: data.courseHistory };
        const bedCgpa = calculateCGPA(bedData);

        const otherSemesters = filterSemesters(data.semesters, false);
        const otherData = { ...data, semesters: otherSemesters, courseHistory: data.courseHistory };
        const otherCgpa = calculateCGPA(otherData);

        // 2. Render B.Ed. Tab
        document.getElementById('bed-totalCgpa').textContent = bedCgpa.cgpa.toFixed(4);
        document.getElementById('bed-totalPercentage').textContent = `${bedCgpa.percentage.toFixed(2)}%`;
        document.getElementById('bed-totalMarksObtained').textContent = bedCgpa.totalMarksObtained.toFixed(0);
        document.getElementById('bed-totalMaxMarks').textContent = `/ ${bedCgpa.totalMaxMarks.toFixed(0)}`;
        const bedCircle = document.getElementById('bed-cgpaCircle');
        if (bedCircle) {
            const bedPercentage = isNaN(bedCgpa.cgpa) ? 0 : (bedCgpa.cgpa / 4.0) * 100;
            setTimeout(() => bedCircle.style.strokeDasharray = `${bedPercentage}, 100`, 100);
        }
        displaySemesterCards('bed-semesterResults', bedData);

        // 3. Render Other Tab (with label fix)
        document.getElementById('other-totalCgpa').textContent = otherCgpa.cgpa.toFixed(4);
        document.getElementById('other-totalPercentage').textContent = `${otherCgpa.percentage.toFixed(2)}%`;
        document.getElementById('other-totalMarksObtained').textContent = otherCgpa.totalMarksObtained.toFixed(0);
        document.getElementById('other-totalMaxMarks').textContent = `/ ${otherCgpa.totalMaxMarks.toFixed(0)}`;
        // --- FIX: Change the label text ---
        const otherCgpaLabel = document.querySelector('#other-tab-content .cgpa-label');
        if (otherCgpaLabel) otherCgpaLabel.textContent = 'CGPA';
        // --- End Fix ---
        const otherCircle = document.getElementById('other-cgpaCircle');
        if (otherCircle) {
            const otherPercentage = isNaN(otherCgpa.cgpa) ? 0 : (otherCgpa.cgpa / 4.0) * 100;
            setTimeout(() => otherCircle.style.strokeDasharray = `${otherPercentage}, 100`, 100);
        }
        displaySemesterCards('other-semesterResults', otherData);
        
        // 4. (Listeners, Chart, Buttons are handled by renderResults)
      }

      // --- 12. Main Fetch & B.Ed. Logic ---
      
      // Handles the B.Ed. modal confirmation
      function handleBedConfirm(isBedStudent, data) {
        if (!data) { // Guard against data being null
             console.error("handleBedConfirm called with no data.");
             showLoadingStage(null);
             return;
        }
        if(bedConfirmationModal) bedConfirmationModal.hide();
        bedModeActive = isBedStudent;
        data.bedMode = isBedStudent; // Save preference to profile

        // Save this as a new profile
        const profiles = getProfiles();
        const studentInfo = data.studentInfo;
        let baseName = `${studentInfo.name || 'Student'} (${studentInfo.registration || 'N/A'})`;
        let finalName = baseName;
        let copyNum = 1;
        const allDisplayNames = Object.values(profiles).map(p => p.displayName);
        while(allDisplayNames.includes(finalName)) { finalName = `${baseName} - Copy ${copyNum++}`; }

        data.displayName = finalName;
        data.createdAt = new Date().toISOString();
        data.lastModified = new Date().toISOString();
        const newProfileId = `profile_${Date.now()}_${Math.random().toString(36).substring(2, 7)}`;
        profiles[newProfileId] = data;
        saveProfiles(profiles);
        setActiveProfileId(newProfileId);

        processedData = data; // Set the global data *after* saving

        showLoadingStage('complete');
        setTimeout(() => {
          renderResults(processedData); // Render UI based on the saved data
          showLoadingStage(null);
          showToast('New profile created successfully!', 'success');
          updateProfileSwitcher(profiles, newProfileId);
        }, 1000);
      }

      // Main function to fetch results
      async function fetchResult() {
        const regNum = registrationNumber.value.trim();
        if (!regNum) { showToast('Please enter a registration number', 'error'); return; }

        resultContainer.style.display = 'none'; // Hide standard container
        bedResultContainer.style.display = 'none'; // Hide B.Ed container
        showLoadingStage('connecting');
        addStatusMessage(`Fetching result for: ${regNum}`, 'info');
        if(semesterResults) semesterResults.innerHTML = '';
        if(bedSemesterResults) bedSemesterResults.innerHTML = '';
        if(otherSemesterResults) otherSemesterResults.innerHTML = '';
        gpaChartContainer.style.display = 'none';
        processedData = null; // Clear old data
        setupFeatureButtons(); // Hide all feature buttons

        try {
          const response = await fetch(`${API_ENDPOINT}&registrationNumber=${encodeURIComponent(regNum)}`);
          showLoadingStage('fetching');
          if (!response.ok) throw new Error(`Server responded with status ${response.status}`);
          const data = await response.json();
          if (!data.success) throw new Error(data.message || 'API returned success=false.');

          showLoadingStage('processing');

          if (data.resultData && data.resultData.length > 0) {
            addStatusMessage('Result fetched successfully from UAF LMS', 'success');
            isInitialLoad = true;
            processedData = processScrapedData(data); // Process and set global data

             // B.Ed. Logic: Check and show modal.
             // The modal handlers (handleBedConfirm) will use the global `processedData`
            if (processedData.hasBedCourses) {
                if (bedConfirmationModal) bedConfirmationModal.show();
                else handleBedConfirm(false, processedData); // Fallback
            } else {
                 handleBedConfirm(false, processedData); // No B.Ed courses
            }
          } else { throw new Error("No result records found for this registration number."); }
        } catch (error) {
             console.error("Fetch Error:", error);
             let userMessage = `Could not retrieve results: ${error.message}`;
             let logMessage = `API/LMS Error: ${error.message}`;
             if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                 userMessage = 'Network error. Please check your internet connection or the server might be down.';
                 logMessage = 'Failed to fetch due to a network error.';
             } else if (error.message.includes("No result records found")) {
                 userMessage = error.message;
                 logMessage = `API Info: ${error.message}`;
             }
             addStatusMessage(logMessage, 'error');
             showToast(userMessage, 'error');
             showLoadingStage(null);
             setupFeatureButtons();
        }
      }

      // --- 13. Event Listeners ---
      resultForm.addEventListener('submit', (e) => { e.preventDefault(); fetchResult(); });
      downloadLogBtn.addEventListener('click', downloadLog);
      clearLogBtn.addEventListener('click', clearLog);
      downloadPdfBtn.addEventListener('click', generatePDF);
      saveCourseBtn.addEventListener('click', addCustomCourse);
      addForecastSemesterBtn.addEventListener('click', addForecastSemester);
      profileSwitcher.addEventListener('change', switchProfile);
      saveProfileNameBtn.addEventListener('click', renameProfile);
      document.getElementById('confirmationConfirmBtn').addEventListener('click', handleConfirm);
      importAttendanceCoursesBtn.addEventListener('click', importSelectedAttendanceCourses);
      importProfilesBtn.addEventListener('click', importProfiles);
      importProfilesBtnModal.addEventListener('click', importProfiles);
      exportProfilesBtnModal.addEventListener('click', exportSelectedProfiles);
      openProfileManagerBtn.addEventListener('click', () => { renderProfileManager(); profileManagerModal.show(); });
      
      document.getElementById('selectAllProfiles').addEventListener('change', e => {
          document.querySelectorAll('#profileManagerList .profile-checkbox').forEach(cb => cb.checked = e.target.checked);
          const anyChecked = e.target.checked;
          document.getElementById('bulkActionsBtn').disabled = !anyChecked;
          exportProfilesBtnModal.disabled = !anyChecked;
      });

      document.getElementById('profileManagerList').addEventListener('change', e => {
            if (e.target.classList.contains('profile-checkbox')) {
                const anyChecked = !!document.querySelector('#profileManagerList .profile-checkbox:checked');
                document.getElementById('bulkActionsBtn').disabled = !anyChecked;
                exportProfilesBtnModal.disabled = !anyChecked;
                const allCheckboxes = document.querySelectorAll('#profileManagerList .profile-checkbox');
                const checkedCheckboxes = document.querySelectorAll('#profileManagerList .profile-checkbox:checked');
                const allChecked = allCheckboxes.length > 0 && checkedCheckboxes.length === allCheckboxes.length;
                const selectAllInput = document.getElementById('selectAllProfiles');
                selectAllInput.checked = allChecked;
                selectAllInput.indeterminate = !allChecked && anyChecked;
            }
      });

      document.getElementById('deleteSelectedBtn').addEventListener('click', handleBulkAction);
      exportProfilesBtn.addEventListener('click', () => { // Main export button
        if (Object.keys(getProfiles()).length === 0) {
            showToast('No profiles available to export.', 'info'); return;
        }
        renderProfileManager();
        profileManagerModal.show();
        showToast('Select profiles from the manager to export.', 'info');
      });

      // Initialize the application
      init();
    });

</script>

          <script>
document.addEventListener('DOMContentLoaded', function() {

  // --- Common Elements ---
  const qpTableContainer = document.getElementById('qpTableContainer');
  const qpTableImage = document.getElementById('qpTableImage');
  const lightbox = document.getElementById('imageLightbox');
  const lightboxContent = document.getElementById('lightboxContent');
  const lightboxClose = document.getElementById('lightboxClose');

  if (!qpTableContainer || !qpTableImage || !lightbox || !lightboxContent || !lightboxClose) {
      console.error("Lightbox elements not found!");
      return;
  }

  const imageSrc = qpTableImage.src;
  let lightboxImage = null; // Reference to the image inside the lightbox

  // --- State Variables ---
  let isLightboxOpen = false;
  let isDesktop = window.matchMedia("(hover: hover) and (pointer: fine)").matches; // Detect if likely desktop

  // Mobile pinch/pan state
  let scale = 1, isPanning = false, isPinching = false;
  let start = { x: 0, y: 0 };
  let initialPinchDistance = 0;
  let currentTransform = { scale: 1, translateX: 0, translateY: 0 };

  // Desktop hover zoom state
  const desktopZoomLevel = 4.5; // How much to zoom on desktop hover

  // --- Utility Functions ---
  function applyTransform() {
    if (!lightboxImage) return;
    // Apply transform based on *current* state (pan/zoom for mobile)
    lightboxImage.style.transform = `translate(${currentTransform.translateX}px, ${currentTransform.translateY}px) scale(${currentTransform.scale})`;
  }

  function getDistance(p1, p2) {
    return Math.hypot(p1.clientX - p2.clientX, p1.clientY - p2.clientY);
  }

  function getCenter(p1, p2) {
    return { x: (p1.clientX + p2.clientX) / 2, y: (p1.clientY + p2.clientY) / 2 };
  }

  // --- Lightbox Open/Close ---
  function openLightbox() {
    if (isLightboxOpen) return;

    const imgClone = qpTableImage.cloneNode(true);
    imgClone.id = 'lightboxImage';
    // Reset styles specifically for the lightbox
    imgClone.style.transform = '';
    imgClone.style.transition = 'transform 0.15s ease-out'; // Keep transition
    imgClone.style.maxWidth = '95%';
    imgClone.style.maxHeight = '95%';
    imgClone.style.width = 'auto';
    imgClone.style.height = 'auto';
    lightboxContent.innerHTML = '';
    lightboxContent.appendChild(imgClone);
    lightboxImage = imgClone;

    // Reset interaction states
    isPanning = false; isPinching = false;
    currentTransform = { scale: 1, translateX: 0, translateY: 0 };
    applyTransform(); // Set initial state

    lightbox.classList.add('show');
    document.body.style.overflow = 'hidden'; // Prevent body scroll
    isLightboxOpen = true;

    // Attach interaction listeners based on device type
    if (isDesktop) {
        setupDesktopLightboxInteraction();
    } else {
        setupMobileLightboxInteraction();
    }
  }

  function closeLightbox() {
    if (!isLightboxOpen) return;
    lightbox.classList.remove('show');
    document.body.style.overflow = ''; // Restore body scroll
    isLightboxOpen = false;
    lightboxImage = null; // Clean up image ref
    // Remove specific listeners added when opened
    removeDesktopLightboxInteraction();
    removeMobileLightboxInteraction();
  }

  // --- Desktop Lightbox Interaction (Hover Zoom) ---
  const handleDesktopMouseMove = (e) => {
      if (!lightboxImage || !isLightboxOpen) return;

      const rect = lightboxImage.getBoundingClientRect();
      // Calculate cursor position as a percentage of the image dimensions
      const xPercent = ((e.clientX - rect.left) / rect.width) * 100;
      const yPercent = ((e.clientY - rect.top) / rect.height) * 100;

      // Apply scale and set transform origin to follow cursor
      lightboxImage.style.transformOrigin = `${xPercent}% ${yPercent}%`;
      lightboxImage.style.transform = `scale(${desktopZoomLevel})`;
  };

  const handleDesktopMouseLeave = () => {
      if (!lightboxImage || !isLightboxOpen) return;
      // Reset zoom when mouse leaves the image
      lightboxImage.style.transformOrigin = `center center`;
      lightboxImage.style.transform = `scale(1)`;
  };

  function setupDesktopLightboxInteraction() {
    if (!lightboxImage) return;
    lightboxContent.classList.add('desktop-zoom-active');
    lightboxImage.addEventListener('mousemove', handleDesktopMouseMove);
    lightboxImage.addEventListener('mouseleave', handleDesktopMouseLeave);
     // Add wheel zoom for desktop as well
    lightboxContent.addEventListener('wheel', handleWheelZoom, { passive: false });
  }

  function removeDesktopLightboxInteraction() {
    if (!lightboxImage) return;
    lightboxContent.classList.remove('desktop-zoom-active');
    lightboxImage.removeEventListener('mousemove', handleDesktopMouseMove);
    lightboxImage.removeEventListener('mouseleave', handleDesktopMouseLeave);
    lightboxContent.removeEventListener('wheel', handleWheelZoom);
  }

  // --- Mobile Lightbox Interaction (Pinch/Pan) ---
  const handleTouchStart = (e) => {
    if (!lightboxImage || !isLightboxOpen) return;
    
    if (e.touches.length === 1 && currentTransform.scale > 1) { // Only pan if zoomed
      isPanning = true;
      start.x = e.touches[0].clientX - currentTransform.translateX;
      start.y = e.touches[0].clientY - currentTransform.translateY;
    } else if (e.touches.length === 2) {
      isPanning = false; // Stop panning
      isPinching = true;
      initialPinchDistance = getDistance(e.touches[0], e.touches[1]);
      // Store center based on current transform - needed? Maybe not.
    }
  };

  const handleTouchMove = (e) => {
    if (!lightboxImage || !isLightboxOpen) return;
    e.preventDefault(); // Prevent scroll

    if (isPanning && e.touches.length === 1) {
      currentTransform.translateX = e.touches[0].clientX - start.x;
      currentTransform.translateY = e.touches[0].clientY - start.y;
      applyTransform();
    } else if (isPinching && e.touches.length === 2) {
        const currentPinchDistance = getDistance(e.touches[0], e.touches[1]);
        const scaleChange = currentPinchDistance / initialPinchDistance;
        let potentialNewScale = currentTransform.scale * scaleChange;

        // Clamp scale
        potentialNewScale = Math.max(1, Math.min(potentialNewScale, 10)); // Min 1x, Max 10x

        // Calculate zoom origin relative to the image
        const rect = lightboxImage.getBoundingClientRect();
        // Use the initial touch center relative to the viewport
        const touchCenterXVP = getCenter(e.touches[0], e.touches[1]).x;
        const touchCenterYVP = getCenter(e.touches[0], e.touches[1]).y;
        // Convert to position relative to the *untransformed* image top-left
        const originX = (touchCenterXVP - rect.left - currentTransform.translateX) / currentTransform.scale;
        const originY = (touchCenterYVP - rect.top - currentTransform.translateY) / currentTransform.scale;

        // Calculate new translation to keep origin point fixed
        currentTransform.translateX += originX * currentTransform.scale - originX * potentialNewScale;
        currentTransform.translateY += originY * currentTransform.scale - originY * potentialNewScale;
        currentTransform.scale = potentialNewScale; // Apply the new scale

        applyTransform();

        // Update for next move event (essential)
        initialPinchDistance = currentPinchDistance;
    }
  };

  const handleTouchEnd = (e) => {
    if (!lightboxImage || !isLightboxOpen) return;

    if (isPanning && e.touches.length === 0) {
      isPanning = false;
    }
    if (isPinching && e.touches.length < 2) {
      isPinching = false;
      // Check if scale is close to 1, if so, reset position
      if (currentTransform.scale <= 1.05) {
         currentTransform.scale = 1; // Snap to 1
         currentTransform.translateX = 0;
         currentTransform.translateY = 0;
         // Apply transform with a slight delay/transition if desired
         lightboxImage.style.transition = 'transform 0.2s ease-out'; // Add smooth reset
         applyTransform();
         setTimeout(() => {
              if (lightboxImage) lightboxImage.style.transition = 'transform 0.15s ease-out'; // Restore default transition
         }, 200);
      }
    }
  };

  function setupMobileLightboxInteraction() {
    if (!lightboxContent) return;
    lightboxContent.addEventListener('touchstart', handleTouchStart, { passive: false });
    lightboxContent.addEventListener('touchmove', handleTouchMove, { passive: false });
    lightboxContent.addEventListener('touchend', handleTouchEnd);
    lightboxContent.addEventListener('touchcancel', handleTouchEnd); // Use same handler for cancel
  }

  function removeMobileLightboxInteraction() {
    if (!lightboxContent) return;
    lightboxContent.removeEventListener('touchstart', handleTouchStart);
    lightboxContent.removeEventListener('touchmove', handleTouchMove);
    lightboxContent.removeEventListener('touchend', handleTouchEnd);
    lightboxContent.removeEventListener('touchcancel', handleTouchEnd);
  }

  // --- Wheel Zoom (Common for both in Lightbox) ---
  const handleWheelZoom = (e) => {
      if (!lightboxImage || !isLightboxOpen) return;
      e.preventDefault();

      const rect = lightboxImage.getBoundingClientRect();
      const delta = e.deltaY > 0 ? -0.2 : 0.2; // Zoom speed
      let potentialNewScale = currentTransform.scale + delta * currentTransform.scale; // Zoom relative to current scale

      // Clamp scale
      potentialNewScale = Math.max(1, Math.min(potentialNewScale, 10));

      // Calculate zoom origin relative to image
      const originX = (e.clientX - rect.left - currentTransform.translateX) / currentTransform.scale;
      const originY = (e.clientY - rect.top - currentTransform.translateY) / currentTransform.scale;

      // Calculate new translation to keep origin fixed
      currentTransform.translateX += originX * currentTransform.scale - originX * potentialNewScale;
      currentTransform.translateY += originY * currentTransform.scale - originY * potentialNewScale;
      currentTransform.scale = potentialNewScale;

      // Reset position if zoomed out fully
      if (currentTransform.scale <= 1.05) {
          currentTransform.scale = 1;
          currentTransform.translateX = 0;
          currentTransform.translateY = 0;
      }

      applyTransform();
  };


  // --- Event Listeners ---
  qpTableContainer.addEventListener('click', openLightbox);
  lightboxClose.addEventListener('click', closeLightbox);
  lightbox.addEventListener('click', (e) => { // Close on background click
    if (e.target === lightbox) closeLightbox();
  });

});
</script>


          <div id="imageLightbox" class="image-lightbox">
  <button id="lightboxClose" class="lightbox-close-btn" title="Close"><i class="fa-solid fa-times"></i></button>
  <div id="lightboxContent" class="lightbox-content">
    </div>
</div>
          

  <!-- 7. ADD THIS SCRIPT AT THE END OF YOUR BODY TAG FOR SCHEMA -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Muhammad Saqlain",
  "alternateName": "M Saqlain",
  "url": "https://uafcgpacalculator.vercel.app",
  "image": "https://uafcgpacalculator.vercel.app/assets/images/UAF CGPA Calculator Developer - M Saqlain.webp",
  "jobTitle": "Developer & Chemistry Graduate",
  "worksFor": {
    "@type": "Organization",
    "name": "UAF CGPA Calculator"
  },
  "alumniOf": {
    "@type": "Organization",
    "name": "University of Agriculture Faisalabad",
    "sameAs": "http://uaf.edu.pk"
  },
  "sameAs": [
    "https://www.instagram.com/uafcalculator_saqlain",
    "https://www.facebook.com/UAFChemist.Rustam",
    "https://x.com/M_Saqlain_Akbar",
    "https://www.linkedin.com/in/muhammad-saqlain-akbar/"
  ],
  "knowsAbout": [
    "UAF CGPA Calculator",
    "University of Agriculture Faisalabad Grading System",
    "Quality Points Calculator",
    "Academic GPA Calculation"
  ]
}
</script>
  
</body>
</html>


