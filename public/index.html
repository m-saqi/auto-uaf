<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UAF Automatic GPA Calculator</title>
  <meta name="description" content="UAF Automatic GPA Calculator that fetches your results directly from UAF LMS. Built for University of Agriculture Faisalabad students." />
  <link rel="canonical" href="https://uaftools.vercel.app/auto.html" />
  <meta property="og:title" content="UAF Automatic GPA Calculator" />
  <meta property="og:description" content="Fetch your results directly from UAF LMS and calculate GPA automatically." />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="UAF Tools" />
  <meta property="og:url" content="https://uaftools.vercel.app/auto.html" />
  <meta property="og:image" content="https://uaftools.vercel.app/uaftools.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="UAF Automatic GPA Calculator" />
  <meta name="twitter:description" content="Fetch your results directly from UAF LMS and calculate GPA automatically." />

  <!-- Brand -->
  <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Theme Styles -->
  <style>
    :root{
      --brand:#7a6ad8;
      --brand-600:#6b5fca;
      --brand-700:#5d52b8;
      --text:#1b1f24;
      --muted:#6b7280;
      --radius:1.25rem;
    }
    html,body{font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}
    body{background:linear-gradient(180deg,#f8f9ff 0%, #ffffff 70%); min-height: 100vh; margin: 0; padding: 0;}
    .navbar{backdrop-filter:saturate(180%) blur(12px); background-color:rgba(255,255,255,.7);}
    .navbar .navbar-brand{font-weight:800; letter-spacing:.3px; color:var(--brand);}

    .btn-brand{--bs-btn-bg:var(--brand); --bs-btn-border-color:var(--brand); --bs-btn-hover-bg:var(--brand-600); --bs-btn-hover-border-color:var(--brand-600);}
    .btn-soft{background:#f2f0ff; color:var(--brand);}
    .badge-brand{background:var(--brand);}

    .btn-primary-action{
      background: linear-gradient(180deg,var(--brand),var(--brand-700));
      color: #fff;
      border: 0;
      box-shadow: 0 6px 18px rgba(122,106,216,.12);
      cursor: pointer;
    }
    .btn-primary-action:hover {
      background: linear-gradient(180deg,var(--brand-600),var(--brand-700));
      color: #fff;
      transform: translateY(-2px);
    }
    .btn-secondary-action{
      background: #fff;
      color: var(--brand);
      border: 1px solid rgba(122,106,216,.12);
      cursor: pointer;
    }
    .btn-secondary-action:hover {
      background: #f8f9ff;
      color: var(--brand);
    }
    .btn-danger-action {
      background: #e74c3c;
      color: white;
      border: 0;
      cursor: pointer;
    }
    .btn-danger-action:hover {
      background: #c0392b;
      color: white;
    }
    .btn-success-action {
      background: #10ac84;
      color: white;
      border: 0;
      cursor: pointer;
    }
    .btn-success-action:hover {
      background: #0d916b;
      color: white;
    }

    .hero{padding: 6rem 0 3rem;}
    .hero h1{font-weight:800; line-height:1.05;}
    .hero .lead{color:#4b5563;}

    .card-modern{border:0; border-radius:var(--radius); box-shadow:0 10px 30px rgba(17,24,39,.06);}
    .card-modern .card-header{border:0; border-top-left-radius:var(--radius); border-top-right-radius:var(--radius); background:linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));}
    .form-select, .form-control{border-radius: .85rem;}
    label{font-weight:600;}

    .subject-row{border:1px dashed #e5e7eb; border-radius:1rem; padding:1rem; background:#fff;}
    .result-display{font-size:1.75rem; font-weight:800; color:var(--brand);}

    .progress-container {
      margin-top: 1.5rem;
    }
    .progress {
      height: 10px;
      border-radius: 5px;
    }
    .progress-bar {
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    .status-log {
      max-height: 300px;
      overflow-y: auto;
      background: #f8f9fa;
      border-radius: 0.5rem;
      padding: 1rem;
      font-family: monospace;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }
    .status-line {
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e9ecef;
      cursor: pointer;
    }
    .status-line:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }
    .status-success { color: #28a745; }
    .status-error { color: #dc3545; }
    .status-warning { color: #fd7e14; }
    .status-info { color: var(--brand); }

    .footer{color:#9ca3af;}
    a{color:var(--brand); text-decoration:none; cursor: pointer;}
    a:hover{color:#9f8df0;}

    /* Loading spinner styles */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    .loading p {
      margin-top: 10px;
    }

    /* Result container styles */
    .result-container {
      display: none;
    }

    /* Toast notifications */
    #toast-container {
      position: fixed;
      bottom: 25px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column-reverse; /* Changed to column-reverse for newer on top */
      gap: 10px;
    }

    .toast {
      background: white;
      border-radius: 8px;
      padding: 16px 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      min-width: 300px;
      max-width: 400px;
      transform: translateX(100%);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      position: relative;
      overflow: hidden;
      border-left: 4px solid var(--brand);
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast-success {
      border-left-color: #10ac84;
    }

    .toast-error {
      border-left-color: #e74c3c;
    }

    .toast-warning {
      border-left-color: #f39c12;
    }

    .toast-info {
      border-left-color: #3498db;
    }

    .toast-content {
      display: flex;
      align-items: center;
      width: 100%;
    }

    .toast-icon {
      margin-right: 12px;
      font-size: 20px;
    }

    .toast-success .toast-icon {
      color: #10ac84;
    }

    .toast-error .toast-icon {
      color: #e74c3c;
    }

    .toast-warning .toast-icon {
      color: #f39c12;
    }

    .toast-info .toast-icon {
      color: #3498db;
    }

    .toast-message {
      flex: 1;
      font-weight: 500;
      font-size: 14px;
      color: #2d3748;
    }

    .toast-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      width: 100%;
      background: rgba(0, 0, 0, 0.1);
      transform: scaleX(1);
      transform-origin: left;
      animation: toastProgress 3s linear forwards;
    }

    .toast-success .toast-progress {
      background: linear-gradient(to right, #10ac84, #0d916b);
    }

    .toast-error .toast-progress {
      background: linear-gradient(to right, #e74c3c, #c0392b);
    }

    .toast-warning .toast-progress {
      background: linear-gradient(to right, #f39c12, #e67e22);
    }

    .toast-info .toast-progress {
      background: linear-gradient(to right, #3498db, #2980b9);
    }

    @keyframes toastProgress {
      from { transform: scaleX(1); }
      to { transform: scaleX(0); }
    }

    /* Download animation overlay */
    #downloadOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      flex-direction: column;
    }

    .download-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--brand);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    .download-text {
      color: white;
      font-size: 16px;
      text-align: center;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Custom cursor */
    .cursor-dot {
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--brand);
      pointer-events: none;
      transform: translate(-50%, -50%);
      opacity: .7;
      z-index: 9999;
      display: none;
    }

    /* Hide default cursor when custom cursor is active */
    @media (min-width: 769px) {
      .cursor-dot {
        display: block;
      }
    }

    /* GPA Result Display */
    .gpa-result-card {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(17,24,39,.06);
      margin-bottom: 2rem;
    }
    
    .semester-card {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(17,24,39,.06);
      margin-bottom: 1.5rem;
      position: relative;
    }
    
    .course-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    
    .course-table th, .course-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .course-table th {
      font-weight: 600;
      color: var(--muted);
    }
    
    .grade-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-weight: 600;
      font-size: 0.75rem;
    }
    
    .grade-A { background-color: #dcfce7; color: #166534; }
    .grade-B { background-color: #dbeafe; color: #1e40af; }
    .grade-C { background-color: #fef3c7; color: #92400e; }
    .grade-D { background-color: #fee2e2; color: #991b1b; }
    .grade-F { background-color: #f3f4f6; color: #374151; }

    .extra-enrolled-badge {
      background-color: #fef3c7;
      color: #92400e;
      padding: 0.2rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.7rem;
      margin-left: 0.5rem;
    }
    
    .delete-semester-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #fee2e2;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #dc2626;
      cursor: pointer;
    }
    
    .delete-semester-btn:hover {
      background: #fecaca;
    }
    
    .recalculate-btn {
      margin-top: 1rem;
    }
    
    .course-detail-modal .modal-content {
      border-radius: var(--radius);
    }
    
    .course-detail-modal .modal-header {
      background: linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
    }

    /* Button alignment improvements */
    .btn-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    @media (max-width: 576px) {
      .btn-container {
        flex-direction: column;
        align-items: center;
      }
      
      .btn-container .btn {
        width: 100%;
        max-width: 280px;
      }
    }

    /* Mobile table improvements */
    .table-container {
      overflow-x: auto;
    }
    
    @media (max-width: 768px) {
      .course-table {
        min-width: 600px; /* Force horizontal scrolling on small screens */
      }
      
      .course-table th, 
      .course-table td {
        padding: 0.5rem;
        font-size: 0.875rem;
      }
    }

    /* ----------- DARK MODE IMPROVED ----------- */
    [data-theme="dark"] body{background:linear-gradient(180deg,#0b0e13 0%, #0f1320 70%); color:#f1f5f9;}
    [data-theme="dark"] .navbar{background-color:rgba(17,24,39,.75);}
    [data-theme="dark"] .navbar .nav-link{color:#d1d5db;}
    [data-theme="dark"] .navbar .nav-link:hover{color:#fff;}
    [data-theme="dark"] .card-modern{background:#0f1422; color:#e5e7eb;}
    [data-theme="dark"] .card-modern .card-header{background:linear-gradient(180deg, rgba(122,106,216,.25), rgba(122,106,216,.1));}
    [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, [data-theme="dark"] h4, [data-theme="dark"] h5{color:#ffffff;}
    [data-theme="dark"] .lead{color:#9ca3af;}
    [data-theme="dark"] .subject-row{background:#1a1f2e; border-color:#2d3748;}
    [data-theme="dark"] label{color:#e5e7eb;}
    [data-theme="dark"] .form-control, [data-theme="dark"] .form-select{background:#0b1020; color:#f1f5f9; border-color:#374151;}
    [data-theme="dark"] .form-control::placeholder{color:#9ca3af;}
    [data-theme="dark"] .input-group-text{background:#1f2937; color:#e5e7eb;}
    [data-theme="dark"] .footer{color:#9ca3af;}
    [data-theme="dark"] a{color: rgb(122, 106, 216);}
    [data-theme="dark"] a:hover{color:#9f8df0;}
    [data-theme="dark"] .status-log { background: #1a2030; }
    [data-theme="dark"] .status-line { border-bottom-color: #2d3748; }
    [data-theme="dark"] .gpa-result-card { background: #1a2030; }
    [data-theme="dark"] .semester-card { background: #1a2030; }
    [data-theme="dark"] .course-table th, 
    [data-theme="dark"] .course-table td { border-bottom-color: #2d3748; }
    [data-theme="dark"] .delete-semester-btn {
      background: #7f1d1d;
      color: #fecaca;
    }
    [data-theme="dark"] .delete-semester-btn:hover {
      background: #991b1b;
    }

    /* Dark mode contrast improvements */
    [data-theme="dark"] .text-body-secondary {
      color: #d1d5db !important;
    }
    
    [data-theme="dark"] .btn-primary-action {
      color: #ffffff !important;
    }

    .cursor-dot{position:fixed; width:10px;height:10px;border-radius:50%; background:var(--brand); pointer-events:none; transform:translate(-50%, -50%); opacity:.7; mix-blend-mode:multiply; z-index:9999;}
    @media (max-width: 575.98px){
      .hero{padding:4rem 0 2rem;}
    }

    /* Ensure subject columns are 2-up on very small screens: change from col-12 col-md-6 -> col-6 col-md-6 */
    @media (max-width: 420px){
      .subject-row .col-6{padding-right:.4rem;padding-left:.4rem;}
    }

    @media (min-width: 992px) {
      .navbar-expand-lg .navbar-nav .nav-link {
        padding-right: var(--bs-navbar-nav-link-padding-x);
        margin-right: 20px;
      }
    }
    
    @media (min-width: 768px) {
      .col-md-4 {
        flex: 0 0 auto;
        width: 48.3%;
      }
    }
  </style>
</head>
<body>
  <!-- Custom cursor -->
  <div class="cursor-dot" id="cursorDot"></div>

  <!-- Download Animation Overlay -->
  <div id="downloadOverlay" style="display: none;">
    <div class="download-spinner"></div>
    <div class="download-text">Processing your result...</div>
  </div>

  <!-- Course Detail Modal -->
  <div class="modal fade course-detail-modal" id="courseDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="courseDetailModalTitle">Course Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="courseDetailModalBody">
          <!-- Course details will be populated here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top border-bottom">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/">
        <span class="badge rounded-pill badge-brand">UAF</span>
        <span>Automatic <span class="text-body-secondary">GPA Calculator</span></span>
      </a>

      <div class="d-flex align-items-center gap-2 order-lg-2">
        <button id="themeToggle" class="btn btn-sm btn-soft rounded-pill" type="button" aria-label="Toggle dark mode">
          <i class="fa-solid fa-moon"></i>
        </button>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="index.html#Home">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html#CGPA-Calculator">Manual Calculator</a></li>
          <li class="nav-item"><a class="nav-link" href="uaf-results.html">UAF Results</a></li>
          <li class="nav-item"><a class="nav-link" href="#contact-us">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero" id="Home">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-7">
          <span class="badge rounded-pill badge-brand mb-3">University of Agriculture Faisalabad</span>
          <h1 class="display-5 mb-3">Fetch Your <span style="color:var(--brand)">Results Automatically</span><br/>from UAF LMS</h1>
          <p class="lead mb-4">Enter your <strong>registration number</strong> to fetch your results directly from UAF LMS. The calculator will automatically compute your GPA based on UAF grading ranges.</p>
          <div class="d-flex gap-2 btn-container">
            <a href="#Auto-Calculator" 
               class="btn btn-primary-action btn-lg rounded-pill" 
               style="font-size: 1.05rem; padding: 0.9rem;">
              <i class="fa-solid fa-bolt me-2"></i>Try It Now
            </a>
            <a href="index.html#CGPA-Calculator" class="btn btn-secondary-action rounded-pill">
              <i class="fa-solid fa-calculator me-2"></i>Manual Calculator
            </a>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="card card-modern">
            <div class="card-body p-4">
              <div class="d-flex align-items-center gap-3">
                <div class="display-6" style="color:var(--brand);"><i class="fa-solid fa-robot"></i></div>
                <div>
                  <h5 class="mb-1 fw-bold">Automatic GPA Calculation</h5>
                  <p class="mb-0 text-body-secondary">No manual inputs needed. Just enter your registration number.</p>
                </div>
              </div>
              <hr class="my-4" />
              <ul class="list-unstyled m-0">
                <li class="d-flex align-items-center gap-2 mb-2"><i class="fa-solid fa-check text-success"></i> Fetches results directly from UAF LMS</li>
                <li class="d-flex align-items-center gap-2 mb-2"><i class="fa-solid fa-check text-success"></i> Automatic GPA calculation</li>
                <li class="d-flex align-items-center gap-2"><i class="fa-solid fa-check text-success"></i> Same accurate UAF grading system</li>
              </ul>
            </div>
          </div>
        </div>
      </div><!-- /row -->
    </div>
  </section>

  <!-- Automatic Calculator Section -->
  <section class="py-5" id="Auto-Calculator">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="card card-modern">
            <div class="card-header p-4">
              <h4 class="mb-0"><i class="fa-solid fa-bolt me-2"></i>UAF Automatic GPA Calculator</h4>
            </div>
            <div class="card-body p-4">
              <form id="resultForm">
                <div class="mb-3">
                  <label for="registrationNumber" class="form-label">Registration Number</label>
                  <input type="text" class="form-control" id="registrationNumber" 
                         placeholder="e.g., 2020-ag-1234" required>
                  <div class="form-text">Enter your UAF registration number</div>
                </div>
                
                <div class="d-flex gap-2 btn-container">
                  <button type="submit" class="btn btn-primary-action rounded-pill">
                    <i class="fa-solid fa-cloud-arrow-down me-2"></i>Fetch Result
                  </button>
                  <button id="testConnectionBtn" type="button" class="btn btn-secondary-action rounded-pill">
                    <i class="fa-solid fa-vial me-2"></i>Test Connection
                  </button>
                </div>
              </form>
              
              <!-- Progress Section -->
              <div class="progress-container mt-4">
                <div class="d-flex justify-content-between mb-2">
                  <span>Status: <strong id="currentStatus">Ready</strong></span>
                  <span><strong id="progressPercentage">0%</strong></span>
                </div>
                <div class="progress">
                  <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%; background-color: var(--brand);" 
                      aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
              
              <!-- Status Log -->
              <div class="status-log mt-4" id="statusLog">
                <div class="status-line status-info">Ready to fetch your results. Enter your registration number and click "Fetch Result".</div>
              </div>
              
              <!-- Log Action Buttons -->
              <div class="d-flex gap-2 mt-3 btn-container">
                <button id="downloadLogBtn" class="btn btn-secondary-action rounded-pill">
                  <i class="fa-solid fa-file-lines me-2"></i>Download Log
                </button>
                <button id="clearLogBtn" class="btn btn-danger-action rounded-pill">
                  <i class="fa-solid fa-trash me-2"></i>Clear Log
                </button>
              </div>
              
              <div id="loading" class="loading mt-4">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p>Fetching your result from UAF LMS...</p>
              </div>
              
              <div id="resultContainer" class="result-container mt-4">
                <!-- GPA Result Card -->
                <div class="gpa-result-card" id="gpaResultCard">
                  <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-4">
                      <div class="p-3 bg-blue-100 rounded-full">
                        <i class="fa-solid fa-book-open text-blue-600"></i>
                      </div>
                      <div>
                        <h2 class="mb-1 fw-bold" id="studentName">Student Name</h2>
                        <p class="mb-0 text-body-secondary" id="studentReg">Registration Number</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="mb-0 text-body-secondary">Total CGPA</p>
                      <p class="mb-0 display-6 fw-bold text-blue-600" id="totalCgpa">0.00</p>
                      <p class="mb-0 text-body-secondary" id="totalPercentage">0%</p>
                    </div>
                  </div>
                </div>
                
                <!-- Semester Results Container -->
                <div id="semesterResults" class="mt-4">
                  <!-- Semester cards will be dynamically inserted here -->
                </div>
                
                <!-- Recalculate Button -->
                <div class="d-flex justify-content-center mt-4">
                  <button id="recalculateBtn" class="btn btn-primary-action rounded-pill recalculate-btn">
                    <i class="fa-solid fa-calculator me-2"></i>Calculate CGPA Now
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section class="py-5" id="contact-us">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-6">
          <h3 class="fw-bold mb-2">Contact</h3>
          <p class="text-body-secondary">Questions or suggestions? Send a message.</p>
          <form id="contact-form" action="https://formspree.io/f/xblrolwp" method="post" class="needs-validation" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="name">Your Name</label>
                <input class="form-control" id="name" name="name" placeholder="e.g., Ali Raza" required />
                <div class="invalid-feedback">Please enter your name.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label" for="email">Email</label>
                <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required />
                <div class="invalid-feedback">Enter a valid email.</div>
              </div>
              <div class="col-12">
                <label class="form-label" for="message">Message</label>
                <textarea class="form-control" id="message" name="message" rows="4" placeholder="Write your message..." required></textarea>
                <div class="invalid-feedback">Please write a message.</div>
              </div>
              <div class="col-12">
                <button class="btn btn-primary-action rounded-pill" type="submit"><i class="fa-solid fa-paper-plane me-2"></i>Send</button>
              </div>
              <div id="contact-form-status" class="mt-2 small"></div>
            </div>
          </form>
        </div>
        <div class="col-lg-6">
          <div class="h-100 p-4 p-lg-5 rounded-4" style="background:linear-gradient(180deg, rgba(122,106,216,.15), rgba(122,106,216,.05));">
            <h5 class="fw-bold">Developer</h5>
            <div class="d-flex align-items-center gap-3 mt-2">
              <img src="assets/images/member-01.png" alt="Muhammad Saqlain" class="rounded-circle" width="56" height="56" />
              <div>
                <div class="fw-semibold">Muhammad Saqlain</div>
                <div class="text-body-secondary small">BS Chemistry (2020–2024)</div>
                <div class="d-flex gap-3 mt-2">
                  <a class="text-decoration-none" href="https://www.facebook.com/UAFChemist.Rustam" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                  <a class="text-decoration-none" href="https://x.com/M_Saqlain_Akbar" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                  <a class="text-decoration-none" href="https://www.linkedin.com/in/muhammad-saqlain-akbar/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                </div>
              </div>
            </div>
            <hr class="my-4" />
            <p class="mb-0 small text-body-secondary">Share this tool with your friends to support the project. ♥</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-top py-4">
    <div class="container text-center footer">
      <div>© 2025 Saqlain. All rights reserved.</div>
    </div>
  </footer>

  <!-- Vendor JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Add this new script reference -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  
  <!-- App JS -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const resultForm = document.getElementById('resultForm');
      const registrationNumber = document.getElementById('registrationNumber');
      const loading = document.getElementById('loading');
      const resultContainer = document.getElementById('resultContainer');
      const testConnectionBtn = document.getElementById('testConnectionBtn');
      const statusLog = document.getElementById('statusLog');
      const progressBar = document.getElementById('progressBar');
      const progressPercentage = document.getElementById('progressPercentage');
      const currentStatus = document.getElementById('currentStatus');
      const themeToggle = document.getElementById('themeToggle');
      const cursorDot = document.getElementById('cursorDot');
      const contactForm = document.getElementById('contact-form');
      const contactFormStatus = document.getElementById('contact-form-status');
      const downloadLogBtn = document.getElementById('downloadLogBtn');
      const clearLogBtn = document.getElementById('clearLogBtn');
      const semesterResults = document.getElementById('semesterResults');
      const gpaResultCard = document.getElementById('gpaResultCard');
      const studentName = document.getElementById('studentName');
      const studentReg = document.getElementById('studentReg');
      const totalCgpa = document.getElementById('totalCgpa');
      const totalPercentage = document.getElementById('totalPercentage');
      const recalculateBtn = document.getElementById('recalculateBtn');
      const courseDetailModal = new bootstrap.Modal(document.getElementById('courseDetailModal'));
      
      // State variables
      let allLogs = [];
      let testInProgress = false;
      let currentResultData = null;
      let currentGPAData = null;
      
      // API endpoints
      const API_ENDPOINTS = {
        scrape: `/api/result-scraper`,
        test: `/api/result-scraper`
      };
      
      // Initialize the application
      function init() {
        initCustomCursor();
        initTheme();
        initContactForm();
        createToastContainer();
      }
      
      // Create a custom toast container
      function createToastContainer() {
        const toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        document.body.appendChild(toastContainer);
      }
      
      // Show toast notification
      function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
          <div class="toast-content">
            <i class="toast-icon ${getToastIcon(type)}"></i>
            <span class="toast-message">${message}</span>
          </div>
          <div class="toast-progress"></div>
        `;
        
        toastContainer.prepend(toast); // Changed to prepend so newer toasts appear on top
        
        // Animate in
        setTimeout(() => {
          toast.classList.add('show');
        }, 10);
        
        // Remove after delay
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }, 3000);
      }
      
      // Get icon for toast type
      function getToastIcon(type) {
        switch(type) {
          case 'success': return 'fa-solid fa-circle-check';
          case 'error': return 'fa-solid fa-circle-exclamation';
          case 'warning': return 'fa-solid fa-triangle-exclamation';
          case 'info': return 'fa-solid fa-circle-info';
          default: return 'fa-solid fa-circle-info';
        }
      }
      
      // Initialize custom cursor
      function initCustomCursor() {
        document.addEventListener('mousemove', (e) => {
          cursorDot.style.display = window.innerWidth > 768 ? 'block' : 'none';
          cursorDot.style.left = e.clientX + 'px';
          cursorDot.style.top = e.clientY + 'px';
        });
      }
      
      // Theme toggle functionality
      function initTheme() {
        const THEME_KEY = 'uaf-theme';
        function applyTheme(theme){
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem(THEME_KEY, theme);
          themeToggle.innerHTML = theme === 'dark' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
        }
        applyTheme(localStorage.getItem(THEME_KEY) || 'light');
        themeToggle.addEventListener('click', () => {
          const next = (localStorage.getItem(THEME_KEY) || 'light') === 'light' ? 'dark' : 'light';
          applyTheme(next);
        });
      }
      
      // Contact form
      function initContactForm() {
        contactForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          if(!contactForm.checkValidity()){
            e.stopPropagation();
            contactForm.classList.add('was-validated');
            return;
          }
          const data = new FormData(contactForm);
          try{
            const res = await fetch(contactForm.action, { method: 'POST', body: data, headers: {'Accept':'application/json'}});
            if(res.ok){
              contactFormStatus.textContent = "Thanks! We'll get back to you soon.";
              contactFormStatus.className = "text-success";
              contactForm.reset(); contactForm.classList.remove('was-validated');
              showToast('Message sent successfully!', 'success');
            }else{
              contactFormStatus.textContent = "Oops! There was a problem submitting your form.";
              contactFormStatus.className = "text-danger";
              showToast('Failed to send message. Please try again.', 'error');
            }
          }catch{
            contactFormStatus.textContent = "Network error. Try again.";
            contactFormStatus.className = "text-danger";
            showToast('Network error. Please try again.', 'error');
          }
        });
      }
      
      // Add a status message to the log
      function addStatusMessage(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const fullMessage = `[${timestamp}] ${message}`;
        
        // Add to all logs array
        allLogs.push({timestamp, message, type});
        
        const messageEl = document.createElement('div');
        messageEl.className = `status-line status-${type}`;
        messageEl.textContent = fullMessage;
        statusLog.prepend(messageEl);
        
        // Auto-scroll to top
        statusLog.scrollTop = 0;
      }
      
      // Update progress bar
      function updateProgress(percent, status) {
        progressBar.style.width = `${percent}%`;
        progressPercentage.textContent = `${percent}%`;
        if (status) {
          currentStatus.textContent = status;
        }
      }
      
      // Show download animation
      function showDownloadAnimation() {
        document.getElementById('downloadOverlay').style.display = 'flex';
      }

      // Hide download animation
      function hideDownloadAnimation() {
        document.getElementById('downloadOverlay').style.display = 'none';
      }
      
      // Download log
      function downloadLog() {
        addStatusMessage('Preparing log file for download...', 'info');
        
        // Create log content
        let logContent = "UAF Automatic GPA Calculator - Activity Log\n";
        logContent += "============================================\n\n";
        
        allLogs.forEach(log => {
          logContent += `[${log.timestamp}] ${log.message}\n`;
        });
        
        // Create download link
        const blob = new Blob([logContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `gpa_calculator_log_${new Date().toISOString().replace(/[:.]/g, '-')}.txt`;
        document.body.appendChild(a);
        a.click();
        
        // Clean up
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
        
        addStatusMessage('Log file downloaded successfully', 'success');
        showToast('Log file downloaded!', 'success');
      }
      
      // Clear log
      function clearLog() {
        statusLog.innerHTML = '';
        allLogs = [];
        addStatusMessage('Log cleared', 'info');
        showToast('Log cleared', 'info');
      }
      
      // Test connection
      async function testConnection() {
        // Prevent multiple simultaneous test requests
        if (testInProgress) {
          addStatusMessage('Test connection already in progress', 'info');
          return;
        }
        
        testInProgress = true;
        testConnectionBtn.disabled = true;
        
        addStatusMessage('Testing connection to UAF LMS server...', 'info');
        updateProgress(30, 'Testing Connection');
        
        try {
          const response = await fetch(`${API_ENDPOINTS.test}?action=test`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            addStatusMessage('Connection test successful - UAF LMS is accessible', 'success');
            showToast('Connection test successful!', 'success');
            updateProgress(100, 'Connection Successful');
          } else {
            addStatusMessage(`Connection test failed: ${data.message}`, 'error');
            showToast('Connection test failed!', 'error');
            updateProgress(100, 'Connection Failed');
          }
        } catch (error) {
          addStatusMessage(`Connection test failed: ${error.message}`, 'error');
          showToast('Connection test failed!', 'error');
          updateProgress(100, 'Connection Failed');
        } finally {
          testInProgress = false;
          testConnectionBtn.disabled = false;
          
          // Reset progress after a delay
          setTimeout(() => {
            updateProgress(0, 'Ready');
          }, 2000);
        }
      }
      
      // Calculate quality points based on UAF grading system (from the table)
      function calculateQualityPoints(marks, creditHours) {
        marks = parseFloat(marks);
        creditHours = parseInt(creditHours);
        
        // For 5 credit hours (100 total marks)
        if (creditHours === 5) {
          if (marks >= 80) return 20.0;
          if (marks >= 75) return 19.0;
          if (marks >= 70) return 18.0;
          if (marks >= 65) return 17.0;
          if (marks >= 60) return 16.0;
          if (marks >= 55) return 15.0;
          if (marks >= 50) return 14.0;
          if (marks >= 45) return 13.0;
          if (marks >= 40) return 12.0;
          return 0.0; // Fail
        }
        
        // For 4 credit hours (80 total marks)
        if (creditHours === 4) {
          if (marks >= 64) return 16.0;
          if (marks >= 60) return 15.0;
          if (marks >= 56) return 14.0;
          if (marks >= 52) return 13.0;
          if (marks >= 48) return 12.0;
          if (marks >= 44) return 11.0;
          if (marks >= 40) return 10.0;
          if (marks >= 36) return 9.0;
          if (marks >= 32) return 8.0;
          return 0.0; // Fail
        }
        
        // For 3 credit hours (60 total marks)
        if (creditHours === 3) {
          if (marks >= 48) return 12.0;
          if (marks >= 45) return 11.0;
          if (marks >= 42) return 10.0;
          if (marks >= 39) return 9.0;
          if (marks >= 36) return 8.0;
          if (marks >= 33) return 7.0;
          if (marks >= 30) return 6.0;
          if (marks >= 27) return 5.0;
          if (marks >= 24) return 4.0;
          return 0.0; // Fail
        }
        
        // For 2 credit hours (40 total marks)
        if (creditHours === 2) {
          if (marks >= 32) return 8.0;
          if (marks >= 30) return 7.0;
          if (marks >= 28) return 6.0;
          if (marks >= 26) return 5.0;
          if (marks >= 24) return 4.0;
          if (marks >= 22) return 3.0;
          if (marks >= 20) return 2.0;
          if (marks >= 18) return 1.5;
          if (marks >= 16) return 1.0;
          return 0.0; // Fail
        }
        
        // For 1 credit hour (20 total marks)
        if (creditHours === 1) {
          if (marks >= 16) return 4.0;
          if (marks >= 15) return 3.67;
          if (marks >= 14) return 3.33;
          if (marks >= 13) return 3.0;
          if (marks >= 12) return 2.67;
          if (marks >= 11) return 2.33;
          if (marks >= 10) return 2.0;
          if (marks >= 9) return 1.5;
          if (marks >= 8) return 1.0;
          return 0.0; // Fail
        }
        
        // Default case (should not happen with UAF courses)
        return 0.0;
      }
      
      // Get grade based on marks (UAF system)
      function getGrade(marks, creditHours) {
        marks = parseFloat(marks);
        
        // Determine grade based on percentage
        const percentage = (marks / (creditHours * 20)) * 100;
        
        if (percentage >= 80) return "A";
        if (percentage >= 65) return "B";
        if (percentage >= 50) return "C";
        if (percentage >= 40) return "D";
        return "F";
      }
      
      // Process semester name for display
      function formatSemesterName(semester) {
        if (!semester) return "Unknown Semester";
        
        // Handle different semester formats
        if (semester.includes('Winter')) {
          const yearMatch = semester.match(/(\d{4}-\d{2,4})/);
          if (yearMatch) {
            const year = yearMatch[0].split('-')[0];
            return `Winter ${year}`;
          }
        } else if (semester.includes('Spring')) {
          const yearMatch = semester.match(/(\d{4}-\d{2,4})/);
          if (yearMatch) {
            const year = yearMatch[0].split('-')[1];
            return `Spring ${year}`;
          }
        } else if (semester.includes('Summer')) {
          const yearMatch = semester.match(/(\d{4}-\d{2,4})/);
          if (yearMatch) {
            const year = yearMatch[0].split('-')[0];
            return `Summer ${year}`;
          }
        }
        
        return semester;
      }
      
      // Process result data to handle duplicate courses
      function processResultData(resultData) {
        if (!resultData || !Array.isArray(resultData)) return [];
        
        // Group by course code and keep only the highest marks
        const courseMap = new Map();
        const extraEnrolledCourses = new Set();
        
        resultData.forEach(course => {
          const courseCode = course.CourseCode;
          const marks = parseFloat(course.Total) || 0;
          
          if (!courseMap.has(courseCode)) {
            courseMap.set(courseCode, course);
          } else {
            // Check if this is a better attempt
            const existingCourse = courseMap.get(courseCode);
            const existingMarks = parseFloat(existingCourse.Total) || 0;
            
            if (marks > existingMarks) {
              // Mark the existing course as extra enrolled
              extraEnrolledCourses.add(`${existingCourse.CourseCode}-${existingCourse.Semester}`);
              courseMap.set(courseCode, course);
            } else {
              // Mark this course as extra enrolled
              extraEnrolledCourses.add(`${course.CourseCode}-${course.Semester}`);
            }
          }
        });
        
        // Convert back to array and mark extra enrolled courses
        const processedData = Array.from(courseMap.values()).map(course => {
          return {
            ...course,
            isExtraEnrolled: extraEnrolledCourses.has(`${course.CourseCode}-${course.Semester}`)
          };
        });
        
        return processedData;
      }
      
      // Calculate GPA from result data
      function calculateGPA(resultData) {
        let totalQualityPoints = 0;
        let totalCreditHours = 0;
        let totalMarksObtained = 0;
        let totalMaxMarks = 0;
        
        // Group by semester
        const semesters = {};
        
        resultData.forEach(course => {
          const semester = formatSemesterName(course.Semester);
          if (!semesters[semester]) {
            semesters[semester] = {
              courses: [],
              totalQualityPoints: 0,
              totalCreditHours: 0,
              totalMarksObtained: 0,
              totalMaxMarks: 0
            };
          }
          
          const creditHours = parseInt(course.CreditHours) || 0;
          const marks = parseFloat(course.Total) || 0;
          const qualityPoints = calculateQualityPoints(marks, creditHours);
          const grade = getGrade(marks, creditHours);
          const maxMarks = creditHours * 20; // UAF system: 20 marks per credit hour
          
          const courseData = {
            code: course.CourseCode || '',
            title: course.CourseTitle || '',
            creditHours: creditHours,
            marks: marks,
            maxMarks: maxMarks,
            qualityPoints: qualityPoints,
            grade: grade,
            isExtraEnrolled: course.isExtraEnrolled || false,
            fullDetails: course // Store all details for modal
          };
          
          semesters[semester].courses.push(courseData);
          semesters[semester].totalQualityPoints += qualityPoints;
          semesters[semester].totalCreditHours += creditHours;
          semesters[semester].totalMarksObtained += marks;
          semesters[semester].totalMaxMarks += maxMarks;
          
          totalQualityPoints += qualityPoints;
          totalCreditHours += creditHours;
          totalMarksObtained += marks;
          totalMaxMarks += maxMarks;
        });
        
        // Calculate GPA for each semester
        Object.keys(semesters).forEach(semester => {
          if (semesters[semester].totalCreditHours > 0) {
            semesters[semester].gpa = parseFloat((semesters[semester].totalQualityPoints / semesters[semester].totalCreditHours).toFixed(4));
            semesters[semester].percentage = parseFloat((semesters[semester].gpa * 25).toFixed(2));
            semesters[semester].marksPercentage = parseFloat((semesters[semester].totalMarksObtained / semesters[semester].totalMaxMarks * 100).toFixed(2));
          } else {
            semesters[semester].gpa = 0;
            semesters[semester].percentage = 0;
            semesters[semester].marksPercentage = 0;
          }
        });
        
        // Calculate overall CGPA
        const cgpa = totalCreditHours > 0 ? parseFloat((totalQualityPoints / totalCreditHours).toFixed(4)) : 0;
        const percentage = parseFloat((cgpa * 25).toFixed(2));
        const marksPercentage = totalMaxMarks > 0 ? parseFloat((totalMarksObtained / totalMaxMarks * 100).toFixed(2)) : 0;
        
        return {
          cgpa: cgpa,
          percentage: percentage,
          marksPercentage: marksPercentage,
          semesters: semesters,
          totalQualityPoints: totalQualityPoints,
          totalCreditHours: totalCreditHours,
          totalMarksObtained: totalMarksObtained,
          totalMaxMarks: totalMaxMarks
        };
      }
      
      // Show course details in modal
      function showCourseDetails(course) {
        const modalTitle = document.getElementById('courseDetailModalTitle');
        const modalBody = document.getElementById('courseDetailModalBody');
        
        modalTitle.textContent = `${course.code} - ${course.title}`;
        
        modalBody.innerHTML = `
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <strong>Course Code:</strong> ${course.code}
              </div>
              <div class="mb-3">
                <strong>Course Title:</strong> ${course.title}
              </div>
              <div class="mb-3">
                <strong>Credit Hours:</strong> ${course.creditHours}
              </div>
              <div class="mb-3">
                <strong>Grade:</strong> <span class="grade-badge grade-${course.grade}">${course.grade}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <strong>Marks Obtained:</strong> ${course.marks}/${course.maxMarks}
              </div>
              <div class="mb-3">
                <strong>Quality Points:</strong> ${course.qualityPoints.toFixed(2)}
              </div>
              <div class="mb-3">
                <strong>Status:</strong> ${course.isExtraEnrolled ? '<span class="extra-enrolled-badge">Extra Enrolled</span>' : 'Regular'}
              </div>
            </div>
          </div>
          ${course.fullDetails.TeacherName ? `
          <div class="mt-3">
            <strong>Teacher:</strong> ${course.fullDetails.TeacherName}
          </div>
          ` : ''}
          ${course.fullDetails.Mid || course.fullDetails.Final || course.fullDetails.Practical || course.fullDetails.Assignment ? `
          <div class="mt-4">
            <h6>Detailed Marks:</h6>
            <div class="row">
              ${course.fullDetails.Mid ? `<div class="col-6 col-md-3"><strong>Mid:</strong> ${course.fullDetails.Mid}</div>` : ''}
              ${course.fullDetails.Final ? `<div class="col-6 col-md-3"><strong>Final:</strong> ${course.fullDetails.Final}</div>` : ''}
              ${course.fullDetails.Practical ? `<div class="col-6 col-md-3"><strong>Practical:</strong> ${course.fullDetails.Practical}</div>` : ''}
              ${course.fullDetails.Assignment ? `<div class="col-6 col-md-3"><strong>Assignment:</strong> ${course.fullDetails.Assignment}</div>` : ''}
            </div>
          </div>
          ` : ''}
        `;
        
        courseDetailModal.show();
      }
      
      // Display GPA results
      function displayGPAResults(resultData, gpaData) {
        // Update student info
        const firstRecord = resultData[0];
        studentName.textContent = firstRecord.StudentName || 'Student Name';
        studentReg.textContent = firstRecord.RegistrationNo || 'Registration Number';
        
        // Update overall CGPA
        totalCgpa.textContent = gpaData.cgpa.toFixed(4);
        totalPercentage.textContent = `${gpaData.marksPercentage.toFixed(2)}%`;
        
        // Clear previous semester results
        semesterResults.innerHTML = '';
        
        // Create semester cards
        Object.keys(gpaData.semesters).forEach(semesterName => {
          const semester = gpaData.semesters[semesterName];
          
          const semesterCard = document.createElement('div');
          semesterCard.className = 'semester-card';
          semesterCard.id = `semester-${semesterName.replace(/\s+/g, '-').toLowerCase()}`;
          semesterCard.dataset.semesterName = semesterName;
          
          semesterCard.innerHTML = `
            <button class="delete-semester-btn" data-semester="${semesterName}">
              <i class="fa-solid fa-times"></i>
            </button>
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h5 class="mb-0">
                <i class="fa-solid fa-book-open me-2 text-blue-600"></i>
                ${semesterName}
              </h5>
              <div class="text-right">
                <p class="mb-0 text-body-secondary small">GPA:</p>
                <p class="mb-0 h4 fw-bold text-blue-600">${semester.gpa.toFixed(4)}</p>
                <p class="mb-0 text-body-secondary small">${semester.marksPercentage.toFixed(2)}%</p>
              </div>
            </div>
            <div class="table-container">
              <table class="course-table">
                <thead>
                  <tr>
                    <th>Course</th>
                    <th>Hrs</th>
                    <th>Marks</th>
                    <th>Grade</th>
                    <th>GP</th>
                  </tr>
                </thead>
                <tbody>
                  ${semester.courses.map(course => `
                    <tr>
                      <td>
                        <div class="d-flex align-items-center">
                          <span class="fw-medium course-code" style="cursor: pointer;" data-course='${JSON.stringify(course).replace(/'/g, "&#39;")}'>${course.code}</span>
                          ${course.isExtraEnrolled ? '<span class="extra-enrolled-badge">Extra</span>' : ''}
                          <i class="fa-solid fa-info-circle ms-2 text-blue-600 small" title="${course.title}"></i>
                        </div>
                      </td>
                      <td>${course.creditHours}</td>
                      <td>${course.marks}/${course.maxMarks}</td>
                      <td>
                        <span class="grade-badge grade-${course.grade}">${course.grade}</span>
                      </td>
                      <td class="fw-medium text-blue-600">${course.qualityPoints.toFixed(2)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
          
          semesterResults.appendChild(semesterCard);
        });
        
        // Add event listeners to course codes
        document.querySelectorAll('.course-code').forEach(element => {
          element.addEventListener('click', function() {
            const courseData = JSON.parse(this.dataset.course.replace(/&#39;/g, "'"));
            showCourseDetails(courseData);
          });
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-semester-btn').forEach(button => {
          button.addEventListener('click', function() {
            const semesterName = this.dataset.semester;
            deleteSemester(semesterName);
          });
        });
        
        // Show result container
        resultContainer.style.display = 'block';
        gpaResultCard.style.display = 'block';
      }
      
      // Delete a semester
      function deleteSemester(semesterName) {
        if (!currentResultData) return;
        
        // Filter out courses from the deleted semester
        const updatedResultData = currentResultData.filter(course => {
          return formatSemesterName(course.Semester) !== semesterName;
        });
        
        // Update current data
        currentResultData = updatedResultData;
        
        // Recalculate GPA
        const processedData = processResultData(currentResultData);
        currentGPAData = calculateGPA(processedData);
        
        // Update display
        displayGPAResults(currentResultData, currentGPAData);
        
        addStatusMessage(`Deleted semester: ${semesterName}`, 'info');
        showToast(`Semester ${semesterName} deleted`, 'info');
      }
      
      // Recalculate CGPA
      function recalculateCGPA() {
        if (!currentResultData) return;
        
        const processedData = processResultData(currentResultData);
        currentGPAData = calculateGPA(processedData);
        
        // Update display
        displayGPAResults(currentResultData, currentGPAData);
        
        addStatusMessage('Recalculated CGPA based on current semesters', 'info');
        showToast('CGPA recalculated successfully!', 'success');
      }
      
      // Fetch result from UAF LMS
      async function fetchResult() {
        const regNum = registrationNumber.value.trim();
        
        if (!regNum) {
          showToast('Please enter a registration number', 'error');
          return;
        }
        
        // Show loading animation
        loading.style.display = 'block';
        resultContainer.style.display = 'none';
        updateProgress(10, 'Starting Fetch');
        addStatusMessage(`Fetching result for registration number: ${regNum}`, 'info');
        
        try {
          showDownloadAnimation();
          
          const response = await fetch(`${API_ENDPOINTS.scrape}?action=scrape_single&registrationNumber=${encodeURIComponent(regNum)}`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          });
          
          const data = await response.json();
          
          if (data.success) {
            updateProgress(70, 'Processing Data');
            addStatusMessage('Result fetched successfully', 'success');
            
            // Store the raw result data
            currentResultData = data.resultData;
            
            // Process the data (handle duplicates, etc.)
            const processedData = processResultData(currentResultData);
            
            // Calculate GPA
            currentGPAData = calculateGPA(processedData);
            
            // Display the result
            displayGPAResults(currentResultData, currentGPAData);
            
            updateProgress(100, 'Fetch Complete');
            showToast('Result fetched successfully!', 'success');
          } else {
            addStatusMessage(`Error: ${data.message}`, 'error');
            showToast(data.message, 'error');
            updateProgress(100, 'Error');
          }
        } catch (error) {
          addStatusMessage(`Error fetching result: ${error.message}`, 'error');
          showToast('Error fetching result', 'error');
          updateProgress(100, 'Error');
        } finally {
          loading.style.display = 'none';
          hideDownloadAnimation();
          
          // Reset progress after a delay
          setTimeout(() => {
            updateProgress(0, 'Ready');
          }, 2000);
        }
      }
      
      // Event listeners
      resultForm.addEventListener('submit', function(e) {
        e.preventDefault();
        fetchResult();
      });
      
      testConnectionBtn.addEventListener('click', testConnection);
      
      downloadLogBtn.addEventListener('click', downloadLog);
      
      clearLogBtn.addEventListener('click', clearLog);
      
      recalculateBtn.addEventListener('click', recalculateCGPA);
      
      // Initialize the application
      init();
    });
  </script>
</body>
</html>
